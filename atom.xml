<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jeremy&#39;s Blog Site</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-12-04T12:12:46.090Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>JeremyTownes</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>RHEL 7 配置网络绑定</title>
    <link href="http://yoursite.com/2020/01/15/bond/"/>
    <id>http://yoursite.com/2020/01/15/bond/</id>
    <published>2020-01-14T16:00:00.000Z</published>
    <updated>2020-12-04T12:12:46.090Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-常见的网卡绑定驱动模式"><a href="#1-常见的网卡绑定驱动模式" class="headerlink" title="1. 常见的网卡绑定驱动模式:"></a>1. 常见的网卡绑定驱动模式:</h2><blockquote><p>active-backup、balance-tlb 和 balance-alb 模式不需要交换机的任何特殊配置。其他绑定模式需要配置交换机以便整合链接。<br>例如：Cisco 交换机需要在模式 0、2 和 3 中使用 EtherChannel，但在模式 4 中需要 LACP 和 EtherChannel。<br>有关交换机附带文档，请查看 <a href="https://www.kernel.org/doc/Documentation/networking/bonding.txt。" target="_blank" rel="noopener">https://www.kernel.org/doc/Documentation/networking/bonding.txt。</a></p></blockquote><ul><li><strong>balance-rr</strong> 或者 0 — 为容错及负载平衡设定轮询机制。从第一个可用的绑定从属接口开始按顺序接收和发送传输数据。</li><li><strong>active-backup</strong> 或者 1 — 为容错设定 active-backup 策略。 通过第一个可用的绑定从属接口接收和发送传输文件。只有在活动的绑定从属接口失败时才使用其他绑定从属接口。</li><li><strong>balance-xor</strong> 或者 2 — 只根据所选哈希策略传输数据。默认为使用源的 XOR 和目标 MAC 地址与从属接口数的余数相乘生成哈希。在这个模式中，指向具体对等接口的模式流量总是使用同一接口发送。因为目标是由 MAC 地址决定，因此这个方法最适合相同链接或本地网络的对等接口流量。如果流量必须通过单一路由器，那么这个流量平衡模式将是次选模式。</li><li><strong>broadcast</strong> 或者 3 — 为容错设定广播策略。可在所有从属接口中传输所有数据。</li><li><strong>802.3ad</strong> 或者 4 — 设定 IEEE 802.3ad 动态链接聚合策略。创建一个共享同一速度和双工设置的聚合组。在所有活跃聚合器中传输和接受数据。需要兼容 802.3ad 的交换机。</li><li><strong>balance-tlb</strong> 或者 5 — 为容错及负载平衡设定传输负载平衡（TLB）策略。传出流量会根据每个从属接口的当前负载分布。传入流量由当前从属接口接收。如果接收数据从属接口失败，另一个从属接口会接管失败从属接口的 MAC 地址。这个模式只适用于内核绑定模式了解的本地地址，因此无法在桥接后的虚拟机中使用。</li><li><strong>balance-alb</strong> 或者 6 — 为容错及负载平衡设定自适应负载平衡（ALB）策略，包括用于 IPv4 流量的传输及接收负载平衡。使用 ARP 协商获得接收负载平衡。这个模式只适用于内核 binding 模块了解的本地地址，因此无法在桥接后的虚拟机中使用。</li></ul><h2 id="2-主接口及从属接口的默认行为"><a href="#2-主接口及从属接口的默认行为" class="headerlink" title="2. 主接口及从属接口的默认行为"></a>2. 主接口及从属接口的默认行为</h2><p>使用 NetworkManager 守护进程控制绑定的从属接口时，特别是在查找出现问题时，请记住以下几点：</p><ul><li>启动主接口不会自动启动从属接口。</li><li>启动从属接口总是启动主接口。</li><li>停止主接口也可以停止从属接口。</li><li>没有从属接口的主接口可启动静态 IP 连接。</li><li>没有从属接口的主接口会在启动 DHCP 连接时等待从属接口。</li><li>有 DHCP 连接的主接口会在添加有载波的从属接口时等待从属接口完成。</li><li>有 DHCP 连接的主接口会在添加没有载波的从属接口时等待从属接口完成。</li></ul><h2 id="3-使用-NetworkManager-nmcli-工具配置网卡绑定"><a href="#3-使用-NetworkManager-nmcli-工具配置网卡绑定" class="headerlink" title="3. 使用 (NetworkManager) nmcli 工具配置网卡绑定"></a>3. 使用 (NetworkManager) nmcli 工具配置网卡绑定</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmcli con add <span class="built_in">type</span> bond con-name bond0 ifname bond0 mode active-backup</span><br><span class="line">nmcli con add <span class="built_in">type</span> bond-slave ifname enp0s9 master bond0</span><br><span class="line">nmcli con add <span class="built_in">type</span> bond-slave ifname enp0s10 master bond0</span><br></pre></td></tr></table></figure><p>要启动绑定，则必须首先启动从属接口：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmcli c up bond-slave-enp0s9</span><br><span class="line"></span><br><span class="line">nmcli c up bond-slave-enp0s10</span><br></pre></td></tr></table></figure><p>启动绑定：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli c up bond0</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nmcli c modify bond0 ipv4.addresses 192.168.33.32/24</span><br><span class="line">nmcli c modify bond0 ipv4.gateway 192.168.33.1</span><br><span class="line">nmcli c modify bond0 ipv4.dns 192.168.33.1</span><br><span class="line">nmcli c modify bond0 ipv4.method manual</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure><h2 id="3-使用命令行界面配置网卡绑定"><a href="#3-使用命令行界面配置网卡绑定" class="headerlink" title="3. 使用命令行界面配置网卡绑定"></a>3. 使用命令行界面配置网卡绑定</h2><h3 id="检查是否已安装-Bonding-内核模块"><a href="#检查是否已安装-Bonding-内核模块" class="headerlink" title="检查是否已安装 Bonding 内核模块"></a>检查是否已安装 Bonding 内核模块</h3><blockquote><p>在 Red Hat Enterprise Linux 7 中默认载入 bonding 模块。</p></blockquote><p>显示 boding 模块信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modinfo bonding</span><br></pre></td></tr></table></figure><h3 id="Bonding-模块指令"><a href="#Bonding-模块指令" class="headerlink" title="Bonding 模块指令"></a>Bonding 模块指令</h3><p>查看所有现有绑定（包括未启动的绑定），请运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/class/net/bonding_masters</span><br></pre></td></tr></table></figure><p>绑定接口参数</p><ul><li><code>ad_select=value</code> - 指定要使用的 802.3ad 聚合选择逻辑。</li><li><code>arp_interval=time_in_milliseconds</code> - 以毫秒为单位指定 ARP 监控的频繁度。默认将这个数值设定为 0，即禁用该功能。</li><li><code>arp_ip_target=ip_address[,ip_address_2,…ip_address_16]</code> - 启用 arp_interval 参数后，指定 ARP 请求的目标 IP 地址。在使用逗号分开的列表中最多可指定 16 个 IP 地址。</li><li><code>arp_validate=value</code> - 验证 ARP 探测的源/分配，默认为 none。其他值为 active、backup 和 all。</li><li><code>downdelay=time_in_milliseconds</code> - 以毫秒为单位指定从链接失败到禁用该链接前要等待的时间。该值必须是 miimon 参数中的多个数值。默认将其设定为 0，即禁用该功能。</li><li><code>fail_over_mac=value</code> - 指定 active-backup 模式是否应该将所有从属连接设定为使用同一 MAC 地址作为 enslavement（传统行为），或在启用时根据所选策略执行绑定 MAC 地址的特殊处理。</li><li><code>lacp_rate=value</code> - 指定链接伙伴应使用 802.3ad 模式传输 LACPDU 的速率</li><li><code>miimon=time_in_milliseconds</code> - 以毫秒为单位指定 MII 链接监控的频率。</li><li><code>mode=value</code> - 允许您指定绑定的策略。</li><li><code>primary=interface_name</code> - 指定主设备的接口名称，比如 eth0。</li><li><code>primary_reselect=value</code> - 为主从属接口指定重新选择策略。</li><li><code>resend_igmp=range</code> - 指定故障转移事件后要进行的 IGMP 成员报告数。故障转移后会立即提交一个报告，之后会每隔 200 毫秒发送数据包。</li><li><code>updelay=time_in_milliseconds</code> - 以毫秒为单位指定启用某个链接前要等待的时间。该数值必须是在 miimon 参数值指定值的倍数。默认设定为 0，即禁用该参数。</li><li><code>use_carrier=number</code> - 指定 miimon 是否应该使用 MII/ETHTOOL ioctls 或者 netif_carrier_ok() 来决定该链接状态。</li><li><code>xmit_hash_policy=value</code> - 选择 balance-xor 和 802.3ad 模式中用来选择从属接口的传输哈希策略。</li></ul><h3 id="创建频道绑定接口"><a href="#创建频道绑定接口" class="headerlink" title="创建频道绑定接口"></a>创建频道绑定接口</h3><blockquote><p>必须在 <code>ifcfg-bondN</code> 接口文件的 <code>BONDING_OPTS=&quot;bonding parameters separated by spaces&quot;</code> 指令中，使用以空格分开的列表指定 bonding 内核模块。<br>请不要在 <code>/etc/modprobe.d/bonding.conf</code> 文件或弃用的 <code>/etc/modprobe.conf</code> 文件中为绑定设备指定选项。<br><code>max_bonds</code> 参数不是具体接口的参数，且不应在使用 <code>BONDING_OPTS</code> 指令的 <code>ifcfg-bondN</code> 文件中设定，因为这个指令会让网络脚本根据需要创建绑定接口。</p></blockquote><p>在 /etc/sysconfig/network-scripts/ 目录中创建名为 ifcfg-bondN 的文件，使用接口号码替换 N，比如 0。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; /etc/sysconfig/network-scripts/ifcfg-bond0</span><br><span class="line">DEVICE=bond0</span><br><span class="line">NAME=bond0</span><br><span class="line">TYPE=Bond</span><br><span class="line">BONDING_MASTER=yes</span><br><span class="line">IPADDR=192.168.33.32</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.33.1</span><br><span class="line">DNS1=192.168.33.1</span><br><span class="line">ONBOOT=yes</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">BONDING_OPTS=<span class="string">"miimon=1000 mode=1 primary=enp0s9"</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="创建从属接口"><a href="#创建从属接口" class="headerlink" title="创建从属接口"></a>创建从属接口</h3><p>在 /etc/sysconfig/network-scripts/ 目录中创建名为 ifcfg-ethN 的文件，使用接口号码替换 N，比如 0。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; /etc/sysconfig/network-scripts/ifcfg-enp0s9</span><br><span class="line">DEVICE=enp0s9</span><br><span class="line">NAME=bond0-slave-enp0s9</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">ONBOOT=yes</span><br><span class="line">MASTER=bond0</span><br><span class="line">SLAVE=yes</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; /etc/sysconfig/network-scripts/ifcfg-enp0s10</span><br><span class="line">DEVICE=enp0s10</span><br><span class="line">NAME=bond0-slave-enp0s10</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">ONBOOT=yes</span><br><span class="line">MASTER=bond0</span><br><span class="line">SLAVE=yes</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="激活频道绑定"><a href="#激活频道绑定" class="headerlink" title="激活频道绑定"></a>激活频道绑定</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ifup bond0</span><br><span class="line">ifup ifcfg-enp0s9</span><br><span class="line">ifup ifcfg-enp0s10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生效更改</span></span><br><span class="line">nmcli con load /etc/sysconfig/network-script/ifcfg-device</span><br><span class="line">nmcli con reload</span><br><span class="line"><span class="comment"># 查看网卡绑定接口状态</span></span><br><span class="line">ip link show</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;1-常见的网卡绑定驱动模式&quot;&gt;&lt;a href=&quot;#1-常见的网卡绑定驱动模式&quot; class=&quot;headerlink&quot; title=&quot;1. 常见的网卡绑定驱动模式:&quot;&gt;&lt;/a&gt;1. 常见的网卡绑定驱动模式:&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;active-ba
      
    
    </summary>
    
    
      <category term="linux" scheme="http://yoursite.com/categories/linux/"/>
    
    
      <category term="nmcli" scheme="http://yoursite.com/tags/nmcli/"/>
    
  </entry>
  
  <entry>
    <title>RHEL 7 配置网络成组</title>
    <link href="http://yoursite.com/2020/01/15/team/"/>
    <id>http://yoursite.com/2020/01/15/team/</id>
    <published>2020-01-14T16:00:00.000Z</published>
    <updated>2020-12-04T11:57:26.676Z</updated>
    
    <content type="html"><![CDATA[<h2 id="网络成组和绑定对比"><a href="#网络成组和绑定对比" class="headerlink" title="网络成组和绑定对比"></a>网络成组和绑定对比</h2><p><img src="/resources/linuxbond/bond&team.png" alt=""></p><h2 id="安装-teamd"><a href="#安装-teamd" class="headerlink" title="安装 teamd"></a>安装 teamd</h2><p>默认不会安装网络成组守护进程 teamd。要安装 teamd</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install teamd</span><br></pre></td></tr></table></figure><h2 id="将绑定转换为成组"><a href="#将绑定转换为成组" class="headerlink" title="将绑定转换为成组"></a>将绑定转换为成组</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bond2team --examples</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">The following commands will deliver the ifcfg files into a temporary</span><br><span class="line">directory. You can review the files and copy to the right location.</span><br><span class="line"></span><br><span class="line">Add the following argument to the commands below to print the output</span><br><span class="line">to the screen instead of writing to files.</span><br><span class="line">  --stdout</span><br><span class="line"></span><br><span class="line">Add the following arguments to the commands below to set the</span><br><span class="line">destination directory for the output files.</span><br><span class="line">  --outputdir &lt;&#x2F;path&#x2F;to&#x2F;dir&gt;</span><br><span class="line"></span><br><span class="line">Add the following argument to the commands below to output the</span><br><span class="line">files in teamd format (JSON) instead of the default ifcfg format.</span><br><span class="line">  --json</span><br><span class="line"></span><br><span class="line">To convert the current &quot;bond0&quot; ifcfg configuration to team ifcfg:</span><br><span class="line"># &#x2F;usr&#x2F;bin&#x2F;bond2team --master bond0</span><br><span class="line"></span><br><span class="line">To convert the current &quot;bond0&quot; ifcfg configuration out of the</span><br><span class="line">standard ifcfg-:</span><br><span class="line"># &#x2F;usr&#x2F;bin&#x2F;bond2team --master bond0 --configdir &lt;&#x2F;path&#x2F;to&#x2F;ifcfg&gt;</span><br><span class="line"></span><br><span class="line">To convert the current &quot;bond0&quot; ifcfg configuration to team ifcfg</span><br><span class="line">renaming the interface name to &quot;team0&quot;. (carefull: firewall rules,</span><br><span class="line">aliases interfaces, etc., will break after the renaming because the</span><br><span class="line">tool will only change the ifcfg file, nothing else)</span><br><span class="line"># &#x2F;usr&#x2F;bin&#x2F;bond2team --master bond0 --rename team0</span><br><span class="line"></span><br><span class="line">To convert given bonding parameters without any ifcfg:</span><br><span class="line"># &#x2F;usr&#x2F;bin&#x2F;bond2team --bonding_opts &quot;mode&#x3D;1 miimon&#x3D;500&quot;</span><br><span class="line"></span><br><span class="line">To convert given bonding parameters without any ifcfg with ports:</span><br><span class="line"># &#x2F;usr&#x2F;bin&#x2F;bond2team --bonding_opts &quot;mode&#x3D;1 miimon&#x3D;500 primary&#x3D;eth1 primary_reselect-0&quot; \</span><br><span class="line">     --port eth1 --port eth2 --port eth3 --port eth4</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 保留名称</span></span><br><span class="line">/usr/bin/bond2team --master bond0</span><br><span class="line"></span><br><span class="line">Resulted files:</span><br><span class="line">  /tmp/bond2team.j8PiKA/ifcfg-bond0</span><br><span class="line">  /tmp/bond2team.j8PiKA/ifcfg-enp0s10</span><br><span class="line">  /tmp/bond2team.j8PiKA/ifcfg-enp0s9</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用新名称保存该配置</span></span><br><span class="line"><span class="comment"># 添加 --json 选项输出 JSON 格式文件</span></span><br><span class="line">/usr/bin/bond2team --master bond0 --rename team0</span><br><span class="line"></span><br><span class="line">Resulted files:</span><br><span class="line">  /tmp/bond2team.vwCjgt/ifcfg-team0</span><br><span class="line">  /tmp/bond2team.vwCjgt/ifcfg-enp0s10</span><br><span class="line">  /tmp/bond2team.vwCjgt/ifcfg-enp0s9</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将绑定转换为成组并指定文件路径</span></span><br><span class="line"><span class="comment"># 添加 --json 选项输出 JSON 格式文件</span></span><br><span class="line">/usr/bin/bond2team --master bond0 --configdir /etc/sysconfig/network-scripts/</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;网络成组和绑定对比&quot;&gt;&lt;a href=&quot;#网络成组和绑定对比&quot; class=&quot;headerlink&quot; title=&quot;网络成组和绑定对比&quot;&gt;&lt;/a&gt;网络成组和绑定对比&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/resources/linuxbond/bond&amp;team.p
      
    
    </summary>
    
    
      <category term="linux" scheme="http://yoursite.com/categories/linux/"/>
    
    
      <category term="nmcli" scheme="http://yoursite.com/tags/nmcli/"/>
    
  </entry>
  
  <entry>
    <title>Journald 指南</title>
    <link href="http://yoursite.com/2019/12/31/journald/"/>
    <id>http://yoursite.com/2019/12/31/journald/</id>
    <published>2019-12-30T16:00:00.000Z</published>
    <updated>2020-12-04T12:18:40.780Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-journald-服务"><a href="#1-journald-服务" class="headerlink" title="1. journald 服务"></a>1. journald 服务</h3><ul><li>systemd-journald 是一项收集和存储日志记录数据的系统服务。它基于从各种来源接收到的日志记录信息来创建和维护结构化, 已索引的日志：<ul><li>通过 kmsg 的内核日志消息</li><li>通过 libc syslog 调用的简单系统日志消息</li><li>通过本机的结构化系统日志消息日志API</li><li>系统服务的标准输出和标准错误</li><li>通过审核子系统的审核记录守护程序将以安全且可靠的方式隐式收集每个日志消息的大量元数据段</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]<span class="comment"># systemctl status systemd-journald.service</span></span><br><span class="line">● systemd-journald.service - Journal Service</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/systemd-journald.service; static; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 三 2020-01-01 06:31:55 CST; 47min ago</span><br><span class="line">     Docs: man:systemd-journald.service(8)</span><br><span class="line">           man:journald.conf(5)</span><br><span class="line"> Main PID: 515 (systemd-journal)</span><br><span class="line">   Status: <span class="string">"Processing requests..."</span></span><br><span class="line">   CGroup: /system.slice/systemd-journald.service</span><br><span class="line">           └─515 /usr/lib/systemd/systemd-journald</span><br><span class="line"></span><br><span class="line">1月 01 06:31:55 ldap.example.com systemd-journal[515]: Runtime journal is using 6.1M (max …M).</span><br><span class="line">1月 01 06:31:55 ldap.example.com systemd-journal[515]: Journal started</span><br><span class="line">1月 01 06:31:55 ldap.example.com systemd-journal[515]: Permanent journal is using 16.0M (m…G).</span><br><span class="line">1月 01 06:31:55 ldap.example.com systemd-journal[515]: Time spent on flushing to /var is 7....</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show <span class="keyword">in</span> full.</span><br></pre></td></tr></table></figure><ul><li>systemd-journald.service 文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]<span class="comment"># cat /usr/lib/systemd/system/systemd-journald.service</span></span><br><span class="line"><span class="comment">#  This file is part of systemd.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  systemd is free software; you can redistribute it and/or modify it</span></span><br><span class="line"><span class="comment">#  under the terms of the GNU Lesser General Public License as published by</span></span><br><span class="line"><span class="comment">#  the Free Software Foundation; either version 2.1 of the License, or</span></span><br><span class="line"><span class="comment">#  (at your option) any later version.</span></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Journal Service</span><br><span class="line">Documentation=man:systemd-journald.service(8) man:journald.conf(5)</span><br><span class="line">DefaultDependencies=no</span><br><span class="line">Requires=systemd-journald.socket</span><br><span class="line">After=systemd-journald.socket syslog.socket</span><br><span class="line">Before=sysinit.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">Sockets=systemd-journald.socket</span><br><span class="line">ExecStart=/usr/lib/systemd/systemd-journald</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=0</span><br><span class="line">StandardOutput=null</span><br><span class="line">FileDescriptorStoreMax=4224</span><br><span class="line">CapabilityBoundingSet=CAP_SYS_ADMIN CAP_DAC_OVERRIDE CAP_SYS_PTRACE CAP_SYSLOG CAP_AUDIT_CONTROL CAP_AUDIT_READ CAP_CHOWN CAP_DAC_READ_SEARCH CAP_FOWNER CAP_SETUID CAP_SETGID CAP_MAC_OVERRIDE</span><br><span class="line">WatchdogSec=3min</span><br><span class="line"></span><br><span class="line"><span class="comment"># Increase the default a bit in order to allow many simultaneous</span></span><br><span class="line"><span class="comment"># services being run since we keep one fd open per service. Also, when</span></span><br><span class="line"><span class="comment"># flushing journal files to disk, we might need a lot of fds when many</span></span><br><span class="line"><span class="comment"># journal files are combined.</span></span><br><span class="line">LimitNOFILE=16384</span><br></pre></td></tr></table></figure><ul><li>默认 journald 配置文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]<span class="comment"># cat /etc/systemd/journald.conf</span></span><br><span class="line"><span class="comment">#  This file is part of systemd.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  systemd is free software; you can redistribute it and/or modify it</span></span><br><span class="line"><span class="comment">#  under the terms of the GNU Lesser General Public License as published by</span></span><br><span class="line"><span class="comment">#  the Free Software Foundation; either version 2.1 of the License, or</span></span><br><span class="line"><span class="comment">#  (at your option) any later version.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Entries in this file show the compile time defaults.</span></span><br><span class="line"><span class="comment"># You can change settings by editing this file.</span></span><br><span class="line"><span class="comment"># Defaults can be restored by simply deleting this file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See journald.conf(5) for details.</span></span><br><span class="line"></span><br><span class="line">[Journal]</span><br><span class="line"><span class="comment">#Storage=auto</span></span><br><span class="line"><span class="comment">#Compress=yes</span></span><br><span class="line"><span class="comment">#Seal=yes</span></span><br><span class="line"><span class="comment">#SplitMode=uid</span></span><br><span class="line"><span class="comment">#SyncIntervalSec=5m</span></span><br><span class="line"><span class="comment">#RateLimitInterval=30s</span></span><br><span class="line"><span class="comment">#RateLimitBurst=1000</span></span><br><span class="line"><span class="comment">#SystemMaxUse=</span></span><br><span class="line"><span class="comment">#SystemKeepFree=</span></span><br><span class="line"><span class="comment">#SystemMaxFileSize=</span></span><br><span class="line"><span class="comment">#RuntimeMaxUse=</span></span><br><span class="line"><span class="comment">#RuntimeKeepFree=</span></span><br><span class="line"><span class="comment">#RuntimeMaxFileSize=</span></span><br><span class="line"><span class="comment">#MaxRetentionSec=</span></span><br><span class="line"><span class="comment">#MaxFileSec=1month</span></span><br><span class="line"><span class="comment">#ForwardToSyslog=yes</span></span><br><span class="line"><span class="comment">#ForwardToKMsg=no</span></span><br><span class="line"><span class="comment">#ForwardToConsole=no</span></span><br><span class="line"><span class="comment">#ForwardToWall=yes</span></span><br><span class="line"><span class="comment">#TTYPath=/dev/console</span></span><br><span class="line"><span class="comment">#MaxLevelStore=debug</span></span><br><span class="line"><span class="comment">#MaxLevelSyslog=debug</span></span><br><span class="line"><span class="comment">#MaxLevelKMsg=notice</span></span><br><span class="line"><span class="comment">#MaxLevelConsole=info</span></span><br><span class="line"><span class="comment">#MaxLevelWall=emerg</span></span><br><span class="line"><span class="comment">#LineMax=48K</span></span><br></pre></td></tr></table></figure><h3 id="2-journald-日志持久化"><a href="#2-journald-日志持久化" class="headerlink" title="2. journald 日志持久化"></a>2. journald 日志持久化</h3><p>默认情况下，日志将日志数据存储在 /run/log/journal/. 中。由于 /run/ 是易失性的，因此日志数据在重新引导时会丢失。要使数据持久化，只需创建 /var/log/journal/，然后systemd-journald将在其中存储数据：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]<span class="comment"># mkdir -p /var/log/journal </span></span><br><span class="line">[root@nginx ~]<span class="comment"># systemd-tmpfiles --create --prefix /var/log/journal</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]<span class="comment"># mkdir /etc/systemd/journald.conf.d</span></span><br><span class="line">[root@nginx ~]<span class="comment"># cat &gt; /etc/systemd/journald.conf.d/99-prophet.conf &lt;&lt;EOF</span></span><br><span class="line">[Journal]</span><br><span class="line"><span class="comment"># 持久化保存到磁盘</span></span><br><span class="line">Storage=persistent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩历史日志</span></span><br><span class="line">Compress=yes</span><br><span class="line"></span><br><span class="line">SyncIntervalSec=5m</span><br><span class="line">RateLimitInterval=30s</span><br><span class="line">RateLimitBurst=1000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最大占用空间 10G</span></span><br><span class="line">SystemMaxUse=10G</span><br><span class="line"></span><br><span class="line"><span class="comment"># 单日志文件最大 200M</span></span><br><span class="line">SystemMaxFileSize=200M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志保存时间 2 周</span></span><br><span class="line">MaxRetentionSec=2week</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不将日志转发到 syslog</span></span><br><span class="line">ForwardToSyslog=no</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">[root@nginx ~]<span class="comment"># systemctl restart systemd-journald</span></span><br></pre></td></tr></table></figure><h3 id="3-journalctl-管理工具"><a href="#3-journalctl-管理工具" class="headerlink" title="3. journalctl 管理工具"></a>3. journalctl 管理工具</h3><blockquote><p>journalctl 是用来查询由 systemd-journald 服务收集的 systemd 日志，当它不接收任何参数则会最早的收集入口展示日志</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]<span class="comment"># journalctl --help</span></span><br><span class="line">journalctl [OPTIONS...] [MATCHES...]</span><br><span class="line"></span><br><span class="line">Query the journal.</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">     --system              展示系统日志</span><br><span class="line">     --user                展示当前用户的用户日志</span><br><span class="line">  -M --machine=CONTAINER   Operate on <span class="built_in">local</span> container</span><br><span class="line">  -S --since=DATE          展示从指定日期 [%Y-%m-%d %H:%M:%S] 开始的日志</span><br><span class="line">  -U --until=DATE          展示到指定日期 [%Y-%m-%d %H:%M:%S] 为止的日志</span><br><span class="line">  -c --cursor=CURSOR       Show entries starting at the specified cursor</span><br><span class="line">     --after-cursor=CURSOR Show entries after the specified cursor</span><br><span class="line">     --show-cursor         Print the cursor after all the entries</span><br><span class="line">  -b --boot[=ID]           Show current boot or the specified boot</span><br><span class="line">     --list-boots          Show terse information about recorded boots</span><br><span class="line">  -k --dmesg               展示当前启动的内核日志</span><br><span class="line">  -u --unit=UNIT           展示指定 unit [nginx, httpd ...] 的日志</span><br><span class="line">  -t --identifier=STRING   Show entries with the specified syslog identifier</span><br><span class="line">  -p --priority=RANGE      Show entries with the specified priority</span><br><span class="line">  -e --pager-end           Immediately jump to the end <span class="keyword">in</span> the pager</span><br><span class="line">  -f --follow              Follow the journal</span><br><span class="line">  -n --lines[=INTEGER]     Number of journal entries to show</span><br><span class="line">     --no-tail             Show all lines, even <span class="keyword">in</span> follow mode</span><br><span class="line">  -r --reverse             Show the newest entries first</span><br><span class="line">  -o --output=STRING       Change journal output mode (short, short-iso,</span><br><span class="line">                                   short-precise, short-monotonic, verbose,</span><br><span class="line">                                   <span class="built_in">export</span>, json, json-pretty, json-sse, cat)</span><br><span class="line">     --utc                 Express time <span class="keyword">in</span> Coordinated Universal Time (UTC)</span><br><span class="line">  -x --catalog             Add message explanations <span class="built_in">where</span> available</span><br><span class="line">     --no-full             Ellipsize fields</span><br><span class="line">  -a --all                 Show all fields, including long and unprintable</span><br><span class="line">  -q --quiet               Do not show privilege warning</span><br><span class="line">     --no-pager            Do not pipe output into a pager</span><br><span class="line">  -m --merge               Show entries from all available journals</span><br><span class="line">  -D --directory=PATH      展示指定目录下的日志文件的日志</span><br><span class="line">     --file=PATH           展示指定日志文件中的日志</span><br><span class="line">     --root=ROOT           Operate on catalog files underneath the root ROOT</span><br><span class="line">     --interval=TIME       Time interval <span class="keyword">for</span> changing the FSS sealing key</span><br><span class="line">     --verify-key=KEY      Specify FSS verification key</span><br><span class="line">     --force               Override of the FSS key pair with --setup-keys</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  -h --<span class="built_in">help</span>                Show this <span class="built_in">help</span> text</span><br><span class="line">     --version             Show package version</span><br><span class="line">  -F --field=FIELD         List all values that a specified field takes</span><br><span class="line">     --new-id128           Generate a new 128-bit ID</span><br><span class="line">     --disk-usage          Show total disk usage of all journal files</span><br><span class="line">     --vacuum-size=BYTES   Reduce disk usage below specified size</span><br><span class="line">     --vacuum-time=TIME    Remove journal files older than specified date</span><br><span class="line">     --flush               Flush all journal data from /run into /var</span><br><span class="line">     --header              Show journal header information</span><br><span class="line">     --list-catalog        Show all message IDs <span class="keyword">in</span> the catalog</span><br><span class="line">     --dump-catalog        Show entries <span class="keyword">in</span> the message catalog</span><br><span class="line">     --update-catalog      Update the message catalog database</span><br><span class="line">     --setup-keys          Generate a new FSS key pair</span><br><span class="line">     --verify              Verify journal file consistency</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;1-journald-服务&quot;&gt;&lt;a href=&quot;#1-journald-服务&quot; class=&quot;headerlink&quot; title=&quot;1. journald 服务&quot;&gt;&lt;/a&gt;1. journald 服务&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;systemd-journald 是
      
    
    </summary>
    
    
      <category term="linux" scheme="http://yoursite.com/categories/linux/"/>
    
    
      <category term="systemd" scheme="http://yoursite.com/tags/systemd/"/>
    
  </entry>
  
  <entry>
    <title>Nginx 安装与配置</title>
    <link href="http://yoursite.com/2019/12/31/nginx/"/>
    <id>http://yoursite.com/2019/12/31/nginx/</id>
    <published>2019-12-30T16:00:00.000Z</published>
    <updated>2020-12-04T12:21:29.167Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Nginx-安装"><a href="#Nginx-安装" class="headerlink" title="Nginx 安装"></a>Nginx 安装</h2><h3 id="1-yum-源安装"><a href="#1-yum-源安装" class="headerlink" title="1. yum 源安装"></a>1. yum 源安装</h3><ul><li>epel 源</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum -y install epel-release</span><br><span class="line">yum makecache</span><br><span class="line">yum -y install nginx</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> nginx &amp;&amp; systemctl start nginx</span><br></pre></td></tr></table></figure><ul><li>nginx 官方源<br><a href="http://nginx.org/en/linux_packages.html#RHEL-CentOS" target="_blank" rel="noopener">http://nginx.org/en/linux_packages.html#RHEL-CentOS</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">yum install yum-utils</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &lt; EOF &gt; /etc/yum.repos.d/nginx.repo</span><br><span class="line">[nginx-stable]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[nginx-mainline]</span><br><span class="line">name=nginx mainline repo</span><br><span class="line">baseurl=http://nginx.org/packages/mainline/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=<span class="literal">true</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">yum-config-manager --<span class="built_in">enable</span> nginx-stable</span><br><span class="line">yum-config-manager --<span class="built_in">enable</span> nginx-mainline</span><br><span class="line"></span><br><span class="line">yum makecache</span><br><span class="line">yum install nginx</span><br><span class="line">systemctl <span class="built_in">enable</span> nginx &amp;&amp; systemctl start nginx</span><br></pre></td></tr></table></figure><h3 id="2-源码编译安装"><a href="#2-源码编译安装" class="headerlink" title="2. 源码编译安装"></a>2. 源码编译安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx nginx-1.16.1]<span class="comment"># yum -y install gcc pcre-devel zlib-devel</span></span><br></pre></td></tr></table></figure><p>下载 nginx 源码<a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">http://nginx.org/en/download.html</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]<span class="comment"># wget http://nginx.org/download/nginx-1.16.1.tar.gz</span></span><br><span class="line">[root@nginx ~]<span class="comment"># tar -zxvf nginx-1.16.1.tar.gz</span></span><br><span class="line">[root@nginx ~]<span class="comment"># cd nginx-1.16.1</span></span><br></pre></td></tr></table></figure><ul><li>configure 参数</li></ul><blockquote><p>根据需求设置编译参数</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx nginx-1.16.1]<span class="comment"># ./configure --help</span></span><br><span class="line"></span><br><span class="line">  --<span class="built_in">help</span>                             <span class="built_in">print</span> this message</span><br><span class="line"></span><br><span class="line">  --prefix=PATH                      <span class="built_in">set</span> installation prefix</span><br><span class="line">  --sbin-path=PATH                   <span class="built_in">set</span> nginx binary pathname</span><br><span class="line">  --modules-path=PATH                <span class="built_in">set</span> modules path</span><br><span class="line">  --conf-path=PATH                   <span class="built_in">set</span> nginx.conf pathname</span><br><span class="line">  --error-log-path=PATH              <span class="built_in">set</span> error <span class="built_in">log</span> pathname</span><br><span class="line">  --pid-path=PATH                    <span class="built_in">set</span> nginx.pid pathname</span><br><span class="line">  --lock-path=PATH                   <span class="built_in">set</span> nginx.lock pathname</span><br><span class="line"></span><br><span class="line">  --user=USER                        <span class="built_in">set</span> non-privileged user <span class="keyword">for</span></span><br><span class="line">                                     worker processes</span><br><span class="line">  --group=GROUP                      <span class="built_in">set</span> non-privileged group <span class="keyword">for</span></span><br><span class="line">                                     worker processes</span><br><span class="line"></span><br><span class="line">  --build=NAME                       <span class="built_in">set</span> build name</span><br><span class="line">  --builddir=DIR                     <span class="built_in">set</span> build directory</span><br><span class="line"></span><br><span class="line">  --with-select_module               <span class="built_in">enable</span> select module</span><br><span class="line">  --without-select_module            <span class="built_in">disable</span> select module</span><br><span class="line">  --with-poll_module                 <span class="built_in">enable</span> poll module</span><br><span class="line">  --without-poll_module              <span class="built_in">disable</span> poll module</span><br><span class="line"></span><br><span class="line">  --with-threads                     <span class="built_in">enable</span> thread pool support</span><br><span class="line"></span><br><span class="line">  --with-file-aio                    <span class="built_in">enable</span> file AIO support</span><br><span class="line"></span><br><span class="line">  --with-http_ssl_module             <span class="built_in">enable</span> ngx_http_ssl_module</span><br><span class="line">  --with-http_v2_module              <span class="built_in">enable</span> ngx_http_v2_module</span><br><span class="line">  --with-http_realip_module          <span class="built_in">enable</span> ngx_http_realip_module</span><br><span class="line">  --with-http_addition_module        <span class="built_in">enable</span> ngx_http_addition_module</span><br><span class="line">  --with-http_xslt_module            <span class="built_in">enable</span> ngx_http_xslt_module</span><br><span class="line">  --with-http_xslt_module=dynamic    <span class="built_in">enable</span> dynamic ngx_http_xslt_module</span><br><span class="line">  --with-http_image_filter_module    <span class="built_in">enable</span> ngx_http_image_filter_module</span><br><span class="line">  --with-http_image_filter_module=dynamic</span><br><span class="line">                                     <span class="built_in">enable</span> dynamic ngx_http_image_filter_module</span><br><span class="line">  --with-http_geoip_module           <span class="built_in">enable</span> ngx_http_geoip_module</span><br><span class="line">  --with-http_geoip_module=dynamic   <span class="built_in">enable</span> dynamic ngx_http_geoip_module</span><br><span class="line">  --with-http_sub_module             <span class="built_in">enable</span> ngx_http_sub_module</span><br><span class="line">  --with-http_dav_module             <span class="built_in">enable</span> ngx_http_dav_module</span><br><span class="line">  --with-http_flv_module             <span class="built_in">enable</span> ngx_http_flv_module</span><br><span class="line">  --with-http_mp4_module             <span class="built_in">enable</span> ngx_http_mp4_module</span><br><span class="line">  --with-http_gunzip_module          <span class="built_in">enable</span> ngx_http_gunzip_module</span><br><span class="line">  --with-http_gzip_static_module     <span class="built_in">enable</span> ngx_http_gzip_static_module</span><br><span class="line">  --with-http_auth_request_module    <span class="built_in">enable</span> ngx_http_auth_request_module</span><br><span class="line">  --with-http_random_index_module    <span class="built_in">enable</span> ngx_http_random_index_module</span><br><span class="line">  --with-http_secure_link_module     <span class="built_in">enable</span> ngx_http_secure_link_module</span><br><span class="line">  --with-http_degradation_module     <span class="built_in">enable</span> ngx_http_degradation_module</span><br><span class="line">  --with-http_slice_module           <span class="built_in">enable</span> ngx_http_slice_module</span><br><span class="line">  --with-http_stub_status_module     <span class="built_in">enable</span> ngx_http_stub_status_module</span><br><span class="line"></span><br><span class="line">  --without-http_charset_module      <span class="built_in">disable</span> ngx_http_charset_module</span><br><span class="line">  --without-http_gzip_module         <span class="built_in">disable</span> ngx_http_gzip_module</span><br><span class="line">  --without-http_ssi_module          <span class="built_in">disable</span> ngx_http_ssi_module</span><br><span class="line">  --without-http_userid_module       <span class="built_in">disable</span> ngx_http_userid_module</span><br><span class="line">  --without-http_access_module       <span class="built_in">disable</span> ngx_http_access_module</span><br><span class="line">  --without-http_auth_basic_module   <span class="built_in">disable</span> ngx_http_auth_basic_module</span><br><span class="line">  --without-http_mirror_module       <span class="built_in">disable</span> ngx_http_mirror_module</span><br><span class="line">  --without-http_autoindex_module    <span class="built_in">disable</span> ngx_http_autoindex_module</span><br><span class="line">  --without-http_geo_module          <span class="built_in">disable</span> ngx_http_geo_module</span><br><span class="line">  --without-http_map_module          <span class="built_in">disable</span> ngx_http_map_module</span><br><span class="line">  --without-http_split_clients_module <span class="built_in">disable</span> ngx_http_split_clients_module</span><br><span class="line">  --without-http_referer_module      <span class="built_in">disable</span> ngx_http_referer_module</span><br><span class="line">  --without-http_rewrite_module      <span class="built_in">disable</span> ngx_http_rewrite_module</span><br><span class="line">  --without-http_proxy_module        <span class="built_in">disable</span> ngx_http_proxy_module</span><br><span class="line">  --without-http_fastcgi_module      <span class="built_in">disable</span> ngx_http_fastcgi_module</span><br><span class="line">  --without-http_uwsgi_module        <span class="built_in">disable</span> ngx_http_uwsgi_module</span><br><span class="line">  --without-http_scgi_module         <span class="built_in">disable</span> ngx_http_scgi_module</span><br><span class="line">  --without-http_grpc_module         <span class="built_in">disable</span> ngx_http_grpc_module</span><br><span class="line">  --without-http_memcached_module    <span class="built_in">disable</span> ngx_http_memcached_module</span><br><span class="line">  --without-http_limit_conn_module   <span class="built_in">disable</span> ngx_http_limit_conn_module</span><br><span class="line">  --without-http_limit_req_module    <span class="built_in">disable</span> ngx_http_limit_req_module</span><br><span class="line">  --without-http_empty_gif_module    <span class="built_in">disable</span> ngx_http_empty_gif_module</span><br><span class="line">  --without-http_browser_module      <span class="built_in">disable</span> ngx_http_browser_module</span><br><span class="line">  --without-http_upstream_hash_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_http_upstream_hash_module</span><br><span class="line">  --without-http_upstream_ip_hash_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_http_upstream_ip_hash_module</span><br><span class="line">  --without-http_upstream_least_conn_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_http_upstream_least_conn_module</span><br><span class="line">  --without-http_upstream_random_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_http_upstream_random_module</span><br><span class="line">  --without-http_upstream_keepalive_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_http_upstream_keepalive_module</span><br><span class="line">  --without-http_upstream_zone_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_http_upstream_zone_module</span><br><span class="line"></span><br><span class="line">  --with-http_perl_module            <span class="built_in">enable</span> ngx_http_perl_module</span><br><span class="line">  --with-http_perl_module=dynamic    <span class="built_in">enable</span> dynamic ngx_http_perl_module</span><br><span class="line">  --with-perl_modules_path=PATH      <span class="built_in">set</span> Perl modules path</span><br><span class="line">  --with-perl=PATH                   <span class="built_in">set</span> perl binary pathname</span><br><span class="line"></span><br><span class="line">  --http-log-path=PATH               <span class="built_in">set</span> http access <span class="built_in">log</span> pathname</span><br><span class="line">  --http-client-body-temp-path=PATH  <span class="built_in">set</span> path to store</span><br><span class="line">                                     http client request body temporary files</span><br><span class="line">  --http-proxy-temp-path=PATH        <span class="built_in">set</span> path to store</span><br><span class="line">                                     http proxy temporary files</span><br><span class="line">  --http-fastcgi-temp-path=PATH      <span class="built_in">set</span> path to store</span><br><span class="line">                                     http fastcgi temporary files</span><br><span class="line">  --http-uwsgi-temp-path=PATH        <span class="built_in">set</span> path to store</span><br><span class="line">                                     http uwsgi temporary files</span><br><span class="line">  --http-scgi-temp-path=PATH         <span class="built_in">set</span> path to store</span><br><span class="line">                                     http scgi temporary files</span><br><span class="line"></span><br><span class="line">  --without-http                     <span class="built_in">disable</span> HTTP server</span><br><span class="line">  --without-http-cache               <span class="built_in">disable</span> HTTP cache</span><br><span class="line"></span><br><span class="line">  --with-mail                        <span class="built_in">enable</span> POP3/IMAP4/SMTP proxy module</span><br><span class="line">  --with-mail=dynamic                <span class="built_in">enable</span> dynamic POP3/IMAP4/SMTP proxy module</span><br><span class="line">  --with-mail_ssl_module             <span class="built_in">enable</span> ngx_mail_ssl_module</span><br><span class="line">  --without-mail_pop3_module         <span class="built_in">disable</span> ngx_mail_pop3_module</span><br><span class="line">  --without-mail_imap_module         <span class="built_in">disable</span> ngx_mail_imap_module</span><br><span class="line">  --without-mail_smtp_module         <span class="built_in">disable</span> ngx_mail_smtp_module</span><br><span class="line"></span><br><span class="line">  --with-stream                      <span class="built_in">enable</span> TCP/UDP proxy module</span><br><span class="line">  --with-stream=dynamic              <span class="built_in">enable</span> dynamic TCP/UDP proxy module</span><br><span class="line">  --with-stream_ssl_module           <span class="built_in">enable</span> ngx_stream_ssl_module</span><br><span class="line">  --with-stream_realip_module        <span class="built_in">enable</span> ngx_stream_realip_module</span><br><span class="line">  --with-stream_geoip_module         <span class="built_in">enable</span> ngx_stream_geoip_module</span><br><span class="line">  --with-stream_geoip_module=dynamic <span class="built_in">enable</span> dynamic ngx_stream_geoip_module</span><br><span class="line">  --with-stream_ssl_preread_module   <span class="built_in">enable</span> ngx_stream_ssl_preread_module</span><br><span class="line">  --without-stream_limit_conn_module <span class="built_in">disable</span> ngx_stream_limit_conn_module</span><br><span class="line">  --without-stream_access_module     <span class="built_in">disable</span> ngx_stream_access_module</span><br><span class="line">  --without-stream_geo_module        <span class="built_in">disable</span> ngx_stream_geo_module</span><br><span class="line">  --without-stream_map_module        <span class="built_in">disable</span> ngx_stream_map_module</span><br><span class="line">  --without-stream_split_clients_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_stream_split_clients_module</span><br><span class="line">  --without-stream_return_module     <span class="built_in">disable</span> ngx_stream_return_module</span><br><span class="line">  --without-stream_upstream_hash_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_stream_upstream_hash_module</span><br><span class="line">  --without-stream_upstream_least_conn_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_stream_upstream_least_conn_module</span><br><span class="line">  --without-stream_upstream_random_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_stream_upstream_random_module</span><br><span class="line">  --without-stream_upstream_zone_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_stream_upstream_zone_module</span><br><span class="line"></span><br><span class="line">  --with-google_perftools_module     <span class="built_in">enable</span> ngx_google_perftools_module</span><br><span class="line">  --with-cpp_test_module             <span class="built_in">enable</span> ngx_cpp_test_module</span><br><span class="line"></span><br><span class="line">  --add-module=PATH                  <span class="built_in">enable</span> external module</span><br><span class="line">  --add-dynamic-module=PATH          <span class="built_in">enable</span> dynamic external module</span><br><span class="line"></span><br><span class="line">  --with-compat                      dynamic modules compatibility</span><br><span class="line"></span><br><span class="line">  --with-cc=PATH                     <span class="built_in">set</span> C compiler pathname</span><br><span class="line">  --with-cpp=PATH                    <span class="built_in">set</span> C preprocessor pathname</span><br><span class="line">  --with-cc-opt=OPTIONS              <span class="built_in">set</span> additional C compiler options</span><br><span class="line">  --with-ld-opt=OPTIONS              <span class="built_in">set</span> additional linker options</span><br><span class="line">  --with-cpu-opt=CPU                 build <span class="keyword">for</span> the specified CPU, valid values:</span><br><span class="line">                                     pentium, pentiumpro, pentium3, pentium4,</span><br><span class="line">                                     athlon, opteron, sparc32, sparc64, ppc64</span><br><span class="line"></span><br><span class="line">  --without-pcre                     <span class="built_in">disable</span> PCRE library usage</span><br><span class="line">  --with-pcre                        force PCRE library usage</span><br><span class="line">  --with-pcre=DIR                    <span class="built_in">set</span> path to PCRE library sources</span><br><span class="line">  --with-pcre-opt=OPTIONS            <span class="built_in">set</span> additional build options <span class="keyword">for</span> PCRE</span><br><span class="line">  --with-pcre-jit                    build PCRE with JIT compilation support</span><br><span class="line"></span><br><span class="line">  --with-zlib=DIR                    <span class="built_in">set</span> path to zlib library sources</span><br><span class="line">  --with-zlib-opt=OPTIONS            <span class="built_in">set</span> additional build options <span class="keyword">for</span> zlib</span><br><span class="line">  --with-zlib-asm=CPU                use zlib assembler sources optimized</span><br><span class="line">                                     <span class="keyword">for</span> the specified CPU, valid values:</span><br><span class="line">                                     pentium, pentiumpro</span><br><span class="line"></span><br><span class="line">  --with-libatomic                   force libatomic_ops library usage</span><br><span class="line">  --with-libatomic=DIR               <span class="built_in">set</span> path to libatomic_ops library sources</span><br><span class="line"></span><br><span class="line">  --with-openssl=DIR                 <span class="built_in">set</span> path to OpenSSL library sources</span><br><span class="line">  --with-openssl-opt=OPTIONS         <span class="built_in">set</span> additional build options <span class="keyword">for</span> OpenSSL</span><br><span class="line"></span><br><span class="line">  --with-debug                       <span class="built_in">enable</span> debug logging</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx nginx-1.16.1]<span class="comment"># mkdir nginx-src</span></span><br><span class="line">[root@nginx nginx-1.16.1]<span class="comment"># ./configure --prefix=$PWD/nginx-src</span></span><br><span class="line">[root@nginx nginx-1.16.1]<span class="comment"># make &amp;&amp; make install</span></span><br><span class="line">[root@nginx nginx-1.16.1]<span class="comment"># ./nginx-src/sbin/nginx -v</span></span><br><span class="line">nginx version: nginx/1.16.1</span><br><span class="line"></span><br><span class="line">[root@nginx nginx-1.16.1]<span class="comment"># ldd ./nginx-src/sbin/nginx</span></span><br><span class="line">linux-vdso.so.1 =&gt;  (0x00007fff44dea000)</span><br><span class="line">libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f9d0b173000)</span><br><span class="line">libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007f9d0af57000)</span><br><span class="line">libcrypt.so.1 =&gt; /lib64/libcrypt.so.1 (0x00007f9d0ad20000)</span><br><span class="line">libpcre.so.1 =&gt; /lib64/libpcre.so.1 (0x00007f9d0aabe000)</span><br><span class="line">libz.so.1 =&gt; /lib64/libz.so.1 (0x00007f9d0a8a8000)</span><br><span class="line">libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f9d0a4da000)</span><br><span class="line">/lib64/ld-linux-x86-64.so.2 (0x00007f9d0b377000)</span><br><span class="line">libfreebl3.so =&gt; /lib64/libfreebl3.so (0x00007f9d0a2d7000)</span><br><span class="line"></span><br><span class="line">[root@nginx nginx-1.16.1]<span class="comment"># mv nginx-src/ /opt/nginx</span></span><br><span class="line">[root@nginx nginx-1.16.1]<span class="comment"># ll /opt/nginx/</span></span><br><span class="line">总用量 0</span><br><span class="line">drwxr-xr-x 2 root root 333 1月   1 06:50 conf</span><br><span class="line">drwxr-xr-x 2 root root  40 1月   1 06:50 html</span><br><span class="line">drwxr-xr-x 2 root root   6 1月   1 06:50 logs</span><br><span class="line">drwxr-xr-x 2 root root  19 1月   1 06:50 sbin</span><br></pre></td></tr></table></figure><ul><li>创建 nginx.service 文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]<span class="comment"># cat &lt; EOF &gt; nginx.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Nginx Server</span><br><span class="line">After=network.target</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStartPre=/opt/nginx/sbin/nginx -c /opt/nginx/conf/nginx.conf -p /opt/nginx -t</span><br><span class="line">ExecStart=/opt/nginx/sbin/nginx -c /opt/nginx/conf/nginx.conf -p /opt/nginx</span><br><span class="line">ExecReload=/opt/nginx/sbin/nginx -c /opt/nginx/conf/nginx.conf -p /opt/nginx -s reload</span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=5</span><br><span class="line">StartLimitInterval=0</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">[root@nginx ~]<span class="comment"># cp nginx.service /etc/systemd/system/</span></span><br><span class="line">[root@nginx ~]<span class="comment"># systemctl enable nginx &amp;&amp; systemctl start nginx</span></span><br><span class="line"></span><br><span class="line">[root@nginx ~]<span class="comment"># systemctl status nginx</span></span><br><span class="line">● nginx.service - Nginx Server</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/nginx.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 三 2020-01-01 06:59:14 CST; 5s ago</span><br><span class="line">  Process: 10052 ExecStart=/opt/nginx/sbin/nginx -c /opt/nginx/conf/nginx.conf -p /opt/nginx (code=exited, status=0/SUCCESS)</span><br><span class="line">  Process: 10051 ExecStartPre=/opt/nginx/sbin/nginx -c /opt/nginx/conf/nginx.conf -p /opt/nginx -t (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 10053 (nginx)</span><br><span class="line">   CGroup: /system.slice/nginx.service</span><br><span class="line">           ├─10053 nginx: master process /opt/nginx/sbin/nginx -c /opt/nginx/conf/nginx.conf...</span><br><span class="line">           └─10054 nginx: worker process</span><br><span class="line"></span><br><span class="line">1月 01 06:59:14 nginx systemd[1]: Starting Nginx Server...</span><br><span class="line">1月 01 06:59:14 nginx nginx[10051]: nginx: the configuration file /opt/nginx/conf/nginx.... ok</span><br><span class="line">1月 01 06:59:14 nginx nginx[10051]: nginx: configuration file /opt/nginx/conf/nginx.conf...ful</span><br><span class="line">1月 01 06:59:14 nginx systemd[1]: Started Nginx Server.</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show <span class="keyword">in</span> full.</span><br><span class="line"></span><br><span class="line">[root@nginx ~]<span class="comment"># netstat -ntlp | grep nginx</span></span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      10053/nginx: master</span><br></pre></td></tr></table></figure><h2 id="Nginx-配置"><a href="#Nginx-配置" class="headerlink" title="Nginx 配置"></a>Nginx 配置</h2><h3 id="1-1-HTTP-Load-Balancing"><a href="#1-1-HTTP-Load-Balancing" class="headerlink" title="1.1 HTTP Load Balancing"></a>1.1 HTTP Load Balancing</h3><ul><li>使用 NGINX 的 HTTP 模块使用 upstream 块在 HTTP 服务器上进行负载均衡</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server 10.10.12.45:80       weight&#x3D;1;</span><br><span class="line">    server app.example.com:80   weight&#x3D;2;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;backend;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-TCP-Load-Balancing"><a href="#1-2-TCP-Load-Balancing" class="headerlink" title="1.2 TCP Load Balancing"></a>1.2 TCP Load Balancing</h3><ul><li>使用 NGINX 的 stream 模块使用 upstream 块在 TCP 服务器上进行负载均衡</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">stream &#123;</span><br><span class="line">    upstream mysql_read &#123;</span><br><span class="line">        server read1.example.com:3306   weight&#x3D;5;</span><br><span class="line">        server read2.example.com:3306;</span><br><span class="line">        server 10.10.12.34:3306         backup;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 3306;</span><br><span class="line">        proxy_pass mysql_read;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3-Load-Balancing-方法"><a href="#1-3-Load-Balancing-方法" class="headerlink" title="1.3 Load-Balancing 方法"></a>1.3 Load-Balancing 方法</h3><ul><li>使用 NGINX 的负载平衡方法之一，例如least_conn, least_time, hash, ip_hash</li></ul><p>这里将后端 upstream 池的负载平衡算法设置为最少连接。所有负载平衡算法（通用散列除外）都将是独立的指令，如前面的示例。通用散列采用单个参数（可以是变量的串联）来构建散列。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    least_conn;</span><br><span class="line">    server backend.example.com;</span><br><span class="line">    server backend1.example.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>并非所有请求或数据包都具有相同的权重。鉴于此，循环，甚至是先前示例中使用的加权循环，将不适合所有应用程序或交通流量的需要。NGINX提供了许多负载平衡算法，可用于适应特定的用例。 这些负载平衡算法或方法不仅可以选择，还可以配置。 以下负载平衡方法可用于 upstream HTTP，TCP 和 UDP 池：</p><ol><li>Round robin（轮询）：<br>默认负载平衡方法，按 upstream 池中服务器列表的顺序分配请求。对于加权循环，可以考虑权重，如果 upstream 服务器的容量变化，则可以使用加权循环。 权重的整数值越高，服务器在循环中的优势就越大。权重背后的算法只是加权平均的统计概率。循环法是默认的负载平衡算法，如果未指定其他算法，则使用该算法。</li><li>Least connections（）：<br>另一种由 NGINX 提供的负载均衡方法。此方法通过将当前请求代理到具有通过 NGINX 代理的最少数量的打开连接的upstream服务器来平衡负载。在决定向哪个服务器发送连接时，最小连接（如循环）也会考虑权重。指令名称为 least_conn。</li><li>Least time（）：<br>仅在 NGINX Plus 中可用，类似于最少连接，因为它代理具有最少数量的当前连接的upstream 服务器，但有利于具有最低平均响应时间的服务器。这种方法是最复杂的负载平衡算法之一，可满足高性能 Web 应用程序的需求。此算法是一个增加最少连接的值，因为少量连接并不一定意味着最快的响应。指令名称为 least_time。</li><li>Generic hash（）：<br>管理员使用给定文本，请求或运行时的变量或两者来定义散列。NGINX 通过为当前请求生成哈希并将其放在 upstream 服务器上来分配服务器之间的负载。当您需要更多地控制发送请求的位置或确定哪些 upstream 服务器最有可能将数据缓存时，此方法非常有用。请注意，在池中添加或删除服务器时，将重新分配散列请求。该算法具有可选参数，一致，以最小化重新分布的影响。指令名称是 hash。</li><li>IP hash（）：<br>仅支持HTTP，是最后一批。IP 哈希使用客户端 IP 地址作为哈希。与在通用散列中使用远程变量略有不同，此算法使用 IPv4 地址的前三个八位字节或整个 IPv6 地址。只要该服务器可用，此方法可确保客户端代理到同一个 upstream 服务器，这在会话状态受到关注且未由应用程序的共享内存处理时非常有用。 在分配散列时，此方法还会考虑权重参数。 指令名称为 ip_hash。</li></ol><h3 id="1-4-Connection-Limiting"><a href="#1-4-Connection-Limiting" class="headerlink" title="1.4 Connection Limiting"></a>1.4 Connection Limiting</h3><ul><li>使用 NGINX Plus 的 max_conns 参数限制 upstream 服务器的连接数</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    zone backends 64k;</span><br><span class="line">    queue 750 timeout&#x3D;30s;</span><br><span class="line"></span><br><span class="line">    server webserver1.example.com max_conns&#x3D;25;</span><br><span class="line">    server webserver2.example.com max_conns&#x3D;15;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Nginx-安装&quot;&gt;&lt;a href=&quot;#Nginx-安装&quot; class=&quot;headerlink&quot; title=&quot;Nginx 安装&quot;&gt;&lt;/a&gt;Nginx 安装&lt;/h2&gt;&lt;h3 id=&quot;1-yum-源安装&quot;&gt;&lt;a href=&quot;#1-yum-源安装&quot; class=&quot;he
      
    
    </summary>
    
    
      <category term="linux" scheme="http://yoursite.com/categories/linux/"/>
    
    
      <category term="nginx" scheme="http://yoursite.com/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>OpenLDAP 安装指南</title>
    <link href="http://yoursite.com/2019/12/27/openldap/"/>
    <id>http://yoursite.com/2019/12/27/openldap/</id>
    <published>2019-12-26T16:00:00.000Z</published>
    <updated>2020-12-04T11:24:29.140Z</updated>
    
    <content type="html"><![CDATA[<p>CentOS 7 OpenLDAP 安装配置指南</p><a id="more"></a><h2 id="1-安装-openldap"><a href="#1-安装-openldap" class="headerlink" title="1. 安装 openldap"></a>1. 安装 openldap</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># yum -y install openldap compat-openldap openldap-clients openldap-servers openldap-servers-sql openldap-devel migrationtools</span></span><br></pre></td></tr></table></figure><h3 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># slapd -VV</span></span><br><span class="line">@(<span class="comment">#) $OpenLDAP: slapd 2.4.44 (Jan 29 2019 17:42:45) $</span></span><br><span class="line">mockbuild@x86-01.bsys.centos.org:/builddir/build/BUILD/openldap-2.4.44/openldap-2.4.44/servers/slapd</span><br></pre></td></tr></table></figure><h3 id="为默认用户设置密码"><a href="#为默认用户设置密码" class="headerlink" title="为默认用户设置密码"></a>为默认用户设置密码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># slappasswd</span></span><br><span class="line">New password:</span><br><span class="line">Re-enter new password:</span><br><span class="line">&#123;SSHA&#125;P+NaHJ1IQAM/17rDCIK8i2Klm3rStDVo</span><br></pre></td></tr></table></figure><h2 id="2-配置-openldap"><a href="#2-配置-openldap" class="headerlink" title="2. 配置 openldap"></a>2. 配置 openldap</h2><h3 id="修改-olcDatabase-2-hdb-ldif-文件"><a href="#修改-olcDatabase-2-hdb-ldif-文件" class="headerlink" title="修改 olcDatabase={2}hdb.ldif 文件"></a>修改 <code>olcDatabase={2}hdb.ldif</code> 文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># vim /etc/openldap/slapd.d/cn\=config/olcDatabase\=\&#123;2\&#125;hdb.ldif</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># AUTO-GENERATED FILE - DO NOT EDIT!! Use ldapmodify.</span></span><br><span class="line"><span class="comment"># CRC32 2df1c260</span></span><br><span class="line">dn: olcDatabase=&#123;2&#125;hdb</span><br><span class="line">objectClass: olcDatabaseConfig</span><br><span class="line">objectClass: olcHdbConfig</span><br><span class="line">olcDatabase: &#123;2&#125;hdb</span><br><span class="line">olcDbDirectory: /var/lib/ldap</span><br><span class="line"><span class="comment"># olcSuffix: dc=my-domain,dc=com</span></span><br><span class="line">olcSuffix: dc=example,dc=com</span><br><span class="line"><span class="comment"># olcRootDN: cn=Manager,dc=my-domain,dc=com</span></span><br><span class="line">olcRootDN: cn=Manager,dc=example,dc=com</span><br><span class="line">olcDbIndex: objectClass eq,pres</span><br><span class="line">olcDbIndex: ou,cn,mail,surname,givenname eq,pres,sub</span><br><span class="line">structuralObjectClass: olcHdbConfig</span><br><span class="line">entryUUID: 7b00e3c0-bcc6-1039-927c-c144385599c7</span><br><span class="line">creatorsName: cn=config</span><br><span class="line">createTimestamp: 20191227073020Z</span><br><span class="line">entryCSN: 20191227073020.070906Z<span class="comment">#000000#000#000000</span></span><br><span class="line">modifiersName: cn=config</span><br><span class="line">modifyTimestamp: 20191227073020Z</span><br><span class="line"><span class="comment"># add</span></span><br><span class="line">olcRootPW: &#123;SSHA&#125;P+NaHJ1IQAM/17rDCIK8i2Klm3rStDVo</span><br></pre></td></tr></table></figure><h3 id="修改-olcDatabase-1-monitor-ldif-文件"><a href="#修改-olcDatabase-1-monitor-ldif-文件" class="headerlink" title="修改 olcDatabase={1}monitor.ldif 文件"></a>修改 <code>olcDatabase={1}monitor.ldif</code> 文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># vim /etc/openldap/slapd.d/cn\=config/olcDatabase\=\&#123;1\&#125;monitor.ldif</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># AUTO-GENERATED FILE - DO NOT EDIT!! Use ldapmodify.</span></span><br><span class="line"><span class="comment"># CRC32 cdc0bae3</span></span><br><span class="line">dn: olcDatabase=&#123;1&#125;monitor</span><br><span class="line">objectClass: olcDatabaseConfig</span><br><span class="line">olcDatabase: &#123;1&#125;monitor</span><br><span class="line"><span class="comment"># olcAccess: &#123;0&#125;to * by dn.base="gidNumber=0+uidNumber=0,cn=peercred,cn=extern</span></span><br><span class="line"><span class="comment">#  al,cn=auth" read by dn.base="cn=Manager,dc=my-domain,dc=com" read by * none</span></span><br><span class="line">olcAccess: &#123;0&#125;to * by dn.base=<span class="string">"gidNumber=0+uidNumber=0,cn=peercred,cn=extern</span></span><br><span class="line"><span class="string"> al,cn=auth"</span> <span class="built_in">read</span> by dn.base=<span class="string">"cn=Manager,dc=example,dc=com"</span> <span class="built_in">read</span> by * none</span><br><span class="line">structuralObjectClass: olcDatabaseConfig</span><br><span class="line">entryUUID: 7b00dc72-bcc6-1039-927b-c144385599c7</span><br><span class="line">creatorsName: cn=config</span><br><span class="line">createTimestamp: 20191227073020Z</span><br><span class="line">entryCSN: 20191227073020.070787Z<span class="comment">#000000#000#000000</span></span><br><span class="line">modifiersName: cn=config</span><br><span class="line">modifyTimestamp: 20191227073020Z</span><br></pre></td></tr></table></figure><h3 id="验证配置文件是否正确"><a href="#验证配置文件是否正确" class="headerlink" title="验证配置文件是否正确"></a>验证配置文件是否正确</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># slaptest -u</span></span><br><span class="line">5e05b57d ldif_read_file: checksum error on <span class="string">"/etc/openldap/slapd.d/cn=config/olcDatabase=&#123;1&#125;monitor.ldif"</span></span><br><span class="line">5e05b57d ldif_read_file: checksum error on <span class="string">"/etc/openldap/slapd.d/cn=config/olcDatabase=&#123;2&#125;hdb.ldif"</span></span><br><span class="line">config file testing succeeded</span><br></pre></td></tr></table></figure><h3 id="启动服务并设置开机启动"><a href="#启动服务并设置开机启动" class="headerlink" title="启动服务并设置开机启动"></a>启动服务并设置开机启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># systemctl start slapd &amp;&amp; systemctl enable slapd</span></span><br><span class="line">[root@ldap ~]<span class="comment"># systemctl status slapd</span></span><br><span class="line">● slapd.service - OpenLDAP Server Daemon</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/slapd.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 五 2019-12-27 15:41:35 CST; 4s ago</span><br><span class="line">     Docs: man:slapd</span><br><span class="line">           man:slapd-config</span><br><span class="line">           man:slapd-hdb</span><br><span class="line">           man:slapd-mdb</span><br><span class="line">           file:///usr/share/doc/openldap-servers/guide.html</span><br><span class="line">  Process: 1783 ExecStart=/usr/sbin/slapd -u ldap -h <span class="variable">$&#123;SLAPD_URLS&#125;</span> <span class="variable">$SLAPD_OPTIONS</span> (code=exited, status=0/SUCCESS)</span><br><span class="line">  Process: 1768 ExecStartPre=/usr/libexec/openldap/check-config.sh (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 1786 (slapd)</span><br><span class="line">   CGroup: /system.slice/slapd.service</span><br><span class="line">           └─1786 /usr/sbin/slapd -u ldap -h ldapi:/// ldap:///</span><br><span class="line"></span><br><span class="line">12月 27 15:41:32 ldap.example.com systemd[1]: Starting OpenLDAP Server Daemon...</span><br><span class="line">12月 27 15:41:32 ldap.example.com runuser[1771]: pam_unix(runuser:session): session opened <span class="keyword">for</span> user ldap by (uid=0)</span><br><span class="line">12月 27 15:41:35 ldap.example.com slapd[1783]: @(<span class="comment">#) $OpenLDAP: slapd 2.4.44 (Jan 29 2019 17:42:45) $</span></span><br><span class="line">                                                        mockbuild@x86-01.bsys.centos.org:/builddir/build/BUILD/openldap-2.4.44/openldap-2.4.44/servers/slapd</span><br><span class="line">12月 27 15:41:35 ldap.example.com slapd[1783]: ldif_read_file: checksum error on <span class="string">"/etc/openldap/slapd.d/cn=config/olcDatabase=&#123;1&#125;monitor.ldif"</span></span><br><span class="line">12月 27 15:41:35 ldap.example.com slapd[1783]: ldif_read_file: checksum error on <span class="string">"/etc/openldap/slapd.d/cn=config/olcDatabase=&#123;2&#125;hdb.ldif"</span></span><br><span class="line">12月 27 15:41:35 ldap.example.com slapd[1783]: tlsmc_get_pin: INFO: Please note the extracted key file will not be protected with a PIN any more, however it will be still prot...permissions.</span><br><span class="line">12月 27 15:41:35 ldap.example.com slapd[1786]: hdb_db_open: warning - no DB_CONFIG file found <span class="keyword">in</span> directory /var/lib/ldap: (2).</span><br><span class="line">                                                Expect poor performance <span class="keyword">for</span> suffix <span class="string">"dc=example,dc=com"</span>.</span><br><span class="line">12月 27 15:41:35 ldap.example.com slapd[1786]: slapd starting</span><br><span class="line">12月 27 15:41:35 ldap.example.com systemd[1]: Started OpenLDAP Server Daemon.</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show <span class="keyword">in</span> full.</span><br></pre></td></tr></table></figure><h3 id="查看监听端口"><a href="#查看监听端口" class="headerlink" title="查看监听端口"></a>查看监听端口</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># netstat -ntlp | grep slapd</span></span><br><span class="line">tcp        0      0 0.0.0.0:389             0.0.0.0:*               LISTEN      1786/slapd</span><br><span class="line">tcp6       0      0 :::389                  :::*                    LISTEN      1786/slapd</span><br></pre></td></tr></table></figure><h3 id="配置-openldap-数据库"><a href="#配置-openldap-数据库" class="headerlink" title="配置 openldap 数据库"></a>配置 openldap 数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG</span></span><br><span class="line">[root@ldap ~]<span class="comment"># chown ldap:ldap -R /var/lib/ldap</span></span><br><span class="line">[root@ldap ~]<span class="comment"># chmod 700 -R /var/lib/ldap</span></span><br><span class="line">[root@ldap ~]<span class="comment"># ll /var/lib/ldap/</span></span><br><span class="line">总用量 324</span><br><span class="line">-rwx------. 1 ldap ldap     2048 12月 27 15:41 alock</span><br><span class="line">-rwx------. 1 ldap ldap   262144 12月 27 15:41 __db.001</span><br><span class="line">-rwx------. 1 ldap ldap    32768 12月 27 15:41 __db.002</span><br><span class="line">-rwx------. 1 ldap ldap    49152 12月 27 15:41 __db.003</span><br><span class="line">-rwx------. 1 ldap ldap      845 12月 27 15:44 DB_CONFIG</span><br><span class="line">-rwx------. 1 ldap ldap     8192 12月 27 15:41 dn2id.bdb</span><br><span class="line">-rwx------. 1 ldap ldap    32768 12月 27 15:41 id2entry.bdb</span><br><span class="line">-rwx------. 1 ldap ldap 10485760 12月 27 15:41 log.0000000001</span><br></pre></td></tr></table></figure><h3 id="导入基本-schema"><a href="#导入基本-schema" class="headerlink" title="导入基本 schema"></a>导入基本 schema</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif</span></span><br><span class="line">SASL/EXTERNAL authentication started</span><br><span class="line">SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><br><span class="line">SASL SSF: 0</span><br><span class="line">adding new entry <span class="string">"cn=cosine,cn=schema,cn=config"</span></span><br><span class="line"></span><br><span class="line">[root@ldap ~]<span class="comment"># ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif</span></span><br><span class="line">SASL/EXTERNAL authentication started</span><br><span class="line">SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><br><span class="line">SASL SSF: 0</span><br><span class="line">adding new entry <span class="string">"cn=nis,cn=schema,cn=config"</span></span><br><span class="line"></span><br><span class="line">[root@ldap ~]<span class="comment"># ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif</span></span><br><span class="line">SASL/EXTERNAL authentication started</span><br><span class="line">SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><br><span class="line">SASL SSF: 0</span><br><span class="line">adding new entry <span class="string">"cn=inetorgperson,cn=schema,cn=config"</span></span><br></pre></td></tr></table></figure><h2 id="3-开启-openldap-日志访问功能"><a href="#3-开启-openldap-日志访问功能" class="headerlink" title="3. 开启 openldap 日志访问功能"></a>3. 开启 openldap 日志访问功能</h2><blockquote><p>默认情况下 openldap 没有启用日志记录功能，在实际使用过程中，为了定位问题，需要使用到 openldap 日志。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># cat &gt; /root/loglevel.ldif &lt;&lt; "EOF"</span></span><br><span class="line">dn: cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcLogLevel</span><br><span class="line">olcLogLevel: stats</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># ldapmodify -Y EXTERNAL -H ldapi:/// -f /root/loglevel.ldif</span></span><br><span class="line">SASL/EXTERNAL authentication started</span><br><span class="line">SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><br><span class="line">SASL SSF: 0</span><br><span class="line">modifying entry <span class="string">"cn=config"</span></span><br><span class="line"></span><br><span class="line">[root@ldap ~]<span class="comment"># systemctl restart slapd</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># cat &gt;&gt; /etc/rsyslog.conf &lt;&lt; "EOF"</span></span><br><span class="line">local4.* /var/<span class="built_in">log</span>/slapd.log</span><br><span class="line">EOF</span><br><span class="line">[root@ldap ~]<span class="comment"># systemctl restart rsyslog</span></span><br></pre></td></tr></table></figure><h2 id="4-安装和配置-phpldapadmin"><a href="#4-安装和配置-phpldapadmin" class="headerlink" title="4. 安装和配置 phpldapadmin"></a>4. 安装和配置 phpldapadmin</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># yum -y install httpd php php-ldap php-gd php-mbstring php-pear php-bcmath php-xml</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># yum -y install epel-release</span></span><br><span class="line">[root@ldap ~]<span class="comment"># yum -y install phpldapadmin</span></span><br></pre></td></tr></table></figure><ul><li>修改配置文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># vim /etc/phpldapadmin/config.php</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">397 <span class="variable">$servers</span>-&gt;setValue(<span class="string">'login'</span>,<span class="string">'attr'</span>,<span class="string">'dn'</span>);</span><br><span class="line">398 // <span class="variable">$servers</span>-&gt;setValue(<span class="string">'login'</span>,<span class="string">'attr'</span>,<span class="string">'uid'</span>);</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># vim /etc/httpd/conf.d/phpldapadmin.conf</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  Web-based tool for managing LDAP servers</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">Alias /phpldapadmin /usr/share/phpldapadmin/htdocs</span><br><span class="line">Alias /ldapadmin /usr/share/phpldapadmin/htdocs</span><br><span class="line"></span><br><span class="line">&lt;Directory /usr/share/phpldapadmin/htdocs&gt;</span><br><span class="line">  &lt;IfModule mod_authz_core.c&gt;</span><br><span class="line">    <span class="comment"># Apache 2.4</span></span><br><span class="line">    Require <span class="built_in">local</span></span><br><span class="line">    Require ip 192.168.33.1</span><br><span class="line">  &lt;/IfModule&gt;</span><br><span class="line">  &lt;IfModule !mod_authz_core.c&gt;</span><br><span class="line">    <span class="comment"># Apache 2.2</span></span><br><span class="line">    Order Deny,Allow</span><br><span class="line">    Deny from all</span><br><span class="line">    Allow from 127.0.0.1</span><br><span class="line">    Allow from ::1</span><br><span class="line">  &lt;/IfModule&gt;</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure><ul><li>启动服务并设置开机启动</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># systemctl enable httpd &amp;&amp; systemctl start httpd</span></span><br></pre></td></tr></table></figure><ul><li>浏览器访问<ul><li>主页<br><img src="/resources/openldap/openldap01.png" alt=""></li><li>登陆<br><img src="/resources/openldap/openldap02.png" alt=""></li><li>导航<br><img src="/resources/openldap/openldap03.png" alt=""></li></ul></li></ul><h2 id="5-添加用户"><a href="#5-添加用户" class="headerlink" title="5. 添加用户"></a>5. 添加用户</h2><h3 id="修改-usr-share-migrate-common-ph-文件"><a href="#修改-usr-share-migrate-common-ph-文件" class="headerlink" title="修改 /usr/share/migrate_common.ph 文件"></a>修改 <code>/usr/share/migrate_common.ph</code> 文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># vim /usr/share/migrationtools/migrate_common.ph</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Default DNS domain</span></span><br><span class="line"><span class="comment"># $DEFAULT_MAIL_DOMAIN = "padl.com";</span></span><br><span class="line"><span class="variable">$DEFAULT_MAIL_DOMAIN</span> = <span class="string">"example.com"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Default base</span></span><br><span class="line"><span class="comment"># $DEFAULT_BASE = "dc=padl,dc=com";</span></span><br><span class="line"><span class="variable">$DEFAULT_BASE</span> = <span class="string">"dc=example,dc=com"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Turn this on for inetLocalMailReceipient</span></span><br><span class="line"><span class="comment"># sendmail support; add the following to</span></span><br><span class="line"><span class="comment"># sendmail.mc (thanks to Petr@Kristof.CZ):</span></span><br><span class="line"><span class="comment">##### CUT HERE #####</span></span><br><span class="line"><span class="comment">#define(`confLDAP_DEFAULT_SPEC',`-h "ldap.padl.com"')dnl</span></span><br><span class="line"><span class="comment">#LDAPROUTE_DOMAIN_FILE(`/etc/mail/ldapdomains')dnl</span></span><br><span class="line"><span class="comment">#FEATURE(ldap_routing)dnl</span></span><br><span class="line"><span class="comment">##### CUT HERE #####</span></span><br><span class="line"><span class="comment"># where /etc/mail/ldapdomains contains names of ldap_routed</span></span><br><span class="line"><span class="comment"># domains (similiar to MASQUERADE_DOMAIN_FILE).</span></span><br><span class="line"><span class="comment"># $DEFAULT_MAIL_HOST = "mail.padl.com";</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># turn this on to support more general object clases</span></span><br><span class="line"><span class="comment"># such as person.</span></span><br><span class="line"><span class="comment"># $EXTENDED_SCHEMA = 0;</span></span><br><span class="line"><span class="variable">$EXTENDED_SCHEMA</span> = 1;</span><br></pre></td></tr></table></figure><h3 id="添加用户及用户组"><a href="#添加用户及用户组" class="headerlink" title="添加用户及用户组"></a>添加用户及用户组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># groupadd ldapgroup1</span></span><br><span class="line">[root@ldap ~]<span class="comment"># groupadd ldapgroup2</span></span><br><span class="line">[root@ldap ~]<span class="comment"># useradd -g ldapgroup1 ldapuser1</span></span><br><span class="line">[root@ldap ~]<span class="comment"># useradd -g ldapgroup2 ldapuser2</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># echo "ldap" | passwd --stdin ldapuser1</span></span><br><span class="line">[root@ldap ~]<span class="comment"># echo "ldap" | passwd --stdin ldapuser2</span></span><br></pre></td></tr></table></figure><h3 id="提取用户和组"><a href="#提取用户和组" class="headerlink" title="提取用户和组"></a>提取用户和组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># cat /etc/passwd | grep ldapuser &gt; users</span></span><br><span class="line">[root@ldap ~]<span class="comment"># cat users</span></span><br><span class="line"></span><br><span class="line">ldapuser1:x:1000:1000::/home/ldapuser1:/bin/bash</span><br><span class="line">ldapuser2:x:1001:1001::/home/ldapuser2:/bin/bash</span><br><span class="line"></span><br><span class="line">[root@ldap ~]<span class="comment"># cat /etc/group | grep ldapgroup &gt; groups</span></span><br><span class="line">[root@ldap ~]<span class="comment"># cat groups</span></span><br><span class="line"></span><br><span class="line">ldapgroup1:x:1000:</span><br><span class="line">ldapgroup2:x:1001:</span><br></pre></td></tr></table></figure><h3 id="生成用户和组的-ldif-文件"><a href="#生成用户和组的-ldif-文件" class="headerlink" title="生成用户和组的 ldif 文件"></a>生成用户和组的 <code>ldif</code> 文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># /usr/share/migrationtools/migrate_passwd.pl /root/users &gt; /root/users.ldif</span></span><br><span class="line">[root@ldap ~]<span class="comment"># /usr/share/migrationtools/migrate_group.pl /root/groups &gt; /root/groups.ldif</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># cat users.ldif</span></span><br><span class="line">dn: uid=ldapuser1,ou=People,dc=example,dc=com</span><br><span class="line">uid: ldapuser1</span><br><span class="line">cn: ldapuser1</span><br><span class="line">sn: ldapuser1</span><br><span class="line">mail: ldapuser1@example.com</span><br><span class="line">objectClass: person</span><br><span class="line">objectClass: organizationalPerson</span><br><span class="line">objectClass: inetOrgPerson</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: shadowAccount</span><br><span class="line">userPassword: &#123;crypt&#125;<span class="variable">$6</span><span class="variable">$ab3EWxCv</span><span class="variable">$w</span>/1qc6F3.z4PT0CLHQeqCQdxEUxbKHQBboBFprgz3HdaoJ8flCSmSjQ7yhTzGCoB3wUhJYT6bSVkpJENqPNtq/</span><br><span class="line">shadowLastChange: 18257</span><br><span class="line">shadowMin: 0</span><br><span class="line">shadowMax: 99999</span><br><span class="line">shadowWarning: 7</span><br><span class="line">loginShell: /bin/bash</span><br><span class="line">uidNumber: 1000</span><br><span class="line">gidNumber: 1000</span><br><span class="line">homeDirectory: /home/ldapuser1</span><br><span class="line"></span><br><span class="line">dn: uid=ldapuser2,ou=People,dc=example,dc=com</span><br><span class="line">uid: ldapuser2</span><br><span class="line">cn: ldapuser2</span><br><span class="line">sn: ldapuser2</span><br><span class="line">mail: ldapuser2@example.com</span><br><span class="line">objectClass: person</span><br><span class="line">objectClass: organizationalPerson</span><br><span class="line">objectClass: inetOrgPerson</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: shadowAccount</span><br><span class="line">userPassword: &#123;crypt&#125;<span class="variable">$6</span><span class="variable">$Lh9DKEZ0</span><span class="variable">$qHpMrkzDYLuGhYmq4OLY2uuxv1Oj8TgiwsYs9CKPTMw0kzwGs0EekygLca27hHozJ04AMxE3cONNovcCrwti2</span>/</span><br><span class="line">shadowLastChange: 18257</span><br><span class="line">shadowMin: 0</span><br><span class="line">shadowMax: 99999</span><br><span class="line">shadowWarning: 7</span><br><span class="line">loginShell: /bin/bash</span><br><span class="line">uidNumber: 1001</span><br><span class="line">gidNumber: 1001</span><br><span class="line">homeDirectory: /home/ldapuser2</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># cat groups.ldif</span></span><br><span class="line">dn: cn=ldapgroup1,ou=Group,dc=example,dc=com</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">objectClass: top</span><br><span class="line">cn: ldapgroup1</span><br><span class="line">userPassword: &#123;crypt&#125;x</span><br><span class="line">gidNumber: 1000</span><br><span class="line"></span><br><span class="line">dn: cn=ldapgroup2,ou=Group,dc=example,dc=com</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">objectClass: top</span><br><span class="line">cn: ldapgroup2</span><br><span class="line">userPassword: &#123;crypt&#125;x</span><br><span class="line">gidNumber: 1001</span><br></pre></td></tr></table></figure><h3 id="导入用户及用户组到-openldap-数据库"><a href="#导入用户及用户组到-openldap-数据库" class="headerlink" title="导入用户及用户组到 openldap 数据库"></a>导入用户及用户组到 <code>openldap</code> 数据库</h3><blockquote><p>尽管已经把用户和用户组信息导入到 openldap 数据库中。但目前 openldap 用户和组之间是没有任何关联的。要把 openldap 数据库中用户和组关联起来需要做单独配置</p></blockquote><ul><li>导入基础数据库</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># cat &gt; /root/base.ldif &lt;&lt; EOF</span></span><br><span class="line">dn: dc=example,dc=com</span><br><span class="line">o: example com</span><br><span class="line">dc: example</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: dcObject</span><br><span class="line">objectclass: organization</span><br><span class="line"></span><br><span class="line">dn: cn=Manager,dc=example,dc=com</span><br><span class="line">cn: Manager</span><br><span class="line">objectClass: organizationalRole</span><br><span class="line">description: Directory Manager</span><br><span class="line"></span><br><span class="line">dn: ou=People,dc=example,dc=com</span><br><span class="line">ou: People</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line"></span><br><span class="line">dn: ou=Group,dc=example,dc=com</span><br><span class="line">ou: Group</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># ldapadd -x -w "ldap" -D "cn=Manager,dc=example,dc=com" -f /root/base.ldif</span></span><br><span class="line">adding new entry <span class="string">"dc=example,dc=com"</span></span><br><span class="line"></span><br><span class="line">adding new entry <span class="string">"cn=Manager,dc=example,dc=com"</span></span><br><span class="line"></span><br><span class="line">adding new entry <span class="string">"ou=People,dc=example,dc=com"</span></span><br><span class="line"></span><br><span class="line">adding new entry <span class="string">"ou=Group,dc=example,dc=com"</span></span><br></pre></td></tr></table></figure><ul><li>导入用户</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># ldapadd -x -w "ldap" -D "cn=Manager,dc=example,dc=com" -f /root/users.ldif</span></span><br><span class="line">adding new entry <span class="string">"uid=ldapuser1,ou=People,dc=example,dc=com"</span></span><br><span class="line"></span><br><span class="line">adding new entry <span class="string">"uid=ldapuser2,ou=People,dc=example,dc=com"</span></span><br></pre></td></tr></table></figure><ul><li>导入组</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># ldapadd -x -w "ldap" -D "cn=Manager,dc=example,dc=com" -f /root/groups.ldif</span></span><br><span class="line">adding new entry <span class="string">"cn=ldapgroup1,ou=Group,dc=example,dc=com"</span></span><br><span class="line"></span><br><span class="line">adding new entry <span class="string">"cn=ldapgroup2,ou=Group,dc=example,dc=com"</span></span><br></pre></td></tr></table></figure><ul><li>将用户加入到用户组</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># cat &gt; add_user_to_groups.ldif &lt;&lt; "EOF"</span></span><br><span class="line">dn: cn=ldapgroup1,ou=Group,dc=example,dc=com</span><br><span class="line">changetype: modify</span><br><span class="line">add: memberuid</span><br><span class="line">memberuid: ldapuser1</span><br><span class="line"></span><br><span class="line">dn: cn=ldapgroup2,ou=Group,dc=example,dc=com</span><br><span class="line">changetype: modify</span><br><span class="line">add: memberuid</span><br><span class="line">memberuid: ldapuser2</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># ldapadd -x -w "ldap" -D "cn=Manager,dc=example,dc=com" -f /root/add_user_to_groups.ldif</span></span><br><span class="line">modifying entry <span class="string">"cn=ldapgroup1,ou=Group,dc=example,dc=com"</span></span><br><span class="line">modifying entry <span class="string">"cn=ldapgroup2,ou=Group,dc=example,dc=com"</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># ldapsearch -LLL -x -D 'cn=Manager,dc=example,dc=com' -w "ldap" -b 'dc=example,dc=com' 'cn=ldapgroup1'</span></span><br><span class="line">dn: cn=ldapgroup1,ou=Group,dc=example,dc=com</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">objectClass: top</span><br><span class="line">cn: ldapgroup1</span><br><span class="line">userPassword:: e2NyeXB0fXg=</span><br><span class="line">gidNumber: 1000</span><br><span class="line">memberUid: ldapuser1</span><br><span class="line"></span><br><span class="line">[root@ldap ~]<span class="comment"># ldapsearch -LLL -x -D 'cn=Manager,dc=example,dc=com' -w "ldap" -b 'dc=example,dc=com' 'cn=ldapgroup2'</span></span><br><span class="line">dn: cn=ldapgroup2,ou=Group,dc=example,dc=com</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">objectClass: top</span><br><span class="line">cn: ldapgroup2</span><br><span class="line">userPassword:: e2NyeXB0fXg=</span><br><span class="line">gidNumber: 1001</span><br><span class="line">memberUid: ldapuser2</span><br></pre></td></tr></table></figure><ul><li>phpldapadmin 导航<br><img src="/resources/openldap/openldap04.png" alt=""></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;CentOS 7 OpenLDAP 安装配置指南&lt;/p&gt;
    
    </summary>
    
    
      <category term="linux" scheme="http://yoursite.com/categories/linux/"/>
    
    
      <category term="ldap" scheme="http://yoursite.com/tags/ldap/"/>
    
  </entry>
  
  <entry>
    <title>Git Hooks</title>
    <link href="http://yoursite.com/2019/12/20/git_hooks/"/>
    <id>http://yoursite.com/2019/12/20/git_hooks/</id>
    <published>2019-12-20T08:51:16.000Z</published>
    <updated>2020-12-04T11:24:29.128Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://www.git-scm.com/book/zh/v2/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git-%E9%92%A9%E5%AD%90" target="_blank" rel="noopener">Git Hooks</a> - 在特定的重要动作发生时触发自定义脚本。</p><a id="more"></a><h2 id="配置一个钩子"><a href="#配置一个钩子" class="headerlink" title="配置一个钩子"></a>配置一个钩子</h2><p>钩子都被存储在 Git 目录下的 hooks 子目录中。 即项目中的 <code>.git/hooks</code> 。 当你用 <code>git init</code> 初始化一个新版本库时，Git 默认会在这个目录中放置一些示例脚本。这些脚本除了本身可以被调用外，它们还透露了被触发时所传入的参数。 所有的示例都是 shell 脚本，其中一些还混杂了 Perl 代码，不过，任何正确命名的可执行脚本都可以正常使用 —— 你可以用 Ruby 或 Python，或其它语言编写它们。 这些示例的名字都是以 .sample 结尾，如果你想启用它们，得先移除这个后缀。</p><p>把一个正确命名且可执行的文件放入 Git 目录下的 hooks 子目录中 <code>.git/hooks</code>，即可激活该钩子脚本。 这样一来，它就能被 Git 调用。</p><h2 id="客户端钩子"><a href="#客户端钩子" class="headerlink" title="客户端钩子"></a>客户端钩子</h2><p>客户端钩子分为很多种。 下面把它们分为：提交工作流钩子、电子邮件工作流钩子和其它钩子。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">applypatch-msg.sample</span><br><span class="line">commit-msg.sample</span><br><span class="line">fsmonitor-watchman.sample</span><br><span class="line">post-update.sample</span><br><span class="line">pre-applypatch.sample</span><br><span class="line">pre-commit.sample</span><br><span class="line">pre-merge-commit.sample</span><br><span class="line">pre-push.sample</span><br><span class="line">pre-rebase.sample</span><br><span class="line">pre-receive.sample</span><br><span class="line">prepare-commit-msg.sample</span><br><span class="line">update.sample</span><br></pre></td></tr></table></figure><ol><li>提交工作流钩子</li></ol><blockquote><p><code>pre-commit</code></p></blockquote><p>钩子在键入提交信息前运行。 它用于检查即将提交的快照，例如，检查是否有所遗漏，确保测试运行，以及核查代码。 如果该钩子以非零值退出，Git 将放弃此次提交，不过你可以用 <code>git commit --no-verify</code> 来绕过这个环节。 你可以利用该钩子，来检查代码风格是否一致（运行类似 lint 的程序）、尾随空白字符是否存在（自带的钩子就是这么做的），或新方法的文档是否适当。</p><blockquote><p><code>prepare-commit-msg</code></p></blockquote><p>钩子在启动提交信息编辑器之前，默认信息被创建之后运行。 它允许你编辑提交者所看到的默认信息。 该钩子接收一些选项：存有当前提交信息的文件的路径、提交类型和修补提交的提交的 SHA-1 校验。 它对一般的提交来说并没有什么用；然而对那些会自动产生默认信息的提交，如提交信息模板、合并提交、压缩提交和修订提交等非常实用。 你可以结合提交模板来使用它，动态地插入信息。</p><blockquote><p><code>commit-msg</code></p></blockquote><p>钩子接收一个参数，此参数即上文提到的，存有当前提交信息的临时文件的路径。 如果该钩子脚本以非零值退出，Git 将放弃提交，因此，可以用来在提交通过前验证项目状态或提交信息。 在本章的最后一节，我们将展示如何使用该钩子来核对提交信息是否遵循指定的模板。</p><blockquote><p><code>post-commit</code><br>钩子在整个提交过程完成后运行。 它不接收任何参数，但你可以很容易地通过运行 <code>git log -1 HEAD</code> 来获得最后一次的提交信息。 该钩子一般用于通知之类的事情。</p></blockquote><ol start="2"><li>电子邮件工作流钩子</li></ol><p>你可以给电子邮件工作流设置三个客户端钩子。 它们都是由 <code>git am</code> 命令调用的，因此如果你没有在你的工作流中用到这个命令，可以跳到下一节。 如果你需要通过电子邮件接收由 <code>git format-patch</code> 产生的补丁，这些钩子也许用得上。</p><blockquote><p><code>applypatch-msg</code></p></blockquote><p>它接收单个参数：包含请求合并信息的临时文件的名字。 如果脚本返回非零值，Git 将放弃该补丁。 你可以用该脚本来确保提交信息符合格式，或直接用脚本修正格式错误。</p><blockquote><p><code>pre-applypatch</code></p></blockquote><p>有些难以理解的是，它正好运行于应用补丁 之后，产生提交之前，所以你可以用它在提交前检查快照。 你可以用这个脚本运行测试或检查工作区。 如果有什么遗漏，或测试未能通过，脚本会以非零值退出，中断 <code>git am</code> 的运行，这样补丁就不会被提交。</p><blockquote><p><code>post-applypatch</code></p></blockquote><p>运行于提交产生之后，是在 <code>git am</code> 运行期间最后被调用的钩子。 你可以用它把结果通知给一个小组或所拉取的补丁的作者。 但你没办法用它停止打补丁的过程。</p><ol start="3"><li>其它客户端钩子</li></ol><blockquote><p><code>pre-rebase</code></p></blockquote><p>钩子运行于变基之前，以非零值退出可以中止变基的过程。 你可以使用这个钩子来禁止对已经推送的提交变基。 Git 自带的 pre-rebase 钩子示例就是这么做的，不过它所做的一些假设可能与你的工作流程不匹配。</p><blockquote><p><code>post-rewrite</code></p></blockquote><p>钩子被那些会替换提交记录的命令调用，比如 git commit –amend 和 git rebase（不过不包括 git filter-branch）。 它唯一的参数是触发重写的命令名，同时从标准输入中接受一系列重写的提交记录。 这个钩子的用途很大程度上跟 post-checkout 和 post-merge 差不多。</p><blockquote><p><code>post-checkout</code></p></blockquote><p>在 <code>git checkout</code> 成功运行后，<code>post-checkout</code> 钩子会被调用。你可以根据你的项目环境用它调整你的工作目录。 其中包括放入大的二进制文件、自动生成文档或进行其他类似这样的操作。</p><blockquote><p><code>post-merge</code></p></blockquote><p>在 <code>git merge</code> 成功运行后，<code>post-merge</code> 钩子会被调用。 你可以用它恢复 Git 无法跟踪的工作区数据，比如权限数据。 这个钩子也可以用来验证某些在 Git 控制之外的文件是否存在，这样你就能在工作区改变时，把这些文件复制进来。</p><blockquote><p><code>pre-push</code></p></blockquote><p>pre-push 钩子会在 <code>git push</code> 运行期间， 更新了远程引用但尚未传送对象时被调用。 它接受远程分支的名字和位置作为参数，同时从标准输入中读取一系列待更新的引用。 你可以在推送开始之前，用它验证对引用的更新操作（一个非零的退出码将终止推送过程）。</p><blockquote><p><code>pre-auto-gc</code></p></blockquote><p>Git 的一些日常操作在运行时，偶尔会调用 <code>git gc --auto</code> 进行垃圾回收。 <code>pre-auto-gc</code> 钩子会在垃圾回收开始之前被调用，可以用它来提醒你现在要回收垃圾了，或者依情形判断是否要中断回收。</p><h2 id="服务器端钩子"><a href="#服务器端钩子" class="headerlink" title="服务器端钩子"></a>服务器端钩子</h2><p>除了客户端钩子，作为系统管理员，你还可以使用若干服务器端的钩子对项目强制执行各种类型的策略。 这些钩子脚本在推送到服务器之前和之后运行。 推送到服务器前运行的钩子可以在任何时候以非零值退出，拒绝推送并给客户端返回错误消息，还可以依你所想设置足够复杂的推送策略。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">applypatch-msg.sample</span><br><span class="line">commit-msg.sample</span><br><span class="line">post-update.sample</span><br><span class="line">pre-applypatch.sample</span><br><span class="line">pre-commit.sample</span><br><span class="line">prepare-commit-msg.sample</span><br><span class="line">pre-push.sample</span><br><span class="line">pre-rebase.sample</span><br><span class="line">update.sample</span><br></pre></td></tr></table></figure><blockquote><p><code>pre-receive</code></p></blockquote><p>处理来自客户端的推送操作时，最先被调用的脚本是 <code>pre-receive</code>。 它从标准输入获取一系列被推送的引用。如果它以非零值退出，所有的推送内容都不会被接受。 你可以用这个钩子阻止对引用进行非快进（non-fast-forward）的更新，或者对该推送所修改的所有引用和文件进行访问控制。</p><blockquote><p><code>update</code></p></blockquote><p><code>update</code> 脚本和 <code>pre-receive</code> 脚本十分类似，不同之处在于它会为每一个准备更新的分支各运行一次。 假如推送者同时向多个分支推送内容，<code>pre-receive</code> 只运行一次，相比之下 <code>update</code> 则会为每一个被推送的分支各运行一次。 它不会从标准输入读取内容，而是接受三个参数：引用的名字（分支），推送前的引用指向的内容的 SHA-1 值，以及用户准备推送的内容的 SHA-1 值。 如果 <code>update</code> 脚本以非零值退出，只有相应的那一个引用会被拒绝；其余的依然会被更新。</p><blockquote><p><code>post-receive</code></p></blockquote><p><code>post-receive</code> 挂钩在整个过程完结以后运行，可以用来更新其他系统服务或者通知用户。 它接受与 <code>pre-receive</code> 相同的标准输入数据。 它的用途包括给某个邮件列表发信，通知持续集成（continous integration）的服务器，或者更新问题追踪系统（ticket-tracking system） —— 甚至可以通过分析提交信息来决定某个问题（ticket）是否应该被开启，修改或者关闭。 该脚本无法终止推送进程，不过客户端在它结束运行之前将保持连接状态，所以如果你想做其他操作需谨慎使用它，因为它将耗费你很长的一段时间。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://www.git-scm.com/book/zh/v2/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git-%E9%92%A9%E5%AD%90&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Git Hooks&lt;/a&gt; - 在特定的重要动作发生时触发自定义脚本。&lt;/p&gt;
    
    </summary>
    
    
      <category term="tools" scheme="http://yoursite.com/categories/tools/"/>
    
    
      <category term="git" scheme="http://yoursite.com/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>在服务器上搭建 Git</title>
    <link href="http://yoursite.com/2019/12/20/git_in_server/"/>
    <id>http://yoursite.com/2019/12/20/git_in_server/</id>
    <published>2019-12-19T16:00:00.000Z</published>
    <updated>2020-12-04T12:25:14.481Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://git-scm.com/book/zh/v2/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84-Git-%E5%9C%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E6%90%AD%E5%BB%BA-Git" target="_blank" rel="noopener">服务器上的 Git</a> - 在服务器上搭建 Git</p><a id="more"></a><h2 id="在服务器上创建裸仓库"><a href="#在服务器上创建裸仓库" class="headerlink" title="在服务器上创建裸仓库"></a>在服务器上创建裸仓库</h2><p>假设一个域名为 <code>git.example.com</code> 的服务器已经架设好，并可以通过 SSH 连接，你想把所有的 Git 仓库放在 /opt/git 目录下。 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 git 用户</span></span><br><span class="line">[root@git ~]<span class="comment"># useradd git -m -d /opt/git</span></span><br><span class="line"></span><br><span class="line">[root@git ~]<span class="comment"># echo "git" | passwd --stdin git</span></span><br><span class="line">更改用户 git 的密码 。</span><br><span class="line">passwd：所有的身份验证令牌已经成功更新。</span><br><span class="line"></span><br><span class="line">[root@git ~]<span class="comment"># su - git</span></span><br><span class="line">[git@git ~]$ <span class="built_in">pwd</span></span><br><span class="line">/opt/git</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[git@git ~]$ git init --bare project.git</span><br><span class="line">初始化空的 Git 版本库于 /opt/git/project.git/</span><br></pre></td></tr></table></figure><h2 id="客户端配置连接"><a href="#客户端配置连接" class="headerlink" title="客户端配置连接"></a>客户端配置连接</h2><h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><p>如果一个用户，通过使用 SSH 连接到一个服务器，并且其对 <code>/opt/git/project.git</code> 目录拥有可写权限，那么他将自动拥有推送权限。（这里我们默认使用 git 用户）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id git@git.example.com</span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> git@git.example.com:/opt/git/project.git</span><br><span class="line"></span><br><span class="line">正克隆到 <span class="string">'project'</span>...</span><br><span class="line">warning: 您似乎克隆了一个空仓库。</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> project</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"## project"</span> &gt; README.md</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">"initial new project"</span></span><br><span class="line"></span><br><span class="line">[master（根提交） 1304197] initial new project</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 README.md</span><br><span class="line"></span><br><span class="line">git push</span><br><span class="line"></span><br><span class="line">枚举对象: 3, 完成.</span><br><span class="line">对象计数中: 100% (3/3), 完成.</span><br><span class="line">写入对象中: 100% (3/3), 226 字节 | 226.00 KiB/s, 完成.</span><br><span class="line">总共 3 （差异 0），复用 0 （差异 0）</span><br><span class="line">To git.example.com:/opt/git/project.git</span><br><span class="line"> * [new branch]      master -&gt; master</span><br></pre></td></tr></table></figure><h3 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h3><p>返回服务端查看文件变化</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[git@git ~]$ ls -1 project.git/</span><br><span class="line">branches</span><br><span class="line">config</span><br><span class="line">description</span><br><span class="line">HEAD</span><br><span class="line">hooks</span><br><span class="line">info</span><br><span class="line">objects</span><br><span class="line">refs</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://git-scm.com/book/zh/v2/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84-Git-%E5%9C%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E6%90%AD%E5%BB%BA-Git&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;服务器上的 Git&lt;/a&gt; - 在服务器上搭建 Git&lt;/p&gt;
    
    </summary>
    
    
      <category term="tools" scheme="http://yoursite.com/categories/tools/"/>
    
    
      <category term="git" scheme="http://yoursite.com/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins 入门指南</title>
    <link href="http://yoursite.com/2019/12/20/jenkins/"/>
    <id>http://yoursite.com/2019/12/20/jenkins/</id>
    <published>2019-12-19T16:00:00.000Z</published>
    <updated>2020-12-04T12:18:17.181Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Jenkins-安装"><a href="#Jenkins-安装" class="headerlink" title="Jenkins 安装"></a>Jenkins 安装</h2><h3 id="方法1-使用-yum-安装（Redhat-CentOS-Fedora）"><a href="#方法1-使用-yum-安装（Redhat-CentOS-Fedora）" class="headerlink" title="方法1. 使用 yum 安装（Redhat/CentOS/Fedora）"></a>方法1. 使用 yum 安装（Redhat/CentOS/Fedora）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key</span></span><br><span class="line"></span><br><span class="line">[root@jenkins ~]<span class="comment"># yum -y install jenkins</span></span><br><span class="line"></span><br><span class="line">[root@jenkins ~]<span class="comment"># systemctl start jenkins</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># systemctl status jenkins</span></span><br><span class="line">● jenkins.service - LSB: Jenkins Automation Server</span><br><span class="line">   Loaded: loaded (/etc/rc.d/init.d/jenkins; bad; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 五 2019-12-20 10:37:48 CST; 6s ago</span><br><span class="line">     Docs: man:systemd-sysv-generator(8)</span><br><span class="line">  Process: 8910 ExecStart=/etc/rc.d/init.d/jenkins start (code=exited, status=0/SUCCESS)</span><br><span class="line">    Tasks: 48</span><br><span class="line">   Memory: 442.5M</span><br><span class="line">   CGroup: /system.slice/jenkins.service</span><br><span class="line">           └─8934 /etc/alternatives/java -Dcom.sun.akuma.Daemon=daemonized -Djava.awt.headless=<span class="literal">true</span> -DJENKINS_HOME=/var/lib/jenkins -jar /usr/lib/jenkins/jenkins.war --logfile=/var/<span class="built_in">log</span>/jen...</span><br><span class="line"></span><br><span class="line">12月 20 10:37:47 jenkins systemd[1]: Starting LSB: Jenkins Automation Server...</span><br><span class="line">12月 20 10:37:47 jenkins runuser[8915]: pam_unix(runuser:session): session opened <span class="keyword">for</span> user jenkins by (uid=0)</span><br><span class="line">12月 20 10:37:48 jenkins runuser[8915]: pam_unix(runuser:session): session closed <span class="keyword">for</span> user jenkins</span><br><span class="line">12月 20 10:37:48 jenkins jenkins[8910]: Starting Jenkins [  确定  ]</span><br><span class="line">12月 20 10:37:48 jenkins systemd[1]: Started LSB: Jenkins Automation Server.</span><br></pre></td></tr></table></figure><ul><li>通过 <code>&lt;IP&gt;:&lt;PORT&gt;</code> 访问 Jenkins</li></ul><p><img src="/resources/jenkins/jenkins_01.png" alt=""></p><ul><li>获取 initialAdminPassword</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># cat /var/lib/jenkins/secrets/initialAdminPassword</span></span><br></pre></td></tr></table></figure><h3 id="方法2-使用-Docker-安装"><a href="#方法2-使用-Docker-安装" class="headerlink" title="方法2. 使用 Docker 安装"></a>方法2. 使用 Docker 安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># docker pull jenkinsci/blueocean</span></span><br><span class="line"></span><br><span class="line">[root@jenkins ~]<span class="comment"># docker run -u root -p 8080:8080 -v jenkins_home:/var/jenkins_home -v /var/run/docker.sock:/var/run/docker.sock -v "$HOME":/home --name jenkins -d jenkinsci/blueocean</span></span><br></pre></td></tr></table></figure><ul><li><p>通过 <code>&lt;IP&gt;:&lt;PORT&gt;</code> 访问 Jenkins</p></li><li><p>获取 initialAdminPassword</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过 docker logs 获取</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># docker logs jenkins</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">Jenkins initial setup is required. An admin user has been created and a password generated.</span><br><span class="line">Please use the following password to proceed to installation:</span><br><span class="line"></span><br><span class="line">95538a82714644d5a4b5d84c6f998a4f</span><br><span class="line"></span><br><span class="line">This may also be found at: /var/jenkins_home/secrets/initialAdminPassword</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入容器内部获取 initialAdminPassword</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># docker exec -it jenkins /bin/bash</span></span><br><span class="line">bash-4.4<span class="comment"># cat /var/jenkins_home/secrets/initialAdminPassword</span></span><br></pre></td></tr></table></figure><h3 id="安装推荐插件"><a href="#安装推荐插件" class="headerlink" title="安装推荐插件"></a>安装推荐插件</h3><p><img src="/resources/jenkins/jenkins_02.png" alt=""><br><img src="/resources/jenkins/jenkins_03.png" alt=""></p><h3 id="设置用户"><a href="#设置用户" class="headerlink" title="设置用户"></a>设置用户</h3><p><img src="/resources/jenkins/jenkins_04.png" alt=""></p><h3 id="安装完成"><a href="#安装完成" class="headerlink" title="安装完成"></a>安装完成</h3><p><img src="/resources/jenkins/jenkins_05.png" alt=""><br><img src="/resources/jenkins/jenkins_06.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Jenkins-安装&quot;&gt;&lt;a href=&quot;#Jenkins-安装&quot; class=&quot;headerlink&quot; title=&quot;Jenkins 安装&quot;&gt;&lt;/a&gt;Jenkins 安装&lt;/h2&gt;&lt;h3 id=&quot;方法1-使用-yum-安装（Redhat-CentOS-Fedor
      
    
    </summary>
    
    
      <category term="linux" scheme="http://yoursite.com/categories/linux/"/>
    
    
      <category term="CI/CD" scheme="http://yoursite.com/tags/CI-CD/"/>
    
  </entry>
  
  <entry>
    <title>LeetCode（最长公共前缀）</title>
    <link href="http://yoursite.com/2019/12/19/leetcode_daily_4/"/>
    <id>http://yoursite.com/2019/12/19/leetcode_daily_4/</id>
    <published>2019-12-18T16:00:00.000Z</published>
    <updated>2020-12-04T12:26:56.615Z</updated>
    
    <content type="html"><![CDATA[<p>LeetCode每日一题（罗马数字转整数）<a href="https://leetcode-cn.com/problems/longest-common-prefix/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/longest-common-prefix/</a></p><a id="more"></a><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>编写一个函数来查找字符串数组中的最长公共前缀。</p><p>如果不存在公共前缀，返回空字符串 <code>&quot;&quot;</code>。</p><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">输入: [&quot;flower&quot;,&quot;flow&quot;,&quot;flight&quot;]</span><br><span class="line">输出: &quot;fl&quot;</span><br><span class="line"></span><br><span class="line">输入: [&quot;dog&quot;,&quot;racecar&quot;,&quot;car&quot;]</span><br><span class="line">输出: &quot;&quot;</span><br></pre></td></tr></table></figure><h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">longestCommonPrefix</span><span class="params">(strs []<span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(strs) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 取strs第一个元素作为前缀</span></span><br><span class="line">prefix := strs[<span class="number">0</span>]</span><br><span class="line"><span class="comment">// 遍历数组的长度</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(strs); i++ &#123;</span><br><span class="line"><span class="comment">// 从数组第二个元素开始，判断是否存在前缀prefix</span></span><br><span class="line"><span class="keyword">for</span> !strings.HasPrefix(strs[i], prefix) &#123;</span><br><span class="line">fmt.Println(i, <span class="built_in">len</span>(prefix), prefix)</span><br><span class="line"><span class="comment">// 如果不存在则将前缀prefix最后一个字符删除</span></span><br><span class="line">prefix = prefix[<span class="number">0</span> : <span class="built_in">len</span>(prefix)<span class="number">-1</span>]</span><br><span class="line"><span class="comment">// 当前缀prefix=0时返回空字符串</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(prefix) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> prefix</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;LeetCode每日一题（罗马数字转整数）&lt;a href=&quot;https://leetcode-cn.com/problems/longest-common-prefix/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://leetcode-cn.com/problems/longest-common-prefix/&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="golang" scheme="http://yoursite.com/categories/golang/"/>
    
    
      <category term="golang" scheme="http://yoursite.com/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>LeetCode（罗马数字转整数）</title>
    <link href="http://yoursite.com/2019/12/18/leetcode_daily_3/"/>
    <id>http://yoursite.com/2019/12/18/leetcode_daily_3/</id>
    <published>2019-12-17T16:00:00.000Z</published>
    <updated>2020-12-04T12:26:51.641Z</updated>
    
    <content type="html"><![CDATA[<p>LeetCode每日一题（罗马数字转整数）<a href="https://leetcode-cn.com/problems/roman-to-integer/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/roman-to-integer/</a></p><a id="more"></a><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>罗马数字包含以下七种字符: I， V， X， L，C，D 和 M。</p><table><thead><tr><th>字符</th><th>数值</th></tr></thead><tbody><tr><td>I</td><td>1</td></tr><tr><td>V</td><td>5</td></tr><tr><td>X</td><td>10</td></tr><tr><td>L</td><td>50</td></tr><tr><td>C</td><td>100</td></tr><tr><td>D</td><td>500</td></tr><tr><td>M</td><td>1000</td></tr></tbody></table><ul><li>I 可以放在 V (5) 和 X (10) 的左边，来表示 4 和 9。</li><li>X 可以放在 L (50) 和 C (100) 的左边，来表示 40 和 90。 </li><li>C 可以放在 D (500) 和 M (1000) 的左边，来表示 400 和 900。</li></ul><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">输入: &quot;III&quot;</span><br><span class="line">输出: 3</span><br><span class="line"></span><br><span class="line">输入: &quot;LVIII&quot;</span><br><span class="line">输出: 58</span><br></pre></td></tr></table></figure><h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">romanToInt</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">r1 := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line"><span class="string">"I"</span>: <span class="number">1</span>,</span><br><span class="line"><span class="string">"V"</span>: <span class="number">5</span>,</span><br><span class="line"><span class="string">"X"</span>: <span class="number">10</span>,</span><br><span class="line"><span class="string">"L"</span>: <span class="number">50</span>,</span><br><span class="line"><span class="string">"C"</span>: <span class="number">100</span>,</span><br><span class="line"><span class="string">"D"</span>: <span class="number">500</span>,</span><br><span class="line"><span class="string">"M"</span>: <span class="number">1000</span>,</span><br><span class="line">&#125;</span><br><span class="line">r2 := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line"><span class="string">"IV"</span>: <span class="number">4</span>,</span><br><span class="line"><span class="string">"IX"</span>: <span class="number">9</span>,</span><br><span class="line"><span class="string">"XL"</span>: <span class="number">40</span>,</span><br><span class="line"><span class="string">"XC"</span>: <span class="number">90</span>,</span><br><span class="line"><span class="string">"CD"</span>: <span class="number">400</span>,</span><br><span class="line"><span class="string">"CM"</span>: <span class="number">900</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ret 用来接收计算结果</span></span><br><span class="line">ret := <span class="number">0</span></span><br><span class="line"><span class="comment">// 判断字符串长度是否为0</span></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">len</span>(s) != <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(s) &gt; <span class="number">1</span> &#123;</span><br><span class="line"><span class="comment">// s长度大于1，先判断前两位是否在r中</span></span><br><span class="line">chars := s[:<span class="number">2</span>]</span><br><span class="line"><span class="keyword">if</span> v, ok := r2[chars]; ok &#123;</span><br><span class="line">ret += v</span><br><span class="line"><span class="comment">// 删掉前两个字符</span></span><br><span class="line">s = s[<span class="number">2</span>:]</span><br><span class="line"><span class="comment">// 判断一个字符是否在r中</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">ret += r1[<span class="keyword">string</span>(s[<span class="number">0</span>])]</span><br><span class="line"><span class="comment">// 删除前一个字符</span></span><br><span class="line">s = s[<span class="number">1</span>:]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 长度为1时</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">ret += r1[<span class="keyword">string</span>(s[<span class="number">0</span>])]</span><br><span class="line"><span class="comment">// 将s置空长度为0</span></span><br><span class="line">s = s[<span class="number">1</span>:]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;LeetCode每日一题（罗马数字转整数）&lt;a href=&quot;https://leetcode-cn.com/problems/roman-to-integer/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://leetcode-cn.com/problems/roman-to-integer/&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="golang" scheme="http://yoursite.com/categories/golang/"/>
    
    
      <category term="golang" scheme="http://yoursite.com/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>LeetCode（整数反转）</title>
    <link href="http://yoursite.com/2019/12/17/leetcode_daily_2/"/>
    <id>http://yoursite.com/2019/12/17/leetcode_daily_2/</id>
    <published>2019-12-16T16:00:00.000Z</published>
    <updated>2020-12-04T12:26:53.421Z</updated>
    
    <content type="html"><![CDATA[<p>LeetCode每日一题（整数反转）<a href="https://leetcode-cn.com/problems/reverse-integer/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/reverse-integer/</a></p><a id="more"></a><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>给出一个 32 位的有符号整数，你需要将这个整数中每位上的数字进行反转。</p><blockquote><p>假设我们的环境只能存储得下 32 位的有符号整数，则其数值范围为 <code>[−2^31, 2^31 − 1]</code><br>。请根据这个假设，如果反转后整数溢出那么就返回 0。</p></blockquote><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">输入: 123</span><br><span class="line">输出: 321</span><br><span class="line"></span><br><span class="line">输入: -123</span><br><span class="line">输出: -321</span><br><span class="line"></span><br><span class="line">输入: 120</span><br><span class="line">输出: 21</span><br></pre></td></tr></table></figure><h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="弹出和推入数字-amp-溢出前进行检查"><a href="#弹出和推入数字-amp-溢出前进行检查" class="headerlink" title="弹出和推入数字 &amp; 溢出前进行检查"></a>弹出和推入数字 &amp; 溢出前进行检查</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 弹出操作:</span><br><span class="line">pop &#x3D; x % 10;</span><br><span class="line">x &#x2F;&#x3D; 10;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 弹出操作:</span><br><span class="line">temp &#x3D; rev * 10 + pop;</span><br><span class="line">rev &#x3D; temp;</span><br></pre></td></tr></table></figure><p>当 <code>temp = rev * 10 + pop</code> 时会导致溢出，所以事先检查这个语句是否会导致溢出。</p><ol><li>如果 <code>temp = rev * 10 + pop</code> 导致溢出，那么一定有 <code>rev &gt;= INTMAX/10</code></li><li>如果 <code>rev &gt; INTMAX/10</code>，那么 <code>temp = rev * 10 + pop</code> 一定会溢出</li><li>如果 <code>rev == INTMAX/10</code>，那么只要 <code>pop &gt; 7</code> ，<code>temp = rev * 10 + pop</code> 就会溢出</li></ol><ul><li>时间复杂度：O(log(x))，x 中大约有 log10(x) 位数字</li><li>空间复杂度：O(1)</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverse</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">rev := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> x != <span class="number">0</span> &#123;</span><br><span class="line">pop := x % <span class="number">10</span></span><br><span class="line">x /= <span class="number">10</span></span><br><span class="line"><span class="keyword">if</span> rev &gt; math.MaxInt32/<span class="number">10</span> || (rev == math.MaxInt32/<span class="number">10</span> &amp;&amp; pop &gt; <span class="number">7</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> rev &lt; math.MinInt32/<span class="number">10</span> || (rev == math.MinInt32/<span class="number">10</span> &amp;&amp; pop &lt; <span class="number">-8</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">rev = rev*<span class="number">10</span> + pop</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> rev</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;LeetCode每日一题（整数反转）&lt;a href=&quot;https://leetcode-cn.com/problems/reverse-integer/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://leetcode-cn.com/problems/reverse-integer/&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="golang" scheme="http://yoursite.com/categories/golang/"/>
    
    
      <category term="golang" scheme="http://yoursite.com/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins使用npm构建Node.js应用</title>
    <link href="http://yoursite.com/2019/12/16/jenkins_npm/"/>
    <id>http://yoursite.com/2019/12/16/jenkins_npm/</id>
    <published>2019-12-15T16:00:00.000Z</published>
    <updated>2020-12-04T12:17:49.375Z</updated>
    
    <content type="html"><![CDATA[<h2 id="在Jenkins中创建流水线项目"><a href="#在Jenkins中创建流水线项目" class="headerlink" title="在Jenkins中创建流水线项目"></a>在Jenkins中创建流水线项目</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/jenkins-docs/building-a-multibranch-pipeline-project.git</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">        docker &#123;</span><br><span class="line">            image 'node:6-alpine' </span><br><span class="line">            args '-p 3000:3000' </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123; </span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'npm install' </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m "Add initial Jenkinsfile"</span><br></pre></td></tr></table></figure><p>simple-node-js-react-npm-app</p><p>An entry-level Pipeline demonstrating how to use Jenkins to build a simple Node.js and React application with npm.</p><h3 id="向流水线添加Test阶段"><a href="#向流水线添加Test阶段" class="headerlink" title="向流水线添加Test阶段"></a>向流水线添加Test阶段</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">        docker &#123;</span><br><span class="line">            image 'node:6-alpine'</span><br><span class="line">            args '-p 3000:3000'</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    environment &#123;</span><br><span class="line">        CI = 'true' </span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'npm install'</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage('Test') &#123; </span><br><span class="line">            steps &#123;</span><br><span class="line">                sh './jenkins/scripts/test.sh' </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git stage .</span><br><span class="line">git commit -m "Add 'Test' stage"</span><br></pre></td></tr></table></figure><h3 id="给流水线添加最终交付阶段"><a href="#给流水线添加最终交付阶段" class="headerlink" title="给流水线添加最终交付阶段"></a>给流水线添加最终交付阶段</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">        docker &#123;</span><br><span class="line">            image 'node:6-alpine'</span><br><span class="line">            args '-p 3000:3000'</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    environment &#123; </span><br><span class="line">        CI = 'true'</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'npm install'</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage('Test') &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh './jenkins/scripts/test.sh'</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage('Deliver') &#123; </span><br><span class="line">            steps &#123;</span><br><span class="line">                sh './jenkins/scripts/deliver.sh' </span><br><span class="line">                input message: 'Finished using the web site? (Click "Proceed" to continue)' </span><br><span class="line">                sh './jenkins/scripts/kill.sh' </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git stage .</span><br><span class="line">git commit -m "Add 'Deliver' stage"</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;在Jenkins中创建流水线项目&quot;&gt;&lt;a href=&quot;#在Jenkins中创建流水线项目&quot; class=&quot;headerlink&quot; title=&quot;在Jenkins中创建流水线项目&quot;&gt;&lt;/a&gt;在Jenkins中创建流水线项目&lt;/h2&gt;&lt;figure class=&quot;hi
      
    
    </summary>
    
    
      <category term="tools" scheme="http://yoursite.com/categories/tools/"/>
    
    
      <category term="docker" scheme="http://yoursite.com/tags/docker/"/>
    
      <category term="CI/CD" scheme="http://yoursite.com/tags/CI-CD/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins使用PyInstaller构建Python应用</title>
    <link href="http://yoursite.com/2019/12/16/jenkins_python/"/>
    <id>http://yoursite.com/2019/12/16/jenkins_python/</id>
    <published>2019-12-15T16:00:00.000Z</published>
    <updated>2020-12-04T12:17:45.209Z</updated>
    
    <content type="html"><![CDATA[<h2 id="在Jenkins中创建流水线项目"><a href="#在Jenkins中创建流水线项目" class="headerlink" title="在Jenkins中创建流水线项目"></a>在Jenkins中创建流水线项目</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/jenkins-docs/simple-python-pyinstaller-app.git</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent none </span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123; </span><br><span class="line">            agent &#123;</span><br><span class="line">                docker &#123;</span><br><span class="line">                    image 'python:2-alpine' </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'python -m py_compile sources/add2vals.py sources/calc.py' </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m "Add initial Jenkinsfile"</span><br></pre></td></tr></table></figure><h3 id="向流水线添加Test阶段"><a href="#向流水线添加Test阶段" class="headerlink" title="向流水线添加Test阶段"></a>向流水线添加Test阶段</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent none</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123;</span><br><span class="line">            agent &#123;</span><br><span class="line">                docker &#123;</span><br><span class="line">                    image 'python:2-alpine'</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'python -m py_compile sources/add2vals.py sources/calc.py'</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage('Test') &#123; </span><br><span class="line">            agent &#123;</span><br><span class="line">                docker &#123;</span><br><span class="line">                    image 'qnib/pytest' </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'py.test --verbose --junit-xml test-reports/results.xml sources/test_calc.py' </span><br><span class="line">            &#125;</span><br><span class="line">            post &#123;</span><br><span class="line">                always &#123;</span><br><span class="line">                    junit 'test-reports/results.xml' </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git stage .</span><br><span class="line">git commit -m "Add 'Test' stage"</span><br></pre></td></tr></table></figure><h3 id="给流水线添加最终交付阶段"><a href="#给流水线添加最终交付阶段" class="headerlink" title="给流水线添加最终交付阶段"></a>给流水线添加最终交付阶段</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent none</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123;</span><br><span class="line">            agent &#123;</span><br><span class="line">                docker &#123;</span><br><span class="line">                    image 'python:2-alpine'</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'python -m py_compile sources/add2vals.py sources/calc.py'</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage('Test') &#123;</span><br><span class="line">            agent &#123;</span><br><span class="line">                docker &#123;</span><br><span class="line">                    image 'qnib/pytest'</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'py.test --verbose --junit-xml test-reports/results.xml sources/test_calc.py'</span><br><span class="line">            &#125;</span><br><span class="line">            post &#123;</span><br><span class="line">                always &#123;</span><br><span class="line">                    junit 'test-reports/results.xml'</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage('Deliver') &#123; </span><br><span class="line">            agent &#123;</span><br><span class="line">                docker &#123;</span><br><span class="line">                    image 'cdrx/pyinstaller-linux:python2' </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'pyinstaller --onefile sources/add2vals.py' </span><br><span class="line">            &#125;</span><br><span class="line">            post &#123;</span><br><span class="line">                success &#123;</span><br><span class="line">                    archiveArtifacts 'dist/add2vals' </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git stage .</span><br><span class="line">git commit -m "Add 'Deliver' stage"</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;在Jenkins中创建流水线项目&quot;&gt;&lt;a href=&quot;#在Jenkins中创建流水线项目&quot; class=&quot;headerlink&quot; title=&quot;在Jenkins中创建流水线项目&quot;&gt;&lt;/a&gt;在Jenkins中创建流水线项目&lt;/h2&gt;&lt;figure class=&quot;hi
      
    
    </summary>
    
    
      <category term="tools" scheme="http://yoursite.com/categories/tools/"/>
    
    
      <category term="docker" scheme="http://yoursite.com/tags/docker/"/>
    
      <category term="CI/CD" scheme="http://yoursite.com/tags/CI-CD/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins使用Maven构建Java应用程序</title>
    <link href="http://yoursite.com/2019/12/16/jenkins_maven/"/>
    <id>http://yoursite.com/2019/12/16/jenkins_maven/</id>
    <published>2019-12-15T16:00:00.000Z</published>
    <updated>2020-12-04T12:17:53.320Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装-Jenkins"><a href="#安装-Jenkins" class="headerlink" title="安装 Jenkins"></a>安装 Jenkins</h2><blockquote><p>参考文档 <a href="https://todevops.github.io/posts/jenkins/" target="_blank" rel="noopener">Jenkins 的安装与使用</a></p></blockquote><h2 id="安装-Docker"><a href="#安装-Docker" class="headerlink" title="安装 Docker"></a>安装 Docker</h2><blockquote><p>参考文档 <a href="https://todevops.github.io/posts/docker/" target="_blank" rel="noopener">Docker 的安装与使用</a></p></blockquote><h2 id="在Jenkins中创建流水线项目"><a href="#在Jenkins中创建流水线项目" class="headerlink" title="在Jenkins中创建流水线项目"></a>在Jenkins中创建流水线项目</h2><ol><li>创建目录，克隆项目；</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># mkdir /home/github</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># git clone https://github.com/jenkins-docs/simple-java-maven-app.git /home/github/simple-java-maven-app</span></span><br></pre></td></tr></table></figure><ol start="2"><li>为新的流水线项目指定名称（例如 simple-java-maven-app）；</li></ol><p><img src="/resources/jenkins/jenkins_07.png" alt=""></p><ol start="3"><li>在 Definition 域中，选择 Pipeline script from SCM 选项。此选项指示Jenkins从源代码管理（SCM）仓库获取你的流水线， 这里的仓库就是你clone到本地的Git仓库；</li><li>在 SCM 域中，选择 Git ，在 Repository URL 域中，填写你本地仓库的目录路径，这是从你主机上的用户账户home目录映射到Jenkins容器的 /home 目录：<code>/home/github/simple-java-maven-app</code>；</li><li>点击 Save 保存你的流水线项目。你现在可以开始创建你的 Jenkinsfile，这些文件会被添加到你的本地仓库</li></ol><p><img src="/resources/jenkins/jenkins_08.png" alt=""></p><h2 id="将初始流水线创建为Jenkinsfile"><a href="#将初始流水线创建为Jenkinsfile" class="headerlink" title="将初始流水线创建为Jenkinsfile"></a>将初始流水线创建为Jenkinsfile</h2><blockquote><p>创建一个初始流水线来下载 Maven Docker 镜像，并将其作为 Docker 容器运行（这将构建你的简单Java应用）。同时添加一个“构建”阶段到流水线中，用于协调整个过程。</p></blockquote><ol><li>在你本地的 simple-java-maven-app Git仓库的根目录创建并保存一个名为 Jenkinsfile 的文本文件。</li><li>复制以下声明式流水线代码并粘贴到 Jenkinsfile 文件中：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># cd /home/github/simple-java-maven-app</span></span><br><span class="line">[root@jenkins simple-java-maven-app]<span class="comment"># vim Jenkinsfile</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">        docker &#123;</span><br><span class="line">            image 'maven:3-alpine'</span><br><span class="line">            args '-v /root/.m2:/root/.m2'</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'mvn -B -DskipTests clean package'</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>保存对 Jenkinsfile 的修改并且将其提交到你本地的 simple-java-maven-app Git仓库<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins simple-java-maven-app]# git stage .</span><br><span class="line">[root@jenkins simple-java-maven-app]# git commit -m "Add initial Jenkinsfile"</span><br></pre></td></tr></table></figure></li><li>再次回到 Jenkins，点击 Build Now。</li></ol><p><img src="/resources/jenkins/jenkins_09.png" alt=""></p><h2 id="为流水线增加test阶段"><a href="#为流水线增加test阶段" class="headerlink" title="为流水线增加test阶段"></a>为流水线增加test阶段</h2><ol><li>打开你的 Jenkinsfile</li><li>复制以下声明式流水线代码，并粘贴到 Jenkinsfile 中 Build 阶段的下方：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">stage('Test') &#123;</span><br><span class="line">    steps &#123;</span><br><span class="line">        sh 'mvn test'</span><br><span class="line">    &#125;</span><br><span class="line">    post &#123;</span><br><span class="line">        always &#123;</span><br><span class="line">            junit 'target/surefire-reports/*.xml'</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>最终的代码为：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">        docker &#123;</span><br><span class="line">            image 'maven:3-alpine'</span><br><span class="line">            args '-v /root/.m2:/root/.m2'</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'mvn -B -DskipTests clean package'</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage('Test') &#123; </span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'mvn test' </span><br><span class="line">            &#125;</span><br><span class="line">            post &#123;</span><br><span class="line">                always &#123;</span><br><span class="line">                    junit 'target/surefire-reports/*.xml'</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>保存对 Jenkinsfile 的修改并将其提交到你的本地 simple-java-maven-app Git仓库。<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git stage .</span><br><span class="line">git commit -m "Add 'Test' stage"</span><br></pre></td></tr></table></figure></li><li>运行构建</li></ol><h2 id="为你的流水线增加deliver阶段"><a href="#为你的流水线增加deliver阶段" class="headerlink" title="为你的流水线增加deliver阶段"></a>为你的流水线增加deliver阶段</h2><ol><li>打开你的 Jenkinsfile。</li><li>复制以下声明式流水线代码，并粘贴到 Jenkinsfile 中 Test 阶段的下方：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">stage('Deliver') &#123;</span><br><span class="line">    steps &#123;</span><br><span class="line">        sh './jenkins/scripts/deliver.sh'</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>最终的代码为：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">        docker &#123;</span><br><span class="line">            image 'maven:3-alpine'</span><br><span class="line">            args '-v /root/.m2:/root/.m2'</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'mvn -B -DskipTests clean package'</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage('Test') &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'mvn test'</span><br><span class="line">            &#125;</span><br><span class="line">            post &#123;</span><br><span class="line">                always &#123;</span><br><span class="line">                    junit 'target/surefire-reports/*.xml'</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage('Deliver') &#123; </span><br><span class="line">            steps &#123;</span><br><span class="line">                sh './jenkins/scripts/deliver.sh' </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>保存对 Jenkinsfile 的修改并将其提交到你的本地 simple-java-maven-app Git仓库。<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git stage .</span><br><span class="line">git commit -m "Add 'Deliver' stage"</span><br></pre></td></tr></table></figure></li><li>运行构建</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;安装-Jenkins&quot;&gt;&lt;a href=&quot;#安装-Jenkins&quot; class=&quot;headerlink&quot; title=&quot;安装 Jenkins&quot;&gt;&lt;/a&gt;安装 Jenkins&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;参考文档 &lt;a href=&quot;https://tod
      
    
    </summary>
    
    
      <category term="tools" scheme="http://yoursite.com/categories/tools/"/>
    
    
      <category term="docker" scheme="http://yoursite.com/tags/docker/"/>
    
      <category term="CI/CD" scheme="http://yoursite.com/tags/CI-CD/"/>
    
  </entry>
  
  <entry>
    <title>LeetCode（两数之和）</title>
    <link href="http://yoursite.com/2019/12/16/leetcode_daily_1/"/>
    <id>http://yoursite.com/2019/12/16/leetcode_daily_1/</id>
    <published>2019-12-15T16:00:00.000Z</published>
    <updated>2020-12-04T12:26:39.033Z</updated>
    
    <content type="html"><![CDATA[<p>LeetCode每日一题（两数之和）<a href="https://leetcode-cn.com/problems/two-sum/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/two-sum/</a></p><a id="more"></a><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>给定一个整数数组 <code>nums</code> 和一个目标值 <code>target</code>，请你在该数组中找出和为目标值的那 <strong>两个</strong> 整数，并返回他们的数组下标。</p><blockquote><p>你可以假设每种输入只会对应一个答案。但是，你不能重复利用这个数组中同样的元素。</p></blockquote><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">给定 nums &#x3D; [2, 7, 11, 15], target &#x3D; 9</span><br><span class="line">因为 nums[0] + nums[1] &#x3D; 2 + 7 &#x3D; 9</span><br><span class="line">所以返回 [0, 1]</span><br></pre></td></tr></table></figure><h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="方法一：暴力法"><a href="#方法一：暴力法" class="headerlink" title="方法一：暴力法"></a>方法一：暴力法</h3><p>遍历每个元素 <code>x</code>，并查找是否存在一个值与 <code>target − x</code> 相等的目标元素。</p><ul><li>时间复杂度：O(n^2)<blockquote><p>对于每个元素，我们试图通过遍历数组的其余部分来寻找它所对应的目标元素，这将耗费 O(n) 的时间。因此时间复杂度为 O(n^2)。</p></blockquote></li><li>空间复杂度：O(1)</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">twoSum</span><span class="params">(nums []<span class="keyword">int</span>, target <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">ret := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line"><span class="keyword">for</span> j := i + <span class="number">1</span>; j &lt; <span class="built_in">len</span>(nums); j++ &#123;</span><br><span class="line"><span class="keyword">if</span> target-nums[i] == nums[j] &#123;</span><br><span class="line">ret = <span class="built_in">append</span>(ret, i, j)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="方法二：两遍哈希表"><a href="#方法二：两遍哈希表" class="headerlink" title="方法二：两遍哈希表"></a>方法二：两遍哈希表</h3><p>在第一次迭代中，我们将每个元素的值和它的索引添加到表中。然后，在第二次迭代中，我们将检查每个元素所对应的目标元素<code>（target - nums[i]）</code>是否存在于表中。注意，该目标元素不能是 <code>nums[i]</code> 本身！</p><ul><li>时间复杂度：O(n)<blockquote><p>我们把包含有 n 个元素的列表遍历两次。由于哈希表将查找时间缩短到 O(1) ，所以时间复杂度为 O(n)。</p></blockquote></li><li>空间复杂度：O(n)<blockquote><p>所需的额外空间取决于哈希表中存储的元素数量，该表中存储了 n 个元素。</p></blockquote></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">twoSum</span><span class="params">(nums []<span class="keyword">int</span>, target <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">numsMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>)</span><br><span class="line">ret := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历 nums 并将 nums 的数值和索引映射</span></span><br><span class="line"><span class="comment">// k: nums []int 索引</span></span><br><span class="line"><span class="comment">// v: nums []int 值</span></span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> nums &#123;</span><br><span class="line">numsMap[v] = k</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, v := <span class="keyword">range</span> nums &#123;</span><br><span class="line"><span class="comment">// 取出一个数然后求出剩下一个数的值</span></span><br><span class="line">x := target - v</span><br><span class="line"><span class="comment">// 判断剩下的数是否存在于 numsMap 中</span></span><br><span class="line"><span class="comment">// 如果存在则返回两个数的索引 i, numsMap[x]</span></span><br><span class="line"><span class="keyword">if</span> _, ok := numsMap[x]; ok &#123;</span><br><span class="line"><span class="comment">// 当 x(target-v) 值所处的索引 (numsMap[x]) 等于当前索引</span></span><br><span class="line"><span class="comment">// 即为同一个数则直接返回空</span></span><br><span class="line"><span class="keyword">if</span> i != numsMap[x] &#123;</span><br><span class="line">ret = <span class="built_in">append</span>(ret, i, numsMap[x])</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="方法三：一遍哈希表"><a href="#方法三：一遍哈希表" class="headerlink" title="方法三：一遍哈希表"></a>方法三：一遍哈希表</h3><p>在进行迭代并将元素插入到表中的同时，我们还会回过头来检查表中是否已经存在当前元素所对应的目标元素。如果它存在，那我们已经找到了对应解，并立即将其返回。</p><ul><li>时间复杂度：O(n)<blockquote><p>我们只遍历了包含有 n 个元素的列表一次。在表中进行的每次查找只花费 O(1) 的时间。</p></blockquote></li><li>空间复杂度：O(n)<blockquote><p>所需的额外空间取决于哈希表中存储的元素数量，该表最多需要存储 n 个元素。</p></blockquote></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">twoSum</span><span class="params">(nums []<span class="keyword">int</span>, target <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">numsMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>)</span><br><span class="line">ret := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, v := <span class="keyword">range</span> nums &#123;</span><br><span class="line">x := target - v</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> _, ok := numsMap[x]; ok &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i != numsMap[x] &#123;</span><br><span class="line">ret = <span class="built_in">append</span>(ret, numsMap[x], i)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">numsMap[v] = i</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;LeetCode每日一题（两数之和）&lt;a href=&quot;https://leetcode-cn.com/problems/two-sum/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://leetcode-cn.com/problems/two-sum/&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="golang" scheme="http://yoursite.com/categories/golang/"/>
    
    
      <category term="golang" scheme="http://yoursite.com/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>Go Tour 练习</title>
    <link href="http://yoursite.com/2019/12/15/go_tour/"/>
    <id>http://yoursite.com/2019/12/15/go_tour/</id>
    <published>2019-12-14T16:00:00.000Z</published>
    <updated>2020-12-04T12:16:01.546Z</updated>
    
    <content type="html"><![CDATA[<h2 id="练习-1：循环与函数"><a href="#练习-1：循环与函数" class="headerlink" title="练习 1：循环与函数"></a>练习 1：<a href="https://tour.go-zh.org/flowcontrol/8" target="_blank" rel="noopener">循环与函数</a></h2><p>为了练习函数与循环，我们来实现一个平方根函数：用牛顿法实现平方根函数。<br>计算机通常使用循环来计算 x 的平方根。从某个猜测的值 z 开始，我们可以根据 z² 与 x 的近似度来调整 z，产生一个更好的猜测：<br><code>z -= (z*z - x) / (2*z)</code><br>重复调整的过程，猜测的结果会越来越精确，得到的答案也会尽可能接近实际的平方根。<br>在提供的 func Sqrt 中实现它。无论输入是什么，对 z 的一个恰当的猜测为 1。 要开始，请重复计算 10 次并随之打印每次的 z 值。观察对于不同的值 <code>x（1、2、3 ...）</code>， 你得到的答案是如何逼近结果的，猜测提升的速度有多快。<br>提示：用类型转换或浮点数语法来声明并初始化一个浮点数值：<br><code>z := 1.0</code><br><code>z := float64(1)</code><br>然后，修改循环条件，使得当值停止改变（或改变非常小）的时候退出循环。观察迭代次数大于还是小于 10。 尝试改变 z 的初始猜测，如 x 或 x/2。你的函数结果与标准库中的 math.Sqrt 接近吗？<br>（<em>注：</em> 如果你对该算法的细节感兴趣，上面的 <code>z² − x</code> 是 <code>z²</code> 到它所要到达的值（即 x）的距离， 除以的 2z 为 z² 的导数，我们通过 z² 的变化速度来改变 z 的调整量。 这种通用方法叫做牛顿法。 它对很多函数，特别是平方根而言非常有效。）</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sqrt</span><span class="params">(x <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(Sqrt(<span class="number">2</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"math"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sqrt</span><span class="params">(x <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">z := <span class="number">1.0</span><span class="comment">// 初始化z</span></span><br><span class="line">temp := <span class="number">0.0</span><span class="comment">// 初始化temp，用于临时存放结果</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">z = z - (z*z-x)/(<span class="number">2</span>*z)<span class="comment">// 定义牛顿法公式求出新的z值</span></span><br><span class="line">fmt.Println(z)</span><br><span class="line"><span class="keyword">if</span> math.Abs(z-temp) &lt; <span class="number">0.000000000000001</span> &#123;<span class="comment">// 判断z是否达到精度</span></span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">temp = z<span class="comment">// 临时存放计算得出的z</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> z</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"牛顿法:"</span>)</span><br><span class="line">fmt.Println(Sqrt(<span class="number">3</span>))</span><br><span class="line">fmt.Println(<span class="string">"math.Sqrt:"</span>)</span><br><span class="line">fmt.Println(math.Sqrt(<span class="number">3</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">牛顿法:</span><br><span class="line">2</span><br><span class="line">1.75</span><br><span class="line">1.7321428571428572</span><br><span class="line">1.7320508100147276</span><br><span class="line">1.7320508075688772</span><br><span class="line">1.7320508075688774</span><br><span class="line">1.7320508075688774</span><br><span class="line">math.Sqrt:</span><br><span class="line">1.7320508075688772</span><br></pre></td></tr></table></figure><h2 id="练习-2：切片"><a href="#练习-2：切片" class="headerlink" title="练习 2：切片"></a>练习 2：<a href="https://tour.go-zh.org/moretypes/18" target="_blank" rel="noopener">切片</a></h2><p>实现 Pic。它应当返回一个长度为 dy 的切片，其中每个元素是一个长度为 dx，元素类型为 uint8 的切片。当你运行此程序时，它会将每个整数解释为灰度值（好吧，其实是蓝度值）并显示它所对应的图像。</p><p>图像的选择由你来定。几个有趣的函数包括 (x+y)/2, x<em>y, x^y, x</em>log(y) 和 x%(y+1)。</p><p>（提示：需要使用循环来分配 [][]uint8 中的每个 []uint8；请使用 uint8(intValue) 在类型之间转换；你可能会用到 math 包中的函数。）</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"golang.org/x/tour/pic"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Pic</span><span class="params">(dx, dy <span class="keyword">int</span>)</span> [][]<span class="title">uint8</span></span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">pic.Show(Pic)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a>实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"golang.org/x/tour/pic"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Pic</span><span class="params">(dx, dy <span class="keyword">int</span>)</span> [][]<span class="title">uint8</span></span> &#123;</span><br><span class="line">a := <span class="built_in">make</span>([][]<span class="keyword">uint8</span>, dy)<span class="comment">// make 一个长度为 dy 的二维数组切片</span></span><br><span class="line">  <span class="keyword">for</span> x := <span class="keyword">range</span> a &#123;<span class="comment">// index, value := range a，x 为数组索引</span></span><br><span class="line">b := <span class="built_in">make</span>([]<span class="keyword">uint8</span>, dx)<span class="comment">// make 一个长度为 dx 的一维数组切片</span></span><br><span class="line"><span class="keyword">for</span> y := <span class="keyword">range</span> b &#123;<span class="comment">// y 为数组索引</span></span><br><span class="line">b[y] = <span class="keyword">uint8</span>(x % (y + <span class="number">1</span>))<span class="comment">// 修改数组 b 对应索引位置的值</span></span><br><span class="line">&#125;</span><br><span class="line">a[x] = b<span class="comment">// 修改数组 a 对应索引位置的值</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">pic.Show(Pic)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="练习-3：映射"><a href="#练习-3：映射" class="headerlink" title="练习 3：映射"></a>练习 3：<a href="https://tour.go-zh.org/moretypes/23" target="_blank" rel="noopener">映射</a></h2><p>实现 WordCount。它应当返回一个映射，其中包含字符串 s 中每个“单词”的个数。函数 wc.Test 会对此函数执行一系列测试用例，并输出成功还是失败。<br>你会发现 strings.Fields 很有帮助。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"golang.org/x/tour/wc"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WordCount</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">map</span>[<span class="title">string</span>]<span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;<span class="string">"x"</span>: <span class="number">1</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">wc.Test(WordCount)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现-2"><a href="#实现-2" class="headerlink" title="实现"></a>实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"strings"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"golang.org/x/tour/wc"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WordCount</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">map</span>[<span class="title">string</span>]<span class="title">int</span></span> &#123;</span><br><span class="line">a := strings.Fields(s)<span class="comment">// 使用 strings.Fields 将字符串分割成数组</span></span><br><span class="line">map_s := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)<span class="comment">// 映射单词和出现次数</span></span><br><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> a &#123;<span class="comment">// 遍历 a 的值</span></span><br><span class="line">_, ok := map_s[v]<span class="comment">// 获取状态值</span></span><br><span class="line"><span class="keyword">if</span> ok &#123;<span class="comment">// 判断map中是否存在当前字符串为下标的值</span></span><br><span class="line">map_s[v]++<span class="comment">// 有则出现次数+1</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">map_s[v] = <span class="number">1</span><span class="comment">// 无则=1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> map_s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">wc.Test(WordCount)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="结果-1"><a href="#结果-1" class="headerlink" title="结果"></a>结果</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PASS</span><br><span class="line"> f(&quot;I am learning Go!&quot;) &#x3D; </span><br><span class="line">  map[string]int&#123;&quot;Go!&quot;:1, &quot;I&quot;:1, &quot;am&quot;:1, &quot;learning&quot;:1&#125;</span><br><span class="line">PASS</span><br><span class="line"> f(&quot;The quick brown fox jumped over the lazy dog.&quot;) &#x3D; </span><br><span class="line">  map[string]int&#123;&quot;The&quot;:1, &quot;brown&quot;:1, &quot;dog.&quot;:1, &quot;fox&quot;:1, &quot;jumped&quot;:1, &quot;lazy&quot;:1, &quot;over&quot;:1, &quot;quick&quot;:1, &quot;the&quot;:1&#125;</span><br><span class="line">PASS</span><br><span class="line"> f(&quot;I ate a donut. Then I ate another donut.&quot;) &#x3D; </span><br><span class="line">  map[string]int&#123;&quot;I&quot;:2, &quot;Then&quot;:1, &quot;a&quot;:1, &quot;another&quot;:1, &quot;ate&quot;:2, &quot;donut.&quot;:2&#125;</span><br><span class="line">PASS</span><br><span class="line"> f(&quot;A man a plan a canal panama.&quot;) &#x3D; </span><br><span class="line">  map[string]int&#123;&quot;A&quot;:1, &quot;a&quot;:2, &quot;canal&quot;:1, &quot;man&quot;:1, &quot;panama.&quot;:1, &quot;plan&quot;:1&#125;</span><br></pre></td></tr></table></figure><h2 id="练习-4：斐波纳契闭包"><a href="#练习-4：斐波纳契闭包" class="headerlink" title="练习 4：斐波纳契闭包"></a>练习 4：<a href="https://tour.go-zh.org/moretypes/26" target="_blank" rel="noopener">斐波纳契闭包</a></h2><p>实现一个 <code>fibonacci</code> 函数，它返回一个函数（闭包），该闭包返回一个斐波纳契数列 <code>(0, 1, 1, 2, 3, 5, ...)</code>。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回一个“返回int的函数”</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fibonacci</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">f := fibonacci()</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">fmt.Println(f())</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现-3"><a href="#实现-3" class="headerlink" title="实现"></a>实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回一个“返回int的函数”</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fibonacci</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">a, b := <span class="number">0</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">temp := a</span><br><span class="line">a, b = b, a+b</span><br><span class="line"><span class="keyword">return</span> temp</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">f := fibonacci()</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">fmt.Println(f())</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="结果-2"><a href="#结果-2" class="headerlink" title="结果"></a>结果</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">8</span><br><span class="line">13</span><br><span class="line">21</span><br><span class="line">34</span><br></pre></td></tr></table></figure><h2 id="练习-5：-Stringer"><a href="#练习-5：-Stringer" class="headerlink" title="练习 5： Stringer"></a>练习 5： <a href="https://tour.go-zh.org/methods/18" target="_blank" rel="noopener">Stringer</a></h2><ol><li>通过让 <code>IPAddr</code> 类型实现 <code>fmt.Stringer</code> 来打印点号分隔的地址。  <blockquote><p>例如，<code>IPAddr{1, 2, 3, 4}</code> 应当打印为 <code>&quot;1.2.3.4&quot;</code>。</p></blockquote></li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IPAddr [<span class="number">4</span>]<span class="keyword">byte</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 给 IPAddr 添加一个 "String() string" 方法</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">hosts := <span class="keyword">map</span>[<span class="keyword">string</span>]IPAddr&#123;</span><br><span class="line"><span class="string">"loopback"</span>:  &#123;<span class="number">127</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line"><span class="string">"googleDNS"</span>: &#123;<span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> name, ip := <span class="keyword">range</span> hosts &#123;</span><br><span class="line">fmt.Printf(<span class="string">"%v: %v\n"</span>, name, ip)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现-4"><a href="#实现-4" class="headerlink" title="实现"></a>实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IPAddr [<span class="number">4</span>]<span class="keyword">byte</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 给 IPAddr 添加一个 "String() string" 方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ip IPAddr)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">"%v.%v.%v.%v"</span>, ip[<span class="number">0</span>], ip[<span class="number">1</span>], ip[<span class="number">2</span>], ip[<span class="number">3</span>])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">hosts := <span class="keyword">map</span>[<span class="keyword">string</span>]IPAddr&#123;</span><br><span class="line"><span class="string">"loopback"</span>:  &#123;<span class="number">127</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line"><span class="string">"googleDNS"</span>: &#123;<span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> name, ip := <span class="keyword">range</span> hosts &#123;</span><br><span class="line">fmt.Printf(<span class="string">"%v: %v\n"</span>, name, ip)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="结果-3"><a href="#结果-3" class="headerlink" title="结果"></a>结果</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">loopback: 127.0.0.1</span><br><span class="line">googleDNS: 8.8.8.8</span><br></pre></td></tr></table></figure><h2 id="练习-6：错误"><a href="#练习-6：错误" class="headerlink" title="练习 6：错误"></a>练习 6：<a href="https://tour.go-zh.org/methods/20" target="_blank" rel="noopener">错误</a></h2><p>Sqrt 接受到一个负数时，应当返回一个非 nil 的错误值。复数同样也不被支持。  </p><ul><li>创建一个新的类型<br><code>type ErrNegativeSqrt float64</code><br>并为其实现<br><code>func (e ErrNegativeSqrt) Error() string</code><br>方法使其拥有 <code>error</code> 值，通过 <code>ErrNegativeSqrt(-2).Error()</code> 调用该方法应返回 <code>&quot;cannot Sqrt negative number: -2&quot;</code>。  </li></ul><blockquote><p>注意: 在 Error 方法内调用 <code>fmt.Sprint(e)</code> 会让程序陷入死循环。可以通过先转换 e 来避免这个问题：<code>fmt.Sprint(float64(e))</code>。这是为什么呢？  </p></blockquote><ul><li>修改 <code>Sqrt</code> 函数，使其接受一个负数时，返回 <code>ErrNegativeSqrt</code> 值。</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sqrt</span><span class="params">(x <span class="keyword">float64</span>)</span> <span class="params">(<span class="keyword">float64</span>, error)</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(Sqrt(<span class="number">2</span>))</span><br><span class="line">fmt.Println(Sqrt(<span class="number">-2</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现-5"><a href="#实现-5" class="headerlink" title="实现"></a>实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"math"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ErrNegativeSqrt <span class="keyword">float64</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e ErrNegativeSqrt)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;<span class="comment">// 重写 Error 函数</span></span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">"cannot Sqrt negative number:%v"</span>, <span class="keyword">float64</span>(e))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sqrt</span><span class="params">(x <span class="keyword">float64</span>)</span> <span class="params">(<span class="keyword">float64</span>, error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> x &lt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, ErrNegativeSqrt(x)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(x), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(Sqrt(<span class="number">2</span>))</span><br><span class="line">fmt.Println(Sqrt(<span class="number">-2</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="结果-4"><a href="#结果-4" class="headerlink" title="结果"></a>结果</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.4142135623730951 &lt;nil&gt;</span><br><span class="line">0 cannot Sqrt negative number:-2</span><br></pre></td></tr></table></figure><h2 id="练习-7：Reader"><a href="#练习-7：Reader" class="headerlink" title="练习 7：Reader"></a>练习 7：<a href="https://tour.go-zh.org/methods/22" target="_blank" rel="noopener">Reader</a></h2><ul><li>实现一个 <code>Reader</code> 类型，它产生一个 ASCII 字符 ‘A’ 的无限流。</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"golang.org/x/tour/reader"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyReader <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 给 MyReader 添加一个 Read([]byte) (int, error) 方法</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">reader.Validate(MyReader&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现-6"><a href="#实现-6" class="headerlink" title="实现"></a>实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"golang.org/x/tour/reader"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyReader <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 给 MyReader 添加一个 Read([]byte) (int, error) 方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r MyReader)</span> <span class="title">Read</span><span class="params">(b []<span class="keyword">byte</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">b[<span class="number">0</span>] = <span class="string">'A'</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">reader.Validate(MyReader&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="练习-8：rot13Reader"><a href="#练习-8：rot13Reader" class="headerlink" title="练习 8：rot13Reader"></a>练习 8：<a href="https://tour.go-zh.org/methods/23" target="_blank" rel="noopener">rot13Reader</a></h2><p>有种常见的模式是一个 <code>io.Reader</code> 包装另一个 <code>io.Reader</code>，然后通过某种方式修改其数据流。  </p><blockquote><p>例如，<code>gzip.NewReader</code> 函数接受一个 <code>io.Reader</code>（已压缩的数据流）并返回一个同样实现了 <code>io.Reader</code> 的 <code>*gzip.Reader</code>（解压后的数据流）。</p></blockquote><ul><li>编写一个实现了 <code>io.Reader</code> 并从另一个 <code>io.Reader</code> 中读取数据的 <code>rot13Reader</code>，通过应用 <code>rot13</code> 代换密码对数据流进行修改。</li></ul><blockquote><figure class="highlight plain"><figcaption><span>类型已经提供。实现 ```Read``` 方法以满足 ```io.Reader```。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#96;&#96;&#96;go</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">&quot;io&quot;</span><br><span class="line">&quot;os&quot;</span><br><span class="line">&quot;strings&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type rot13Reader struct &#123;</span><br><span class="line">r io.Reader</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">s :&#x3D; strings.NewReader(&quot;Lbh penpxrq gur pbqr!&quot;)</span><br><span class="line">r :&#x3D; rot13Reader&#123;s&#125;</span><br><span class="line">io.Copy(os.Stdout, &amp;r)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></blockquote><h3 id="实现-7"><a href="#实现-7" class="headerlink" title="实现"></a>实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"io"</span></span><br><span class="line"><span class="string">"os"</span></span><br><span class="line"><span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> rot13Reader <span class="keyword">struct</span> &#123;</span><br><span class="line">r io.Reader</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现 rot13 函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">rot13</span><span class="params">(out <span class="keyword">byte</span>)</span> <span class="title">byte</span></span> &#123;<span class="comment">//字母转换</span></span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line"><span class="keyword">case</span> out &gt;= <span class="string">'A'</span> &amp;&amp; out &lt;= <span class="string">'M'</span> || out &gt;= <span class="string">'a'</span> &amp;&amp; out &lt;= <span class="string">'m'</span>:</span><br><span class="line">out += <span class="number">13</span></span><br><span class="line"><span class="keyword">case</span> out &gt;= <span class="string">'N'</span> &amp;&amp; out &lt;= <span class="string">'Z'</span> || out &gt;= <span class="string">'n'</span> &amp;&amp; out &lt;= <span class="string">'z'</span>:</span><br><span class="line">out -= <span class="number">13</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> out</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(fz rot13Reader)</span> <span class="title">Read</span><span class="params">(b []<span class="keyword">byte</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">n, e := fz.r.Read(b)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">b[i] = rot13(b[i])</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> n, e</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := strings.NewReader(<span class="string">"Lbh penpxrq gur pbqr!"</span>)</span><br><span class="line">r := rot13Reader&#123;s&#125;</span><br><span class="line">io.Copy(os.Stdout, &amp;r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="结果-5"><a href="#结果-5" class="headerlink" title="结果"></a>结果</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You cracked the code!%</span><br></pre></td></tr></table></figure><h2 id="练习-9：图像"><a href="#练习-9：图像" class="headerlink" title="练习 9：图像"></a>练习 9：<a href="https://tour.go-zh.org/methods/25" target="_blank" rel="noopener">图像</a></h2><p>还记得之前编写的图片生成器 吗？我们再来编写另外一个，不过这次它将会返回一个 image.Image 的实现而非一个数据切片。<br>定义你自己的 Image 类型，实现必要的方法并调用 pic.ShowImage。<br>Bounds 应当返回一个 image.Rectangle ，例如 image.Rect(0, 0, w, h)。<br>ColorModel 应当返回 color.RGBAModel。<br>At 应当返回一个颜色。上一个图片生成器的值 v 对应于此次的 color.RGBA{v, v, 255, 255}。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"golang.org/x/tour/pic"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Image <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">m := Image&#123;&#125;</span><br><span class="line">pic.ShowImage(m)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现-8"><a href="#实现-8" class="headerlink" title="实现"></a>实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"image"</span></span><br><span class="line"><span class="string">"image/color"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"golang.org/x/tour/pic"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Image <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i Image)</span> <span class="title">ColorModel</span><span class="params">()</span> <span class="title">color</span>.<span class="title">Model</span></span> &#123;<span class="comment">//实现 Image 包中颜色模式的方法</span></span><br><span class="line"><span class="keyword">return</span> color.RGBAModel</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i Image)</span> <span class="title">Bounds</span><span class="params">()</span> <span class="title">image</span>.<span class="title">Rectangle</span></span> &#123;<span class="comment">//实现 Image 包中生成图片边界的方法</span></span><br><span class="line"><span class="keyword">return</span> image.Rect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i Image)</span> <span class="title">At</span><span class="params">(x, y <span class="keyword">int</span>)</span> <span class="title">color</span>.<span class="title">Color</span></span> &#123;<span class="comment">// 实现 Image 包中生成图像某个点的方法</span></span><br><span class="line"><span class="keyword">return</span> color.RGBA&#123;<span class="keyword">uint8</span>(x), <span class="keyword">uint8</span>(y), <span class="keyword">uint8</span>(<span class="number">255</span>), <span class="keyword">uint8</span>(<span class="number">255</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">m := Image&#123;&#125;</span><br><span class="line">pic.ShowImage(m)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;练习-1：循环与函数&quot;&gt;&lt;a href=&quot;#练习-1：循环与函数&quot; class=&quot;headerlink&quot; title=&quot;练习 1：循环与函数&quot;&gt;&lt;/a&gt;练习 1：&lt;a href=&quot;https://tour.go-zh.org/flowcontrol/8&quot; targ
      
    
    </summary>
    
    
      <category term="golang" scheme="http://yoursite.com/categories/golang/"/>
    
    
      <category term="golang" scheme="http://yoursite.com/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>Python 判断变量的类型</title>
    <link href="http://yoursite.com/2019/11/20/python-variable/"/>
    <id>http://yoursite.com/2019/11/20/python-variable/</id>
    <published>2019-11-20T10:10:52.000Z</published>
    <updated>2020-12-04T12:22:19.659Z</updated>
    
    <content type="html"><![CDATA[<p>Python 判断变量的类型的方法</p><a id="more"></a><h2 id="python-判断变量的类型"><a href="#python-判断变量的类型" class="headerlink" title="python 判断变量的类型"></a>python 判断变量的类型</h2><p>python的数据类型有：</p><ul><li>数字(int)</li><li>浮点(float)</li><li>字符串(str)</li><li>列表(list)</li><li>元组(tuple)</li><li>字典(dict)</li><li>集合(set)</li></ul><p>一般通过以下方法判断变量类型：</p><ul><li>isinstance(参数1, 参数2)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">1</span></span><br><span class="line">isinstance(i, int)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="string">"test"</span></span><br><span class="line">isinstance(i, str)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">isinstance(i, tuple)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><ul><li>type(参数1)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">1</span></span><br><span class="line">type(i)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">int</span>'&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="string">"test"</span></span><br><span class="line">type(i)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">type(i)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">tuple</span>'&gt;</span></span><br></pre></td></tr></table></figure><h2 id="python-变量转换错误-ValueError"><a href="#python-变量转换错误-ValueError" class="headerlink" title="python 变量转换错误 ValueError"></a>python 变量转换错误 ValueError</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">3.1415926</span></span><br><span class="line">int(i)</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">2</span></span><br><span class="line">float(i)</span><br><span class="line"><span class="number">2.0</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="string">"test"</span></span><br><span class="line">int(i)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ValueError: invalid literal <span class="keyword">for</span> int() <span class="keyword">with</span> base <span class="number">10</span>: <span class="string">'test'</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="string">"test"</span></span><br><span class="line">tuple(i)</span><br><span class="line">(<span class="string">'t'</span>, <span class="string">'e'</span>, <span class="string">'s'</span>, <span class="string">'t'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="string">"test"</span></span><br><span class="line">list(i)</span><br><span class="line">[<span class="string">'t'</span>, <span class="string">'e'</span>, <span class="string">'s'</span>, <span class="string">'t'</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="string">"test"</span></span><br><span class="line">dict(i)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ValueError: dictionary update sequence element <span class="comment">#0 has length 1; 2 is required</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="string">"test"</span></span><br><span class="line">set(i)</span><br><span class="line">&#123;<span class="string">'e'</span>, <span class="string">'s'</span>, <span class="string">'t'</span>&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Python 判断变量的类型的方法&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="python" scheme="http://yoursite.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Docker /etc/docker/daemon.json 文件的参数</title>
    <link href="http://yoursite.com/2019/11/20/docker-daemon-json/"/>
    <id>http://yoursite.com/2019/11/20/docker-daemon-json/</id>
    <published>2019-11-20T09:25:46.000Z</published>
    <updated>2020-12-04T12:14:45.328Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="attr">"api-cors-header"</span>:<span class="string">""</span>, </span><br><span class="line"> <span class="attr">"authorization-plugins"</span>:[],</span><br><span class="line"> <span class="attr">"bip"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="attr">"bridge"</span>:<span class="string">""</span>,</span><br><span class="line"> <span class="attr">"cgroup-parent"</span>:<span class="string">""</span>,</span><br><span class="line"> <span class="attr">"cluster-store"</span>:<span class="string">""</span>,</span><br><span class="line"> <span class="attr">"cluster-store-opts"</span>:&#123;&#125;,</span><br><span class="line"> <span class="attr">"cluster-advertise"</span>:<span class="string">""</span>,</span><br><span class="line"> <span class="attr">"debug"</span>: <span class="literal">true</span>,</span><br><span class="line"> <span class="attr">"default-gateway"</span>:<span class="string">""</span>,</span><br><span class="line"> <span class="attr">"default-gateway-v6"</span>:<span class="string">""</span>,</span><br><span class="line"> <span class="attr">"default-runtime"</span>:<span class="string">"runc"</span>,</span><br><span class="line"> <span class="attr">"default-ulimits"</span>:&#123;&#125;,</span><br><span class="line"> <span class="attr">"disable-legacy-registry"</span>:<span class="literal">false</span>,</span><br><span class="line"> "dns": ["192.168.1.1"],        # 设定容器DNS的地址，在容器的 /etc/resolv.conf文件中可查看。</span><br><span class="line"> "dns-opts": [],                # 容器 /etc/resolv.conf 文件，其他设置</span><br><span class="line"> "dns-search": [],              # 设定容器的搜索域，当设定搜索域为 .example.com 时，在搜索一个名为 host 的 主机时，DNS不仅搜索host，还会搜索host.example.com 。 注意：如果不设置， Docker 会默认用主机上的 /etc/resolv.conf 来配置容器。</span><br><span class="line"> </span><br><span class="line">"exec-opts": [],</span><br><span class="line"> "exec-root":"",</span><br><span class="line"> "fixed-cidr":"",</span><br><span class="line"> "fixed-cidr-v6":"",</span><br><span class="line"> "data-root":"/var/lib/docker",     ＃ Docker运行时使用的根路径,根路径下的内容稍后介绍，默认/var/lib/docker</span><br><span class="line"> "group": "",                       # Unix套接字的属组,仅指/var/run/docker.sock</span><br><span class="line"> "hosts": [],                       # 设置容器hosts</span><br><span class="line"> "icc": false,</span><br><span class="line"> "insecure-registries": [],         # 配置docker的私库地址</span><br><span class="line"> "ip":"0.0.0.0",</span><br><span class="line"> "iptables": false,</span><br><span class="line"> "ipv6": false,</span><br><span class="line"> "ip-forward": false,               # 默认true, 启用 net.ipv4.ip_forward ,进入容器后使用 sysctl -a | grepnet.ipv4.ip_forward 查看</span><br><span class="line"> </span><br><span class="line">  "ip-masq":false,</span><br><span class="line"> "labels":["nodeName=node-121"],   # docker主机的标签，很实用的功能,例如定义：–label nodeName=host-121</span><br><span class="line"> </span><br><span class="line"> "live-restore": true,</span><br><span class="line"> "log-driver":"",</span><br><span class="line"> "log-level":"",</span><br><span class="line"> "log-opts": &#123;&#125;,</span><br><span class="line"> "max-concurrent-downloads":3,</span><br><span class="line"> "max-concurrent-uploads":5,</span><br><span class="line"> "mtu": 0,</span><br><span class="line"> "oom-score-adjust":-500,</span><br><span class="line"> "pidfile": "",                    # Docker守护进程的PID文件</span><br><span class="line"> "raw-logs": false,</span><br><span class="line"> "registry-mirrors":["xxxx"],      # 镜像加速的地址，增加后在 docker info 中可查看。</span><br><span class="line"> "runtimes": &#123;</span><br><span class="line"> "runc": &#123;</span><br><span class="line"> "path": "runc"</span><br><span class="line"> &#125;,</span><br><span class="line"> "custom": &#123;</span><br><span class="line"> "path":"/usr/local/bin/my-runc-replacement",</span><br><span class="line"> "runtimeArgs": [</span><br><span class="line"> <span class="string">"--debug"</span></span><br><span class="line"> ]</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;,</span><br><span class="line"> "selinux-enabled": false,          # 默认 false，启用 selinux 支持</span><br><span class="line"> </span><br><span class="line"> "storage-driver":"",</span><br><span class="line"> "storage-opts": [],</span><br><span class="line"> "swarm-default-advertise-addr":"",</span><br><span class="line"> "tls": true,                       # 默认 false, 启动TLS认证开关</span><br><span class="line"> "tlscacert": "",                   # 默认 ~/.docker/ca.pem，通过CA认证过的的certificate文件路径</span><br><span class="line"> "tlscert": "",                     # 默认 ~/.docker/cert.pem，TLS的certificate文件路径</span><br><span class="line"> "tlskey": "",                      # 默认 ~/.docker/key.pem，TLS的key文件路径</span><br><span class="line"> "tlsverify": true,                 # 默认 false，使用TLS并做后台进程与客户端通讯的验证</span><br><span class="line"> "userland-proxy":false,</span><br><span class="line"> "userns-remap":""</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line
      
    
    </summary>
    
    
      <category term="linux" scheme="http://yoursite.com/categories/linux/"/>
    
    
      <category term="linux" scheme="http://yoursite.com/tags/linux/"/>
    
      <category term="docker" scheme="http://yoursite.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>将 Nginx 日志格式化成 json</title>
    <link href="http://yoursite.com/2019/11/19/nginx-log-format-to-json/"/>
    <id>http://yoursite.com/2019/11/19/nginx-log-format-to-json/</id>
    <published>2019-11-19T09:27:38.000Z</published>
    <updated>2020-12-04T12:21:16.459Z</updated>
    
    <content type="html"><![CDATA[<p>将 Nginx 日志格式化成 json 格式</p><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 修改log_format</span><br><span class="line">log_format log_json &#39;&#123;&quot;timestamp&quot;:&quot;$time_local&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;http_host&quot;:&quot;$http_host&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;clinetip&quot;:&quot;$remote_addr&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;request&quot;:&quot;$request&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;status&quot;:&quot;$status&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;size&quot;:&quot;$body_bytes_sent&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;upstream_addr&quot;:&quot;$upstream_addr&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;upstream_status&quot;:&quot;$upstream_status&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;upstream_response_time&quot;:&quot;$upstream_response_time&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;request_time&quot;:&quot;$request_time&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;http_referer&quot;:&quot;$http_referer&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;http_user_agent&quot;:&quot;$http_user_agent&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;http_x_forwarded_for&quot;:&quot;$http_x_forwarded_for&quot;&#125;&#39;;</span><br><span class="line">access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log  log_json;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;将 Nginx 日志格式化成 json 格式&lt;/p&gt;
    
    </summary>
    
    
      <category term="linux" scheme="http://yoursite.com/categories/linux/"/>
    
    
      <category term="nginx" scheme="http://yoursite.com/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>使用 ELK 搭建日志分析系统</title>
    <link href="http://yoursite.com/2019/11/19/elk/"/>
    <id>http://yoursite.com/2019/11/19/elk/</id>
    <published>2019-11-19T05:22:39.000Z</published>
    <updated>2020-12-04T12:23:38.074Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt;&gt; &#x2F;etc&#x2F;security&#x2F;limits.conf</span><br><span class="line">* soft nproc 65535</span><br><span class="line">* hard nproc 65535</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">    tcp &#123;</span><br><span class="line">        port &#x3D;&gt; 8002</span><br><span class="line">        codec &#x3D;&gt; json_lines</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter&#123;</span><br><span class="line"># 如果message中以Retrieved hosts from InstanceDiscovery: 0开头</span><br><span class="line">    if([message]&#x3D;~ &quot;^Retrieved hosts from InstanceDiscovery: 0&quot;)&#123;</span><br><span class="line">    # 丢弃</span><br><span class="line">        drop&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">        elasticsearch &#123;</span><br><span class="line">                hosts &#x3D;&gt; &quot;localhost:8001&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        stdout &#123; codec &#x3D;&gt; rubydebug&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">filter &#123;</span><br><span class="line">    json &#123;</span><br><span class="line">        source &#x3D;&gt; &quot;message&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class
      
    
    </summary>
    
    
      <category term="linux" scheme="http://yoursite.com/categories/linux/"/>
    
    
      <category term="elasticsearch" scheme="http://yoursite.com/tags/elasticsearch/"/>
    
  </entry>
  
</feed>
