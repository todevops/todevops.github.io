<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>RHEL 7 配置网络绑定</title>
      <link href="2020/01/15/bond/"/>
      <url>2020/01/15/bond/</url>
      
        <content type="html"><![CDATA[<h2 id="1-常见的网卡绑定驱动模式"><a href="#1-常见的网卡绑定驱动模式" class="headerlink" title="1. 常见的网卡绑定驱动模式:"></a>1. 常见的网卡绑定驱动模式:</h2><blockquote><p>active-backup、balance-tlb 和 balance-alb 模式不需要交换机的任何特殊配置。其他绑定模式需要配置交换机以便整合链接。<br>例如：Cisco 交换机需要在模式 0、2 和 3 中使用 EtherChannel，但在模式 4 中需要 LACP 和 EtherChannel。<br>有关交换机附带文档，请查看 <a href="https://www.kernel.org/doc/Documentation/networking/bonding.txt。" target="_blank" rel="noopener">https://www.kernel.org/doc/Documentation/networking/bonding.txt。</a></p></blockquote><ul><li><strong>balance-rr</strong> 或者 0 — 为容错及负载平衡设定轮询机制。从第一个可用的绑定从属接口开始按顺序接收和发送传输数据。</li><li><strong>active-backup</strong> 或者 1 — 为容错设定 active-backup 策略。 通过第一个可用的绑定从属接口接收和发送传输文件。只有在活动的绑定从属接口失败时才使用其他绑定从属接口。</li><li><strong>balance-xor</strong> 或者 2 — 只根据所选哈希策略传输数据。默认为使用源的 XOR 和目标 MAC 地址与从属接口数的余数相乘生成哈希。在这个模式中，指向具体对等接口的模式流量总是使用同一接口发送。因为目标是由 MAC 地址决定，因此这个方法最适合相同链接或本地网络的对等接口流量。如果流量必须通过单一路由器，那么这个流量平衡模式将是次选模式。</li><li><strong>broadcast</strong> 或者 3 — 为容错设定广播策略。可在所有从属接口中传输所有数据。</li><li><strong>802.3ad</strong> 或者 4 — 设定 IEEE 802.3ad 动态链接聚合策略。创建一个共享同一速度和双工设置的聚合组。在所有活跃聚合器中传输和接受数据。需要兼容 802.3ad 的交换机。</li><li><strong>balance-tlb</strong> 或者 5 — 为容错及负载平衡设定传输负载平衡（TLB）策略。传出流量会根据每个从属接口的当前负载分布。传入流量由当前从属接口接收。如果接收数据从属接口失败，另一个从属接口会接管失败从属接口的 MAC 地址。这个模式只适用于内核绑定模式了解的本地地址，因此无法在桥接后的虚拟机中使用。</li><li><strong>balance-alb</strong> 或者 6 — 为容错及负载平衡设定自适应负载平衡（ALB）策略，包括用于 IPv4 流量的传输及接收负载平衡。使用 ARP 协商获得接收负载平衡。这个模式只适用于内核 binding 模块了解的本地地址，因此无法在桥接后的虚拟机中使用。</li></ul><h2 id="2-主接口及从属接口的默认行为"><a href="#2-主接口及从属接口的默认行为" class="headerlink" title="2. 主接口及从属接口的默认行为"></a>2. 主接口及从属接口的默认行为</h2><p>使用 NetworkManager 守护进程控制绑定的从属接口时，特别是在查找出现问题时，请记住以下几点：</p><ul><li>启动主接口不会自动启动从属接口。</li><li>启动从属接口总是启动主接口。</li><li>停止主接口也可以停止从属接口。</li><li>没有从属接口的主接口可启动静态 IP 连接。</li><li>没有从属接口的主接口会在启动 DHCP 连接时等待从属接口。</li><li>有 DHCP 连接的主接口会在添加有载波的从属接口时等待从属接口完成。</li><li>有 DHCP 连接的主接口会在添加没有载波的从属接口时等待从属接口完成。</li></ul><h2 id="3-使用-NetworkManager-nmcli-工具配置网卡绑定"><a href="#3-使用-NetworkManager-nmcli-工具配置网卡绑定" class="headerlink" title="3. 使用 (NetworkManager) nmcli 工具配置网卡绑定"></a>3. 使用 (NetworkManager) nmcli 工具配置网卡绑定</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmcli con add <span class="built_in">type</span> bond con-name bond0 ifname bond0 mode active-backup</span><br><span class="line">nmcli con add <span class="built_in">type</span> bond-slave ifname enp0s9 master bond0</span><br><span class="line">nmcli con add <span class="built_in">type</span> bond-slave ifname enp0s10 master bond0</span><br></pre></td></tr></table></figure><p>要启动绑定，则必须首先启动从属接口：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmcli c up bond-slave-enp0s9</span><br><span class="line"></span><br><span class="line">nmcli c up bond-slave-enp0s10</span><br></pre></td></tr></table></figure><p>启动绑定：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli c up bond0</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nmcli c modify bond0 ipv4.addresses 192.168.33.32/24</span><br><span class="line">nmcli c modify bond0 ipv4.gateway 192.168.33.1</span><br><span class="line">nmcli c modify bond0 ipv4.dns 192.168.33.1</span><br><span class="line">nmcli c modify bond0 ipv4.method manual</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure><h2 id="3-使用命令行界面配置网卡绑定"><a href="#3-使用命令行界面配置网卡绑定" class="headerlink" title="3. 使用命令行界面配置网卡绑定"></a>3. 使用命令行界面配置网卡绑定</h2><h3 id="检查是否已安装-Bonding-内核模块"><a href="#检查是否已安装-Bonding-内核模块" class="headerlink" title="检查是否已安装 Bonding 内核模块"></a>检查是否已安装 Bonding 内核模块</h3><blockquote><p>在 Red Hat Enterprise Linux 7 中默认载入 bonding 模块。</p></blockquote><p>显示 boding 模块信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modinfo bonding</span><br></pre></td></tr></table></figure><h3 id="Bonding-模块指令"><a href="#Bonding-模块指令" class="headerlink" title="Bonding 模块指令"></a>Bonding 模块指令</h3><p>查看所有现有绑定（包括未启动的绑定），请运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/class/net/bonding_masters</span><br></pre></td></tr></table></figure><p>绑定接口参数</p><ul><li><code>ad_select=value</code> - 指定要使用的 802.3ad 聚合选择逻辑。</li><li><code>arp_interval=time_in_milliseconds</code> - 以毫秒为单位指定 ARP 监控的频繁度。默认将这个数值设定为 0，即禁用该功能。</li><li><code>arp_ip_target=ip_address[,ip_address_2,…ip_address_16]</code> - 启用 arp_interval 参数后，指定 ARP 请求的目标 IP 地址。在使用逗号分开的列表中最多可指定 16 个 IP 地址。</li><li><code>arp_validate=value</code> - 验证 ARP 探测的源/分配，默认为 none。其他值为 active、backup 和 all。</li><li><code>downdelay=time_in_milliseconds</code> - 以毫秒为单位指定从链接失败到禁用该链接前要等待的时间。该值必须是 miimon 参数中的多个数值。默认将其设定为 0，即禁用该功能。</li><li><code>fail_over_mac=value</code> - 指定 active-backup 模式是否应该将所有从属连接设定为使用同一 MAC 地址作为 enslavement（传统行为），或在启用时根据所选策略执行绑定 MAC 地址的特殊处理。</li><li><code>lacp_rate=value</code> - 指定链接伙伴应使用 802.3ad 模式传输 LACPDU 的速率</li><li><code>miimon=time_in_milliseconds</code> - 以毫秒为单位指定 MII 链接监控的频率。</li><li><code>mode=value</code> - 允许您指定绑定的策略。</li><li><code>primary=interface_name</code> - 指定主设备的接口名称，比如 eth0。</li><li><code>primary_reselect=value</code> - 为主从属接口指定重新选择策略。</li><li><code>resend_igmp=range</code> - 指定故障转移事件后要进行的 IGMP 成员报告数。故障转移后会立即提交一个报告，之后会每隔 200 毫秒发送数据包。</li><li><code>updelay=time_in_milliseconds</code> - 以毫秒为单位指定启用某个链接前要等待的时间。该数值必须是在 miimon 参数值指定值的倍数。默认设定为 0，即禁用该参数。</li><li><code>use_carrier=number</code> - 指定 miimon 是否应该使用 MII/ETHTOOL ioctls 或者 netif_carrier_ok() 来决定该链接状态。</li><li><code>xmit_hash_policy=value</code> - 选择 balance-xor 和 802.3ad 模式中用来选择从属接口的传输哈希策略。</li></ul><h3 id="创建频道绑定接口"><a href="#创建频道绑定接口" class="headerlink" title="创建频道绑定接口"></a>创建频道绑定接口</h3><blockquote><p>必须在 <code>ifcfg-bondN</code> 接口文件的 <code>BONDING_OPTS=&quot;bonding parameters separated by spaces&quot;</code> 指令中，使用以空格分开的列表指定 bonding 内核模块。<br>请不要在 <code>/etc/modprobe.d/bonding.conf</code> 文件或弃用的 <code>/etc/modprobe.conf</code> 文件中为绑定设备指定选项。<br><code>max_bonds</code> 参数不是具体接口的参数，且不应在使用 <code>BONDING_OPTS</code> 指令的 <code>ifcfg-bondN</code> 文件中设定，因为这个指令会让网络脚本根据需要创建绑定接口。</p></blockquote><p>在 /etc/sysconfig/network-scripts/ 目录中创建名为 ifcfg-bondN 的文件，使用接口号码替换 N，比如 0。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; /etc/sysconfig/network-scripts/ifcfg-bond0</span><br><span class="line">DEVICE=bond0</span><br><span class="line">NAME=bond0</span><br><span class="line">TYPE=Bond</span><br><span class="line">BONDING_MASTER=yes</span><br><span class="line">IPADDR=192.168.33.32</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.33.1</span><br><span class="line">DNS1=192.168.33.1</span><br><span class="line">ONBOOT=yes</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">BONDING_OPTS=<span class="string">"miimon=1000 mode=1 primary=enp0s9"</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="创建从属接口"><a href="#创建从属接口" class="headerlink" title="创建从属接口"></a>创建从属接口</h3><p>在 /etc/sysconfig/network-scripts/ 目录中创建名为 ifcfg-ethN 的文件，使用接口号码替换 N，比如 0。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; /etc/sysconfig/network-scripts/ifcfg-enp0s9</span><br><span class="line">DEVICE=enp0s9</span><br><span class="line">NAME=bond0-slave-enp0s9</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">ONBOOT=yes</span><br><span class="line">MASTER=bond0</span><br><span class="line">SLAVE=yes</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; /etc/sysconfig/network-scripts/ifcfg-enp0s10</span><br><span class="line">DEVICE=enp0s10</span><br><span class="line">NAME=bond0-slave-enp0s10</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">ONBOOT=yes</span><br><span class="line">MASTER=bond0</span><br><span class="line">SLAVE=yes</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="激活频道绑定"><a href="#激活频道绑定" class="headerlink" title="激活频道绑定"></a>激活频道绑定</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ifup bond0</span><br><span class="line">ifup ifcfg-enp0s9</span><br><span class="line">ifup ifcfg-enp0s10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生效更改</span></span><br><span class="line">nmcli con load /etc/sysconfig/network-script/ifcfg-device</span><br><span class="line">nmcli con reload</span><br><span class="line"><span class="comment"># 查看网卡绑定接口状态</span></span><br><span class="line">ip link show</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nmcli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RHEL 7 配置网络成组</title>
      <link href="2020/01/15/team/"/>
      <url>2020/01/15/team/</url>
      
        <content type="html"><![CDATA[<h2 id="网络成组和绑定对比"><a href="#网络成组和绑定对比" class="headerlink" title="网络成组和绑定对比"></a>网络成组和绑定对比</h2><p><img src="/resources/linuxbond/bond&team.png" alt=""></p><h2 id="安装-teamd"><a href="#安装-teamd" class="headerlink" title="安装 teamd"></a>安装 teamd</h2><p>默认不会安装网络成组守护进程 teamd。要安装 teamd</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install teamd</span><br></pre></td></tr></table></figure><h2 id="将绑定转换为成组"><a href="#将绑定转换为成组" class="headerlink" title="将绑定转换为成组"></a>将绑定转换为成组</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bond2team --examples</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">The following commands will deliver the ifcfg files into a temporary</span><br><span class="line">directory. You can review the files and copy to the right location.</span><br><span class="line"></span><br><span class="line">Add the following argument to the commands below to print the output</span><br><span class="line">to the screen instead of writing to files.</span><br><span class="line">  --stdout</span><br><span class="line"></span><br><span class="line">Add the following arguments to the commands below to set the</span><br><span class="line">destination directory for the output files.</span><br><span class="line">  --outputdir &lt;&#x2F;path&#x2F;to&#x2F;dir&gt;</span><br><span class="line"></span><br><span class="line">Add the following argument to the commands below to output the</span><br><span class="line">files in teamd format (JSON) instead of the default ifcfg format.</span><br><span class="line">  --json</span><br><span class="line"></span><br><span class="line">To convert the current &quot;bond0&quot; ifcfg configuration to team ifcfg:</span><br><span class="line"># &#x2F;usr&#x2F;bin&#x2F;bond2team --master bond0</span><br><span class="line"></span><br><span class="line">To convert the current &quot;bond0&quot; ifcfg configuration out of the</span><br><span class="line">standard ifcfg-:</span><br><span class="line"># &#x2F;usr&#x2F;bin&#x2F;bond2team --master bond0 --configdir &lt;&#x2F;path&#x2F;to&#x2F;ifcfg&gt;</span><br><span class="line"></span><br><span class="line">To convert the current &quot;bond0&quot; ifcfg configuration to team ifcfg</span><br><span class="line">renaming the interface name to &quot;team0&quot;. (carefull: firewall rules,</span><br><span class="line">aliases interfaces, etc., will break after the renaming because the</span><br><span class="line">tool will only change the ifcfg file, nothing else)</span><br><span class="line"># &#x2F;usr&#x2F;bin&#x2F;bond2team --master bond0 --rename team0</span><br><span class="line"></span><br><span class="line">To convert given bonding parameters without any ifcfg:</span><br><span class="line"># &#x2F;usr&#x2F;bin&#x2F;bond2team --bonding_opts &quot;mode&#x3D;1 miimon&#x3D;500&quot;</span><br><span class="line"></span><br><span class="line">To convert given bonding parameters without any ifcfg with ports:</span><br><span class="line"># &#x2F;usr&#x2F;bin&#x2F;bond2team --bonding_opts &quot;mode&#x3D;1 miimon&#x3D;500 primary&#x3D;eth1 primary_reselect-0&quot; \</span><br><span class="line">     --port eth1 --port eth2 --port eth3 --port eth4</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 保留名称</span></span><br><span class="line">/usr/bin/bond2team --master bond0</span><br><span class="line"></span><br><span class="line">Resulted files:</span><br><span class="line">  /tmp/bond2team.j8PiKA/ifcfg-bond0</span><br><span class="line">  /tmp/bond2team.j8PiKA/ifcfg-enp0s10</span><br><span class="line">  /tmp/bond2team.j8PiKA/ifcfg-enp0s9</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用新名称保存该配置</span></span><br><span class="line"><span class="comment"># 添加 --json 选项输出 JSON 格式文件</span></span><br><span class="line">/usr/bin/bond2team --master bond0 --rename team0</span><br><span class="line"></span><br><span class="line">Resulted files:</span><br><span class="line">  /tmp/bond2team.vwCjgt/ifcfg-team0</span><br><span class="line">  /tmp/bond2team.vwCjgt/ifcfg-enp0s10</span><br><span class="line">  /tmp/bond2team.vwCjgt/ifcfg-enp0s9</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将绑定转换为成组并指定文件路径</span></span><br><span class="line"><span class="comment"># 添加 --json 选项输出 JSON 格式文件</span></span><br><span class="line">/usr/bin/bond2team --master bond0 --configdir /etc/sysconfig/network-scripts/</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nmcli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Journald 指南</title>
      <link href="2019/12/31/journald/"/>
      <url>2019/12/31/journald/</url>
      
        <content type="html"><![CDATA[<h3 id="1-journald-服务"><a href="#1-journald-服务" class="headerlink" title="1. journald 服务"></a>1. journald 服务</h3><ul><li>systemd-journald 是一项收集和存储日志记录数据的系统服务。它基于从各种来源接收到的日志记录信息来创建和维护结构化, 已索引的日志：<ul><li>通过 kmsg 的内核日志消息</li><li>通过 libc syslog 调用的简单系统日志消息</li><li>通过本机的结构化系统日志消息日志API</li><li>系统服务的标准输出和标准错误</li><li>通过审核子系统的审核记录守护程序将以安全且可靠的方式隐式收集每个日志消息的大量元数据段</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]<span class="comment"># systemctl status systemd-journald.service</span></span><br><span class="line">● systemd-journald.service - Journal Service</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/systemd-journald.service; static; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 三 2020-01-01 06:31:55 CST; 47min ago</span><br><span class="line">     Docs: man:systemd-journald.service(8)</span><br><span class="line">           man:journald.conf(5)</span><br><span class="line"> Main PID: 515 (systemd-journal)</span><br><span class="line">   Status: <span class="string">"Processing requests..."</span></span><br><span class="line">   CGroup: /system.slice/systemd-journald.service</span><br><span class="line">           └─515 /usr/lib/systemd/systemd-journald</span><br><span class="line"></span><br><span class="line">1月 01 06:31:55 ldap.example.com systemd-journal[515]: Runtime journal is using 6.1M (max …M).</span><br><span class="line">1月 01 06:31:55 ldap.example.com systemd-journal[515]: Journal started</span><br><span class="line">1月 01 06:31:55 ldap.example.com systemd-journal[515]: Permanent journal is using 16.0M (m…G).</span><br><span class="line">1月 01 06:31:55 ldap.example.com systemd-journal[515]: Time spent on flushing to /var is 7....</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show <span class="keyword">in</span> full.</span><br></pre></td></tr></table></figure><ul><li>systemd-journald.service 文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]<span class="comment"># cat /usr/lib/systemd/system/systemd-journald.service</span></span><br><span class="line"><span class="comment">#  This file is part of systemd.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  systemd is free software; you can redistribute it and/or modify it</span></span><br><span class="line"><span class="comment">#  under the terms of the GNU Lesser General Public License as published by</span></span><br><span class="line"><span class="comment">#  the Free Software Foundation; either version 2.1 of the License, or</span></span><br><span class="line"><span class="comment">#  (at your option) any later version.</span></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Journal Service</span><br><span class="line">Documentation=man:systemd-journald.service(8) man:journald.conf(5)</span><br><span class="line">DefaultDependencies=no</span><br><span class="line">Requires=systemd-journald.socket</span><br><span class="line">After=systemd-journald.socket syslog.socket</span><br><span class="line">Before=sysinit.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">Sockets=systemd-journald.socket</span><br><span class="line">ExecStart=/usr/lib/systemd/systemd-journald</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=0</span><br><span class="line">StandardOutput=null</span><br><span class="line">FileDescriptorStoreMax=4224</span><br><span class="line">CapabilityBoundingSet=CAP_SYS_ADMIN CAP_DAC_OVERRIDE CAP_SYS_PTRACE CAP_SYSLOG CAP_AUDIT_CONTROL CAP_AUDIT_READ CAP_CHOWN CAP_DAC_READ_SEARCH CAP_FOWNER CAP_SETUID CAP_SETGID CAP_MAC_OVERRIDE</span><br><span class="line">WatchdogSec=3min</span><br><span class="line"></span><br><span class="line"><span class="comment"># Increase the default a bit in order to allow many simultaneous</span></span><br><span class="line"><span class="comment"># services being run since we keep one fd open per service. Also, when</span></span><br><span class="line"><span class="comment"># flushing journal files to disk, we might need a lot of fds when many</span></span><br><span class="line"><span class="comment"># journal files are combined.</span></span><br><span class="line">LimitNOFILE=16384</span><br></pre></td></tr></table></figure><ul><li>默认 journald 配置文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]<span class="comment"># cat /etc/systemd/journald.conf</span></span><br><span class="line"><span class="comment">#  This file is part of systemd.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  systemd is free software; you can redistribute it and/or modify it</span></span><br><span class="line"><span class="comment">#  under the terms of the GNU Lesser General Public License as published by</span></span><br><span class="line"><span class="comment">#  the Free Software Foundation; either version 2.1 of the License, or</span></span><br><span class="line"><span class="comment">#  (at your option) any later version.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Entries in this file show the compile time defaults.</span></span><br><span class="line"><span class="comment"># You can change settings by editing this file.</span></span><br><span class="line"><span class="comment"># Defaults can be restored by simply deleting this file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See journald.conf(5) for details.</span></span><br><span class="line"></span><br><span class="line">[Journal]</span><br><span class="line"><span class="comment">#Storage=auto</span></span><br><span class="line"><span class="comment">#Compress=yes</span></span><br><span class="line"><span class="comment">#Seal=yes</span></span><br><span class="line"><span class="comment">#SplitMode=uid</span></span><br><span class="line"><span class="comment">#SyncIntervalSec=5m</span></span><br><span class="line"><span class="comment">#RateLimitInterval=30s</span></span><br><span class="line"><span class="comment">#RateLimitBurst=1000</span></span><br><span class="line"><span class="comment">#SystemMaxUse=</span></span><br><span class="line"><span class="comment">#SystemKeepFree=</span></span><br><span class="line"><span class="comment">#SystemMaxFileSize=</span></span><br><span class="line"><span class="comment">#RuntimeMaxUse=</span></span><br><span class="line"><span class="comment">#RuntimeKeepFree=</span></span><br><span class="line"><span class="comment">#RuntimeMaxFileSize=</span></span><br><span class="line"><span class="comment">#MaxRetentionSec=</span></span><br><span class="line"><span class="comment">#MaxFileSec=1month</span></span><br><span class="line"><span class="comment">#ForwardToSyslog=yes</span></span><br><span class="line"><span class="comment">#ForwardToKMsg=no</span></span><br><span class="line"><span class="comment">#ForwardToConsole=no</span></span><br><span class="line"><span class="comment">#ForwardToWall=yes</span></span><br><span class="line"><span class="comment">#TTYPath=/dev/console</span></span><br><span class="line"><span class="comment">#MaxLevelStore=debug</span></span><br><span class="line"><span class="comment">#MaxLevelSyslog=debug</span></span><br><span class="line"><span class="comment">#MaxLevelKMsg=notice</span></span><br><span class="line"><span class="comment">#MaxLevelConsole=info</span></span><br><span class="line"><span class="comment">#MaxLevelWall=emerg</span></span><br><span class="line"><span class="comment">#LineMax=48K</span></span><br></pre></td></tr></table></figure><h3 id="2-journald-日志持久化"><a href="#2-journald-日志持久化" class="headerlink" title="2. journald 日志持久化"></a>2. journald 日志持久化</h3><p>默认情况下，日志将日志数据存储在 /run/log/journal/. 中。由于 /run/ 是易失性的，因此日志数据在重新引导时会丢失。要使数据持久化，只需创建 /var/log/journal/，然后systemd-journald将在其中存储数据：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]<span class="comment"># mkdir -p /var/log/journal </span></span><br><span class="line">[root@nginx ~]<span class="comment"># systemd-tmpfiles --create --prefix /var/log/journal</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]<span class="comment"># mkdir /etc/systemd/journald.conf.d</span></span><br><span class="line">[root@nginx ~]<span class="comment"># cat &gt; /etc/systemd/journald.conf.d/99-prophet.conf &lt;&lt;EOF</span></span><br><span class="line">[Journal]</span><br><span class="line"><span class="comment"># 持久化保存到磁盘</span></span><br><span class="line">Storage=persistent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 压缩历史日志</span></span><br><span class="line">Compress=yes</span><br><span class="line"></span><br><span class="line">SyncIntervalSec=5m</span><br><span class="line">RateLimitInterval=30s</span><br><span class="line">RateLimitBurst=1000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最大占用空间 10G</span></span><br><span class="line">SystemMaxUse=10G</span><br><span class="line"></span><br><span class="line"><span class="comment"># 单日志文件最大 200M</span></span><br><span class="line">SystemMaxFileSize=200M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志保存时间 2 周</span></span><br><span class="line">MaxRetentionSec=2week</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不将日志转发到 syslog</span></span><br><span class="line">ForwardToSyslog=no</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">[root@nginx ~]<span class="comment"># systemctl restart systemd-journald</span></span><br></pre></td></tr></table></figure><h3 id="3-journalctl-管理工具"><a href="#3-journalctl-管理工具" class="headerlink" title="3. journalctl 管理工具"></a>3. journalctl 管理工具</h3><blockquote><p>journalctl 是用来查询由 systemd-journald 服务收集的 systemd 日志，当它不接收任何参数则会最早的收集入口展示日志</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]<span class="comment"># journalctl --help</span></span><br><span class="line">journalctl [OPTIONS...] [MATCHES...]</span><br><span class="line"></span><br><span class="line">Query the journal.</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">     --system              展示系统日志</span><br><span class="line">     --user                展示当前用户的用户日志</span><br><span class="line">  -M --machine=CONTAINER   Operate on <span class="built_in">local</span> container</span><br><span class="line">  -S --since=DATE          展示从指定日期 [%Y-%m-%d %H:%M:%S] 开始的日志</span><br><span class="line">  -U --until=DATE          展示到指定日期 [%Y-%m-%d %H:%M:%S] 为止的日志</span><br><span class="line">  -c --cursor=CURSOR       Show entries starting at the specified cursor</span><br><span class="line">     --after-cursor=CURSOR Show entries after the specified cursor</span><br><span class="line">     --show-cursor         Print the cursor after all the entries</span><br><span class="line">  -b --boot[=ID]           Show current boot or the specified boot</span><br><span class="line">     --list-boots          Show terse information about recorded boots</span><br><span class="line">  -k --dmesg               展示当前启动的内核日志</span><br><span class="line">  -u --unit=UNIT           展示指定 unit [nginx, httpd ...] 的日志</span><br><span class="line">  -t --identifier=STRING   Show entries with the specified syslog identifier</span><br><span class="line">  -p --priority=RANGE      Show entries with the specified priority</span><br><span class="line">  -e --pager-end           Immediately jump to the end <span class="keyword">in</span> the pager</span><br><span class="line">  -f --follow              Follow the journal</span><br><span class="line">  -n --lines[=INTEGER]     Number of journal entries to show</span><br><span class="line">     --no-tail             Show all lines, even <span class="keyword">in</span> follow mode</span><br><span class="line">  -r --reverse             Show the newest entries first</span><br><span class="line">  -o --output=STRING       Change journal output mode (short, short-iso,</span><br><span class="line">                                   short-precise, short-monotonic, verbose,</span><br><span class="line">                                   <span class="built_in">export</span>, json, json-pretty, json-sse, cat)</span><br><span class="line">     --utc                 Express time <span class="keyword">in</span> Coordinated Universal Time (UTC)</span><br><span class="line">  -x --catalog             Add message explanations <span class="built_in">where</span> available</span><br><span class="line">     --no-full             Ellipsize fields</span><br><span class="line">  -a --all                 Show all fields, including long and unprintable</span><br><span class="line">  -q --quiet               Do not show privilege warning</span><br><span class="line">     --no-pager            Do not pipe output into a pager</span><br><span class="line">  -m --merge               Show entries from all available journals</span><br><span class="line">  -D --directory=PATH      展示指定目录下的日志文件的日志</span><br><span class="line">     --file=PATH           展示指定日志文件中的日志</span><br><span class="line">     --root=ROOT           Operate on catalog files underneath the root ROOT</span><br><span class="line">     --interval=TIME       Time interval <span class="keyword">for</span> changing the FSS sealing key</span><br><span class="line">     --verify-key=KEY      Specify FSS verification key</span><br><span class="line">     --force               Override of the FSS key pair with --setup-keys</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  -h --<span class="built_in">help</span>                Show this <span class="built_in">help</span> text</span><br><span class="line">     --version             Show package version</span><br><span class="line">  -F --field=FIELD         List all values that a specified field takes</span><br><span class="line">     --new-id128           Generate a new 128-bit ID</span><br><span class="line">     --disk-usage          Show total disk usage of all journal files</span><br><span class="line">     --vacuum-size=BYTES   Reduce disk usage below specified size</span><br><span class="line">     --vacuum-time=TIME    Remove journal files older than specified date</span><br><span class="line">     --flush               Flush all journal data from /run into /var</span><br><span class="line">     --header              Show journal header information</span><br><span class="line">     --list-catalog        Show all message IDs <span class="keyword">in</span> the catalog</span><br><span class="line">     --dump-catalog        Show entries <span class="keyword">in</span> the message catalog</span><br><span class="line">     --update-catalog      Update the message catalog database</span><br><span class="line">     --setup-keys          Generate a new FSS key pair</span><br><span class="line">     --verify              Verify journal file consistency</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> systemd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx 安装与配置</title>
      <link href="2019/12/31/nginx/"/>
      <url>2019/12/31/nginx/</url>
      
        <content type="html"><![CDATA[<h2 id="Nginx-安装"><a href="#Nginx-安装" class="headerlink" title="Nginx 安装"></a>Nginx 安装</h2><h3 id="1-yum-源安装"><a href="#1-yum-源安装" class="headerlink" title="1. yum 源安装"></a>1. yum 源安装</h3><ul><li>epel 源</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum -y install epel-release</span><br><span class="line">yum makecache</span><br><span class="line">yum -y install nginx</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> nginx &amp;&amp; systemctl start nginx</span><br></pre></td></tr></table></figure><ul><li>nginx 官方源<br><a href="http://nginx.org/en/linux_packages.html#RHEL-CentOS" target="_blank" rel="noopener">http://nginx.org/en/linux_packages.html#RHEL-CentOS</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">yum install yum-utils</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &lt; EOF &gt; /etc/yum.repos.d/nginx.repo</span><br><span class="line">[nginx-stable]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[nginx-mainline]</span><br><span class="line">name=nginx mainline repo</span><br><span class="line">baseurl=http://nginx.org/packages/mainline/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=<span class="literal">true</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">yum-config-manager --<span class="built_in">enable</span> nginx-stable</span><br><span class="line">yum-config-manager --<span class="built_in">enable</span> nginx-mainline</span><br><span class="line"></span><br><span class="line">yum makecache</span><br><span class="line">yum install nginx</span><br><span class="line">systemctl <span class="built_in">enable</span> nginx &amp;&amp; systemctl start nginx</span><br></pre></td></tr></table></figure><h3 id="2-源码编译安装"><a href="#2-源码编译安装" class="headerlink" title="2. 源码编译安装"></a>2. 源码编译安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx nginx-1.16.1]<span class="comment"># yum -y install gcc pcre-devel zlib-devel</span></span><br></pre></td></tr></table></figure><p>下载 nginx 源码<a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">http://nginx.org/en/download.html</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]<span class="comment"># wget http://nginx.org/download/nginx-1.16.1.tar.gz</span></span><br><span class="line">[root@nginx ~]<span class="comment"># tar -zxvf nginx-1.16.1.tar.gz</span></span><br><span class="line">[root@nginx ~]<span class="comment"># cd nginx-1.16.1</span></span><br></pre></td></tr></table></figure><ul><li>configure 参数</li></ul><blockquote><p>根据需求设置编译参数</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx nginx-1.16.1]<span class="comment"># ./configure --help</span></span><br><span class="line"></span><br><span class="line">  --<span class="built_in">help</span>                             <span class="built_in">print</span> this message</span><br><span class="line"></span><br><span class="line">  --prefix=PATH                      <span class="built_in">set</span> installation prefix</span><br><span class="line">  --sbin-path=PATH                   <span class="built_in">set</span> nginx binary pathname</span><br><span class="line">  --modules-path=PATH                <span class="built_in">set</span> modules path</span><br><span class="line">  --conf-path=PATH                   <span class="built_in">set</span> nginx.conf pathname</span><br><span class="line">  --error-log-path=PATH              <span class="built_in">set</span> error <span class="built_in">log</span> pathname</span><br><span class="line">  --pid-path=PATH                    <span class="built_in">set</span> nginx.pid pathname</span><br><span class="line">  --lock-path=PATH                   <span class="built_in">set</span> nginx.lock pathname</span><br><span class="line"></span><br><span class="line">  --user=USER                        <span class="built_in">set</span> non-privileged user <span class="keyword">for</span></span><br><span class="line">                                     worker processes</span><br><span class="line">  --group=GROUP                      <span class="built_in">set</span> non-privileged group <span class="keyword">for</span></span><br><span class="line">                                     worker processes</span><br><span class="line"></span><br><span class="line">  --build=NAME                       <span class="built_in">set</span> build name</span><br><span class="line">  --builddir=DIR                     <span class="built_in">set</span> build directory</span><br><span class="line"></span><br><span class="line">  --with-select_module               <span class="built_in">enable</span> select module</span><br><span class="line">  --without-select_module            <span class="built_in">disable</span> select module</span><br><span class="line">  --with-poll_module                 <span class="built_in">enable</span> poll module</span><br><span class="line">  --without-poll_module              <span class="built_in">disable</span> poll module</span><br><span class="line"></span><br><span class="line">  --with-threads                     <span class="built_in">enable</span> thread pool support</span><br><span class="line"></span><br><span class="line">  --with-file-aio                    <span class="built_in">enable</span> file AIO support</span><br><span class="line"></span><br><span class="line">  --with-http_ssl_module             <span class="built_in">enable</span> ngx_http_ssl_module</span><br><span class="line">  --with-http_v2_module              <span class="built_in">enable</span> ngx_http_v2_module</span><br><span class="line">  --with-http_realip_module          <span class="built_in">enable</span> ngx_http_realip_module</span><br><span class="line">  --with-http_addition_module        <span class="built_in">enable</span> ngx_http_addition_module</span><br><span class="line">  --with-http_xslt_module            <span class="built_in">enable</span> ngx_http_xslt_module</span><br><span class="line">  --with-http_xslt_module=dynamic    <span class="built_in">enable</span> dynamic ngx_http_xslt_module</span><br><span class="line">  --with-http_image_filter_module    <span class="built_in">enable</span> ngx_http_image_filter_module</span><br><span class="line">  --with-http_image_filter_module=dynamic</span><br><span class="line">                                     <span class="built_in">enable</span> dynamic ngx_http_image_filter_module</span><br><span class="line">  --with-http_geoip_module           <span class="built_in">enable</span> ngx_http_geoip_module</span><br><span class="line">  --with-http_geoip_module=dynamic   <span class="built_in">enable</span> dynamic ngx_http_geoip_module</span><br><span class="line">  --with-http_sub_module             <span class="built_in">enable</span> ngx_http_sub_module</span><br><span class="line">  --with-http_dav_module             <span class="built_in">enable</span> ngx_http_dav_module</span><br><span class="line">  --with-http_flv_module             <span class="built_in">enable</span> ngx_http_flv_module</span><br><span class="line">  --with-http_mp4_module             <span class="built_in">enable</span> ngx_http_mp4_module</span><br><span class="line">  --with-http_gunzip_module          <span class="built_in">enable</span> ngx_http_gunzip_module</span><br><span class="line">  --with-http_gzip_static_module     <span class="built_in">enable</span> ngx_http_gzip_static_module</span><br><span class="line">  --with-http_auth_request_module    <span class="built_in">enable</span> ngx_http_auth_request_module</span><br><span class="line">  --with-http_random_index_module    <span class="built_in">enable</span> ngx_http_random_index_module</span><br><span class="line">  --with-http_secure_link_module     <span class="built_in">enable</span> ngx_http_secure_link_module</span><br><span class="line">  --with-http_degradation_module     <span class="built_in">enable</span> ngx_http_degradation_module</span><br><span class="line">  --with-http_slice_module           <span class="built_in">enable</span> ngx_http_slice_module</span><br><span class="line">  --with-http_stub_status_module     <span class="built_in">enable</span> ngx_http_stub_status_module</span><br><span class="line"></span><br><span class="line">  --without-http_charset_module      <span class="built_in">disable</span> ngx_http_charset_module</span><br><span class="line">  --without-http_gzip_module         <span class="built_in">disable</span> ngx_http_gzip_module</span><br><span class="line">  --without-http_ssi_module          <span class="built_in">disable</span> ngx_http_ssi_module</span><br><span class="line">  --without-http_userid_module       <span class="built_in">disable</span> ngx_http_userid_module</span><br><span class="line">  --without-http_access_module       <span class="built_in">disable</span> ngx_http_access_module</span><br><span class="line">  --without-http_auth_basic_module   <span class="built_in">disable</span> ngx_http_auth_basic_module</span><br><span class="line">  --without-http_mirror_module       <span class="built_in">disable</span> ngx_http_mirror_module</span><br><span class="line">  --without-http_autoindex_module    <span class="built_in">disable</span> ngx_http_autoindex_module</span><br><span class="line">  --without-http_geo_module          <span class="built_in">disable</span> ngx_http_geo_module</span><br><span class="line">  --without-http_map_module          <span class="built_in">disable</span> ngx_http_map_module</span><br><span class="line">  --without-http_split_clients_module <span class="built_in">disable</span> ngx_http_split_clients_module</span><br><span class="line">  --without-http_referer_module      <span class="built_in">disable</span> ngx_http_referer_module</span><br><span class="line">  --without-http_rewrite_module      <span class="built_in">disable</span> ngx_http_rewrite_module</span><br><span class="line">  --without-http_proxy_module        <span class="built_in">disable</span> ngx_http_proxy_module</span><br><span class="line">  --without-http_fastcgi_module      <span class="built_in">disable</span> ngx_http_fastcgi_module</span><br><span class="line">  --without-http_uwsgi_module        <span class="built_in">disable</span> ngx_http_uwsgi_module</span><br><span class="line">  --without-http_scgi_module         <span class="built_in">disable</span> ngx_http_scgi_module</span><br><span class="line">  --without-http_grpc_module         <span class="built_in">disable</span> ngx_http_grpc_module</span><br><span class="line">  --without-http_memcached_module    <span class="built_in">disable</span> ngx_http_memcached_module</span><br><span class="line">  --without-http_limit_conn_module   <span class="built_in">disable</span> ngx_http_limit_conn_module</span><br><span class="line">  --without-http_limit_req_module    <span class="built_in">disable</span> ngx_http_limit_req_module</span><br><span class="line">  --without-http_empty_gif_module    <span class="built_in">disable</span> ngx_http_empty_gif_module</span><br><span class="line">  --without-http_browser_module      <span class="built_in">disable</span> ngx_http_browser_module</span><br><span class="line">  --without-http_upstream_hash_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_http_upstream_hash_module</span><br><span class="line">  --without-http_upstream_ip_hash_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_http_upstream_ip_hash_module</span><br><span class="line">  --without-http_upstream_least_conn_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_http_upstream_least_conn_module</span><br><span class="line">  --without-http_upstream_random_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_http_upstream_random_module</span><br><span class="line">  --without-http_upstream_keepalive_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_http_upstream_keepalive_module</span><br><span class="line">  --without-http_upstream_zone_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_http_upstream_zone_module</span><br><span class="line"></span><br><span class="line">  --with-http_perl_module            <span class="built_in">enable</span> ngx_http_perl_module</span><br><span class="line">  --with-http_perl_module=dynamic    <span class="built_in">enable</span> dynamic ngx_http_perl_module</span><br><span class="line">  --with-perl_modules_path=PATH      <span class="built_in">set</span> Perl modules path</span><br><span class="line">  --with-perl=PATH                   <span class="built_in">set</span> perl binary pathname</span><br><span class="line"></span><br><span class="line">  --http-log-path=PATH               <span class="built_in">set</span> http access <span class="built_in">log</span> pathname</span><br><span class="line">  --http-client-body-temp-path=PATH  <span class="built_in">set</span> path to store</span><br><span class="line">                                     http client request body temporary files</span><br><span class="line">  --http-proxy-temp-path=PATH        <span class="built_in">set</span> path to store</span><br><span class="line">                                     http proxy temporary files</span><br><span class="line">  --http-fastcgi-temp-path=PATH      <span class="built_in">set</span> path to store</span><br><span class="line">                                     http fastcgi temporary files</span><br><span class="line">  --http-uwsgi-temp-path=PATH        <span class="built_in">set</span> path to store</span><br><span class="line">                                     http uwsgi temporary files</span><br><span class="line">  --http-scgi-temp-path=PATH         <span class="built_in">set</span> path to store</span><br><span class="line">                                     http scgi temporary files</span><br><span class="line"></span><br><span class="line">  --without-http                     <span class="built_in">disable</span> HTTP server</span><br><span class="line">  --without-http-cache               <span class="built_in">disable</span> HTTP cache</span><br><span class="line"></span><br><span class="line">  --with-mail                        <span class="built_in">enable</span> POP3/IMAP4/SMTP proxy module</span><br><span class="line">  --with-mail=dynamic                <span class="built_in">enable</span> dynamic POP3/IMAP4/SMTP proxy module</span><br><span class="line">  --with-mail_ssl_module             <span class="built_in">enable</span> ngx_mail_ssl_module</span><br><span class="line">  --without-mail_pop3_module         <span class="built_in">disable</span> ngx_mail_pop3_module</span><br><span class="line">  --without-mail_imap_module         <span class="built_in">disable</span> ngx_mail_imap_module</span><br><span class="line">  --without-mail_smtp_module         <span class="built_in">disable</span> ngx_mail_smtp_module</span><br><span class="line"></span><br><span class="line">  --with-stream                      <span class="built_in">enable</span> TCP/UDP proxy module</span><br><span class="line">  --with-stream=dynamic              <span class="built_in">enable</span> dynamic TCP/UDP proxy module</span><br><span class="line">  --with-stream_ssl_module           <span class="built_in">enable</span> ngx_stream_ssl_module</span><br><span class="line">  --with-stream_realip_module        <span class="built_in">enable</span> ngx_stream_realip_module</span><br><span class="line">  --with-stream_geoip_module         <span class="built_in">enable</span> ngx_stream_geoip_module</span><br><span class="line">  --with-stream_geoip_module=dynamic <span class="built_in">enable</span> dynamic ngx_stream_geoip_module</span><br><span class="line">  --with-stream_ssl_preread_module   <span class="built_in">enable</span> ngx_stream_ssl_preread_module</span><br><span class="line">  --without-stream_limit_conn_module <span class="built_in">disable</span> ngx_stream_limit_conn_module</span><br><span class="line">  --without-stream_access_module     <span class="built_in">disable</span> ngx_stream_access_module</span><br><span class="line">  --without-stream_geo_module        <span class="built_in">disable</span> ngx_stream_geo_module</span><br><span class="line">  --without-stream_map_module        <span class="built_in">disable</span> ngx_stream_map_module</span><br><span class="line">  --without-stream_split_clients_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_stream_split_clients_module</span><br><span class="line">  --without-stream_return_module     <span class="built_in">disable</span> ngx_stream_return_module</span><br><span class="line">  --without-stream_upstream_hash_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_stream_upstream_hash_module</span><br><span class="line">  --without-stream_upstream_least_conn_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_stream_upstream_least_conn_module</span><br><span class="line">  --without-stream_upstream_random_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_stream_upstream_random_module</span><br><span class="line">  --without-stream_upstream_zone_module</span><br><span class="line">                                     <span class="built_in">disable</span> ngx_stream_upstream_zone_module</span><br><span class="line"></span><br><span class="line">  --with-google_perftools_module     <span class="built_in">enable</span> ngx_google_perftools_module</span><br><span class="line">  --with-cpp_test_module             <span class="built_in">enable</span> ngx_cpp_test_module</span><br><span class="line"></span><br><span class="line">  --add-module=PATH                  <span class="built_in">enable</span> external module</span><br><span class="line">  --add-dynamic-module=PATH          <span class="built_in">enable</span> dynamic external module</span><br><span class="line"></span><br><span class="line">  --with-compat                      dynamic modules compatibility</span><br><span class="line"></span><br><span class="line">  --with-cc=PATH                     <span class="built_in">set</span> C compiler pathname</span><br><span class="line">  --with-cpp=PATH                    <span class="built_in">set</span> C preprocessor pathname</span><br><span class="line">  --with-cc-opt=OPTIONS              <span class="built_in">set</span> additional C compiler options</span><br><span class="line">  --with-ld-opt=OPTIONS              <span class="built_in">set</span> additional linker options</span><br><span class="line">  --with-cpu-opt=CPU                 build <span class="keyword">for</span> the specified CPU, valid values:</span><br><span class="line">                                     pentium, pentiumpro, pentium3, pentium4,</span><br><span class="line">                                     athlon, opteron, sparc32, sparc64, ppc64</span><br><span class="line"></span><br><span class="line">  --without-pcre                     <span class="built_in">disable</span> PCRE library usage</span><br><span class="line">  --with-pcre                        force PCRE library usage</span><br><span class="line">  --with-pcre=DIR                    <span class="built_in">set</span> path to PCRE library sources</span><br><span class="line">  --with-pcre-opt=OPTIONS            <span class="built_in">set</span> additional build options <span class="keyword">for</span> PCRE</span><br><span class="line">  --with-pcre-jit                    build PCRE with JIT compilation support</span><br><span class="line"></span><br><span class="line">  --with-zlib=DIR                    <span class="built_in">set</span> path to zlib library sources</span><br><span class="line">  --with-zlib-opt=OPTIONS            <span class="built_in">set</span> additional build options <span class="keyword">for</span> zlib</span><br><span class="line">  --with-zlib-asm=CPU                use zlib assembler sources optimized</span><br><span class="line">                                     <span class="keyword">for</span> the specified CPU, valid values:</span><br><span class="line">                                     pentium, pentiumpro</span><br><span class="line"></span><br><span class="line">  --with-libatomic                   force libatomic_ops library usage</span><br><span class="line">  --with-libatomic=DIR               <span class="built_in">set</span> path to libatomic_ops library sources</span><br><span class="line"></span><br><span class="line">  --with-openssl=DIR                 <span class="built_in">set</span> path to OpenSSL library sources</span><br><span class="line">  --with-openssl-opt=OPTIONS         <span class="built_in">set</span> additional build options <span class="keyword">for</span> OpenSSL</span><br><span class="line"></span><br><span class="line">  --with-debug                       <span class="built_in">enable</span> debug logging</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx nginx-1.16.1]<span class="comment"># mkdir nginx-src</span></span><br><span class="line">[root@nginx nginx-1.16.1]<span class="comment"># ./configure --prefix=$PWD/nginx-src</span></span><br><span class="line">[root@nginx nginx-1.16.1]<span class="comment"># make &amp;&amp; make install</span></span><br><span class="line">[root@nginx nginx-1.16.1]<span class="comment"># ./nginx-src/sbin/nginx -v</span></span><br><span class="line">nginx version: nginx/1.16.1</span><br><span class="line"></span><br><span class="line">[root@nginx nginx-1.16.1]<span class="comment"># ldd ./nginx-src/sbin/nginx</span></span><br><span class="line">linux-vdso.so.1 =&gt;  (0x00007fff44dea000)</span><br><span class="line">libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f9d0b173000)</span><br><span class="line">libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007f9d0af57000)</span><br><span class="line">libcrypt.so.1 =&gt; /lib64/libcrypt.so.1 (0x00007f9d0ad20000)</span><br><span class="line">libpcre.so.1 =&gt; /lib64/libpcre.so.1 (0x00007f9d0aabe000)</span><br><span class="line">libz.so.1 =&gt; /lib64/libz.so.1 (0x00007f9d0a8a8000)</span><br><span class="line">libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f9d0a4da000)</span><br><span class="line">/lib64/ld-linux-x86-64.so.2 (0x00007f9d0b377000)</span><br><span class="line">libfreebl3.so =&gt; /lib64/libfreebl3.so (0x00007f9d0a2d7000)</span><br><span class="line"></span><br><span class="line">[root@nginx nginx-1.16.1]<span class="comment"># mv nginx-src/ /opt/nginx</span></span><br><span class="line">[root@nginx nginx-1.16.1]<span class="comment"># ll /opt/nginx/</span></span><br><span class="line">总用量 0</span><br><span class="line">drwxr-xr-x 2 root root 333 1月   1 06:50 conf</span><br><span class="line">drwxr-xr-x 2 root root  40 1月   1 06:50 html</span><br><span class="line">drwxr-xr-x 2 root root   6 1月   1 06:50 logs</span><br><span class="line">drwxr-xr-x 2 root root  19 1月   1 06:50 sbin</span><br></pre></td></tr></table></figure><ul><li>创建 nginx.service 文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]<span class="comment"># cat &lt; EOF &gt; nginx.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Nginx Server</span><br><span class="line">After=network.target</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStartPre=/opt/nginx/sbin/nginx -c /opt/nginx/conf/nginx.conf -p /opt/nginx -t</span><br><span class="line">ExecStart=/opt/nginx/sbin/nginx -c /opt/nginx/conf/nginx.conf -p /opt/nginx</span><br><span class="line">ExecReload=/opt/nginx/sbin/nginx -c /opt/nginx/conf/nginx.conf -p /opt/nginx -s reload</span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=5</span><br><span class="line">StartLimitInterval=0</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">[root@nginx ~]<span class="comment"># cp nginx.service /etc/systemd/system/</span></span><br><span class="line">[root@nginx ~]<span class="comment"># systemctl enable nginx &amp;&amp; systemctl start nginx</span></span><br><span class="line"></span><br><span class="line">[root@nginx ~]<span class="comment"># systemctl status nginx</span></span><br><span class="line">● nginx.service - Nginx Server</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/nginx.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 三 2020-01-01 06:59:14 CST; 5s ago</span><br><span class="line">  Process: 10052 ExecStart=/opt/nginx/sbin/nginx -c /opt/nginx/conf/nginx.conf -p /opt/nginx (code=exited, status=0/SUCCESS)</span><br><span class="line">  Process: 10051 ExecStartPre=/opt/nginx/sbin/nginx -c /opt/nginx/conf/nginx.conf -p /opt/nginx -t (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 10053 (nginx)</span><br><span class="line">   CGroup: /system.slice/nginx.service</span><br><span class="line">           ├─10053 nginx: master process /opt/nginx/sbin/nginx -c /opt/nginx/conf/nginx.conf...</span><br><span class="line">           └─10054 nginx: worker process</span><br><span class="line"></span><br><span class="line">1月 01 06:59:14 nginx systemd[1]: Starting Nginx Server...</span><br><span class="line">1月 01 06:59:14 nginx nginx[10051]: nginx: the configuration file /opt/nginx/conf/nginx.... ok</span><br><span class="line">1月 01 06:59:14 nginx nginx[10051]: nginx: configuration file /opt/nginx/conf/nginx.conf...ful</span><br><span class="line">1月 01 06:59:14 nginx systemd[1]: Started Nginx Server.</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show <span class="keyword">in</span> full.</span><br><span class="line"></span><br><span class="line">[root@nginx ~]<span class="comment"># netstat -ntlp | grep nginx</span></span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      10053/nginx: master</span><br></pre></td></tr></table></figure><h2 id="Nginx-配置"><a href="#Nginx-配置" class="headerlink" title="Nginx 配置"></a>Nginx 配置</h2><h3 id="1-1-HTTP-Load-Balancing"><a href="#1-1-HTTP-Load-Balancing" class="headerlink" title="1.1 HTTP Load Balancing"></a>1.1 HTTP Load Balancing</h3><ul><li>使用 NGINX 的 HTTP 模块使用 upstream 块在 HTTP 服务器上进行负载均衡</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server 10.10.12.45:80       weight&#x3D;1;</span><br><span class="line">    server app.example.com:80   weight&#x3D;2;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;backend;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-TCP-Load-Balancing"><a href="#1-2-TCP-Load-Balancing" class="headerlink" title="1.2 TCP Load Balancing"></a>1.2 TCP Load Balancing</h3><ul><li>使用 NGINX 的 stream 模块使用 upstream 块在 TCP 服务器上进行负载均衡</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">stream &#123;</span><br><span class="line">    upstream mysql_read &#123;</span><br><span class="line">        server read1.example.com:3306   weight&#x3D;5;</span><br><span class="line">        server read2.example.com:3306;</span><br><span class="line">        server 10.10.12.34:3306         backup;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 3306;</span><br><span class="line">        proxy_pass mysql_read;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3-Load-Balancing-方法"><a href="#1-3-Load-Balancing-方法" class="headerlink" title="1.3 Load-Balancing 方法"></a>1.3 Load-Balancing 方法</h3><ul><li>使用 NGINX 的负载平衡方法之一，例如least_conn, least_time, hash, ip_hash</li></ul><p>这里将后端 upstream 池的负载平衡算法设置为最少连接。所有负载平衡算法（通用散列除外）都将是独立的指令，如前面的示例。通用散列采用单个参数（可以是变量的串联）来构建散列。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    least_conn;</span><br><span class="line">    server backend.example.com;</span><br><span class="line">    server backend1.example.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>并非所有请求或数据包都具有相同的权重。鉴于此，循环，甚至是先前示例中使用的加权循环，将不适合所有应用程序或交通流量的需要。NGINX提供了许多负载平衡算法，可用于适应特定的用例。 这些负载平衡算法或方法不仅可以选择，还可以配置。 以下负载平衡方法可用于 upstream HTTP，TCP 和 UDP 池：</p><ol><li>Round robin（轮询）：<br>默认负载平衡方法，按 upstream 池中服务器列表的顺序分配请求。对于加权循环，可以考虑权重，如果 upstream 服务器的容量变化，则可以使用加权循环。 权重的整数值越高，服务器在循环中的优势就越大。权重背后的算法只是加权平均的统计概率。循环法是默认的负载平衡算法，如果未指定其他算法，则使用该算法。</li><li>Least connections（）：<br>另一种由 NGINX 提供的负载均衡方法。此方法通过将当前请求代理到具有通过 NGINX 代理的最少数量的打开连接的upstream服务器来平衡负载。在决定向哪个服务器发送连接时，最小连接（如循环）也会考虑权重。指令名称为 least_conn。</li><li>Least time（）：<br>仅在 NGINX Plus 中可用，类似于最少连接，因为它代理具有最少数量的当前连接的upstream 服务器，但有利于具有最低平均响应时间的服务器。这种方法是最复杂的负载平衡算法之一，可满足高性能 Web 应用程序的需求。此算法是一个增加最少连接的值，因为少量连接并不一定意味着最快的响应。指令名称为 least_time。</li><li>Generic hash（）：<br>管理员使用给定文本，请求或运行时的变量或两者来定义散列。NGINX 通过为当前请求生成哈希并将其放在 upstream 服务器上来分配服务器之间的负载。当您需要更多地控制发送请求的位置或确定哪些 upstream 服务器最有可能将数据缓存时，此方法非常有用。请注意，在池中添加或删除服务器时，将重新分配散列请求。该算法具有可选参数，一致，以最小化重新分布的影响。指令名称是 hash。</li><li>IP hash（）：<br>仅支持HTTP，是最后一批。IP 哈希使用客户端 IP 地址作为哈希。与在通用散列中使用远程变量略有不同，此算法使用 IPv4 地址的前三个八位字节或整个 IPv6 地址。只要该服务器可用，此方法可确保客户端代理到同一个 upstream 服务器，这在会话状态受到关注且未由应用程序的共享内存处理时非常有用。 在分配散列时，此方法还会考虑权重参数。 指令名称为 ip_hash。</li></ol><h3 id="1-4-Connection-Limiting"><a href="#1-4-Connection-Limiting" class="headerlink" title="1.4 Connection Limiting"></a>1.4 Connection Limiting</h3><ul><li>使用 NGINX Plus 的 max_conns 参数限制 upstream 服务器的连接数</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    zone backends 64k;</span><br><span class="line">    queue 750 timeout&#x3D;30s;</span><br><span class="line"></span><br><span class="line">    server webserver1.example.com max_conns&#x3D;25;</span><br><span class="line">    server webserver2.example.com max_conns&#x3D;15;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenLDAP 安装指南</title>
      <link href="2019/12/27/openldap/"/>
      <url>2019/12/27/openldap/</url>
      
        <content type="html"><![CDATA[<p>CentOS 7 OpenLDAP 安装配置指南</p><a id="more"></a><h2 id="1-安装-openldap"><a href="#1-安装-openldap" class="headerlink" title="1. 安装 openldap"></a>1. 安装 openldap</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># yum -y install openldap compat-openldap openldap-clients openldap-servers openldap-servers-sql openldap-devel migrationtools</span></span><br></pre></td></tr></table></figure><h3 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># slapd -VV</span></span><br><span class="line">@(<span class="comment">#) $OpenLDAP: slapd 2.4.44 (Jan 29 2019 17:42:45) $</span></span><br><span class="line">mockbuild@x86-01.bsys.centos.org:/builddir/build/BUILD/openldap-2.4.44/openldap-2.4.44/servers/slapd</span><br></pre></td></tr></table></figure><h3 id="为默认用户设置密码"><a href="#为默认用户设置密码" class="headerlink" title="为默认用户设置密码"></a>为默认用户设置密码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># slappasswd</span></span><br><span class="line">New password:</span><br><span class="line">Re-enter new password:</span><br><span class="line">&#123;SSHA&#125;P+NaHJ1IQAM/17rDCIK8i2Klm3rStDVo</span><br></pre></td></tr></table></figure><h2 id="2-配置-openldap"><a href="#2-配置-openldap" class="headerlink" title="2. 配置 openldap"></a>2. 配置 openldap</h2><h3 id="修改-olcDatabase-2-hdb-ldif-文件"><a href="#修改-olcDatabase-2-hdb-ldif-文件" class="headerlink" title="修改 olcDatabase={2}hdb.ldif 文件"></a>修改 <code>olcDatabase={2}hdb.ldif</code> 文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># vim /etc/openldap/slapd.d/cn\=config/olcDatabase\=\&#123;2\&#125;hdb.ldif</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># AUTO-GENERATED FILE - DO NOT EDIT!! Use ldapmodify.</span></span><br><span class="line"><span class="comment"># CRC32 2df1c260</span></span><br><span class="line">dn: olcDatabase=&#123;2&#125;hdb</span><br><span class="line">objectClass: olcDatabaseConfig</span><br><span class="line">objectClass: olcHdbConfig</span><br><span class="line">olcDatabase: &#123;2&#125;hdb</span><br><span class="line">olcDbDirectory: /var/lib/ldap</span><br><span class="line"><span class="comment"># olcSuffix: dc=my-domain,dc=com</span></span><br><span class="line">olcSuffix: dc=example,dc=com</span><br><span class="line"><span class="comment"># olcRootDN: cn=Manager,dc=my-domain,dc=com</span></span><br><span class="line">olcRootDN: cn=Manager,dc=example,dc=com</span><br><span class="line">olcDbIndex: objectClass eq,pres</span><br><span class="line">olcDbIndex: ou,cn,mail,surname,givenname eq,pres,sub</span><br><span class="line">structuralObjectClass: olcHdbConfig</span><br><span class="line">entryUUID: 7b00e3c0-bcc6-1039-927c-c144385599c7</span><br><span class="line">creatorsName: cn=config</span><br><span class="line">createTimestamp: 20191227073020Z</span><br><span class="line">entryCSN: 20191227073020.070906Z<span class="comment">#000000#000#000000</span></span><br><span class="line">modifiersName: cn=config</span><br><span class="line">modifyTimestamp: 20191227073020Z</span><br><span class="line"><span class="comment"># add</span></span><br><span class="line">olcRootPW: &#123;SSHA&#125;P+NaHJ1IQAM/17rDCIK8i2Klm3rStDVo</span><br></pre></td></tr></table></figure><h3 id="修改-olcDatabase-1-monitor-ldif-文件"><a href="#修改-olcDatabase-1-monitor-ldif-文件" class="headerlink" title="修改 olcDatabase={1}monitor.ldif 文件"></a>修改 <code>olcDatabase={1}monitor.ldif</code> 文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># vim /etc/openldap/slapd.d/cn\=config/olcDatabase\=\&#123;1\&#125;monitor.ldif</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># AUTO-GENERATED FILE - DO NOT EDIT!! Use ldapmodify.</span></span><br><span class="line"><span class="comment"># CRC32 cdc0bae3</span></span><br><span class="line">dn: olcDatabase=&#123;1&#125;monitor</span><br><span class="line">objectClass: olcDatabaseConfig</span><br><span class="line">olcDatabase: &#123;1&#125;monitor</span><br><span class="line"><span class="comment"># olcAccess: &#123;0&#125;to * by dn.base="gidNumber=0+uidNumber=0,cn=peercred,cn=extern</span></span><br><span class="line"><span class="comment">#  al,cn=auth" read by dn.base="cn=Manager,dc=my-domain,dc=com" read by * none</span></span><br><span class="line">olcAccess: &#123;0&#125;to * by dn.base=<span class="string">"gidNumber=0+uidNumber=0,cn=peercred,cn=extern</span></span><br><span class="line"><span class="string"> al,cn=auth"</span> <span class="built_in">read</span> by dn.base=<span class="string">"cn=Manager,dc=example,dc=com"</span> <span class="built_in">read</span> by * none</span><br><span class="line">structuralObjectClass: olcDatabaseConfig</span><br><span class="line">entryUUID: 7b00dc72-bcc6-1039-927b-c144385599c7</span><br><span class="line">creatorsName: cn=config</span><br><span class="line">createTimestamp: 20191227073020Z</span><br><span class="line">entryCSN: 20191227073020.070787Z<span class="comment">#000000#000#000000</span></span><br><span class="line">modifiersName: cn=config</span><br><span class="line">modifyTimestamp: 20191227073020Z</span><br></pre></td></tr></table></figure><h3 id="验证配置文件是否正确"><a href="#验证配置文件是否正确" class="headerlink" title="验证配置文件是否正确"></a>验证配置文件是否正确</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># slaptest -u</span></span><br><span class="line">5e05b57d ldif_read_file: checksum error on <span class="string">"/etc/openldap/slapd.d/cn=config/olcDatabase=&#123;1&#125;monitor.ldif"</span></span><br><span class="line">5e05b57d ldif_read_file: checksum error on <span class="string">"/etc/openldap/slapd.d/cn=config/olcDatabase=&#123;2&#125;hdb.ldif"</span></span><br><span class="line">config file testing succeeded</span><br></pre></td></tr></table></figure><h3 id="启动服务并设置开机启动"><a href="#启动服务并设置开机启动" class="headerlink" title="启动服务并设置开机启动"></a>启动服务并设置开机启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># systemctl start slapd &amp;&amp; systemctl enable slapd</span></span><br><span class="line">[root@ldap ~]<span class="comment"># systemctl status slapd</span></span><br><span class="line">● slapd.service - OpenLDAP Server Daemon</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/slapd.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 五 2019-12-27 15:41:35 CST; 4s ago</span><br><span class="line">     Docs: man:slapd</span><br><span class="line">           man:slapd-config</span><br><span class="line">           man:slapd-hdb</span><br><span class="line">           man:slapd-mdb</span><br><span class="line">           file:///usr/share/doc/openldap-servers/guide.html</span><br><span class="line">  Process: 1783 ExecStart=/usr/sbin/slapd -u ldap -h <span class="variable">$&#123;SLAPD_URLS&#125;</span> <span class="variable">$SLAPD_OPTIONS</span> (code=exited, status=0/SUCCESS)</span><br><span class="line">  Process: 1768 ExecStartPre=/usr/libexec/openldap/check-config.sh (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 1786 (slapd)</span><br><span class="line">   CGroup: /system.slice/slapd.service</span><br><span class="line">           └─1786 /usr/sbin/slapd -u ldap -h ldapi:/// ldap:///</span><br><span class="line"></span><br><span class="line">12月 27 15:41:32 ldap.example.com systemd[1]: Starting OpenLDAP Server Daemon...</span><br><span class="line">12月 27 15:41:32 ldap.example.com runuser[1771]: pam_unix(runuser:session): session opened <span class="keyword">for</span> user ldap by (uid=0)</span><br><span class="line">12月 27 15:41:35 ldap.example.com slapd[1783]: @(<span class="comment">#) $OpenLDAP: slapd 2.4.44 (Jan 29 2019 17:42:45) $</span></span><br><span class="line">                                                        mockbuild@x86-01.bsys.centos.org:/builddir/build/BUILD/openldap-2.4.44/openldap-2.4.44/servers/slapd</span><br><span class="line">12月 27 15:41:35 ldap.example.com slapd[1783]: ldif_read_file: checksum error on <span class="string">"/etc/openldap/slapd.d/cn=config/olcDatabase=&#123;1&#125;monitor.ldif"</span></span><br><span class="line">12月 27 15:41:35 ldap.example.com slapd[1783]: ldif_read_file: checksum error on <span class="string">"/etc/openldap/slapd.d/cn=config/olcDatabase=&#123;2&#125;hdb.ldif"</span></span><br><span class="line">12月 27 15:41:35 ldap.example.com slapd[1783]: tlsmc_get_pin: INFO: Please note the extracted key file will not be protected with a PIN any more, however it will be still prot...permissions.</span><br><span class="line">12月 27 15:41:35 ldap.example.com slapd[1786]: hdb_db_open: warning - no DB_CONFIG file found <span class="keyword">in</span> directory /var/lib/ldap: (2).</span><br><span class="line">                                                Expect poor performance <span class="keyword">for</span> suffix <span class="string">"dc=example,dc=com"</span>.</span><br><span class="line">12月 27 15:41:35 ldap.example.com slapd[1786]: slapd starting</span><br><span class="line">12月 27 15:41:35 ldap.example.com systemd[1]: Started OpenLDAP Server Daemon.</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show <span class="keyword">in</span> full.</span><br></pre></td></tr></table></figure><h3 id="查看监听端口"><a href="#查看监听端口" class="headerlink" title="查看监听端口"></a>查看监听端口</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># netstat -ntlp | grep slapd</span></span><br><span class="line">tcp        0      0 0.0.0.0:389             0.0.0.0:*               LISTEN      1786/slapd</span><br><span class="line">tcp6       0      0 :::389                  :::*                    LISTEN      1786/slapd</span><br></pre></td></tr></table></figure><h3 id="配置-openldap-数据库"><a href="#配置-openldap-数据库" class="headerlink" title="配置 openldap 数据库"></a>配置 openldap 数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG</span></span><br><span class="line">[root@ldap ~]<span class="comment"># chown ldap:ldap -R /var/lib/ldap</span></span><br><span class="line">[root@ldap ~]<span class="comment"># chmod 700 -R /var/lib/ldap</span></span><br><span class="line">[root@ldap ~]<span class="comment"># ll /var/lib/ldap/</span></span><br><span class="line">总用量 324</span><br><span class="line">-rwx------. 1 ldap ldap     2048 12月 27 15:41 alock</span><br><span class="line">-rwx------. 1 ldap ldap   262144 12月 27 15:41 __db.001</span><br><span class="line">-rwx------. 1 ldap ldap    32768 12月 27 15:41 __db.002</span><br><span class="line">-rwx------. 1 ldap ldap    49152 12月 27 15:41 __db.003</span><br><span class="line">-rwx------. 1 ldap ldap      845 12月 27 15:44 DB_CONFIG</span><br><span class="line">-rwx------. 1 ldap ldap     8192 12月 27 15:41 dn2id.bdb</span><br><span class="line">-rwx------. 1 ldap ldap    32768 12月 27 15:41 id2entry.bdb</span><br><span class="line">-rwx------. 1 ldap ldap 10485760 12月 27 15:41 log.0000000001</span><br></pre></td></tr></table></figure><h3 id="导入基本-schema"><a href="#导入基本-schema" class="headerlink" title="导入基本 schema"></a>导入基本 schema</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif</span></span><br><span class="line">SASL/EXTERNAL authentication started</span><br><span class="line">SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><br><span class="line">SASL SSF: 0</span><br><span class="line">adding new entry <span class="string">"cn=cosine,cn=schema,cn=config"</span></span><br><span class="line"></span><br><span class="line">[root@ldap ~]<span class="comment"># ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif</span></span><br><span class="line">SASL/EXTERNAL authentication started</span><br><span class="line">SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><br><span class="line">SASL SSF: 0</span><br><span class="line">adding new entry <span class="string">"cn=nis,cn=schema,cn=config"</span></span><br><span class="line"></span><br><span class="line">[root@ldap ~]<span class="comment"># ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif</span></span><br><span class="line">SASL/EXTERNAL authentication started</span><br><span class="line">SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><br><span class="line">SASL SSF: 0</span><br><span class="line">adding new entry <span class="string">"cn=inetorgperson,cn=schema,cn=config"</span></span><br></pre></td></tr></table></figure><h2 id="3-开启-openldap-日志访问功能"><a href="#3-开启-openldap-日志访问功能" class="headerlink" title="3. 开启 openldap 日志访问功能"></a>3. 开启 openldap 日志访问功能</h2><blockquote><p>默认情况下 openldap 没有启用日志记录功能，在实际使用过程中，为了定位问题，需要使用到 openldap 日志。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># cat &gt; /root/loglevel.ldif &lt;&lt; "EOF"</span></span><br><span class="line">dn: cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcLogLevel</span><br><span class="line">olcLogLevel: stats</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># ldapmodify -Y EXTERNAL -H ldapi:/// -f /root/loglevel.ldif</span></span><br><span class="line">SASL/EXTERNAL authentication started</span><br><span class="line">SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><br><span class="line">SASL SSF: 0</span><br><span class="line">modifying entry <span class="string">"cn=config"</span></span><br><span class="line"></span><br><span class="line">[root@ldap ~]<span class="comment"># systemctl restart slapd</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># cat &gt;&gt; /etc/rsyslog.conf &lt;&lt; "EOF"</span></span><br><span class="line">local4.* /var/<span class="built_in">log</span>/slapd.log</span><br><span class="line">EOF</span><br><span class="line">[root@ldap ~]<span class="comment"># systemctl restart rsyslog</span></span><br></pre></td></tr></table></figure><h2 id="4-安装和配置-phpldapadmin"><a href="#4-安装和配置-phpldapadmin" class="headerlink" title="4. 安装和配置 phpldapadmin"></a>4. 安装和配置 phpldapadmin</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># yum -y install httpd php php-ldap php-gd php-mbstring php-pear php-bcmath php-xml</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># yum -y install epel-release</span></span><br><span class="line">[root@ldap ~]<span class="comment"># yum -y install phpldapadmin</span></span><br></pre></td></tr></table></figure><ul><li>修改配置文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># vim /etc/phpldapadmin/config.php</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">397 <span class="variable">$servers</span>-&gt;setValue(<span class="string">'login'</span>,<span class="string">'attr'</span>,<span class="string">'dn'</span>);</span><br><span class="line">398 // <span class="variable">$servers</span>-&gt;setValue(<span class="string">'login'</span>,<span class="string">'attr'</span>,<span class="string">'uid'</span>);</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># vim /etc/httpd/conf.d/phpldapadmin.conf</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  Web-based tool for managing LDAP servers</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">Alias /phpldapadmin /usr/share/phpldapadmin/htdocs</span><br><span class="line">Alias /ldapadmin /usr/share/phpldapadmin/htdocs</span><br><span class="line"></span><br><span class="line">&lt;Directory /usr/share/phpldapadmin/htdocs&gt;</span><br><span class="line">  &lt;IfModule mod_authz_core.c&gt;</span><br><span class="line">    <span class="comment"># Apache 2.4</span></span><br><span class="line">    Require <span class="built_in">local</span></span><br><span class="line">    Require ip 192.168.33.1</span><br><span class="line">  &lt;/IfModule&gt;</span><br><span class="line">  &lt;IfModule !mod_authz_core.c&gt;</span><br><span class="line">    <span class="comment"># Apache 2.2</span></span><br><span class="line">    Order Deny,Allow</span><br><span class="line">    Deny from all</span><br><span class="line">    Allow from 127.0.0.1</span><br><span class="line">    Allow from ::1</span><br><span class="line">  &lt;/IfModule&gt;</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure><ul><li>启动服务并设置开机启动</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># systemctl enable httpd &amp;&amp; systemctl start httpd</span></span><br></pre></td></tr></table></figure><ul><li>浏览器访问<ul><li>主页<br><img src="/resources/openldap/openldap01.png" alt=""></li><li>登陆<br><img src="/resources/openldap/openldap02.png" alt=""></li><li>导航<br><img src="/resources/openldap/openldap03.png" alt=""></li></ul></li></ul><h2 id="5-添加用户"><a href="#5-添加用户" class="headerlink" title="5. 添加用户"></a>5. 添加用户</h2><h3 id="修改-usr-share-migrate-common-ph-文件"><a href="#修改-usr-share-migrate-common-ph-文件" class="headerlink" title="修改 /usr/share/migrate_common.ph 文件"></a>修改 <code>/usr/share/migrate_common.ph</code> 文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># vim /usr/share/migrationtools/migrate_common.ph</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Default DNS domain</span></span><br><span class="line"><span class="comment"># $DEFAULT_MAIL_DOMAIN = "padl.com";</span></span><br><span class="line"><span class="variable">$DEFAULT_MAIL_DOMAIN</span> = <span class="string">"example.com"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Default base</span></span><br><span class="line"><span class="comment"># $DEFAULT_BASE = "dc=padl,dc=com";</span></span><br><span class="line"><span class="variable">$DEFAULT_BASE</span> = <span class="string">"dc=example,dc=com"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Turn this on for inetLocalMailReceipient</span></span><br><span class="line"><span class="comment"># sendmail support; add the following to</span></span><br><span class="line"><span class="comment"># sendmail.mc (thanks to Petr@Kristof.CZ):</span></span><br><span class="line"><span class="comment">##### CUT HERE #####</span></span><br><span class="line"><span class="comment">#define(`confLDAP_DEFAULT_SPEC',`-h "ldap.padl.com"')dnl</span></span><br><span class="line"><span class="comment">#LDAPROUTE_DOMAIN_FILE(`/etc/mail/ldapdomains')dnl</span></span><br><span class="line"><span class="comment">#FEATURE(ldap_routing)dnl</span></span><br><span class="line"><span class="comment">##### CUT HERE #####</span></span><br><span class="line"><span class="comment"># where /etc/mail/ldapdomains contains names of ldap_routed</span></span><br><span class="line"><span class="comment"># domains (similiar to MASQUERADE_DOMAIN_FILE).</span></span><br><span class="line"><span class="comment"># $DEFAULT_MAIL_HOST = "mail.padl.com";</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># turn this on to support more general object clases</span></span><br><span class="line"><span class="comment"># such as person.</span></span><br><span class="line"><span class="comment"># $EXTENDED_SCHEMA = 0;</span></span><br><span class="line"><span class="variable">$EXTENDED_SCHEMA</span> = 1;</span><br></pre></td></tr></table></figure><h3 id="添加用户及用户组"><a href="#添加用户及用户组" class="headerlink" title="添加用户及用户组"></a>添加用户及用户组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># groupadd ldapgroup1</span></span><br><span class="line">[root@ldap ~]<span class="comment"># groupadd ldapgroup2</span></span><br><span class="line">[root@ldap ~]<span class="comment"># useradd -g ldapgroup1 ldapuser1</span></span><br><span class="line">[root@ldap ~]<span class="comment"># useradd -g ldapgroup2 ldapuser2</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># echo "ldap" | passwd --stdin ldapuser1</span></span><br><span class="line">[root@ldap ~]<span class="comment"># echo "ldap" | passwd --stdin ldapuser2</span></span><br></pre></td></tr></table></figure><h3 id="提取用户和组"><a href="#提取用户和组" class="headerlink" title="提取用户和组"></a>提取用户和组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># cat /etc/passwd | grep ldapuser &gt; users</span></span><br><span class="line">[root@ldap ~]<span class="comment"># cat users</span></span><br><span class="line"></span><br><span class="line">ldapuser1:x:1000:1000::/home/ldapuser1:/bin/bash</span><br><span class="line">ldapuser2:x:1001:1001::/home/ldapuser2:/bin/bash</span><br><span class="line"></span><br><span class="line">[root@ldap ~]<span class="comment"># cat /etc/group | grep ldapgroup &gt; groups</span></span><br><span class="line">[root@ldap ~]<span class="comment"># cat groups</span></span><br><span class="line"></span><br><span class="line">ldapgroup1:x:1000:</span><br><span class="line">ldapgroup2:x:1001:</span><br></pre></td></tr></table></figure><h3 id="生成用户和组的-ldif-文件"><a href="#生成用户和组的-ldif-文件" class="headerlink" title="生成用户和组的 ldif 文件"></a>生成用户和组的 <code>ldif</code> 文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># /usr/share/migrationtools/migrate_passwd.pl /root/users &gt; /root/users.ldif</span></span><br><span class="line">[root@ldap ~]<span class="comment"># /usr/share/migrationtools/migrate_group.pl /root/groups &gt; /root/groups.ldif</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># cat users.ldif</span></span><br><span class="line">dn: uid=ldapuser1,ou=People,dc=example,dc=com</span><br><span class="line">uid: ldapuser1</span><br><span class="line">cn: ldapuser1</span><br><span class="line">sn: ldapuser1</span><br><span class="line">mail: ldapuser1@example.com</span><br><span class="line">objectClass: person</span><br><span class="line">objectClass: organizationalPerson</span><br><span class="line">objectClass: inetOrgPerson</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: shadowAccount</span><br><span class="line">userPassword: &#123;crypt&#125;<span class="variable">$6</span><span class="variable">$ab3EWxCv</span><span class="variable">$w</span>/1qc6F3.z4PT0CLHQeqCQdxEUxbKHQBboBFprgz3HdaoJ8flCSmSjQ7yhTzGCoB3wUhJYT6bSVkpJENqPNtq/</span><br><span class="line">shadowLastChange: 18257</span><br><span class="line">shadowMin: 0</span><br><span class="line">shadowMax: 99999</span><br><span class="line">shadowWarning: 7</span><br><span class="line">loginShell: /bin/bash</span><br><span class="line">uidNumber: 1000</span><br><span class="line">gidNumber: 1000</span><br><span class="line">homeDirectory: /home/ldapuser1</span><br><span class="line"></span><br><span class="line">dn: uid=ldapuser2,ou=People,dc=example,dc=com</span><br><span class="line">uid: ldapuser2</span><br><span class="line">cn: ldapuser2</span><br><span class="line">sn: ldapuser2</span><br><span class="line">mail: ldapuser2@example.com</span><br><span class="line">objectClass: person</span><br><span class="line">objectClass: organizationalPerson</span><br><span class="line">objectClass: inetOrgPerson</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: shadowAccount</span><br><span class="line">userPassword: &#123;crypt&#125;<span class="variable">$6</span><span class="variable">$Lh9DKEZ0</span><span class="variable">$qHpMrkzDYLuGhYmq4OLY2uuxv1Oj8TgiwsYs9CKPTMw0kzwGs0EekygLca27hHozJ04AMxE3cONNovcCrwti2</span>/</span><br><span class="line">shadowLastChange: 18257</span><br><span class="line">shadowMin: 0</span><br><span class="line">shadowMax: 99999</span><br><span class="line">shadowWarning: 7</span><br><span class="line">loginShell: /bin/bash</span><br><span class="line">uidNumber: 1001</span><br><span class="line">gidNumber: 1001</span><br><span class="line">homeDirectory: /home/ldapuser2</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># cat groups.ldif</span></span><br><span class="line">dn: cn=ldapgroup1,ou=Group,dc=example,dc=com</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">objectClass: top</span><br><span class="line">cn: ldapgroup1</span><br><span class="line">userPassword: &#123;crypt&#125;x</span><br><span class="line">gidNumber: 1000</span><br><span class="line"></span><br><span class="line">dn: cn=ldapgroup2,ou=Group,dc=example,dc=com</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">objectClass: top</span><br><span class="line">cn: ldapgroup2</span><br><span class="line">userPassword: &#123;crypt&#125;x</span><br><span class="line">gidNumber: 1001</span><br></pre></td></tr></table></figure><h3 id="导入用户及用户组到-openldap-数据库"><a href="#导入用户及用户组到-openldap-数据库" class="headerlink" title="导入用户及用户组到 openldap 数据库"></a>导入用户及用户组到 <code>openldap</code> 数据库</h3><blockquote><p>尽管已经把用户和用户组信息导入到 openldap 数据库中。但目前 openldap 用户和组之间是没有任何关联的。要把 openldap 数据库中用户和组关联起来需要做单独配置</p></blockquote><ul><li>导入基础数据库</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># cat &gt; /root/base.ldif &lt;&lt; EOF</span></span><br><span class="line">dn: dc=example,dc=com</span><br><span class="line">o: example com</span><br><span class="line">dc: example</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: dcObject</span><br><span class="line">objectclass: organization</span><br><span class="line"></span><br><span class="line">dn: cn=Manager,dc=example,dc=com</span><br><span class="line">cn: Manager</span><br><span class="line">objectClass: organizationalRole</span><br><span class="line">description: Directory Manager</span><br><span class="line"></span><br><span class="line">dn: ou=People,dc=example,dc=com</span><br><span class="line">ou: People</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line"></span><br><span class="line">dn: ou=Group,dc=example,dc=com</span><br><span class="line">ou: Group</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># ldapadd -x -w "ldap" -D "cn=Manager,dc=example,dc=com" -f /root/base.ldif</span></span><br><span class="line">adding new entry <span class="string">"dc=example,dc=com"</span></span><br><span class="line"></span><br><span class="line">adding new entry <span class="string">"cn=Manager,dc=example,dc=com"</span></span><br><span class="line"></span><br><span class="line">adding new entry <span class="string">"ou=People,dc=example,dc=com"</span></span><br><span class="line"></span><br><span class="line">adding new entry <span class="string">"ou=Group,dc=example,dc=com"</span></span><br></pre></td></tr></table></figure><ul><li>导入用户</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># ldapadd -x -w "ldap" -D "cn=Manager,dc=example,dc=com" -f /root/users.ldif</span></span><br><span class="line">adding new entry <span class="string">"uid=ldapuser1,ou=People,dc=example,dc=com"</span></span><br><span class="line"></span><br><span class="line">adding new entry <span class="string">"uid=ldapuser2,ou=People,dc=example,dc=com"</span></span><br></pre></td></tr></table></figure><ul><li>导入组</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># ldapadd -x -w "ldap" -D "cn=Manager,dc=example,dc=com" -f /root/groups.ldif</span></span><br><span class="line">adding new entry <span class="string">"cn=ldapgroup1,ou=Group,dc=example,dc=com"</span></span><br><span class="line"></span><br><span class="line">adding new entry <span class="string">"cn=ldapgroup2,ou=Group,dc=example,dc=com"</span></span><br></pre></td></tr></table></figure><ul><li>将用户加入到用户组</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># cat &gt; add_user_to_groups.ldif &lt;&lt; "EOF"</span></span><br><span class="line">dn: cn=ldapgroup1,ou=Group,dc=example,dc=com</span><br><span class="line">changetype: modify</span><br><span class="line">add: memberuid</span><br><span class="line">memberuid: ldapuser1</span><br><span class="line"></span><br><span class="line">dn: cn=ldapgroup2,ou=Group,dc=example,dc=com</span><br><span class="line">changetype: modify</span><br><span class="line">add: memberuid</span><br><span class="line">memberuid: ldapuser2</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># ldapadd -x -w "ldap" -D "cn=Manager,dc=example,dc=com" -f /root/add_user_to_groups.ldif</span></span><br><span class="line">modifying entry <span class="string">"cn=ldapgroup1,ou=Group,dc=example,dc=com"</span></span><br><span class="line">modifying entry <span class="string">"cn=ldapgroup2,ou=Group,dc=example,dc=com"</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@ldap ~]<span class="comment"># ldapsearch -LLL -x -D 'cn=Manager,dc=example,dc=com' -w "ldap" -b 'dc=example,dc=com' 'cn=ldapgroup1'</span></span><br><span class="line">dn: cn=ldapgroup1,ou=Group,dc=example,dc=com</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">objectClass: top</span><br><span class="line">cn: ldapgroup1</span><br><span class="line">userPassword:: e2NyeXB0fXg=</span><br><span class="line">gidNumber: 1000</span><br><span class="line">memberUid: ldapuser1</span><br><span class="line"></span><br><span class="line">[root@ldap ~]<span class="comment"># ldapsearch -LLL -x -D 'cn=Manager,dc=example,dc=com' -w "ldap" -b 'dc=example,dc=com' 'cn=ldapgroup2'</span></span><br><span class="line">dn: cn=ldapgroup2,ou=Group,dc=example,dc=com</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">objectClass: top</span><br><span class="line">cn: ldapgroup2</span><br><span class="line">userPassword:: e2NyeXB0fXg=</span><br><span class="line">gidNumber: 1001</span><br><span class="line">memberUid: ldapuser2</span><br></pre></td></tr></table></figure><ul><li>phpldapadmin 导航<br><img src="/resources/openldap/openldap04.png" alt=""></li></ul>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ldap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git Hooks</title>
      <link href="2019/12/20/git_hooks/"/>
      <url>2019/12/20/git_hooks/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.git-scm.com/book/zh/v2/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git-%E9%92%A9%E5%AD%90" target="_blank" rel="noopener">Git Hooks</a> - 在特定的重要动作发生时触发自定义脚本。</p><a id="more"></a><h2 id="配置一个钩子"><a href="#配置一个钩子" class="headerlink" title="配置一个钩子"></a>配置一个钩子</h2><p>钩子都被存储在 Git 目录下的 hooks 子目录中。 即项目中的 <code>.git/hooks</code> 。 当你用 <code>git init</code> 初始化一个新版本库时，Git 默认会在这个目录中放置一些示例脚本。这些脚本除了本身可以被调用外，它们还透露了被触发时所传入的参数。 所有的示例都是 shell 脚本，其中一些还混杂了 Perl 代码，不过，任何正确命名的可执行脚本都可以正常使用 —— 你可以用 Ruby 或 Python，或其它语言编写它们。 这些示例的名字都是以 .sample 结尾，如果你想启用它们，得先移除这个后缀。</p><p>把一个正确命名且可执行的文件放入 Git 目录下的 hooks 子目录中 <code>.git/hooks</code>，即可激活该钩子脚本。 这样一来，它就能被 Git 调用。</p><h2 id="客户端钩子"><a href="#客户端钩子" class="headerlink" title="客户端钩子"></a>客户端钩子</h2><p>客户端钩子分为很多种。 下面把它们分为：提交工作流钩子、电子邮件工作流钩子和其它钩子。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">applypatch-msg.sample</span><br><span class="line">commit-msg.sample</span><br><span class="line">fsmonitor-watchman.sample</span><br><span class="line">post-update.sample</span><br><span class="line">pre-applypatch.sample</span><br><span class="line">pre-commit.sample</span><br><span class="line">pre-merge-commit.sample</span><br><span class="line">pre-push.sample</span><br><span class="line">pre-rebase.sample</span><br><span class="line">pre-receive.sample</span><br><span class="line">prepare-commit-msg.sample</span><br><span class="line">update.sample</span><br></pre></td></tr></table></figure><ol><li>提交工作流钩子</li></ol><blockquote><p><code>pre-commit</code></p></blockquote><p>钩子在键入提交信息前运行。 它用于检查即将提交的快照，例如，检查是否有所遗漏，确保测试运行，以及核查代码。 如果该钩子以非零值退出，Git 将放弃此次提交，不过你可以用 <code>git commit --no-verify</code> 来绕过这个环节。 你可以利用该钩子，来检查代码风格是否一致（运行类似 lint 的程序）、尾随空白字符是否存在（自带的钩子就是这么做的），或新方法的文档是否适当。</p><blockquote><p><code>prepare-commit-msg</code></p></blockquote><p>钩子在启动提交信息编辑器之前，默认信息被创建之后运行。 它允许你编辑提交者所看到的默认信息。 该钩子接收一些选项：存有当前提交信息的文件的路径、提交类型和修补提交的提交的 SHA-1 校验。 它对一般的提交来说并没有什么用；然而对那些会自动产生默认信息的提交，如提交信息模板、合并提交、压缩提交和修订提交等非常实用。 你可以结合提交模板来使用它，动态地插入信息。</p><blockquote><p><code>commit-msg</code></p></blockquote><p>钩子接收一个参数，此参数即上文提到的，存有当前提交信息的临时文件的路径。 如果该钩子脚本以非零值退出，Git 将放弃提交，因此，可以用来在提交通过前验证项目状态或提交信息。 在本章的最后一节，我们将展示如何使用该钩子来核对提交信息是否遵循指定的模板。</p><blockquote><p><code>post-commit</code><br>钩子在整个提交过程完成后运行。 它不接收任何参数，但你可以很容易地通过运行 <code>git log -1 HEAD</code> 来获得最后一次的提交信息。 该钩子一般用于通知之类的事情。</p></blockquote><ol start="2"><li>电子邮件工作流钩子</li></ol><p>你可以给电子邮件工作流设置三个客户端钩子。 它们都是由 <code>git am</code> 命令调用的，因此如果你没有在你的工作流中用到这个命令，可以跳到下一节。 如果你需要通过电子邮件接收由 <code>git format-patch</code> 产生的补丁，这些钩子也许用得上。</p><blockquote><p><code>applypatch-msg</code></p></blockquote><p>它接收单个参数：包含请求合并信息的临时文件的名字。 如果脚本返回非零值，Git 将放弃该补丁。 你可以用该脚本来确保提交信息符合格式，或直接用脚本修正格式错误。</p><blockquote><p><code>pre-applypatch</code></p></blockquote><p>有些难以理解的是，它正好运行于应用补丁 之后，产生提交之前，所以你可以用它在提交前检查快照。 你可以用这个脚本运行测试或检查工作区。 如果有什么遗漏，或测试未能通过，脚本会以非零值退出，中断 <code>git am</code> 的运行，这样补丁就不会被提交。</p><blockquote><p><code>post-applypatch</code></p></blockquote><p>运行于提交产生之后，是在 <code>git am</code> 运行期间最后被调用的钩子。 你可以用它把结果通知给一个小组或所拉取的补丁的作者。 但你没办法用它停止打补丁的过程。</p><ol start="3"><li>其它客户端钩子</li></ol><blockquote><p><code>pre-rebase</code></p></blockquote><p>钩子运行于变基之前，以非零值退出可以中止变基的过程。 你可以使用这个钩子来禁止对已经推送的提交变基。 Git 自带的 pre-rebase 钩子示例就是这么做的，不过它所做的一些假设可能与你的工作流程不匹配。</p><blockquote><p><code>post-rewrite</code></p></blockquote><p>钩子被那些会替换提交记录的命令调用，比如 git commit –amend 和 git rebase（不过不包括 git filter-branch）。 它唯一的参数是触发重写的命令名，同时从标准输入中接受一系列重写的提交记录。 这个钩子的用途很大程度上跟 post-checkout 和 post-merge 差不多。</p><blockquote><p><code>post-checkout</code></p></blockquote><p>在 <code>git checkout</code> 成功运行后，<code>post-checkout</code> 钩子会被调用。你可以根据你的项目环境用它调整你的工作目录。 其中包括放入大的二进制文件、自动生成文档或进行其他类似这样的操作。</p><blockquote><p><code>post-merge</code></p></blockquote><p>在 <code>git merge</code> 成功运行后，<code>post-merge</code> 钩子会被调用。 你可以用它恢复 Git 无法跟踪的工作区数据，比如权限数据。 这个钩子也可以用来验证某些在 Git 控制之外的文件是否存在，这样你就能在工作区改变时，把这些文件复制进来。</p><blockquote><p><code>pre-push</code></p></blockquote><p>pre-push 钩子会在 <code>git push</code> 运行期间， 更新了远程引用但尚未传送对象时被调用。 它接受远程分支的名字和位置作为参数，同时从标准输入中读取一系列待更新的引用。 你可以在推送开始之前，用它验证对引用的更新操作（一个非零的退出码将终止推送过程）。</p><blockquote><p><code>pre-auto-gc</code></p></blockquote><p>Git 的一些日常操作在运行时，偶尔会调用 <code>git gc --auto</code> 进行垃圾回收。 <code>pre-auto-gc</code> 钩子会在垃圾回收开始之前被调用，可以用它来提醒你现在要回收垃圾了，或者依情形判断是否要中断回收。</p><h2 id="服务器端钩子"><a href="#服务器端钩子" class="headerlink" title="服务器端钩子"></a>服务器端钩子</h2><p>除了客户端钩子，作为系统管理员，你还可以使用若干服务器端的钩子对项目强制执行各种类型的策略。 这些钩子脚本在推送到服务器之前和之后运行。 推送到服务器前运行的钩子可以在任何时候以非零值退出，拒绝推送并给客户端返回错误消息，还可以依你所想设置足够复杂的推送策略。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">applypatch-msg.sample</span><br><span class="line">commit-msg.sample</span><br><span class="line">post-update.sample</span><br><span class="line">pre-applypatch.sample</span><br><span class="line">pre-commit.sample</span><br><span class="line">prepare-commit-msg.sample</span><br><span class="line">pre-push.sample</span><br><span class="line">pre-rebase.sample</span><br><span class="line">update.sample</span><br></pre></td></tr></table></figure><blockquote><p><code>pre-receive</code></p></blockquote><p>处理来自客户端的推送操作时，最先被调用的脚本是 <code>pre-receive</code>。 它从标准输入获取一系列被推送的引用。如果它以非零值退出，所有的推送内容都不会被接受。 你可以用这个钩子阻止对引用进行非快进（non-fast-forward）的更新，或者对该推送所修改的所有引用和文件进行访问控制。</p><blockquote><p><code>update</code></p></blockquote><p><code>update</code> 脚本和 <code>pre-receive</code> 脚本十分类似，不同之处在于它会为每一个准备更新的分支各运行一次。 假如推送者同时向多个分支推送内容，<code>pre-receive</code> 只运行一次，相比之下 <code>update</code> 则会为每一个被推送的分支各运行一次。 它不会从标准输入读取内容，而是接受三个参数：引用的名字（分支），推送前的引用指向的内容的 SHA-1 值，以及用户准备推送的内容的 SHA-1 值。 如果 <code>update</code> 脚本以非零值退出，只有相应的那一个引用会被拒绝；其余的依然会被更新。</p><blockquote><p><code>post-receive</code></p></blockquote><p><code>post-receive</code> 挂钩在整个过程完结以后运行，可以用来更新其他系统服务或者通知用户。 它接受与 <code>pre-receive</code> 相同的标准输入数据。 它的用途包括给某个邮件列表发信，通知持续集成（continous integration）的服务器，或者更新问题追踪系统（ticket-tracking system） —— 甚至可以通过分析提交信息来决定某个问题（ticket）是否应该被开启，修改或者关闭。 该脚本无法终止推送进程，不过客户端在它结束运行之前将保持连接状态，所以如果你想做其他操作需谨慎使用它，因为它将耗费你很长的一段时间。</p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在服务器上搭建 Git</title>
      <link href="2019/12/20/git_in_server/"/>
      <url>2019/12/20/git_in_server/</url>
      
        <content type="html"><![CDATA[<p><a href="https://git-scm.com/book/zh/v2/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84-Git-%E5%9C%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E6%90%AD%E5%BB%BA-Git" target="_blank" rel="noopener">服务器上的 Git</a> - 在服务器上搭建 Git</p><a id="more"></a><h2 id="在服务器上创建裸仓库"><a href="#在服务器上创建裸仓库" class="headerlink" title="在服务器上创建裸仓库"></a>在服务器上创建裸仓库</h2><p>假设一个域名为 <code>git.example.com</code> 的服务器已经架设好，并可以通过 SSH 连接，你想把所有的 Git 仓库放在 /opt/git 目录下。 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 git 用户</span></span><br><span class="line">[root@git ~]<span class="comment"># useradd git -m -d /opt/git</span></span><br><span class="line"></span><br><span class="line">[root@git ~]<span class="comment"># echo "git" | passwd --stdin git</span></span><br><span class="line">更改用户 git 的密码 。</span><br><span class="line">passwd：所有的身份验证令牌已经成功更新。</span><br><span class="line"></span><br><span class="line">[root@git ~]<span class="comment"># su - git</span></span><br><span class="line">[git@git ~]$ <span class="built_in">pwd</span></span><br><span class="line">/opt/git</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[git@git ~]$ git init --bare project.git</span><br><span class="line">初始化空的 Git 版本库于 /opt/git/project.git/</span><br></pre></td></tr></table></figure><h2 id="客户端配置连接"><a href="#客户端配置连接" class="headerlink" title="客户端配置连接"></a>客户端配置连接</h2><h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><p>如果一个用户，通过使用 SSH 连接到一个服务器，并且其对 <code>/opt/git/project.git</code> 目录拥有可写权限，那么他将自动拥有推送权限。（这里我们默认使用 git 用户）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id git@git.example.com</span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> git@git.example.com:/opt/git/project.git</span><br><span class="line"></span><br><span class="line">正克隆到 <span class="string">'project'</span>...</span><br><span class="line">warning: 您似乎克隆了一个空仓库。</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> project</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"## project"</span> &gt; README.md</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">"initial new project"</span></span><br><span class="line"></span><br><span class="line">[master（根提交） 1304197] initial new project</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 README.md</span><br><span class="line"></span><br><span class="line">git push</span><br><span class="line"></span><br><span class="line">枚举对象: 3, 完成.</span><br><span class="line">对象计数中: 100% (3/3), 完成.</span><br><span class="line">写入对象中: 100% (3/3), 226 字节 | 226.00 KiB/s, 完成.</span><br><span class="line">总共 3 （差异 0），复用 0 （差异 0）</span><br><span class="line">To git.example.com:/opt/git/project.git</span><br><span class="line"> * [new branch]      master -&gt; master</span><br></pre></td></tr></table></figure><h3 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h3><p>返回服务端查看文件变化</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[git@git ~]$ ls -1 project.git/</span><br><span class="line">branches</span><br><span class="line">config</span><br><span class="line">description</span><br><span class="line">HEAD</span><br><span class="line">hooks</span><br><span class="line">info</span><br><span class="line">objects</span><br><span class="line">refs</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jenkins 入门指南</title>
      <link href="2019/12/20/jenkins/"/>
      <url>2019/12/20/jenkins/</url>
      
        <content type="html"><![CDATA[<h2 id="Jenkins-安装"><a href="#Jenkins-安装" class="headerlink" title="Jenkins 安装"></a>Jenkins 安装</h2><h3 id="方法1-使用-yum-安装（Redhat-CentOS-Fedora）"><a href="#方法1-使用-yum-安装（Redhat-CentOS-Fedora）" class="headerlink" title="方法1. 使用 yum 安装（Redhat/CentOS/Fedora）"></a>方法1. 使用 yum 安装（Redhat/CentOS/Fedora）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key</span></span><br><span class="line"></span><br><span class="line">[root@jenkins ~]<span class="comment"># yum -y install jenkins</span></span><br><span class="line"></span><br><span class="line">[root@jenkins ~]<span class="comment"># systemctl start jenkins</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># systemctl status jenkins</span></span><br><span class="line">● jenkins.service - LSB: Jenkins Automation Server</span><br><span class="line">   Loaded: loaded (/etc/rc.d/init.d/jenkins; bad; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 五 2019-12-20 10:37:48 CST; 6s ago</span><br><span class="line">     Docs: man:systemd-sysv-generator(8)</span><br><span class="line">  Process: 8910 ExecStart=/etc/rc.d/init.d/jenkins start (code=exited, status=0/SUCCESS)</span><br><span class="line">    Tasks: 48</span><br><span class="line">   Memory: 442.5M</span><br><span class="line">   CGroup: /system.slice/jenkins.service</span><br><span class="line">           └─8934 /etc/alternatives/java -Dcom.sun.akuma.Daemon=daemonized -Djava.awt.headless=<span class="literal">true</span> -DJENKINS_HOME=/var/lib/jenkins -jar /usr/lib/jenkins/jenkins.war --logfile=/var/<span class="built_in">log</span>/jen...</span><br><span class="line"></span><br><span class="line">12月 20 10:37:47 jenkins systemd[1]: Starting LSB: Jenkins Automation Server...</span><br><span class="line">12月 20 10:37:47 jenkins runuser[8915]: pam_unix(runuser:session): session opened <span class="keyword">for</span> user jenkins by (uid=0)</span><br><span class="line">12月 20 10:37:48 jenkins runuser[8915]: pam_unix(runuser:session): session closed <span class="keyword">for</span> user jenkins</span><br><span class="line">12月 20 10:37:48 jenkins jenkins[8910]: Starting Jenkins [  确定  ]</span><br><span class="line">12月 20 10:37:48 jenkins systemd[1]: Started LSB: Jenkins Automation Server.</span><br></pre></td></tr></table></figure><ul><li>通过 <code>&lt;IP&gt;:&lt;PORT&gt;</code> 访问 Jenkins</li></ul><p><img src="/resources/jenkins/jenkins_01.png" alt=""></p><ul><li>获取 initialAdminPassword</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># cat /var/lib/jenkins/secrets/initialAdminPassword</span></span><br></pre></td></tr></table></figure><h3 id="方法2-使用-Docker-安装"><a href="#方法2-使用-Docker-安装" class="headerlink" title="方法2. 使用 Docker 安装"></a>方法2. 使用 Docker 安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># docker pull jenkinsci/blueocean</span></span><br><span class="line"></span><br><span class="line">[root@jenkins ~]<span class="comment"># docker run -u root -p 8080:8080 -v jenkins_home:/var/jenkins_home -v /var/run/docker.sock:/var/run/docker.sock -v "$HOME":/home --name jenkins -d jenkinsci/blueocean</span></span><br></pre></td></tr></table></figure><ul><li><p>通过 <code>&lt;IP&gt;:&lt;PORT&gt;</code> 访问 Jenkins</p></li><li><p>获取 initialAdminPassword</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过 docker logs 获取</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># docker logs jenkins</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">Jenkins initial setup is required. An admin user has been created and a password generated.</span><br><span class="line">Please use the following password to proceed to installation:</span><br><span class="line"></span><br><span class="line">95538a82714644d5a4b5d84c6f998a4f</span><br><span class="line"></span><br><span class="line">This may also be found at: /var/jenkins_home/secrets/initialAdminPassword</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入容器内部获取 initialAdminPassword</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># docker exec -it jenkins /bin/bash</span></span><br><span class="line">bash-4.4<span class="comment"># cat /var/jenkins_home/secrets/initialAdminPassword</span></span><br></pre></td></tr></table></figure><h3 id="安装推荐插件"><a href="#安装推荐插件" class="headerlink" title="安装推荐插件"></a>安装推荐插件</h3><p><img src="/resources/jenkins/jenkins_02.png" alt=""><br><img src="/resources/jenkins/jenkins_03.png" alt=""></p><h3 id="设置用户"><a href="#设置用户" class="headerlink" title="设置用户"></a>设置用户</h3><p><img src="/resources/jenkins/jenkins_04.png" alt=""></p><h3 id="安装完成"><a href="#安装完成" class="headerlink" title="安装完成"></a>安装完成</h3><p><img src="/resources/jenkins/jenkins_05.png" alt=""><br><img src="/resources/jenkins/jenkins_06.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CI/CD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode（最长公共前缀）</title>
      <link href="2019/12/19/leetcode_daily_4/"/>
      <url>2019/12/19/leetcode_daily_4/</url>
      
        <content type="html"><![CDATA[<p>LeetCode每日一题（罗马数字转整数）<a href="https://leetcode-cn.com/problems/longest-common-prefix/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/longest-common-prefix/</a></p><a id="more"></a><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>编写一个函数来查找字符串数组中的最长公共前缀。</p><p>如果不存在公共前缀，返回空字符串 <code>&quot;&quot;</code>。</p><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">输入: [&quot;flower&quot;,&quot;flow&quot;,&quot;flight&quot;]</span><br><span class="line">输出: &quot;fl&quot;</span><br><span class="line"></span><br><span class="line">输入: [&quot;dog&quot;,&quot;racecar&quot;,&quot;car&quot;]</span><br><span class="line">输出: &quot;&quot;</span><br></pre></td></tr></table></figure><h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">longestCommonPrefix</span><span class="params">(strs []<span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(strs) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 取strs第一个元素作为前缀</span></span><br><span class="line">prefix := strs[<span class="number">0</span>]</span><br><span class="line"><span class="comment">// 遍历数组的长度</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(strs); i++ &#123;</span><br><span class="line"><span class="comment">// 从数组第二个元素开始，判断是否存在前缀prefix</span></span><br><span class="line"><span class="keyword">for</span> !strings.HasPrefix(strs[i], prefix) &#123;</span><br><span class="line">fmt.Println(i, <span class="built_in">len</span>(prefix), prefix)</span><br><span class="line"><span class="comment">// 如果不存在则将前缀prefix最后一个字符删除</span></span><br><span class="line">prefix = prefix[<span class="number">0</span> : <span class="built_in">len</span>(prefix)<span class="number">-1</span>]</span><br><span class="line"><span class="comment">// 当前缀prefix=0时返回空字符串</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(prefix) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> prefix</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode（罗马数字转整数）</title>
      <link href="2019/12/18/leetcode_daily_3/"/>
      <url>2019/12/18/leetcode_daily_3/</url>
      
        <content type="html"><![CDATA[<p>LeetCode每日一题（罗马数字转整数）<a href="https://leetcode-cn.com/problems/roman-to-integer/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/roman-to-integer/</a></p><a id="more"></a><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>罗马数字包含以下七种字符: I， V， X， L，C，D 和 M。</p><table><thead><tr><th>字符</th><th>数值</th></tr></thead><tbody><tr><td>I</td><td>1</td></tr><tr><td>V</td><td>5</td></tr><tr><td>X</td><td>10</td></tr><tr><td>L</td><td>50</td></tr><tr><td>C</td><td>100</td></tr><tr><td>D</td><td>500</td></tr><tr><td>M</td><td>1000</td></tr></tbody></table><ul><li>I 可以放在 V (5) 和 X (10) 的左边，来表示 4 和 9。</li><li>X 可以放在 L (50) 和 C (100) 的左边，来表示 40 和 90。 </li><li>C 可以放在 D (500) 和 M (1000) 的左边，来表示 400 和 900。</li></ul><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">输入: &quot;III&quot;</span><br><span class="line">输出: 3</span><br><span class="line"></span><br><span class="line">输入: &quot;LVIII&quot;</span><br><span class="line">输出: 58</span><br></pre></td></tr></table></figure><h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">romanToInt</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">r1 := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line"><span class="string">"I"</span>: <span class="number">1</span>,</span><br><span class="line"><span class="string">"V"</span>: <span class="number">5</span>,</span><br><span class="line"><span class="string">"X"</span>: <span class="number">10</span>,</span><br><span class="line"><span class="string">"L"</span>: <span class="number">50</span>,</span><br><span class="line"><span class="string">"C"</span>: <span class="number">100</span>,</span><br><span class="line"><span class="string">"D"</span>: <span class="number">500</span>,</span><br><span class="line"><span class="string">"M"</span>: <span class="number">1000</span>,</span><br><span class="line">&#125;</span><br><span class="line">r2 := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line"><span class="string">"IV"</span>: <span class="number">4</span>,</span><br><span class="line"><span class="string">"IX"</span>: <span class="number">9</span>,</span><br><span class="line"><span class="string">"XL"</span>: <span class="number">40</span>,</span><br><span class="line"><span class="string">"XC"</span>: <span class="number">90</span>,</span><br><span class="line"><span class="string">"CD"</span>: <span class="number">400</span>,</span><br><span class="line"><span class="string">"CM"</span>: <span class="number">900</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ret 用来接收计算结果</span></span><br><span class="line">ret := <span class="number">0</span></span><br><span class="line"><span class="comment">// 判断字符串长度是否为0</span></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">len</span>(s) != <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(s) &gt; <span class="number">1</span> &#123;</span><br><span class="line"><span class="comment">// s长度大于1，先判断前两位是否在r中</span></span><br><span class="line">chars := s[:<span class="number">2</span>]</span><br><span class="line"><span class="keyword">if</span> v, ok := r2[chars]; ok &#123;</span><br><span class="line">ret += v</span><br><span class="line"><span class="comment">// 删掉前两个字符</span></span><br><span class="line">s = s[<span class="number">2</span>:]</span><br><span class="line"><span class="comment">// 判断一个字符是否在r中</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">ret += r1[<span class="keyword">string</span>(s[<span class="number">0</span>])]</span><br><span class="line"><span class="comment">// 删除前一个字符</span></span><br><span class="line">s = s[<span class="number">1</span>:]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 长度为1时</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">ret += r1[<span class="keyword">string</span>(s[<span class="number">0</span>])]</span><br><span class="line"><span class="comment">// 将s置空长度为0</span></span><br><span class="line">s = s[<span class="number">1</span>:]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode（整数反转）</title>
      <link href="2019/12/17/leetcode_daily_2/"/>
      <url>2019/12/17/leetcode_daily_2/</url>
      
        <content type="html"><![CDATA[<p>LeetCode每日一题（整数反转）<a href="https://leetcode-cn.com/problems/reverse-integer/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/reverse-integer/</a></p><a id="more"></a><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>给出一个 32 位的有符号整数，你需要将这个整数中每位上的数字进行反转。</p><blockquote><p>假设我们的环境只能存储得下 32 位的有符号整数，则其数值范围为 <code>[−2^31, 2^31 − 1]</code><br>。请根据这个假设，如果反转后整数溢出那么就返回 0。</p></blockquote><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">输入: 123</span><br><span class="line">输出: 321</span><br><span class="line"></span><br><span class="line">输入: -123</span><br><span class="line">输出: -321</span><br><span class="line"></span><br><span class="line">输入: 120</span><br><span class="line">输出: 21</span><br></pre></td></tr></table></figure><h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="弹出和推入数字-amp-溢出前进行检查"><a href="#弹出和推入数字-amp-溢出前进行检查" class="headerlink" title="弹出和推入数字 &amp; 溢出前进行检查"></a>弹出和推入数字 &amp; 溢出前进行检查</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 弹出操作:</span><br><span class="line">pop &#x3D; x % 10;</span><br><span class="line">x &#x2F;&#x3D; 10;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 弹出操作:</span><br><span class="line">temp &#x3D; rev * 10 + pop;</span><br><span class="line">rev &#x3D; temp;</span><br></pre></td></tr></table></figure><p>当 <code>temp = rev * 10 + pop</code> 时会导致溢出，所以事先检查这个语句是否会导致溢出。</p><ol><li>如果 <code>temp = rev * 10 + pop</code> 导致溢出，那么一定有 <code>rev &gt;= INTMAX/10</code></li><li>如果 <code>rev &gt; INTMAX/10</code>，那么 <code>temp = rev * 10 + pop</code> 一定会溢出</li><li>如果 <code>rev == INTMAX/10</code>，那么只要 <code>pop &gt; 7</code> ，<code>temp = rev * 10 + pop</code> 就会溢出</li></ol><ul><li>时间复杂度：O(log(x))，x 中大约有 log10(x) 位数字</li><li>空间复杂度：O(1)</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverse</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">rev := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> x != <span class="number">0</span> &#123;</span><br><span class="line">pop := x % <span class="number">10</span></span><br><span class="line">x /= <span class="number">10</span></span><br><span class="line"><span class="keyword">if</span> rev &gt; math.MaxInt32/<span class="number">10</span> || (rev == math.MaxInt32/<span class="number">10</span> &amp;&amp; pop &gt; <span class="number">7</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> rev &lt; math.MinInt32/<span class="number">10</span> || (rev == math.MinInt32/<span class="number">10</span> &amp;&amp; pop &lt; <span class="number">-8</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">rev = rev*<span class="number">10</span> + pop</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> rev</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jenkins使用npm构建Node.js应用</title>
      <link href="2019/12/16/jenkins_npm/"/>
      <url>2019/12/16/jenkins_npm/</url>
      
        <content type="html"><![CDATA[<h2 id="在Jenkins中创建流水线项目"><a href="#在Jenkins中创建流水线项目" class="headerlink" title="在Jenkins中创建流水线项目"></a>在Jenkins中创建流水线项目</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/jenkins-docs/building-a-multibranch-pipeline-project.git</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">        docker &#123;</span><br><span class="line">            image 'node:6-alpine' </span><br><span class="line">            args '-p 3000:3000' </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123; </span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'npm install' </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m "Add initial Jenkinsfile"</span><br></pre></td></tr></table></figure><p>simple-node-js-react-npm-app</p><p>An entry-level Pipeline demonstrating how to use Jenkins to build a simple Node.js and React application with npm.</p><h3 id="向流水线添加Test阶段"><a href="#向流水线添加Test阶段" class="headerlink" title="向流水线添加Test阶段"></a>向流水线添加Test阶段</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">        docker &#123;</span><br><span class="line">            image 'node:6-alpine'</span><br><span class="line">            args '-p 3000:3000'</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    environment &#123;</span><br><span class="line">        CI = 'true' </span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'npm install'</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage('Test') &#123; </span><br><span class="line">            steps &#123;</span><br><span class="line">                sh './jenkins/scripts/test.sh' </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git stage .</span><br><span class="line">git commit -m "Add 'Test' stage"</span><br></pre></td></tr></table></figure><h3 id="给流水线添加最终交付阶段"><a href="#给流水线添加最终交付阶段" class="headerlink" title="给流水线添加最终交付阶段"></a>给流水线添加最终交付阶段</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">        docker &#123;</span><br><span class="line">            image 'node:6-alpine'</span><br><span class="line">            args '-p 3000:3000'</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    environment &#123; </span><br><span class="line">        CI = 'true'</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'npm install'</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage('Test') &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh './jenkins/scripts/test.sh'</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage('Deliver') &#123; </span><br><span class="line">            steps &#123;</span><br><span class="line">                sh './jenkins/scripts/deliver.sh' </span><br><span class="line">                input message: 'Finished using the web site? (Click "Proceed" to continue)' </span><br><span class="line">                sh './jenkins/scripts/kill.sh' </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git stage .</span><br><span class="line">git commit -m "Add 'Deliver' stage"</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> CI/CD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jenkins使用PyInstaller构建Python应用</title>
      <link href="2019/12/16/jenkins_python/"/>
      <url>2019/12/16/jenkins_python/</url>
      
        <content type="html"><![CDATA[<h2 id="在Jenkins中创建流水线项目"><a href="#在Jenkins中创建流水线项目" class="headerlink" title="在Jenkins中创建流水线项目"></a>在Jenkins中创建流水线项目</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/jenkins-docs/simple-python-pyinstaller-app.git</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent none </span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123; </span><br><span class="line">            agent &#123;</span><br><span class="line">                docker &#123;</span><br><span class="line">                    image 'python:2-alpine' </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'python -m py_compile sources/add2vals.py sources/calc.py' </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m "Add initial Jenkinsfile"</span><br></pre></td></tr></table></figure><h3 id="向流水线添加Test阶段"><a href="#向流水线添加Test阶段" class="headerlink" title="向流水线添加Test阶段"></a>向流水线添加Test阶段</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent none</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123;</span><br><span class="line">            agent &#123;</span><br><span class="line">                docker &#123;</span><br><span class="line">                    image 'python:2-alpine'</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'python -m py_compile sources/add2vals.py sources/calc.py'</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage('Test') &#123; </span><br><span class="line">            agent &#123;</span><br><span class="line">                docker &#123;</span><br><span class="line">                    image 'qnib/pytest' </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'py.test --verbose --junit-xml test-reports/results.xml sources/test_calc.py' </span><br><span class="line">            &#125;</span><br><span class="line">            post &#123;</span><br><span class="line">                always &#123;</span><br><span class="line">                    junit 'test-reports/results.xml' </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git stage .</span><br><span class="line">git commit -m "Add 'Test' stage"</span><br></pre></td></tr></table></figure><h3 id="给流水线添加最终交付阶段"><a href="#给流水线添加最终交付阶段" class="headerlink" title="给流水线添加最终交付阶段"></a>给流水线添加最终交付阶段</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent none</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123;</span><br><span class="line">            agent &#123;</span><br><span class="line">                docker &#123;</span><br><span class="line">                    image 'python:2-alpine'</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'python -m py_compile sources/add2vals.py sources/calc.py'</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage('Test') &#123;</span><br><span class="line">            agent &#123;</span><br><span class="line">                docker &#123;</span><br><span class="line">                    image 'qnib/pytest'</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'py.test --verbose --junit-xml test-reports/results.xml sources/test_calc.py'</span><br><span class="line">            &#125;</span><br><span class="line">            post &#123;</span><br><span class="line">                always &#123;</span><br><span class="line">                    junit 'test-reports/results.xml'</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage('Deliver') &#123; </span><br><span class="line">            agent &#123;</span><br><span class="line">                docker &#123;</span><br><span class="line">                    image 'cdrx/pyinstaller-linux:python2' </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'pyinstaller --onefile sources/add2vals.py' </span><br><span class="line">            &#125;</span><br><span class="line">            post &#123;</span><br><span class="line">                success &#123;</span><br><span class="line">                    archiveArtifacts 'dist/add2vals' </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git stage .</span><br><span class="line">git commit -m "Add 'Deliver' stage"</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> CI/CD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jenkins使用Maven构建Java应用程序</title>
      <link href="2019/12/16/jenkins_maven/"/>
      <url>2019/12/16/jenkins_maven/</url>
      
        <content type="html"><![CDATA[<h2 id="安装-Jenkins"><a href="#安装-Jenkins" class="headerlink" title="安装 Jenkins"></a>安装 Jenkins</h2><blockquote><p>参考文档 <a href="https://todevops.github.io/posts/jenkins/" target="_blank" rel="noopener">Jenkins 的安装与使用</a></p></blockquote><h2 id="安装-Docker"><a href="#安装-Docker" class="headerlink" title="安装 Docker"></a>安装 Docker</h2><blockquote><p>参考文档 <a href="https://todevops.github.io/posts/docker/" target="_blank" rel="noopener">Docker 的安装与使用</a></p></blockquote><h2 id="在Jenkins中创建流水线项目"><a href="#在Jenkins中创建流水线项目" class="headerlink" title="在Jenkins中创建流水线项目"></a>在Jenkins中创建流水线项目</h2><ol><li>创建目录，克隆项目；</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># mkdir /home/github</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># git clone https://github.com/jenkins-docs/simple-java-maven-app.git /home/github/simple-java-maven-app</span></span><br></pre></td></tr></table></figure><ol start="2"><li>为新的流水线项目指定名称（例如 simple-java-maven-app）；</li></ol><p><img src="/resources/jenkins/jenkins_07.png" alt=""></p><ol start="3"><li>在 Definition 域中，选择 Pipeline script from SCM 选项。此选项指示Jenkins从源代码管理（SCM）仓库获取你的流水线， 这里的仓库就是你clone到本地的Git仓库；</li><li>在 SCM 域中，选择 Git ，在 Repository URL 域中，填写你本地仓库的目录路径，这是从你主机上的用户账户home目录映射到Jenkins容器的 /home 目录：<code>/home/github/simple-java-maven-app</code>；</li><li>点击 Save 保存你的流水线项目。你现在可以开始创建你的 Jenkinsfile，这些文件会被添加到你的本地仓库</li></ol><p><img src="/resources/jenkins/jenkins_08.png" alt=""></p><h2 id="将初始流水线创建为Jenkinsfile"><a href="#将初始流水线创建为Jenkinsfile" class="headerlink" title="将初始流水线创建为Jenkinsfile"></a>将初始流水线创建为Jenkinsfile</h2><blockquote><p>创建一个初始流水线来下载 Maven Docker 镜像，并将其作为 Docker 容器运行（这将构建你的简单Java应用）。同时添加一个“构建”阶段到流水线中，用于协调整个过程。</p></blockquote><ol><li>在你本地的 simple-java-maven-app Git仓库的根目录创建并保存一个名为 Jenkinsfile 的文本文件。</li><li>复制以下声明式流水线代码并粘贴到 Jenkinsfile 文件中：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># cd /home/github/simple-java-maven-app</span></span><br><span class="line">[root@jenkins simple-java-maven-app]<span class="comment"># vim Jenkinsfile</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">        docker &#123;</span><br><span class="line">            image 'maven:3-alpine'</span><br><span class="line">            args '-v /root/.m2:/root/.m2'</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'mvn -B -DskipTests clean package'</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>保存对 Jenkinsfile 的修改并且将其提交到你本地的 simple-java-maven-app Git仓库<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins simple-java-maven-app]# git stage .</span><br><span class="line">[root@jenkins simple-java-maven-app]# git commit -m "Add initial Jenkinsfile"</span><br></pre></td></tr></table></figure></li><li>再次回到 Jenkins，点击 Build Now。</li></ol><p><img src="/resources/jenkins/jenkins_09.png" alt=""></p><h2 id="为流水线增加test阶段"><a href="#为流水线增加test阶段" class="headerlink" title="为流水线增加test阶段"></a>为流水线增加test阶段</h2><ol><li>打开你的 Jenkinsfile</li><li>复制以下声明式流水线代码，并粘贴到 Jenkinsfile 中 Build 阶段的下方：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">stage('Test') &#123;</span><br><span class="line">    steps &#123;</span><br><span class="line">        sh 'mvn test'</span><br><span class="line">    &#125;</span><br><span class="line">    post &#123;</span><br><span class="line">        always &#123;</span><br><span class="line">            junit 'target/surefire-reports/*.xml'</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>最终的代码为：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">        docker &#123;</span><br><span class="line">            image 'maven:3-alpine'</span><br><span class="line">            args '-v /root/.m2:/root/.m2'</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'mvn -B -DskipTests clean package'</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage('Test') &#123; </span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'mvn test' </span><br><span class="line">            &#125;</span><br><span class="line">            post &#123;</span><br><span class="line">                always &#123;</span><br><span class="line">                    junit 'target/surefire-reports/*.xml'</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>保存对 Jenkinsfile 的修改并将其提交到你的本地 simple-java-maven-app Git仓库。<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git stage .</span><br><span class="line">git commit -m "Add 'Test' stage"</span><br></pre></td></tr></table></figure></li><li>运行构建</li></ol><h2 id="为你的流水线增加deliver阶段"><a href="#为你的流水线增加deliver阶段" class="headerlink" title="为你的流水线增加deliver阶段"></a>为你的流水线增加deliver阶段</h2><ol><li>打开你的 Jenkinsfile。</li><li>复制以下声明式流水线代码，并粘贴到 Jenkinsfile 中 Test 阶段的下方：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">stage('Deliver') &#123;</span><br><span class="line">    steps &#123;</span><br><span class="line">        sh './jenkins/scripts/deliver.sh'</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>最终的代码为：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">        docker &#123;</span><br><span class="line">            image 'maven:3-alpine'</span><br><span class="line">            args '-v /root/.m2:/root/.m2'</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage('Build') &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'mvn -B -DskipTests clean package'</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage('Test') &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh 'mvn test'</span><br><span class="line">            &#125;</span><br><span class="line">            post &#123;</span><br><span class="line">                always &#123;</span><br><span class="line">                    junit 'target/surefire-reports/*.xml'</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage('Deliver') &#123; </span><br><span class="line">            steps &#123;</span><br><span class="line">                sh './jenkins/scripts/deliver.sh' </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>保存对 Jenkinsfile 的修改并将其提交到你的本地 simple-java-maven-app Git仓库。<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git stage .</span><br><span class="line">git commit -m "Add 'Deliver' stage"</span><br></pre></td></tr></table></figure></li><li>运行构建</li></ol>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> CI/CD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode（两数之和）</title>
      <link href="2019/12/16/leetcode_daily_1/"/>
      <url>2019/12/16/leetcode_daily_1/</url>
      
        <content type="html"><![CDATA[<p>LeetCode每日一题（两数之和）<a href="https://leetcode-cn.com/problems/two-sum/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/two-sum/</a></p><a id="more"></a><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>给定一个整数数组 <code>nums</code> 和一个目标值 <code>target</code>，请你在该数组中找出和为目标值的那 <strong>两个</strong> 整数，并返回他们的数组下标。</p><blockquote><p>你可以假设每种输入只会对应一个答案。但是，你不能重复利用这个数组中同样的元素。</p></blockquote><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">给定 nums &#x3D; [2, 7, 11, 15], target &#x3D; 9</span><br><span class="line">因为 nums[0] + nums[1] &#x3D; 2 + 7 &#x3D; 9</span><br><span class="line">所以返回 [0, 1]</span><br></pre></td></tr></table></figure><h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><h3 id="方法一：暴力法"><a href="#方法一：暴力法" class="headerlink" title="方法一：暴力法"></a>方法一：暴力法</h3><p>遍历每个元素 <code>x</code>，并查找是否存在一个值与 <code>target − x</code> 相等的目标元素。</p><ul><li>时间复杂度：O(n^2)<blockquote><p>对于每个元素，我们试图通过遍历数组的其余部分来寻找它所对应的目标元素，这将耗费 O(n) 的时间。因此时间复杂度为 O(n^2)。</p></blockquote></li><li>空间复杂度：O(1)</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">twoSum</span><span class="params">(nums []<span class="keyword">int</span>, target <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">ret := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line"><span class="keyword">for</span> j := i + <span class="number">1</span>; j &lt; <span class="built_in">len</span>(nums); j++ &#123;</span><br><span class="line"><span class="keyword">if</span> target-nums[i] == nums[j] &#123;</span><br><span class="line">ret = <span class="built_in">append</span>(ret, i, j)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="方法二：两遍哈希表"><a href="#方法二：两遍哈希表" class="headerlink" title="方法二：两遍哈希表"></a>方法二：两遍哈希表</h3><p>在第一次迭代中，我们将每个元素的值和它的索引添加到表中。然后，在第二次迭代中，我们将检查每个元素所对应的目标元素<code>（target - nums[i]）</code>是否存在于表中。注意，该目标元素不能是 <code>nums[i]</code> 本身！</p><ul><li>时间复杂度：O(n)<blockquote><p>我们把包含有 n 个元素的列表遍历两次。由于哈希表将查找时间缩短到 O(1) ，所以时间复杂度为 O(n)。</p></blockquote></li><li>空间复杂度：O(n)<blockquote><p>所需的额外空间取决于哈希表中存储的元素数量，该表中存储了 n 个元素。</p></blockquote></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">twoSum</span><span class="params">(nums []<span class="keyword">int</span>, target <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">numsMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>)</span><br><span class="line">ret := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历 nums 并将 nums 的数值和索引映射</span></span><br><span class="line"><span class="comment">// k: nums []int 索引</span></span><br><span class="line"><span class="comment">// v: nums []int 值</span></span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> nums &#123;</span><br><span class="line">numsMap[v] = k</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, v := <span class="keyword">range</span> nums &#123;</span><br><span class="line"><span class="comment">// 取出一个数然后求出剩下一个数的值</span></span><br><span class="line">x := target - v</span><br><span class="line"><span class="comment">// 判断剩下的数是否存在于 numsMap 中</span></span><br><span class="line"><span class="comment">// 如果存在则返回两个数的索引 i, numsMap[x]</span></span><br><span class="line"><span class="keyword">if</span> _, ok := numsMap[x]; ok &#123;</span><br><span class="line"><span class="comment">// 当 x(target-v) 值所处的索引 (numsMap[x]) 等于当前索引</span></span><br><span class="line"><span class="comment">// 即为同一个数则直接返回空</span></span><br><span class="line"><span class="keyword">if</span> i != numsMap[x] &#123;</span><br><span class="line">ret = <span class="built_in">append</span>(ret, i, numsMap[x])</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="方法三：一遍哈希表"><a href="#方法三：一遍哈希表" class="headerlink" title="方法三：一遍哈希表"></a>方法三：一遍哈希表</h3><p>在进行迭代并将元素插入到表中的同时，我们还会回过头来检查表中是否已经存在当前元素所对应的目标元素。如果它存在，那我们已经找到了对应解，并立即将其返回。</p><ul><li>时间复杂度：O(n)<blockquote><p>我们只遍历了包含有 n 个元素的列表一次。在表中进行的每次查找只花费 O(1) 的时间。</p></blockquote></li><li>空间复杂度：O(n)<blockquote><p>所需的额外空间取决于哈希表中存储的元素数量，该表最多需要存储 n 个元素。</p></blockquote></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">twoSum</span><span class="params">(nums []<span class="keyword">int</span>, target <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">numsMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>)</span><br><span class="line">ret := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, v := <span class="keyword">range</span> nums &#123;</span><br><span class="line">x := target - v</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> _, ok := numsMap[x]; ok &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i != numsMap[x] &#123;</span><br><span class="line">ret = <span class="built_in">append</span>(ret, numsMap[x], i)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">numsMap[v] = i</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go Tour 练习</title>
      <link href="2019/12/15/go_tour/"/>
      <url>2019/12/15/go_tour/</url>
      
        <content type="html"><![CDATA[<h2 id="练习-1：循环与函数"><a href="#练习-1：循环与函数" class="headerlink" title="练习 1：循环与函数"></a>练习 1：<a href="https://tour.go-zh.org/flowcontrol/8" target="_blank" rel="noopener">循环与函数</a></h2><p>为了练习函数与循环，我们来实现一个平方根函数：用牛顿法实现平方根函数。<br>计算机通常使用循环来计算 x 的平方根。从某个猜测的值 z 开始，我们可以根据 z² 与 x 的近似度来调整 z，产生一个更好的猜测：<br><code>z -= (z*z - x) / (2*z)</code><br>重复调整的过程，猜测的结果会越来越精确，得到的答案也会尽可能接近实际的平方根。<br>在提供的 func Sqrt 中实现它。无论输入是什么，对 z 的一个恰当的猜测为 1。 要开始，请重复计算 10 次并随之打印每次的 z 值。观察对于不同的值 <code>x（1、2、3 ...）</code>， 你得到的答案是如何逼近结果的，猜测提升的速度有多快。<br>提示：用类型转换或浮点数语法来声明并初始化一个浮点数值：<br><code>z := 1.0</code><br><code>z := float64(1)</code><br>然后，修改循环条件，使得当值停止改变（或改变非常小）的时候退出循环。观察迭代次数大于还是小于 10。 尝试改变 z 的初始猜测，如 x 或 x/2。你的函数结果与标准库中的 math.Sqrt 接近吗？<br>（<em>注：</em> 如果你对该算法的细节感兴趣，上面的 <code>z² − x</code> 是 <code>z²</code> 到它所要到达的值（即 x）的距离， 除以的 2z 为 z² 的导数，我们通过 z² 的变化速度来改变 z 的调整量。 这种通用方法叫做牛顿法。 它对很多函数，特别是平方根而言非常有效。）</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sqrt</span><span class="params">(x <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(Sqrt(<span class="number">2</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"math"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sqrt</span><span class="params">(x <span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">z := <span class="number">1.0</span><span class="comment">// 初始化z</span></span><br><span class="line">temp := <span class="number">0.0</span><span class="comment">// 初始化temp，用于临时存放结果</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">z = z - (z*z-x)/(<span class="number">2</span>*z)<span class="comment">// 定义牛顿法公式求出新的z值</span></span><br><span class="line">fmt.Println(z)</span><br><span class="line"><span class="keyword">if</span> math.Abs(z-temp) &lt; <span class="number">0.000000000000001</span> &#123;<span class="comment">// 判断z是否达到精度</span></span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">temp = z<span class="comment">// 临时存放计算得出的z</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> z</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"牛顿法:"</span>)</span><br><span class="line">fmt.Println(Sqrt(<span class="number">3</span>))</span><br><span class="line">fmt.Println(<span class="string">"math.Sqrt:"</span>)</span><br><span class="line">fmt.Println(math.Sqrt(<span class="number">3</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">牛顿法:</span><br><span class="line">2</span><br><span class="line">1.75</span><br><span class="line">1.7321428571428572</span><br><span class="line">1.7320508100147276</span><br><span class="line">1.7320508075688772</span><br><span class="line">1.7320508075688774</span><br><span class="line">1.7320508075688774</span><br><span class="line">math.Sqrt:</span><br><span class="line">1.7320508075688772</span><br></pre></td></tr></table></figure><h2 id="练习-2：切片"><a href="#练习-2：切片" class="headerlink" title="练习 2：切片"></a>练习 2：<a href="https://tour.go-zh.org/moretypes/18" target="_blank" rel="noopener">切片</a></h2><p>实现 Pic。它应当返回一个长度为 dy 的切片，其中每个元素是一个长度为 dx，元素类型为 uint8 的切片。当你运行此程序时，它会将每个整数解释为灰度值（好吧，其实是蓝度值）并显示它所对应的图像。</p><p>图像的选择由你来定。几个有趣的函数包括 (x+y)/2, x<em>y, x^y, x</em>log(y) 和 x%(y+1)。</p><p>（提示：需要使用循环来分配 [][]uint8 中的每个 []uint8；请使用 uint8(intValue) 在类型之间转换；你可能会用到 math 包中的函数。）</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"golang.org/x/tour/pic"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Pic</span><span class="params">(dx, dy <span class="keyword">int</span>)</span> [][]<span class="title">uint8</span></span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">pic.Show(Pic)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a>实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"golang.org/x/tour/pic"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Pic</span><span class="params">(dx, dy <span class="keyword">int</span>)</span> [][]<span class="title">uint8</span></span> &#123;</span><br><span class="line">a := <span class="built_in">make</span>([][]<span class="keyword">uint8</span>, dy)<span class="comment">// make 一个长度为 dy 的二维数组切片</span></span><br><span class="line">  <span class="keyword">for</span> x := <span class="keyword">range</span> a &#123;<span class="comment">// index, value := range a，x 为数组索引</span></span><br><span class="line">b := <span class="built_in">make</span>([]<span class="keyword">uint8</span>, dx)<span class="comment">// make 一个长度为 dx 的一维数组切片</span></span><br><span class="line"><span class="keyword">for</span> y := <span class="keyword">range</span> b &#123;<span class="comment">// y 为数组索引</span></span><br><span class="line">b[y] = <span class="keyword">uint8</span>(x % (y + <span class="number">1</span>))<span class="comment">// 修改数组 b 对应索引位置的值</span></span><br><span class="line">&#125;</span><br><span class="line">a[x] = b<span class="comment">// 修改数组 a 对应索引位置的值</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">pic.Show(Pic)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="练习-3：映射"><a href="#练习-3：映射" class="headerlink" title="练习 3：映射"></a>练习 3：<a href="https://tour.go-zh.org/moretypes/23" target="_blank" rel="noopener">映射</a></h2><p>实现 WordCount。它应当返回一个映射，其中包含字符串 s 中每个“单词”的个数。函数 wc.Test 会对此函数执行一系列测试用例，并输出成功还是失败。<br>你会发现 strings.Fields 很有帮助。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"golang.org/x/tour/wc"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WordCount</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">map</span>[<span class="title">string</span>]<span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;<span class="string">"x"</span>: <span class="number">1</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">wc.Test(WordCount)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现-2"><a href="#实现-2" class="headerlink" title="实现"></a>实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"strings"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"golang.org/x/tour/wc"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WordCount</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">map</span>[<span class="title">string</span>]<span class="title">int</span></span> &#123;</span><br><span class="line">a := strings.Fields(s)<span class="comment">// 使用 strings.Fields 将字符串分割成数组</span></span><br><span class="line">map_s := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)<span class="comment">// 映射单词和出现次数</span></span><br><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> a &#123;<span class="comment">// 遍历 a 的值</span></span><br><span class="line">_, ok := map_s[v]<span class="comment">// 获取状态值</span></span><br><span class="line"><span class="keyword">if</span> ok &#123;<span class="comment">// 判断map中是否存在当前字符串为下标的值</span></span><br><span class="line">map_s[v]++<span class="comment">// 有则出现次数+1</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">map_s[v] = <span class="number">1</span><span class="comment">// 无则=1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> map_s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">wc.Test(WordCount)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="结果-1"><a href="#结果-1" class="headerlink" title="结果"></a>结果</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PASS</span><br><span class="line"> f(&quot;I am learning Go!&quot;) &#x3D; </span><br><span class="line">  map[string]int&#123;&quot;Go!&quot;:1, &quot;I&quot;:1, &quot;am&quot;:1, &quot;learning&quot;:1&#125;</span><br><span class="line">PASS</span><br><span class="line"> f(&quot;The quick brown fox jumped over the lazy dog.&quot;) &#x3D; </span><br><span class="line">  map[string]int&#123;&quot;The&quot;:1, &quot;brown&quot;:1, &quot;dog.&quot;:1, &quot;fox&quot;:1, &quot;jumped&quot;:1, &quot;lazy&quot;:1, &quot;over&quot;:1, &quot;quick&quot;:1, &quot;the&quot;:1&#125;</span><br><span class="line">PASS</span><br><span class="line"> f(&quot;I ate a donut. Then I ate another donut.&quot;) &#x3D; </span><br><span class="line">  map[string]int&#123;&quot;I&quot;:2, &quot;Then&quot;:1, &quot;a&quot;:1, &quot;another&quot;:1, &quot;ate&quot;:2, &quot;donut.&quot;:2&#125;</span><br><span class="line">PASS</span><br><span class="line"> f(&quot;A man a plan a canal panama.&quot;) &#x3D; </span><br><span class="line">  map[string]int&#123;&quot;A&quot;:1, &quot;a&quot;:2, &quot;canal&quot;:1, &quot;man&quot;:1, &quot;panama.&quot;:1, &quot;plan&quot;:1&#125;</span><br></pre></td></tr></table></figure><h2 id="练习-4：斐波纳契闭包"><a href="#练习-4：斐波纳契闭包" class="headerlink" title="练习 4：斐波纳契闭包"></a>练习 4：<a href="https://tour.go-zh.org/moretypes/26" target="_blank" rel="noopener">斐波纳契闭包</a></h2><p>实现一个 <code>fibonacci</code> 函数，它返回一个函数（闭包），该闭包返回一个斐波纳契数列 <code>(0, 1, 1, 2, 3, 5, ...)</code>。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回一个“返回int的函数”</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fibonacci</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">f := fibonacci()</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">fmt.Println(f())</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现-3"><a href="#实现-3" class="headerlink" title="实现"></a>实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回一个“返回int的函数”</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fibonacci</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">a, b := <span class="number">0</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">temp := a</span><br><span class="line">a, b = b, a+b</span><br><span class="line"><span class="keyword">return</span> temp</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">f := fibonacci()</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">fmt.Println(f())</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="结果-2"><a href="#结果-2" class="headerlink" title="结果"></a>结果</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">8</span><br><span class="line">13</span><br><span class="line">21</span><br><span class="line">34</span><br></pre></td></tr></table></figure><h2 id="练习-5：-Stringer"><a href="#练习-5：-Stringer" class="headerlink" title="练习 5： Stringer"></a>练习 5： <a href="https://tour.go-zh.org/methods/18" target="_blank" rel="noopener">Stringer</a></h2><ol><li>通过让 <code>IPAddr</code> 类型实现 <code>fmt.Stringer</code> 来打印点号分隔的地址。  <blockquote><p>例如，<code>IPAddr{1, 2, 3, 4}</code> 应当打印为 <code>&quot;1.2.3.4&quot;</code>。</p></blockquote></li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IPAddr [<span class="number">4</span>]<span class="keyword">byte</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 给 IPAddr 添加一个 "String() string" 方法</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">hosts := <span class="keyword">map</span>[<span class="keyword">string</span>]IPAddr&#123;</span><br><span class="line"><span class="string">"loopback"</span>:  &#123;<span class="number">127</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line"><span class="string">"googleDNS"</span>: &#123;<span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> name, ip := <span class="keyword">range</span> hosts &#123;</span><br><span class="line">fmt.Printf(<span class="string">"%v: %v\n"</span>, name, ip)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现-4"><a href="#实现-4" class="headerlink" title="实现"></a>实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IPAddr [<span class="number">4</span>]<span class="keyword">byte</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 给 IPAddr 添加一个 "String() string" 方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ip IPAddr)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">"%v.%v.%v.%v"</span>, ip[<span class="number">0</span>], ip[<span class="number">1</span>], ip[<span class="number">2</span>], ip[<span class="number">3</span>])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">hosts := <span class="keyword">map</span>[<span class="keyword">string</span>]IPAddr&#123;</span><br><span class="line"><span class="string">"loopback"</span>:  &#123;<span class="number">127</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line"><span class="string">"googleDNS"</span>: &#123;<span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> name, ip := <span class="keyword">range</span> hosts &#123;</span><br><span class="line">fmt.Printf(<span class="string">"%v: %v\n"</span>, name, ip)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="结果-3"><a href="#结果-3" class="headerlink" title="结果"></a>结果</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">loopback: 127.0.0.1</span><br><span class="line">googleDNS: 8.8.8.8</span><br></pre></td></tr></table></figure><h2 id="练习-6：错误"><a href="#练习-6：错误" class="headerlink" title="练习 6：错误"></a>练习 6：<a href="https://tour.go-zh.org/methods/20" target="_blank" rel="noopener">错误</a></h2><p>Sqrt 接受到一个负数时，应当返回一个非 nil 的错误值。复数同样也不被支持。  </p><ul><li>创建一个新的类型<br><code>type ErrNegativeSqrt float64</code><br>并为其实现<br><code>func (e ErrNegativeSqrt) Error() string</code><br>方法使其拥有 <code>error</code> 值，通过 <code>ErrNegativeSqrt(-2).Error()</code> 调用该方法应返回 <code>&quot;cannot Sqrt negative number: -2&quot;</code>。  </li></ul><blockquote><p>注意: 在 Error 方法内调用 <code>fmt.Sprint(e)</code> 会让程序陷入死循环。可以通过先转换 e 来避免这个问题：<code>fmt.Sprint(float64(e))</code>。这是为什么呢？  </p></blockquote><ul><li>修改 <code>Sqrt</code> 函数，使其接受一个负数时，返回 <code>ErrNegativeSqrt</code> 值。</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sqrt</span><span class="params">(x <span class="keyword">float64</span>)</span> <span class="params">(<span class="keyword">float64</span>, error)</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(Sqrt(<span class="number">2</span>))</span><br><span class="line">fmt.Println(Sqrt(<span class="number">-2</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现-5"><a href="#实现-5" class="headerlink" title="实现"></a>实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"math"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ErrNegativeSqrt <span class="keyword">float64</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e ErrNegativeSqrt)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span> &#123;<span class="comment">// 重写 Error 函数</span></span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">"cannot Sqrt negative number:%v"</span>, <span class="keyword">float64</span>(e))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sqrt</span><span class="params">(x <span class="keyword">float64</span>)</span> <span class="params">(<span class="keyword">float64</span>, error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> x &lt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, ErrNegativeSqrt(x)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> math.Sqrt(x), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(Sqrt(<span class="number">2</span>))</span><br><span class="line">fmt.Println(Sqrt(<span class="number">-2</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="结果-4"><a href="#结果-4" class="headerlink" title="结果"></a>结果</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.4142135623730951 &lt;nil&gt;</span><br><span class="line">0 cannot Sqrt negative number:-2</span><br></pre></td></tr></table></figure><h2 id="练习-7：Reader"><a href="#练习-7：Reader" class="headerlink" title="练习 7：Reader"></a>练习 7：<a href="https://tour.go-zh.org/methods/22" target="_blank" rel="noopener">Reader</a></h2><ul><li>实现一个 <code>Reader</code> 类型，它产生一个 ASCII 字符 ‘A’ 的无限流。</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"golang.org/x/tour/reader"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyReader <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 给 MyReader 添加一个 Read([]byte) (int, error) 方法</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">reader.Validate(MyReader&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现-6"><a href="#实现-6" class="headerlink" title="实现"></a>实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"golang.org/x/tour/reader"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyReader <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 给 MyReader 添加一个 Read([]byte) (int, error) 方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r MyReader)</span> <span class="title">Read</span><span class="params">(b []<span class="keyword">byte</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">b[<span class="number">0</span>] = <span class="string">'A'</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">reader.Validate(MyReader&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="练习-8：rot13Reader"><a href="#练习-8：rot13Reader" class="headerlink" title="练习 8：rot13Reader"></a>练习 8：<a href="https://tour.go-zh.org/methods/23" target="_blank" rel="noopener">rot13Reader</a></h2><p>有种常见的模式是一个 <code>io.Reader</code> 包装另一个 <code>io.Reader</code>，然后通过某种方式修改其数据流。  </p><blockquote><p>例如，<code>gzip.NewReader</code> 函数接受一个 <code>io.Reader</code>（已压缩的数据流）并返回一个同样实现了 <code>io.Reader</code> 的 <code>*gzip.Reader</code>（解压后的数据流）。</p></blockquote><ul><li>编写一个实现了 <code>io.Reader</code> 并从另一个 <code>io.Reader</code> 中读取数据的 <code>rot13Reader</code>，通过应用 <code>rot13</code> 代换密码对数据流进行修改。</li></ul><blockquote><figure class="highlight plain"><figcaption><span>类型已经提供。实现 ```Read``` 方法以满足 ```io.Reader```。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#96;&#96;&#96;go</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">&quot;io&quot;</span><br><span class="line">&quot;os&quot;</span><br><span class="line">&quot;strings&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type rot13Reader struct &#123;</span><br><span class="line">r io.Reader</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">s :&#x3D; strings.NewReader(&quot;Lbh penpxrq gur pbqr!&quot;)</span><br><span class="line">r :&#x3D; rot13Reader&#123;s&#125;</span><br><span class="line">io.Copy(os.Stdout, &amp;r)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></blockquote><h3 id="实现-7"><a href="#实现-7" class="headerlink" title="实现"></a>实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"io"</span></span><br><span class="line"><span class="string">"os"</span></span><br><span class="line"><span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> rot13Reader <span class="keyword">struct</span> &#123;</span><br><span class="line">r io.Reader</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现 rot13 函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">rot13</span><span class="params">(out <span class="keyword">byte</span>)</span> <span class="title">byte</span></span> &#123;<span class="comment">//字母转换</span></span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line"><span class="keyword">case</span> out &gt;= <span class="string">'A'</span> &amp;&amp; out &lt;= <span class="string">'M'</span> || out &gt;= <span class="string">'a'</span> &amp;&amp; out &lt;= <span class="string">'m'</span>:</span><br><span class="line">out += <span class="number">13</span></span><br><span class="line"><span class="keyword">case</span> out &gt;= <span class="string">'N'</span> &amp;&amp; out &lt;= <span class="string">'Z'</span> || out &gt;= <span class="string">'n'</span> &amp;&amp; out &lt;= <span class="string">'z'</span>:</span><br><span class="line">out -= <span class="number">13</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> out</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(fz rot13Reader)</span> <span class="title">Read</span><span class="params">(b []<span class="keyword">byte</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">n, e := fz.r.Read(b)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</span><br><span class="line">b[i] = rot13(b[i])</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> n, e</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := strings.NewReader(<span class="string">"Lbh penpxrq gur pbqr!"</span>)</span><br><span class="line">r := rot13Reader&#123;s&#125;</span><br><span class="line">io.Copy(os.Stdout, &amp;r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="结果-5"><a href="#结果-5" class="headerlink" title="结果"></a>结果</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You cracked the code!%</span><br></pre></td></tr></table></figure><h2 id="练习-9：图像"><a href="#练习-9：图像" class="headerlink" title="练习 9：图像"></a>练习 9：<a href="https://tour.go-zh.org/methods/25" target="_blank" rel="noopener">图像</a></h2><p>还记得之前编写的图片生成器 吗？我们再来编写另外一个，不过这次它将会返回一个 image.Image 的实现而非一个数据切片。<br>定义你自己的 Image 类型，实现必要的方法并调用 pic.ShowImage。<br>Bounds 应当返回一个 image.Rectangle ，例如 image.Rect(0, 0, w, h)。<br>ColorModel 应当返回 color.RGBAModel。<br>At 应当返回一个颜色。上一个图片生成器的值 v 对应于此次的 color.RGBA{v, v, 255, 255}。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"golang.org/x/tour/pic"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Image <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">m := Image&#123;&#125;</span><br><span class="line">pic.ShowImage(m)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现-8"><a href="#实现-8" class="headerlink" title="实现"></a>实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"image"</span></span><br><span class="line"><span class="string">"image/color"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"golang.org/x/tour/pic"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Image <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i Image)</span> <span class="title">ColorModel</span><span class="params">()</span> <span class="title">color</span>.<span class="title">Model</span></span> &#123;<span class="comment">//实现 Image 包中颜色模式的方法</span></span><br><span class="line"><span class="keyword">return</span> color.RGBAModel</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i Image)</span> <span class="title">Bounds</span><span class="params">()</span> <span class="title">image</span>.<span class="title">Rectangle</span></span> &#123;<span class="comment">//实现 Image 包中生成图片边界的方法</span></span><br><span class="line"><span class="keyword">return</span> image.Rect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i Image)</span> <span class="title">At</span><span class="params">(x, y <span class="keyword">int</span>)</span> <span class="title">color</span>.<span class="title">Color</span></span> &#123;<span class="comment">// 实现 Image 包中生成图像某个点的方法</span></span><br><span class="line"><span class="keyword">return</span> color.RGBA&#123;<span class="keyword">uint8</span>(x), <span class="keyword">uint8</span>(y), <span class="keyword">uint8</span>(<span class="number">255</span>), <span class="keyword">uint8</span>(<span class="number">255</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">m := Image&#123;&#125;</span><br><span class="line">pic.ShowImage(m)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python 判断变量的类型</title>
      <link href="2019/11/20/python-variable/"/>
      <url>2019/11/20/python-variable/</url>
      
        <content type="html"><![CDATA[<p>Python 判断变量的类型的方法</p><a id="more"></a><h2 id="python-判断变量的类型"><a href="#python-判断变量的类型" class="headerlink" title="python 判断变量的类型"></a>python 判断变量的类型</h2><p>python的数据类型有：</p><ul><li>数字(int)</li><li>浮点(float)</li><li>字符串(str)</li><li>列表(list)</li><li>元组(tuple)</li><li>字典(dict)</li><li>集合(set)</li></ul><p>一般通过以下方法判断变量类型：</p><ul><li>isinstance(参数1, 参数2)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">1</span></span><br><span class="line">isinstance(i, int)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="string">"test"</span></span><br><span class="line">isinstance(i, str)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">isinstance(i, tuple)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><ul><li>type(参数1)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">1</span></span><br><span class="line">type(i)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">int</span>'&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="string">"test"</span></span><br><span class="line">type(i)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">type(i)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">tuple</span>'&gt;</span></span><br></pre></td></tr></table></figure><h2 id="python-变量转换错误-ValueError"><a href="#python-变量转换错误-ValueError" class="headerlink" title="python 变量转换错误 ValueError"></a>python 变量转换错误 ValueError</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">3.1415926</span></span><br><span class="line">int(i)</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">2</span></span><br><span class="line">float(i)</span><br><span class="line"><span class="number">2.0</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="string">"test"</span></span><br><span class="line">int(i)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ValueError: invalid literal <span class="keyword">for</span> int() <span class="keyword">with</span> base <span class="number">10</span>: <span class="string">'test'</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="string">"test"</span></span><br><span class="line">tuple(i)</span><br><span class="line">(<span class="string">'t'</span>, <span class="string">'e'</span>, <span class="string">'s'</span>, <span class="string">'t'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="string">"test"</span></span><br><span class="line">list(i)</span><br><span class="line">[<span class="string">'t'</span>, <span class="string">'e'</span>, <span class="string">'s'</span>, <span class="string">'t'</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="string">"test"</span></span><br><span class="line">dict(i)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ValueError: dictionary update sequence element <span class="comment">#0 has length 1; 2 is required</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="string">"test"</span></span><br><span class="line">set(i)</span><br><span class="line">&#123;<span class="string">'e'</span>, <span class="string">'s'</span>, <span class="string">'t'</span>&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker /etc/docker/daemon.json 文件的参数</title>
      <link href="2019/11/20/docker-daemon-json/"/>
      <url>2019/11/20/docker-daemon-json/</url>
      
        <content type="html"><![CDATA[<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="attr">"api-cors-header"</span>:<span class="string">""</span>, </span><br><span class="line"> <span class="attr">"authorization-plugins"</span>:[],</span><br><span class="line"> <span class="attr">"bip"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="attr">"bridge"</span>:<span class="string">""</span>,</span><br><span class="line"> <span class="attr">"cgroup-parent"</span>:<span class="string">""</span>,</span><br><span class="line"> <span class="attr">"cluster-store"</span>:<span class="string">""</span>,</span><br><span class="line"> <span class="attr">"cluster-store-opts"</span>:&#123;&#125;,</span><br><span class="line"> <span class="attr">"cluster-advertise"</span>:<span class="string">""</span>,</span><br><span class="line"> <span class="attr">"debug"</span>: <span class="literal">true</span>,</span><br><span class="line"> <span class="attr">"default-gateway"</span>:<span class="string">""</span>,</span><br><span class="line"> <span class="attr">"default-gateway-v6"</span>:<span class="string">""</span>,</span><br><span class="line"> <span class="attr">"default-runtime"</span>:<span class="string">"runc"</span>,</span><br><span class="line"> <span class="attr">"default-ulimits"</span>:&#123;&#125;,</span><br><span class="line"> <span class="attr">"disable-legacy-registry"</span>:<span class="literal">false</span>,</span><br><span class="line"> "dns": ["192.168.1.1"],        # 设定容器DNS的地址，在容器的 /etc/resolv.conf文件中可查看。</span><br><span class="line"> "dns-opts": [],                # 容器 /etc/resolv.conf 文件，其他设置</span><br><span class="line"> "dns-search": [],              # 设定容器的搜索域，当设定搜索域为 .example.com 时，在搜索一个名为 host 的 主机时，DNS不仅搜索host，还会搜索host.example.com 。 注意：如果不设置， Docker 会默认用主机上的 /etc/resolv.conf 来配置容器。</span><br><span class="line"> </span><br><span class="line">"exec-opts": [],</span><br><span class="line"> "exec-root":"",</span><br><span class="line"> "fixed-cidr":"",</span><br><span class="line"> "fixed-cidr-v6":"",</span><br><span class="line"> "data-root":"/var/lib/docker",     ＃ Docker运行时使用的根路径,根路径下的内容稍后介绍，默认/var/lib/docker</span><br><span class="line"> "group": "",                       # Unix套接字的属组,仅指/var/run/docker.sock</span><br><span class="line"> "hosts": [],                       # 设置容器hosts</span><br><span class="line"> "icc": false,</span><br><span class="line"> "insecure-registries": [],         # 配置docker的私库地址</span><br><span class="line"> "ip":"0.0.0.0",</span><br><span class="line"> "iptables": false,</span><br><span class="line"> "ipv6": false,</span><br><span class="line"> "ip-forward": false,               # 默认true, 启用 net.ipv4.ip_forward ,进入容器后使用 sysctl -a | grepnet.ipv4.ip_forward 查看</span><br><span class="line"> </span><br><span class="line">  "ip-masq":false,</span><br><span class="line"> "labels":["nodeName=node-121"],   # docker主机的标签，很实用的功能,例如定义：–label nodeName=host-121</span><br><span class="line"> </span><br><span class="line"> "live-restore": true,</span><br><span class="line"> "log-driver":"",</span><br><span class="line"> "log-level":"",</span><br><span class="line"> "log-opts": &#123;&#125;,</span><br><span class="line"> "max-concurrent-downloads":3,</span><br><span class="line"> "max-concurrent-uploads":5,</span><br><span class="line"> "mtu": 0,</span><br><span class="line"> "oom-score-adjust":-500,</span><br><span class="line"> "pidfile": "",                    # Docker守护进程的PID文件</span><br><span class="line"> "raw-logs": false,</span><br><span class="line"> "registry-mirrors":["xxxx"],      # 镜像加速的地址，增加后在 docker info 中可查看。</span><br><span class="line"> "runtimes": &#123;</span><br><span class="line"> "runc": &#123;</span><br><span class="line"> "path": "runc"</span><br><span class="line"> &#125;,</span><br><span class="line"> "custom": &#123;</span><br><span class="line"> "path":"/usr/local/bin/my-runc-replacement",</span><br><span class="line"> "runtimeArgs": [</span><br><span class="line"> <span class="string">"--debug"</span></span><br><span class="line"> ]</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;,</span><br><span class="line"> "selinux-enabled": false,          # 默认 false，启用 selinux 支持</span><br><span class="line"> </span><br><span class="line"> "storage-driver":"",</span><br><span class="line"> "storage-opts": [],</span><br><span class="line"> "swarm-default-advertise-addr":"",</span><br><span class="line"> "tls": true,                       # 默认 false, 启动TLS认证开关</span><br><span class="line"> "tlscacert": "",                   # 默认 ~/.docker/ca.pem，通过CA认证过的的certificate文件路径</span><br><span class="line"> "tlscert": "",                     # 默认 ~/.docker/cert.pem，TLS的certificate文件路径</span><br><span class="line"> "tlskey": "",                      # 默认 ~/.docker/key.pem，TLS的key文件路径</span><br><span class="line"> "tlsverify": true,                 # 默认 false，使用TLS并做后台进程与客户端通讯的验证</span><br><span class="line"> "userland-proxy":false,</span><br><span class="line"> "userns-remap":""</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>将 Nginx 日志格式化成 json</title>
      <link href="2019/11/19/nginx-log-format-to-json/"/>
      <url>2019/11/19/nginx-log-format-to-json/</url>
      
        <content type="html"><![CDATA[<p>将 Nginx 日志格式化成 json 格式</p><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 修改log_format</span><br><span class="line">log_format log_json &#39;&#123;&quot;timestamp&quot;:&quot;$time_local&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;http_host&quot;:&quot;$http_host&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;clinetip&quot;:&quot;$remote_addr&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;request&quot;:&quot;$request&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;status&quot;:&quot;$status&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;size&quot;:&quot;$body_bytes_sent&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;upstream_addr&quot;:&quot;$upstream_addr&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;upstream_status&quot;:&quot;$upstream_status&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;upstream_response_time&quot;:&quot;$upstream_response_time&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;request_time&quot;:&quot;$request_time&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;http_referer&quot;:&quot;$http_referer&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;http_user_agent&quot;:&quot;$http_user_agent&quot;,&#39;</span><br><span class="line">                                  &#39;&quot;http_x_forwarded_for&quot;:&quot;$http_x_forwarded_for&quot;&#125;&#39;;</span><br><span class="line">access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log  log_json;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 ELK 搭建日志分析系统</title>
      <link href="2019/11/19/elk/"/>
      <url>2019/11/19/elk/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt;&gt; &#x2F;etc&#x2F;security&#x2F;limits.conf</span><br><span class="line">* soft nproc 65535</span><br><span class="line">* hard nproc 65535</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">    tcp &#123;</span><br><span class="line">        port &#x3D;&gt; 8002</span><br><span class="line">        codec &#x3D;&gt; json_lines</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">filter&#123;</span><br><span class="line"># 如果message中以Retrieved hosts from InstanceDiscovery: 0开头</span><br><span class="line">    if([message]&#x3D;~ &quot;^Retrieved hosts from InstanceDiscovery: 0&quot;)&#123;</span><br><span class="line">    # 丢弃</span><br><span class="line">        drop&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">        elasticsearch &#123;</span><br><span class="line">                hosts &#x3D;&gt; &quot;localhost:8001&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        stdout &#123; codec &#x3D;&gt; rubydebug&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">filter &#123;</span><br><span class="line">    json &#123;</span><br><span class="line">        source &#x3D;&gt; &quot;message&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> elasticsearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Filebeat 指南</title>
      <link href="2019/11/19/filebeat/"/>
      <url>2019/11/19/filebeat/</url>
      
        <content type="html"><![CDATA[<h2 id="配置-Filebeat"><a href="#配置-Filebeat" class="headerlink" title="配置 Filebeat"></a>配置 Filebeat</h2><h3 id="日志输入"><a href="#日志输入" class="headerlink" title="日志输入"></a>日志输入</h3><p>使用 log 输入从日志文件中读取行。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">filebeat.inputs:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">type:</span> <span class="string">log</span></span><br><span class="line">  <span class="attr">paths:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/var/log/messages</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/var/log/*.log</span></span><br></pre></td></tr></table></figure><p>您可以配置额外的设置（例如 fields，include_lines，exclude_lines，multiline 等），从这些文件中获取行。您指定的选项将应用于此输入收集的所有文件。<br>要将不同的配置设置应用于不同的文件，您需要定义多个输入节：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">filebeat.inputs:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">type:</span> <span class="string">log</span> </span><br><span class="line">  <span class="attr">paths:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/var/log/system.log</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/var/log/wifi.log</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">type:</span> <span class="string">log</span> </span><br><span class="line">  <span class="attr">paths:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">"/var/log/apache2/*"</span></span><br><span class="line">  <span class="attr">fields:</span></span><br><span class="line">    <span class="attr">apache:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">fields_under_root:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> elasticsearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>habor</title>
      <link href="2019/11/18/habor/"/>
      <url>2019/11/18/habor/</url>
      
        <content type="html"><![CDATA[<p>curl -s 192.168.33.11:5000/v2/_catalog | json_reformat<br>curl -s 192.168.33.11:5000/v2/base/centos/tags/list | json_reformat</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetes 离线安装</title>
      <link href="2019/10/15/kubernetes/"/>
      <url>2019/10/15/kubernetes/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>IPADDRESS</th><th>HOSTNAME</th><th>ENVIROMENT</th><th>KERNEL</th></tr></thead><tbody><tr><td>192.168.33.50</td><td>k8smaster</td><td>CentOS 7</td><td>5.3.7-1.el7.elrepo.x86_64</td></tr><tr><td>192.168.33.51</td><td>k8snode01</td><td>CentOS 7</td><td>5.3.7-1.el7.elrepo.x86_64</td></tr><tr><td>192.168.33.52</td><td>k8snode01</td><td>CentOS 7</td><td>5.3.7-1.el7.elrepo.x86_64</td></tr></tbody></table><h3 id="1-设置域名解析"><a href="#1-设置域名解析" class="headerlink" title="1. 设置域名解析"></a>1. 设置域名解析</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt;&gt; /etc/hosts</span><br><span class="line">192.168.33.50 k8smaster</span><br><span class="line">192.168.33.51 k8snode01</span><br><span class="line">192.168.33.52 k8snode01</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="2-安装相关依赖包"><a href="#2-安装相关依赖包" class="headerlink" title="2. 安装相关依赖包"></a>2. 安装相关依赖包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install conntrack ipvsadm sysstat wget git</span><br></pre></td></tr></table></figure><h3 id="3-设置防火墙、SELINUX"><a href="#3-设置防火墙、SELINUX" class="headerlink" title="3. 设置防火墙、SELINUX"></a>3. 设置防火墙、SELINUX</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">systemctl disable firewalld &amp;&amp; systemctl stop firewalld</span><br><span class="line">yum -y install iptables-services</span><br><span class="line">systemctl enable iptables &amp;&amp; systemctl start iptables</span><br><span class="line">iptables -F</span><br><span class="line">service iptables save</span><br><span class="line"></span><br><span class="line">setenforce 0</span><br><span class="line">vim &#x2F;etc&#x2F;selinux&#x2F;config</span><br><span class="line"></span><br><span class="line">SELINUX&#x3D;disabled</span><br></pre></td></tr></table></figure><h3 id="4-设置时区调整系统时间"><a href="#4-设置时区调整系统时间" class="headerlink" title="4. 设置时区调整系统时间"></a>4. 设置时区调整系统时间</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">timedatectl set-timezone Asia&#x2F;Shanghai</span><br><span class="line"># 将当前时间写入硬件时钟</span><br><span class="line">timedatectl set-local-rtc 0</span><br><span class="line"># 重启依赖于系统时间的服务</span><br><span class="line">systemctl restart rsyslog</span><br><span class="line">systemctl restart crond</span><br></pre></td></tr></table></figure><h3 id="5-关闭系统不需要的服务"><a href="#5-关闭系统不需要的服务" class="headerlink" title="5. 关闭系统不需要的服务"></a>5. 关闭系统不需要的服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl disable postfix &amp;&amp; systemctl stop postfix</span><br></pre></td></tr></table></figure><h3 id="6-设置rsyslogd和systemd-journald"><a href="#6-设置rsyslogd和systemd-journald" class="headerlink" title="6. 设置rsyslogd和systemd journald"></a>6. 设置rsyslogd和systemd journald</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># 创建持久化保存日志的目录</span><br><span class="line">mkdir &#x2F;var&#x2F;log&#x2F;journal</span><br><span class="line">mkdir &#x2F;etc&#x2F;systemd&#x2F;journald.conf.d</span><br><span class="line">cat &lt;&lt; EOF &gt; &#x2F;etc&#x2F;systemd&#x2F;journald.conf.d&#x2F;99-prophet.conf</span><br><span class="line">[Journal]</span><br><span class="line"></span><br><span class="line"># 持久化保存到磁盘</span><br><span class="line">Storage&#x3D;persistent</span><br><span class="line"></span><br><span class="line"># 压缩历史日志</span><br><span class="line">Compress&#x3D;yes</span><br><span class="line">SyncIntervalSec&#x3D;5m</span><br><span class="line">RateLimitInterval&#x3D;30s</span><br><span class="line">RateLimitBurst&#x3D;1000</span><br><span class="line"></span><br><span class="line"># 最大占用空间</span><br><span class="line">SystemMaxUse&#x3D;5G</span><br><span class="line"></span><br><span class="line"># 单个日志文件最大100M</span><br><span class="line">SystemMaxFileSize&#x3D;100M</span><br><span class="line"></span><br><span class="line"># 日志保存时间2周</span><br><span class="line">MaxRetentionSec&#x3D;2week</span><br><span class="line"></span><br><span class="line"># 不将日志转发到syslog</span><br><span class="line">ForwardToSyslog&#x3D;no</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">systemctl restart systemd-journald</span><br></pre></td></tr></table></figure><h3 id="7-升级系统内核"><a href="#7-升级系统内核" class="headerlink" title="7. 升级系统内核"></a>7. 升级系统内核</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rpm --import https:&#x2F;&#x2F;www.elrepo.org&#x2F;RPM-GPG-KEY-elrepo.org</span><br><span class="line">yum install https:&#x2F;&#x2F;www.elrepo.org&#x2F;elrepo-release-7.0-4.el7.elrepo.noarch.rpm</span><br><span class="line">yum --enablerepo&#x3D;elrepo-kernel install kernel-ml -y</span><br><span class="line">grub2-mkconfig -o &#x2F;boot&#x2F;grub2&#x2F;grub.cfg</span><br><span class="line"></span><br><span class="line"># 设置默认启动为新内核</span><br><span class="line">sed -i &#39;s&#x2F;GRUB_DEFAULT&#x3D;saved&#x2F;GRUB_DEFAULT&#x3D;0&#x2F;g&#39; &#x2F;etc&#x2F;default&#x2F;grub</span><br><span class="line"></span><br><span class="line"># 重启</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h3 id="8-关闭SWAP"><a href="#8-关闭SWAP" class="headerlink" title="8. 关闭SWAP"></a>8. 关闭SWAP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">swapoff -a</span><br><span class="line">sed -i &#39;s|^&#x2F;swapfile|#&#x2F;swapfile|g&#39; &#x2F;etc&#x2F;fstab</span><br></pre></td></tr></table></figure><h3 id="9-调整内核参数"><a href="#9-调整内核参数" class="headerlink" title="9. 调整内核参数"></a>9. 调整内核参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; &#x2F;etc&#x2F;sysctl.d&#x2F;k8s.conf</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables &#x3D; 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables &#x3D; 1</span><br><span class="line">net.ipv6.conf.all.disable_ipv6 &#x3D; 1</span><br><span class="line">net.ipv4.ip_forward &#x3D; 1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sysctl -p &#x2F;etc&#x2F;sysctl.d&#x2F;k8s.conf</span><br></pre></td></tr></table></figure><h2 id="10-kube-proxy开启ipvs的前置条件"><a href="#10-kube-proxy开启ipvs的前置条件" class="headerlink" title="10. kube-proxy开启ipvs的前置条件"></a>10. kube-proxy开启ipvs的前置条件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">modprobe br_netfilter</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- nf_conntrack_ipv4</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看是否已经正确加载所需的内核模块</span></span><br><span class="line">lsmod | grep -e ip_vs -e nf_conntrack_ipv4</span><br></pre></td></tr></table></figure><h2 id="11-安装Docker"><a href="#11-安装Docker" class="headerlink" title="11. 安装Docker"></a>11. 安装Docker</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"># Step 2: 添加软件源信息</span><br><span class="line">sudo yum-config-manager --add-repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line"># Step 3: 更新并安装 Docker-CE</span><br><span class="line">sudo yum makecache fast</span><br><span class="line"></span><br><span class="line">yum install -y docker-ce</span><br><span class="line"></span><br><span class="line">systemctl enable docker &amp;&amp; systemctl start docker</span><br><span class="line"></span><br><span class="line"># 配置daemon</span><br><span class="line">cat &lt;&lt; EOF &gt; &#x2F;etc&#x2F;docker&#x2F;daemon.json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;exec-opts&quot;: [&quot;native.cgroupdriver&#x3D;systemd&quot;],</span><br><span class="line">    &quot;log-driver&quot;: &quot;json-file&quot;,</span><br><span class="line">    &quot;log-opts&quot;: &#123;</span><br><span class="line">        &quot;max-size&quot;: &quot;100m&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">mkdir -p &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;docker.service.d</span><br><span class="line"></span><br><span class="line"># 重启docker服务</span><br><span class="line">systemctl daemon-reload &amp;&amp; systemctl restart docker</span><br></pre></td></tr></table></figure><h3 id="12-安装kubeadm和kubelet（1-4-1-0）"><a href="#12-安装kubeadm和kubelet（1-4-1-0）" class="headerlink" title="12. 安装kubeadm和kubelet（1.4.1-0）"></a>12. 安装kubeadm和kubelet（1.4.1-0）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># yum remove -y kubelet kubeadm kubectl</span></span><br><span class="line">yum -y install kubelet-1.14.1-0.x86_64 kubeadm-1.14.1-0.x86_64 kubectl-1.14.1-0.x86_64</span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet &amp;&amp; systemctl start kubelet</span><br></pre></td></tr></table></figure><h2 id="13-使用kubeadm-init初始化集群"><a href="#13-使用kubeadm-init初始化集群" class="headerlink" title="13. 使用kubeadm init初始化集群"></a>13. 使用kubeadm init初始化集群</h2><ul><li><p>下载离线安装所需的docker image（需要科学上网）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images list</span><br></pre></td></tr></table></figure></li><li><p>所需镜像清单</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">k8s.gcr.io#coredns#1.3.1.tar</span><br><span class="line">k8s.gcr.io#etcd#3.3.10.tar</span><br><span class="line">k8s.gcr.io#kube-apiserver#v1.14.1.tar</span><br><span class="line">k8s.gcr.io#kube-controller-manager#v1.14.1.tar</span><br><span class="line">k8s.gcr.io#kube-proxy#v1.14.1.tar</span><br><span class="line">k8s.gcr.io#kube-scheduler#v1.14.1.tar</span><br><span class="line">k8s.gcr.io#pause#3.1.tar</span><br><span class="line">quay.io#coreos#flannel#v0.11.0-amd64.tar</span><br></pre></td></tr></table></figure><ul><li>导入docker image</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for i in &#96;ls -1&#96;;</span><br><span class="line">do</span><br><span class="line">docker load &lt; $i</span><br><span class="line">done</span><br></pre></td></tr></table></figure><hr><h3 id="14-k8smaster初始化k8s集群"><a href="#14-k8smaster初始化k8s集群" class="headerlink" title="14. k8smaster初始化k8s集群"></a>14. k8smaster初始化k8s集群</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config print init-defaults &gt; kubeadm-config.yaml</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: kubeadm.k8s.io&#x2F;v1beta1</span><br><span class="line">bootstrapTokens:</span><br><span class="line">- groups:</span><br><span class="line">  - system:bootstrappers:kubeadm:default-node-token</span><br><span class="line">  token: abcdef.0123456789abcdef</span><br><span class="line">  ttl: 24h0m0s</span><br><span class="line">  usages:</span><br><span class="line">  - signing</span><br><span class="line">  - authentication</span><br><span class="line">kind: InitConfiguration</span><br><span class="line">localAPIEndpoint:</span><br><span class="line">  advertiseAddress: 192.168.33.50</span><br><span class="line">  bindPort: 6443</span><br><span class="line">nodeRegistration:</span><br><span class="line">  criSocket: &#x2F;var&#x2F;run&#x2F;dockershim.sock</span><br><span class="line">  name: k8smaster</span><br><span class="line">  taints:</span><br><span class="line">  - effect: NoSchedule</span><br><span class="line">    key: node-role.kubernetes.io&#x2F;master</span><br><span class="line">---</span><br><span class="line">apiServer:</span><br><span class="line">  timeoutForControlPlane: 4m0s</span><br><span class="line">apiVersion: kubeadm.k8s.io&#x2F;v1beta1</span><br><span class="line">certificatesDir: &#x2F;etc&#x2F;kubernetes&#x2F;pki</span><br><span class="line">clusterName: kubernetes</span><br><span class="line">controlPlaneEndpoint: &quot;&quot;</span><br><span class="line">controllerManager: &#123;&#125;</span><br><span class="line">dns:</span><br><span class="line">  type: CoreDNS</span><br><span class="line">etcd:</span><br><span class="line">  local:</span><br><span class="line">    dataDir: &#x2F;var&#x2F;lib&#x2F;etcd</span><br><span class="line">imageRepository: k8s.gcr.io</span><br><span class="line">kind: ClusterConfiguration</span><br><span class="line">kubernetesVersion: v1.14.1</span><br><span class="line">networking:</span><br><span class="line">  dnsDomain: cluster.local</span><br><span class="line">  podSubnet: &quot;10.244.0.0&#x2F;16&quot;</span><br><span class="line">  serviceSubnet: 10.96.0.0&#x2F;12</span><br><span class="line">scheduler: &#123;&#125;</span><br><span class="line">---</span><br><span class="line">apiVersion: kubeproxy.config.k8s.io&#x2F;v1alpha1</span><br><span class="line">kind: KubeProxyConfiguration</span><br><span class="line">featureGates:</span><br><span class="line">  SupportIPVSProxyMode: true</span><br><span class="line">mode: ipvs</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --config&#x3D;kubeadm-config.yaml | tee kubeadm-init.log</span><br><span class="line"></span><br><span class="line">mkdir -p $HOME&#x2F;.kube</span><br><span class="line">sudo cp -i &#x2F;etc&#x2F;kubernetes&#x2F;admin.conf $HOME&#x2F;.kube&#x2F;config</span><br><span class="line">sudo chown $(id -u):$(id -g) $HOME&#x2F;.kube&#x2F;config</span><br></pre></td></tr></table></figure><ul><li>查看节点状态</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl get node</span><br><span class="line"></span><br><span class="line">NAME        STATUS     ROLES    AGE    VERSION</span><br><span class="line">k8smaster   NotReady   master   2m2s   v1.14.1</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl get cs</span><br><span class="line"></span><br><span class="line">NAME                 STATUS    MESSAGE             ERROR</span><br><span class="line">scheduler            Healthy   ok                  </span><br><span class="line">controller-manager   Healthy   ok                  </span><br><span class="line">etcd-0               Healthy   &#123;&quot;health&quot;:&quot;true&quot;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod -n kube-system -o wide</span><br><span class="line"></span><br><span class="line">NAME                                READY   STATUS    RESTARTS   AGE     IP              NODE        NOMINATED NODE   READINESS GATES</span><br><span class="line">coredns-fb8b8dccf-4sr7j             0&#x2F;1     Pending   0          10m     &lt;none&gt;          &lt;none&gt;      &lt;none&gt;           &lt;none&gt;</span><br><span class="line">coredns-fb8b8dccf-9lxf8             0&#x2F;1     Pending   0          10m     &lt;none&gt;          &lt;none&gt;      &lt;none&gt;           &lt;none&gt;</span><br><span class="line">etcd-k8smaster                      1&#x2F;1     Running   0          10m     192.168.33.50   k8smaster   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-apiserver-k8smaster            1&#x2F;1     Running   0          9m58s   192.168.33.50   k8smaster   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-controller-manager-k8smaster   1&#x2F;1     Running   0          9m56s   192.168.33.50   k8smaster   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-flannel-ds-amd64-r68r5         1&#x2F;1     Running   0          14s     192.168.33.50   k8smaster   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-proxy-gc9ms                    1&#x2F;1     Running   0          10m     192.168.33.50   k8smaster   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-scheduler-k8smaster            1&#x2F;1     Running   0          10m     192.168.33.50   k8smaster   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><h3 id="15-k8smaster安装flannel"><a href="#15-k8smaster安装flannel" class="headerlink" title="15. k8smaster安装flannel"></a>15. k8smaster安装flannel</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/k8s/</span><br><span class="line"><span class="built_in">cd</span> ~/k8s</span><br><span class="line">wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br><span class="line">kubectl apply -f  kube-flannel.yml</span><br></pre></td></tr></table></figure><h3 id="16-k8snode01、k8snode02加入集群"><a href="#16-k8snode01、k8snode02加入集群" class="headerlink" title="16. k8snode01、k8snode02加入集群"></a>16. k8snode01、k8snode02加入集群</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join 192.168.33.50:6443 --token abcdef.0123456789abcdef \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:91dd4c335d92e948075b8980f78beb112ebf7a23fffe156b64f90097b88d1612</span><br><span class="line"># 查看加入语句</span><br><span class="line">kubeadm token create --print-join-command</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod -n kube-system -o wide</span><br><span class="line">NAME                                READY   STATUS    RESTARTS   AGE     IP              NODE        NOMINATED NODE   READINESS GATES</span><br><span class="line">coredns-fb8b8dccf-4sr7j             1&#x2F;1     Running   0          14m     10.244.0.2      k8smaster   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">coredns-fb8b8dccf-9lxf8             1&#x2F;1     Running   0          14m     10.244.0.3      k8smaster   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">etcd-k8smaster                      1&#x2F;1     Running   0          13m     192.168.33.50   k8smaster   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-apiserver-k8smaster            1&#x2F;1     Running   0          13m     192.168.33.50   k8smaster   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-controller-manager-k8smaster   1&#x2F;1     Running   0          13m     192.168.33.50   k8smaster   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-flannel-ds-amd64-m6mtp         1&#x2F;1     Running   0          2m11s   192.168.33.51   k8snode01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-flannel-ds-amd64-qgmwp         1&#x2F;1     Running   0          2m5s    192.168.33.52   k8snode02   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-flannel-ds-amd64-r68r5         1&#x2F;1     Running   0          3m47s   192.168.33.50   k8smaster   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-proxy-9tpgd                    1&#x2F;1     Running   0          2m5s    192.168.33.52   k8snode02   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-proxy-gc9ms                    1&#x2F;1     Running   0          14m     192.168.33.50   k8smaster   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-proxy-tdz9k                    1&#x2F;1     Running   0          2m11s   192.168.33.51   k8snode01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-scheduler-k8smaster            1&#x2F;1     Running   0          13m     192.168.33.50   k8smaster   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl get node</span><br><span class="line"></span><br><span class="line">NAME        STATUS   ROLES    AGE     VERSION</span><br><span class="line">k8smaster   Ready    master   16m     v1.14.1</span><br><span class="line">k8snode01   Ready    &lt;none&gt;   3m54s   v1.14.1</span><br><span class="line">k8snode02   Ready    &lt;none&gt;   3m48s   v1.14.1</span><br></pre></td></tr></table></figure><h3 id="17-安装kubernetes-dashboard"><a href="#17-安装kubernetes-dashboard" class="headerlink" title="17. 安装kubernetes-dashboard"></a>17. 安装kubernetes-dashboard</h3>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>macOS 设置 launchpad 图标大小</title>
      <link href="2019/10/15/macos_launchpad_config/"/>
      <url>2019/10/15/macos_launchpad_config/</url>
      
        <content type="html"><![CDATA[<p>KMacOS 设置 launchpad 图标大小</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.dock springboard-rows -int 7</span><br><span class="line">defaults write com.apple.dock springboard-columns -int 6</span><br><span class="line">killall Dock</span><br><span class="line">defaults write com.apple.dock ResetLaunchPad -bool TRUE;killall Dock</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL Group Replication 安装及配置</title>
      <link href="2019/10/15/mysql_group_replication/"/>
      <url>2019/10/15/mysql_group_replication/</url>
      
        <content type="html"><![CDATA[<p>MySQL 组复制</p><a id="more"></a><h3 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">yum-config-manager --add-repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line">yum -y install docker-ce</span><br><span class="line">systemctl enable docker</span><br><span class="line">systemctl start docker</span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure><h3 id="创建网络"><a href="#创建网络" class="headerlink" title="创建网络"></a>创建网络</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:5.7</span><br><span class="line">docker network create --subnet&#x3D;192.168.100.0&#x2F;24 mysqlsubnet</span><br><span class="line">docker network ls</span><br></pre></td></tr></table></figure><h3 id="编辑配置文件"><a href="#编辑配置文件" class="headerlink" title="编辑配置文件"></a>编辑配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mkdir &#x2F;mysqldata &amp;&amp; cd &#x2F;mysqldata</span><br><span class="line">mkdir s&#123;1..3&#125;</span><br><span class="line"></span><br><span class="line">.&#x2F;conf.d&#x2F;</span><br><span class="line">├── s1</span><br><span class="line">│   └── my.cnf</span><br><span class="line">├── s2</span><br><span class="line">│   └── my.cnf</span><br><span class="line">└── s3</span><br><span class="line">    └── my.cnf</span><br></pre></td></tr></table></figure><blockquote><p>/mysqldata/conf.d/s1/my.cnf</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">port&#x3D;3306</span><br><span class="line">datadir&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">pid-file&#x3D;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.pid</span><br><span class="line">socket&#x3D;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.sock</span><br><span class="line">server_id&#x3D;1</span><br><span class="line">gtid_mode&#x3D;ON</span><br><span class="line">enforce_gtid_consistency&#x3D;ON</span><br><span class="line">master_info_repository&#x3D;TABLE</span><br><span class="line">relay_log_info_repository&#x3D;TABLE</span><br><span class="line">binlog-format&#x3D;ROW</span><br><span class="line">binlog_checksum&#x3D;NONE</span><br><span class="line">log-slave-updates&#x3D;1</span><br><span class="line">log_bin&#x3D;binlog</span><br><span class="line">relay-log&#x3D;bogon-relay-bin</span><br><span class="line"></span><br><span class="line">transaction_write_set_extraction &#x3D; XXHASH64</span><br><span class="line">loose-group_replication_group_name&#x3D;&quot;81263447-5a2b-11e9-94c6-0242c0a86465&quot;</span><br><span class="line">loose-group_replication_start_on_boot &#x3D; off</span><br><span class="line">loose-group_replication_local_address &#x3D; &#39;192.168.100.101:33061&#39;</span><br><span class="line">loose-group_replication_group_seeds &#x3D;&#39;192.168.100.101:33061,192.168.100.103:33061,192.168.100.105:33061&#39;</span><br><span class="line">loose-group_replication_bootstrap_group &#x3D; off</span><br></pre></td></tr></table></figure><blockquote><p>/mysqldata/conf.d/s2/my.cnf</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">port&#x3D;3306</span><br><span class="line">datadir&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">pid-file&#x3D;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.pid</span><br><span class="line">socket&#x3D;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.sock</span><br><span class="line">server_id&#x3D;3</span><br><span class="line">gtid_mode&#x3D;ON</span><br><span class="line">enforce_gtid_consistency&#x3D;ON</span><br><span class="line">master_info_repository&#x3D;TABLE</span><br><span class="line">relay_log_info_repository&#x3D;TABLE</span><br><span class="line">binlog-format&#x3D;ROW</span><br><span class="line">binlog_checksum&#x3D;NONE</span><br><span class="line">log-slave-updates&#x3D;1</span><br><span class="line">log_bin&#x3D;binlog</span><br><span class="line">relay-log&#x3D;bogon-relay-bin</span><br><span class="line"></span><br><span class="line">transaction_write_set_extraction &#x3D; XXHASH64</span><br><span class="line">loose-group_replication_group_name&#x3D;&quot;81263447-5a2b-11e9-94c6-0242c0a86465&quot;</span><br><span class="line">loose-group_replication_start_on_boot &#x3D; off</span><br><span class="line">loose-group_replication_local_address &#x3D; &#39;192.168.100.103:33061&#39;</span><br><span class="line">loose-group_replication_group_seeds &#x3D;&#39;192.168.100.101:33061,192.168.100.103:33061,192.168.100.105:33061&#39;</span><br><span class="line">loose-group_replication_bootstrap_group &#x3D; off</span><br></pre></td></tr></table></figure><blockquote><p>/mysqldata/conf.d/s2/my.cnf</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">port&#x3D;3306</span><br><span class="line">datadir&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">pid-file&#x3D;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.pid</span><br><span class="line">socket&#x3D;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.sock</span><br><span class="line">server_id&#x3D;5</span><br><span class="line">gtid_mode&#x3D;ON</span><br><span class="line">enforce_gtid_consistency&#x3D;ON</span><br><span class="line">master_info_repository&#x3D;TABLE</span><br><span class="line">relay_log_info_repository&#x3D;TABLE</span><br><span class="line">binlog-format&#x3D;ROW</span><br><span class="line">binlog_checksum&#x3D;NONE</span><br><span class="line">log-slave-updates&#x3D;1</span><br><span class="line">log_bin&#x3D;binlog</span><br><span class="line">relay-log&#x3D;bogon-relay-bin</span><br><span class="line"></span><br><span class="line">transaction_write_set_extraction &#x3D; XXHASH64</span><br><span class="line">loose-group_replication_group_name&#x3D;&quot;81263447-5a2b-11e9-94c6-0242c0a86465&quot;</span><br><span class="line">loose-group_replication_start_on_boot &#x3D; off</span><br><span class="line">loose-group_replication_local_address &#x3D; &#39;192.168.100.105:33061&#39;</span><br><span class="line">loose-group_replication_group_seeds &#x3D;&#39;192.168.100.101:33061,192.168.100.103:33061,192.168.100.105:33061&#39;</span><br><span class="line">loose-group_replication_bootstrap_group &#x3D; off</span><br></pre></td></tr></table></figure><h3 id="启动mysql"><a href="#启动mysql" class="headerlink" title="启动mysql"></a>启动mysql</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run --detach --memory&#x3D;512m --memory-swap&#x3D;1g --hostname&#x3D;mgr-s1 --net&#x3D;mysqlsubnet --ip&#x3D;192.168.100.101 --add-host mgr-s2:192.168.100.103 --add-host mgr-s3:192.168.100.105 --publish 3306:3306 --volume&#x3D;&#x2F;mysqldata&#x2F;conf.d&#x2F;s1&#x2F;:&#x2F;etc&#x2F;mysql&#x2F;conf.d --volume&#x3D;&#x2F;mysqldata&#x2F;s1:&#x2F;var&#x2F;lib&#x2F;mysql --name&#x3D;mgr-s1 -e MYSQL_ROOT_PASSWORD&#x3D;password -d mysql:5.7</span><br><span class="line">docker run --detach --memory&#x3D;512m --memory-swap&#x3D;1g --hostname&#x3D;mgr-s2 --net&#x3D;mysqlsubnet --ip&#x3D;192.168.100.103 --add-host mgr-s1:192.168.100.101 --add-host mgr-s3:192.168.100.105 --publish 3307:3306 --volume&#x3D;&#x2F;mysqldata&#x2F;conf.d&#x2F;s2&#x2F;:&#x2F;etc&#x2F;mysql&#x2F;conf.d --volume&#x3D;&#x2F;mysqldata&#x2F;s2:&#x2F;var&#x2F;lib&#x2F;mysql --name&#x3D;mgr-s2 -e MYSQL_ROOT_PASSWORD&#x3D;password -d mysql:5.7</span><br><span class="line">docker run --detach --memory&#x3D;512m --memory-swap&#x3D;1g --hostname&#x3D;mgr-s3 --net&#x3D;mysqlsubnet --ip&#x3D;192.168.100.105 --add-host mgr-s1:192.168.100.101 --add-host mgr-s2:192.168.100.103 --publish 3308:3306 --volume&#x3D;&#x2F;mysqldata&#x2F;conf.d&#x2F;s3&#x2F;:&#x2F;etc&#x2F;mysql&#x2F;conf.d --volume&#x3D;&#x2F;mysqldata&#x2F;s3:&#x2F;var&#x2F;lib&#x2F;mysql --name&#x3D;mgr-s3 -e MYSQL_ROOT_PASSWORD&#x3D;password -d mysql:5.7</span><br></pre></td></tr></table></figure><h3 id="设置复制组"><a href="#设置复制组" class="headerlink" title="设置复制组"></a>设置复制组</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">docker exec -it mgr-s1 &#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">mysql -uroot -ppassword</span><br><span class="line"></span><br><span class="line">SET SQL_LOG_BIN&#x3D;0;</span><br><span class="line">CREATE USER rpl_user@&#39;%&#39; IDENTIFIED BY &#39;password&#39;;</span><br><span class="line">GRANT REPLICATION SLAVE ON *.* TO rpl_user@&#39;%&#39;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line">SET SQL_LOG_BIN&#x3D;1;</span><br><span class="line">CHANGE MASTER TO MASTER_USER&#x3D;&#39;rpl_user&#39;, MASTER_PASSWORD&#x3D;&#39;password&#39; FOR CHANNEL &#39;group_replication_recovery&#39;;</span><br><span class="line">INSTALL PLUGIN group_replication SONAME &#39;group_replication.so&#39;;</span><br><span class="line">SHOW PLUGINS;</span><br><span class="line">SET GLOBAL group_replication_bootstrap_group&#x3D;ON;</span><br><span class="line">START GROUP_REPLICATION;</span><br><span class="line">SET GLOBAL group_replication_bootstrap_group&#x3D;OFF;</span><br><span class="line">SELECT * FROM performance_schema.replication_group_members;</span><br></pre></td></tr></table></figure><h3 id="向复制组中增加成员1"><a href="#向复制组中增加成员1" class="headerlink" title="向复制组中增加成员1"></a>向复制组中增加成员1</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mgr-s2 &#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">mysql -uroot -ppassword</span><br><span class="line"></span><br><span class="line">SET SQL_LOG_BIN&#x3D;0;</span><br><span class="line">CREATE USER rpl_user@&#39;%&#39; IDENTIFIED BY &#39;password&#39;;</span><br><span class="line">GRANT REPLICATION SLAVE ON *.* TO rpl_user@&#39;%&#39;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line">SET SQL_LOG_BIN&#x3D;1;</span><br><span class="line">CHANGE MASTER TO MASTER_USER&#x3D;&#39;rpl_user&#39;, MASTER_PASSWORD&#x3D;&#39;password&#39; FOR CHANNEL &#39;group_replication_recovery&#39;;</span><br><span class="line">INSTALL PLUGIN group_replication SONAME &#39;group_replication.so&#39;;</span><br><span class="line">SHOW PLUGINS;</span><br><span class="line">set global group_replication_allow_local_disjoint_gtids_join&#x3D;ON;</span><br><span class="line">START GROUP_REPLICATION;</span><br><span class="line">SELECT * FROM performance_schema.replication_group_members;</span><br></pre></td></tr></table></figure><h3 id="向复制组中增加成员2"><a href="#向复制组中增加成员2" class="headerlink" title="向复制组中增加成员2"></a>向复制组中增加成员2</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mgr-s3 &#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">mysql -uroot -ppassword</span><br><span class="line"></span><br><span class="line">SET SQL_LOG_BIN&#x3D;0;</span><br><span class="line">CREATE USER rpl_user@&#39;%&#39; IDENTIFIED BY &#39;password&#39;;</span><br><span class="line">GRANT REPLICATION SLAVE ON *.* TO rpl_user@&#39;%&#39;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line">SET SQL_LOG_BIN&#x3D;1;</span><br><span class="line">CHANGE MASTER TO MASTER_USER&#x3D;&#39;rpl_user&#39;, MASTER_PASSWORD&#x3D;&#39;password&#39; FOR CHANNEL &#39;group_replication_recovery&#39;;</span><br><span class="line">INSTALL PLUGIN group_replication SONAME &#39;group_replication.so&#39;;</span><br><span class="line">SHOW PLUGINS;</span><br><span class="line">set global group_replication_allow_local_disjoint_gtids_join&#x3D;ON;</span><br><span class="line">START GROUP_REPLICATION;</span><br><span class="line">SELECT * FROM performance_schema.replication_group_members;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cannot set LC_ALL to default locale</title>
      <link href="2019/10/14/issuse_locale/"/>
      <url>2019/10/14/issuse_locale/</url>
      
        <content type="html"><![CDATA[<p>locale: Cannot set LC_ALL to default locale: No such file or directory</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@kubemaster ~]# locale</span><br><span class="line">locale: Cannot set LC_CTYPE to default locale: No such file or directory</span><br><span class="line">locale: Cannot set LC_MESSAGES to default locale: No such file or directory</span><br><span class="line">locale: Cannot set LC_ALL to default locale: No such file or directory</span><br><span class="line">LANG&#x3D;zh_CN.UTF-8</span><br><span class="line">LC_CTYPE&#x3D;&quot;zh_CN.UTF-8&quot;</span><br><span class="line">LC_NUMERIC&#x3D;&quot;zh_CN.UTF-8&quot;</span><br><span class="line">LC_TIME&#x3D;&quot;zh_CN.UTF-8&quot;</span><br><span class="line">LC_COLLATE&#x3D;&quot;zh_CN.UTF-8&quot;</span><br><span class="line">LC_MONETARY&#x3D;&quot;zh_CN.UTF-8&quot;</span><br><span class="line">LC_MESSAGES&#x3D;&quot;zh_CN.UTF-8&quot;</span><br><span class="line">LC_PAPER&#x3D;&quot;zh_CN.UTF-8&quot;</span><br><span class="line">LC_NAME&#x3D;&quot;zh_CN.UTF-8&quot;</span><br><span class="line">LC_ADDRESS&#x3D;&quot;zh_CN.UTF-8&quot;</span><br><span class="line">LC_TELEPHONE&#x3D;&quot;zh_CN.UTF-8&quot;</span><br><span class="line">LC_MEASUREMENT&#x3D;&quot;zh_CN.UTF-8&quot;</span><br><span class="line">LC_IDENTIFICATION&#x3D;&quot;zh_CN.UTF-8&quot;</span><br><span class="line">LC_ALL&#x3D;zh_CN.UTF-8</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install glibc</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于 GTID 的 MySQL 双主安装及配置</title>
      <link href="2019/09/15/mysql_replication/"/>
      <url>2019/09/15/mysql_replication/</url>
      
        <content type="html"><![CDATA[<p>基于 GTID 的 MySQL 双主安装及配置</p><a id="more"></a><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul><li>CentOS 7</li><li>MySQL 5.7</li></ul><table><thead><tr><th>hostname</th><th>ipaddress</th></tr></thead><tbody><tr><td>mysql01</td><td>192.168.33.31</td></tr><tr><td>mysql02</td><td>192.168.33.32</td></tr></tbody></table><h3 id="1-下载MySQL安装包"><a href="#1-下载MySQL安装包" class="headerlink" title="1. 下载MySQL安装包"></a>1. 下载MySQL安装包</h3><p><a href="https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-community-server-5.7.28-1.el7.x86_64.rpm" target="_blank" rel="noopener">mysql-community-server-5.7.28</a><br><a href="https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-community-client-5.7.28-1.el7.x86_64.rpm" target="_blank" rel="noopener">mysql-community-client-5.7.28</a><br><a href="https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-community-common-5.7.28-1.el7.x86_64.rpm" target="_blank" rel="noopener">mysql-community-common-5.7.28</a><br><a href="https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-community-libs-5.7.28-1.el7.x86_64.rpm" target="_blank" rel="noopener">mysql-community-libs-5.7.28</a><br><a href="https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-community-libs-compat-5.7.28-1.el7.x86_64.rpm" target="_blank" rel="noopener">mysql-community-libs-compat-5.7.28</a><br><a href="https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-community-devel-5.7.28-1.el7.x86_64.rpm" target="_blank" rel="noopener">mysql-community-devel-5.7.28</a></p><h3 id="2-安装MySQL"><a href="#2-安装MySQL" class="headerlink" title="2. 安装MySQL"></a>2. 安装MySQL</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql01 ~]# yum -y remove mariadb-*</span><br><span class="line">[root@mysql01 ~]# rpm -ivh mysql-community-*</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql02 ~]# yum -y remove mariadb-*</span><br><span class="line">[root@mysql02 ~]# rpm -ivh mysql-community-*</span><br></pre></td></tr></table></figure><h3 id="3-配置-etc-my-cnf"><a href="#3-配置-etc-my-cnf" class="headerlink" title="3. 配置/etc/my.cnf"></a>3. 配置/etc/my.cnf</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql01 ~]# cat &#x2F;etc&#x2F;my.cnf | grep -Ev &quot;#|^$&quot;</span><br><span class="line">[mysqld]</span><br><span class="line">server-id                       &#x3D;       1</span><br><span class="line">log-bin                         &#x3D;       mysql-bin</span><br><span class="line">binlog_format                   &#x3D;       row</span><br><span class="line">gtid_mode                       &#x3D;       on</span><br><span class="line">enforce_gtid_consistency        &#x3D;       on</span><br><span class="line">log-slave-updates               &#x3D;       on</span><br><span class="line">auto_increment_offset           &#x3D;       1</span><br><span class="line">auto_increment_increment        &#x3D;       2</span><br><span class="line">datadir                         &#x3D;       &#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">socket                          &#x3D;       &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock</span><br><span class="line">symbolic-links                  &#x3D;       0</span><br><span class="line">log-error                       &#x3D;       &#x2F;var&#x2F;log&#x2F;mysqld.log</span><br><span class="line">pid-file                        &#x3D;       &#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.pid</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql02 ~]# cat &#x2F;etc&#x2F;my.cnf | grep -Ev &quot;#|^$&quot;</span><br><span class="line">server-id                       &#x3D;       2</span><br><span class="line">log-bin                         &#x3D;       mysql-bin</span><br><span class="line">binlog_format                   &#x3D;       row</span><br><span class="line">gtid_mode                       &#x3D;       on</span><br><span class="line">enforce_gtid_consistency        &#x3D;       on</span><br><span class="line">auto_increment_offset           &#x3D;       2</span><br><span class="line">auto_increment_increment        &#x3D;       2</span><br><span class="line">datadir                         &#x3D;       &#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">socket                          &#x3D;       &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock</span><br><span class="line">symbolic-links                  &#x3D;       0</span><br><span class="line">log-error                       &#x3D;       &#x2F;var&#x2F;log&#x2F;mysqld.log</span><br><span class="line">pid-file                        &#x3D;       &#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.pid</span><br></pre></td></tr></table></figure><h3 id="3-配置replication"><a href="#3-配置replication" class="headerlink" title="3. 配置replication"></a>3. 配置replication</h3><ul><li>mysql01、mysql02创建同步用户</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql01 ~]# systemctl enable mysqld</span><br><span class="line">[root@mysql01 ~]# systemctl start mysqld</span><br><span class="line">[root@mysql01 ~]# mysql -uroot -pP@ssw0rd</span><br><span class="line">mysql&gt; create user replication@&#39;%&#39; identified by &#39;P@ssw0rd&#39;;</span><br><span class="line">mysql&gt; grant replication slave on *.* to replication@&#39;%&#39;;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql02 ~]# systemctl enable mysqld</span><br><span class="line">[root@mysql02 ~]# systemctl start mysqld</span><br><span class="line">[root@mysql02 ~]# mysql -uroot -pP@ssw0rd</span><br><span class="line">mysql&gt; create user replication@&#39;%&#39; identified by &#39;P@ssw0rd&#39;;</span><br><span class="line">mysql&gt; grant replication slave on *.* to replication@&#39;%&#39;;</span><br></pre></td></tr></table></figure><ul><li>备库配置slave</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql02 ~]# mysql -uroot -pP@ssw0rd</span><br><span class="line">mysql&gt; CHANGE MASTER TO </span><br><span class="line">mysql&gt; MASTER_HOST&#x3D;&#39;192.168.33.31&#39;, </span><br><span class="line">mysql&gt; MASTER_USER&#x3D;&#39;replication&#39;, </span><br><span class="line">mysql&gt; MASTER_PASSWORD&#x3D;&#39;P@ssw0rd&#39;, </span><br><span class="line">mysql&gt; MASTER_AUTO_POSITION&#x3D;1;</span><br><span class="line">mysql&gt; start slave;</span><br><span class="line">mysql&gt; show slave status\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 192.168.33.31</span><br><span class="line">                  Master_User: replication</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000005</span><br><span class="line">          Read_Master_Log_Pos: 1146</span><br><span class="line">               Relay_Log_File: mysql02-relay-bin.000003</span><br><span class="line">                Relay_Log_Pos: 1359</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000005</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 1146</span><br><span class="line">              Relay_Log_Space: 1568</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 1</span><br><span class="line">                  Master_UUID: be182906-ef69-11e9-b8e6-5254008afee6</span><br><span class="line">             Master_Info_File: &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;master.info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind:</span><br><span class="line">      Last_IO_Error_Timestamp:</span><br><span class="line">     Last_SQL_Error_Timestamp:</span><br><span class="line">               Master_SSL_Crl:</span><br><span class="line">           Master_SSL_Crlpath:</span><br><span class="line">           Retrieved_Gtid_Set: be182906-ef69-11e9-b8e6-5254008afee6:1-5</span><br><span class="line">            Executed_Gtid_Set: be182906-ef69-11e9-b8e6-5254008afee6:1-5</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">         Replicate_Rewrite_DB:</span><br><span class="line">                 Channel_Name:</span><br><span class="line">           Master_TLS_Version:</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql01 ~]# mysql -uroot -pP@ssw0rd</span><br><span class="line">mysql&gt; CHANGE MASTER TO </span><br><span class="line">mysql&gt; MASTER_HOST&#x3D;&#39;192.168.33.32&#39;, </span><br><span class="line">mysql&gt; MASTER_USER&#x3D;&#39;replication&#39;, </span><br><span class="line">mysql&gt; MASTER_PASSWORD&#x3D;&#39;P@ssw0rd&#39;, </span><br><span class="line">mysql&gt; MASTER_AUTO_POSITION&#x3D;1;</span><br><span class="line">mysql&gt; start slave;</span><br><span class="line">mysql&gt; show slave status\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 192.168.33.32</span><br><span class="line">                  Master_User: replication</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000003</span><br><span class="line">          Read_Master_Log_Pos: 859</span><br><span class="line">               Relay_Log_File: mysql01-relay-bin.000007</span><br><span class="line">                Relay_Log_Pos: 1072</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000003</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 859</span><br><span class="line">              Relay_Log_Space: 1581</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 2</span><br><span class="line">                  Master_UUID: dc67074d-ef6a-11e9-be75-5254008afee6</span><br><span class="line">             Master_Info_File: &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;master.info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind:</span><br><span class="line">      Last_IO_Error_Timestamp:</span><br><span class="line">     Last_SQL_Error_Timestamp:</span><br><span class="line">               Master_SSL_Crl:</span><br><span class="line">           Master_SSL_Crlpath:</span><br><span class="line">           Retrieved_Gtid_Set: dc67074d-ef6a-11e9-be75-5254008afee6:1-4</span><br><span class="line">            Executed_Gtid_Set: be182906-ef69-11e9-b8e6-5254008afee6:1-31944,</span><br><span class="line">dc67074d-ef6a-11e9-be75-5254008afee6:1-4</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">         Replicate_Rewrite_DB:</span><br><span class="line">                 Channel_Name:</span><br><span class="line">           Master_TLS_Version:</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>开启mysql慢查询和死锁日志</title>
      <link href="2019/09/15/mysql_slow_query/"/>
      <url>2019/09/15/mysql_slow_query/</url>
      
        <content type="html"><![CDATA[<p>开启mysql慢查询和死锁日志</p><a id="more"></a><h3 id="显示慢查询状态及日志目录"><a href="#显示慢查询状态及日志目录" class="headerlink" title="显示慢查询状态及日志目录"></a>显示慢查询状态及日志目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;%slow_query_log%&#39;;</span><br><span class="line"></span><br><span class="line">+---------------------+--------------------------------------+</span><br><span class="line">| Variable_name       | Value                                |</span><br><span class="line">+---------------------+--------------------------------------+</span><br><span class="line">| slow_query_log      | OFF                                  |</span><br><span class="line">| slow_query_log_file | &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;9e6bec7d7160-slow.log |</span><br><span class="line">+---------------------+--------------------------------------+</span><br></pre></td></tr></table></figure><p>开启慢查询</p><p>说明: 1开启;0关闭;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global slow_query_log &#x3D; 1;</span><br></pre></td></tr></table></figure><p>显示慢查询阈值(单位秒)</p><p>默认执行时间超过10s才会被记录到日志</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;%long_query%&#39;;</span><br><span class="line"></span><br><span class="line">+-----------------+-----------+</span><br><span class="line">| Variable_name   | Value     |</span><br><span class="line">+-----------------+-----------+</span><br><span class="line">| long_query_time | 10.000000 |</span><br><span class="line">+-----------------+-----------+</span><br></pre></td></tr></table></figure><p>设置慢查询阈值</p><p>注意:设置后需要重新打开mysql客户端才能到最新的值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global long_query_time &#x3D; 0.8;</span><br></pre></td></tr></table></figure><p>查看死锁的日志是否开启</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">show variables like &quot;%innodb_print_all_deadlocks%&quot;;</span><br><span class="line"></span><br><span class="line">+----------------------------+-------+</span><br><span class="line">| Variable_name              | Value |</span><br><span class="line">+----------------------------+-------+</span><br><span class="line">| innodb_print_all_deadlocks | OFF   |</span><br><span class="line">+----------------------------+-------+</span><br></pre></td></tr></table></figure><p>开启记录死锁</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global innodb_print_all_deadlocks&#x3D;1</span><br></pre></td></tr></table></figure><p>查看最近一次deadlock</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show engine innodb status\G;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pip 使用国内源</title>
      <link href="2019/09/15/pip_cn/"/>
      <url>2019/09/15/pip_cn/</url>
      
        <content type="html"><![CDATA[<p>pip 使用国内源</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~&#x2F;.pip</span><br><span class="line">cat &lt;&lt; EOF &gt; ~&#x2F;.pip&#x2F;pip.conf</span><br><span class="line">[global]</span><br><span class="line">index-url &#x3D; https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple</span><br><span class="line">[install]</span><br><span class="line">trusted-host &#x3D; tsinghua.edu.cn</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 vagrant 搭建 kubernetes 基础环境</title>
      <link href="2019/09/15/vagrant_k8s/"/>
      <url>2019/09/15/vagrant_k8s/</url>
      
        <content type="html"><![CDATA[<p>使用 vagrant 搭建 kubernetes 基础环境</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"># -*- mode: ruby -*-</span><br><span class="line"># vi: set ft&#x3D;ruby :</span><br><span class="line"></span><br><span class="line">ENV[&quot;LC_ALL&quot;] &#x3D; &quot;en_US.UTF-8&quot;</span><br><span class="line">Vagrant.configure(&quot;2&quot;) do |config|</span><br><span class="line">  </span><br><span class="line">  config.vm.define &quot;kubemaster&quot; do |kubemaster|</span><br><span class="line">    kubemaster.vm.box &#x3D; &quot;centos&#x2F;7&quot;</span><br><span class="line">    kubemaster.vm.hostname &#x3D; &quot;kubemaster&quot;</span><br><span class="line">    kubemaster.vm.network &quot;private_network&quot;, ip: &quot;192.168.33.100&quot;</span><br><span class="line">    kubemaster.vm.provider &quot;virtualbox&quot; do |vb|</span><br><span class="line">      vb.gui &#x3D; false</span><br><span class="line">      vb.cpus &#x3D; 2</span><br><span class="line">      vb.memory &#x3D; &quot;1024&quot;</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  config.vm.define &quot;kubenode01&quot; do |kubenode01|</span><br><span class="line">    kubenode01.vm.box &#x3D; &quot;centos&#x2F;7&quot;</span><br><span class="line">    kubenode01.vm.hostname &#x3D; &quot;kubenode01&quot;</span><br><span class="line">    kubenode01.vm.network &quot;private_network&quot;, ip: &quot;192.168.33.101&quot;</span><br><span class="line">    kubenode01.vm.provider &quot;virtualbox&quot; do |vb|</span><br><span class="line">      vb.gui &#x3D; false</span><br><span class="line">      vb.cpus &#x3D; 2</span><br><span class="line">      vb.memory &#x3D; &quot;1024&quot;</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  config.vm.define &quot;kubenode02&quot; do |kubenode02|</span><br><span class="line">    kubenode02.vm.box &#x3D; &quot;centos&#x2F;7&quot;</span><br><span class="line">    kubenode02.vm.hostname &#x3D; &quot;kubenode02&quot;</span><br><span class="line">    kubenode02.vm.network &quot;private_network&quot;, ip: &quot;192.168.33.102&quot;</span><br><span class="line">    kubenode02.vm.provider &quot;virtualbox&quot; do |vb|</span><br><span class="line">      vb.gui &#x3D; false</span><br><span class="line">      vb.cpus &#x3D; 2</span><br><span class="line">      vb.memory &#x3D; &quot;1024&quot;</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">            </span><br><span class="line">  config.vm.provision &quot;shell&quot;, inline: &lt;&lt;-SHELL</span><br><span class="line">    sudo -i</span><br><span class="line">    echo &quot;设置SSH&quot;</span><br><span class="line">    sed -i &#39;s&#x2F;^#PermitRootLogin yes&#x2F;PermitRootLogin yes&#x2F;g&#39; &#x2F;etc&#x2F;ssh&#x2F;sshd_config</span><br><span class="line">    sed -i &#39;s&#x2F;PasswordAuthentication no&#x2F;PasswordAuthentication yes&#x2F;g&#39; &#x2F;etc&#x2F;ssh&#x2F;sshd_config</span><br><span class="line">    systemctl restart sshd</span><br><span class="line">    echo &quot;manager&quot; | passwd --stdin root</span><br><span class="line">    echo &quot;manager&quot; | passwd --stdin vagrant</span><br><span class="line"></span><br><span class="line">    echo &quot;# 关闭firewalld、selinux&quot;</span><br><span class="line">    setenforce 0</span><br><span class="line">    sed -i &#39;s&#x2F;^SELINUX&#x3D;enforcing&#x2F;SELINUX&#x3D;disabled&#x2F;g&#39; &#x2F;etc&#x2F;selinux&#x2F;config</span><br><span class="line">    systemctl disable firewalld &amp;&amp; systemctl stop firewalld</span><br><span class="line"></span><br><span class="line">    echo &quot;# 设置&#x2F;etc&#x2F;hosts&quot;</span><br><span class="line">    cat &lt;&lt; EOF &gt;&gt; &#x2F;etc&#x2F;hosts</span><br><span class="line">192.168.33.100 kubemaster</span><br><span class="line">192.168.33.101 kubenode01</span><br><span class="line">192.168.33.102 kubenode02</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">    echo &quot;# 安装依赖&quot;</span><br><span class="line">    yum makecache</span><br><span class="line">    yum -y install vim wget curl sysstat bind-utils zlib-devel openssl-devel conntrack ipvsadm sysstat wget git iptables-services yum-utils device-mapper-persistent-data lvm2 net-tools</span><br><span class="line"></span><br><span class="line">    echo &quot;# 安装docker&quot;</span><br><span class="line">    yum-config-manager --add-repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line">    yum install -y docker-ce</span><br><span class="line">    systemctl enable docker &amp;&amp; systemctl start docker</span><br><span class="line">    cat &lt;&lt; EOF &gt; &#x2F;etc&#x2F;docker&#x2F;daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver&#x3D;systemd&quot;],</span><br><span class="line">  &quot;log-driver&quot;: &quot;json-file&quot;,</span><br><span class="line">  &quot;log-opts&quot;: &#123;</span><br><span class="line">    &quot;max-size&quot;: &quot;100m&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">    mkdir -p &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;docker.service.d</span><br><span class="line">    systemctl daemon-reload &amp;&amp; systemctl restart docker</span><br><span class="line">    </span><br><span class="line">    echo &quot;# 启用iptables&quot;</span><br><span class="line">    systemctl enable iptables &amp;&amp; systemctl start iptables</span><br><span class="line">    iptables -F</span><br><span class="line">    service iptables save</span><br><span class="line"></span><br><span class="line">    echo &quot;# 关闭系统不需要的服务&quot;</span><br><span class="line">    systemctl disable postfix &amp;&amp; systemctl stop postfix</span><br><span class="line"></span><br><span class="line">    echo &quot;# kube-proxy开启ipvs&quot;</span><br><span class="line">    modprobe br_netfilter</span><br><span class="line">    cat &lt;&lt; EOF &gt; &#x2F;etc&#x2F;sysconfig&#x2F;modules&#x2F;ipvs.modules</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- nf_conntrack_ipv4</span><br><span class="line">EOF</span><br><span class="line">    chmod 755 &#x2F;etc&#x2F;sysconfig&#x2F;modules&#x2F;ipvs.modules &amp;&amp; bash &#x2F;etc&#x2F;sysconfig&#x2F;modules&#x2F;ipvs.modules</span><br><span class="line">    lsmod | grep -e ip_vs -e nf_conntrack_ipv4</span><br><span class="line"></span><br><span class="line">    echo &quot;# 调整内核参数&quot;</span><br><span class="line">    cat &lt;&lt; EOF &gt; &#x2F;etc&#x2F;sysctl.d&#x2F;k8s.conf</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables &#x3D; 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables &#x3D; 1</span><br><span class="line">net.ipv6.conf.all.disable_ipv6 &#x3D; 1</span><br><span class="line">net.ipv4.ip_forward &#x3D; 1</span><br><span class="line">EOF</span><br><span class="line">    sysctl -p &#x2F;etc&#x2F;sysctl.d&#x2F;k8s.conf</span><br><span class="line"></span><br><span class="line">    echo &quot;# 添加kubernetes源&quot;</span><br><span class="line">    cat &lt;&lt; EOF &gt; &#x2F;etc&#x2F;yum.repos.d&#x2F;kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name&#x3D;Kubernetes</span><br><span class="line">baseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;repos&#x2F;kubernetes-el7-x86_64&#x2F;</span><br><span class="line">enabled&#x3D;1</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">repo_gpgcheck&#x3D;1</span><br><span class="line">gpgkey&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;doc&#x2F;yum-key.gpg https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;doc&#x2F;rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line">  SHELL</span><br><span class="line">end</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vagrant </tag>
            
            <tag> virtualbox </tag>
            
            <tag> kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git 指南</title>
      <link href="2019/05/26/git/"/>
      <url>2019/05/26/git/</url>
      
        <content type="html"><![CDATA[<h2 id="1-获取-Git-仓库"><a href="#1-获取-Git-仓库" class="headerlink" title="1. 获取 Git 仓库"></a>1. 获取 Git 仓库</h2><h3 id="在现有目录中初始化仓库"><a href="#在现有目录中初始化仓库" class="headerlink" title="在现有目录中初始化仓库"></a>在现有目录中初始化仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure><h3 id="克隆现有的仓库"><a href="#克隆现有的仓库" class="headerlink" title="克隆现有的仓库"></a>克隆现有的仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/libgit2/libgit2 mylibgit</span><br></pre></td></tr></table></figure><h2 id="2-记录每次更新到仓库"><a href="#2-记录每次更新到仓库" class="headerlink" title="2. 记录每次更新到仓库"></a>2. 记录每次更新到仓库</h2><h3 id="检查当前文件状态"><a href="#检查当前文件状态" class="headerlink" title="检查当前文件状态"></a>检查当前文件状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure><h3 id="跟踪新文件"><a href="#跟踪新文件" class="headerlink" title="跟踪新文件"></a>跟踪新文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add README</span><br><span class="line">git status</span><br></pre></td></tr></table></figure><h3 id="暂存已修改文件"><a href="#暂存已修改文件" class="headerlink" title="暂存已修改文件"></a>暂存已修改文件</h3><h3 id="状态简览"><a href="#状态简览" class="headerlink" title="状态简览"></a>状态简览</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git status --short</span><br><span class="line">git status -s</span><br></pre></td></tr></table></figure><h3 id="忽略文件"><a href="#忽略文件" class="headerlink" title="忽略文件"></a>忽略文件</h3><p>使用 .gitignore 文件</p><ul><li>所有空行或者以 ＃ 开头的行都会被 Git 忽略。</li><li>可以使用标准的 glob 模式匹配。</li><li>匹配模式可以以（/）开头防止递归。</li><li>匹配模式可以以（/）结尾指定目录。</li><li>要忽略指定模式以外的文件或目录，可以在模式前加上惊叹号（!）取反。</li></ul><p>glob 模式</p><ul><li>星号（*）匹配零个或多个任意字符；</li><li>[abc] 匹配任何一个列在方括号中的字符；</li><li>问号（?）只匹配一个任意字符；</li><li>如果在方括号中使用短划线分隔两个字符，表示所有在这两个字符范围内的都可以匹配；</li><li>使用两个星号（*) 表示匹配任意中间目录。</li></ul><h3 id="查看已暂存和未暂存的修改"><a href="#查看已暂存和未暂存的修改" class="headerlink" title="查看已暂存和未暂存的修改"></a>查看已暂存和未暂存的修改</h3><ul><li>查看尚未暂存的文件更新了哪些部分</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff</span><br></pre></td></tr></table></figure><ul><li>查看已暂存的将要添加到下次提交里的内容</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git diff --staged</span><br><span class="line">git diff --cached</span><br></pre></td></tr></table></figure><h3 id="提交更新"><a href="#提交更新" class="headerlink" title="提交更新"></a>提交更新</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m <span class="string">"first commit"</span></span><br></pre></td></tr></table></figure><h3 id="跳过使用暂存区域"><a href="#跳过使用暂存区域" class="headerlink" title="跳过使用暂存区域"></a>跳过使用暂存区域</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -a -m <span class="string">"second commit"</span></span><br></pre></td></tr></table></figure><h3 id="移除文件"><a href="#移除文件" class="headerlink" title="移除文件"></a>移除文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm [file_name]</span><br></pre></td></tr></table></figure><p>把文件从 Git 仓库中删除，文件保留在当前工作目录中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm --cached [file_name]</span><br></pre></td></tr></table></figure><h3 id="移动文件"><a href="#移动文件" class="headerlink" title="移动文件"></a>移动文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git mv file_from file_to</span><br></pre></td></tr></table></figure><h2 id="3-查看提交历史"><a href="#3-查看提交历史" class="headerlink" title="3. 查看提交历史"></a>3. 查看提交历史</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> -p -2 <span class="comment"># -p 显示每次提交的内容差异，-2 仅显示最近两次提交</span></span><br><span class="line">git <span class="built_in">log</span> --<span class="built_in">stat</span> <span class="comment"># 查看提交的简略的统计信息</span></span><br><span class="line">git <span class="built_in">log</span> --oneline <span class="comment"># 将每个提交放在一行显示</span></span><br><span class="line">git <span class="built_in">log</span> --short</span><br><span class="line">git <span class="built_in">log</span> --full</span><br><span class="line">git <span class="built_in">log</span> --fuller</span><br><span class="line">git <span class="built_in">log</span> --pretty=online</span><br><span class="line">git <span class="built_in">log</span> --pretty=format:<span class="string">"%h - %an, %ar : %s"</span> --graph <span class="comment"># 定制要显示的记录格式</span></span><br></pre></td></tr></table></figure><p><code>git log</code> 常用选项</p><table><thead><tr><th align="right">选项</th><th align="left">说明</th></tr></thead><tbody><tr><td align="right">-p</td><td align="left">按补丁格式显示每个更新之间的差异</td></tr><tr><td align="right">–stat</td><td align="left">显示每次更新的文件修改统计信息。</td></tr><tr><td align="right">–shortstat</td><td align="left">只显示 –stat 中最后的行数修改添加移除统计。</td></tr><tr><td align="right">–name-only</td><td align="left">仅在提交信息后显示已修改的文件清单。</td></tr><tr><td align="right">–name-status</td><td align="left">显示新增、修改、删除的文件清单。</td></tr><tr><td align="right">–abbrev-commit</td><td align="left">仅显示 SHA-1 的前几个字符，而非所有的 40 个字符。</td></tr><tr><td align="right">–relative-date</td><td align="left">使用较短的相对时间显示（比如，“2 weeks ago”）。</td></tr><tr><td align="right">–graph</td><td align="left">显示 ASCII 图形表示的分支合并历史。</td></tr><tr><td align="right">–pretty</td><td align="left">使用其他格式显示历史提交信息。可用的选项包括 oneline，short，full，fuller 和 format（后跟指定格式）。</td></tr></tbody></table><p><code>git log --pretty=format</code> 常用的选项</p><table><thead><tr><th align="right">选项</th><th align="left">说明</th></tr></thead><tbody><tr><td align="right">%H</td><td align="left">提交对象（commit）的完整哈希字串</td></tr><tr><td align="right">%h</td><td align="left">提交对象的简短哈希字串</td></tr><tr><td align="right">%T</td><td align="left">树对象（tree）的完整哈希字串</td></tr><tr><td align="right">%t</td><td align="left">树对象的简短哈希字串</td></tr><tr><td align="right">%P</td><td align="left">父对象（parent）的完整哈希字串</td></tr><tr><td align="right">%p</td><td align="left">父对象的简短哈希字串</td></tr><tr><td align="right">%an</td><td align="left">作者（author）的名字</td></tr><tr><td align="right">%ae</td><td align="left">作者的电子邮件地址</td></tr><tr><td align="right">%ad</td><td align="left">作者修订日期（可以用 –date= 选项定制格式）</td></tr><tr><td align="right">%ar</td><td align="left">作者修订日期，按多久以前的方式显示</td></tr><tr><td align="right">%cn</td><td align="left">提交者（committer）的名字</td></tr><tr><td align="right">%ce</td><td align="left">提交者的电子邮件地址</td></tr><tr><td align="right">%cd</td><td align="left">提交日期</td></tr><tr><td align="right">%cr</td><td align="left">提交日期，按多久以前的方式显示</td></tr><tr><td align="right">%s</td><td align="left">提交说明</td></tr></tbody></table><h3 id="限制输出长度"><a href="#限制输出长度" class="headerlink" title="限制输出长度"></a>限制输出长度</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --since=2.weeks</span><br></pre></td></tr></table></figure><p>限制 <code>git log</code> 输出的选项</p><table><thead><tr><th align="right">选项</th><th align="left">说明</th></tr></thead><tbody><tr><td align="right">-(n)</td><td align="left">仅显示最近的 n 条提交</td></tr><tr><td align="right">–since, –after</td><td align="left">仅显示指定时间之后的提交</td></tr><tr><td align="right">–until, –before</td><td align="left">仅显示指定时间之前的提交</td></tr><tr><td align="right">–author</td><td align="left">仅显示指定作者相关的提交</td></tr><tr><td align="right">–committer</td><td align="left">仅显示指定提交者相关的提交</td></tr><tr><td align="right">–grep</td><td align="left">仅显示含指定关键字的提交</td></tr><tr><td align="right">-S</td><td align="left">仅显示添加或移除了某个关键字的提交</td></tr></tbody></table><h2 id="4-撤消操作"><a href="#4-撤消操作" class="headerlink" title="4. 撤消操作"></a>4. 撤消操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit --amend</span><br></pre></td></tr></table></figure><h3 id="取消暂存的文件"><a href="#取消暂存的文件" class="headerlink" title="取消暂存的文件"></a>取消暂存的文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git reset HEAD &lt;file&gt; ...</span></span><br><span class="line">git reset HEAD CONTRIBUTING.md</span><br></pre></td></tr></table></figure><h3 id="撤消对文件的修改"><a href="#撤消对文件的修改" class="headerlink" title="撤消对文件的修改"></a>撤消对文件的修改</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git checkout -- &lt;file&gt;</span></span><br><span class="line">git checkout -- CONTRIBUTING.md</span><br></pre></td></tr></table></figure><h2 id="5-远程仓库的使用"><a href="#5-远程仓库的使用" class="headerlink" title="5. 远程仓库的使用"></a>5. 远程仓库的使用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/schacon/ticgit</span><br><span class="line">git remote</span><br><span class="line">git remote -v</span><br><span class="line">git remote add pb https://github.com/paulboone/ticgit</span><br><span class="line">git fetch pb</span><br></pre></td></tr></table></figure><h3 id="从远程仓库中抓取与拉取"><a href="#从远程仓库中抓取与拉取" class="headerlink" title="从远程仓库中抓取与拉取"></a>从远程仓库中抓取与拉取</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git fetch [remote-name]</span><br></pre></td></tr></table></figure><h3 id="推送到远程仓库"><a href="#推送到远程仓库" class="headerlink" title="推送到远程仓库"></a>推送到远程仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure><h3 id="查看远程仓库"><a href="#查看远程仓库" class="headerlink" title="查看远程仓库"></a>查看远程仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git remote show [remote-name]</span></span><br><span class="line">git remote show origin</span><br></pre></td></tr></table></figure><h3 id="远程仓库的移除与重命名"><a href="#远程仓库的移除与重命名" class="headerlink" title="远程仓库的移除与重命名"></a>远程仓库的移除与重命名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote rename pb paul</span><br><span class="line">git remote rm paul</span><br></pre></td></tr></table></figure><h2 id="6-打标签"><a href="#6-打标签" class="headerlink" title="6. 打标签"></a>6. 打标签</h2><h3 id="列出标签"><a href="#列出标签" class="headerlink" title="列出标签"></a>列出标签</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git tag</span><br><span class="line">git tag -l <span class="string">'v1.8.5*'</span></span><br></pre></td></tr></table></figure><h3 id="创建标签"><a href="#创建标签" class="headerlink" title="创建标签"></a>创建标签</h3><h3 id="附注标签"><a href="#附注标签" class="headerlink" title="附注标签"></a>附注标签</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git tag -a v1.4 -m <span class="string">'my version 1.4'</span></span><br><span class="line">git tag</span><br><span class="line">git show v1.4 <span class="comment"># 查看标签信息与对应的提交信息</span></span><br></pre></td></tr></table></figure><h3 id="轻量标签"><a href="#轻量标签" class="headerlink" title="轻量标签"></a>轻量标签</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git tag v1.4-lw</span><br><span class="line">git tag</span><br></pre></td></tr></table></figure><h3 id="后期打标签"><a href="#后期打标签" class="headerlink" title="后期打标签"></a>后期打标签</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --pretty=oneline</span><br><span class="line">git tag -a v1.2 &lt;部分校验和&gt; <span class="comment"># git tag -a v1.2 9fceb02</span></span><br></pre></td></tr></table></figure><h3 id="共享标签"><a href="#共享标签" class="headerlink" title="共享标签"></a>共享标签</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git push origin v1.5</span><br><span class="line">git push origin --tags <span class="comment"># 一次性推送全部标签</span></span><br></pre></td></tr></table></figure><h3 id="检出标签"><a href="#检出标签" class="headerlink" title="检出标签"></a>检出标签</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 git checkout -b [branchname] [tagname] 在特定的标签上创建一个新分支</span></span><br><span class="line">git checkout -b version2 v2.0.0</span><br></pre></td></tr></table></figure><h2 id="7-Git-别名"><a href="#7-Git-别名" class="headerlink" title="7. Git 别名"></a>7. Git 别名</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git config --global alias.co checkout</span><br><span class="line">git config --global alias.br branch</span><br><span class="line">git config --global alias.ci commit</span><br><span class="line">git config --global alias.st status</span><br><span class="line">git config --global alias.unstage <span class="string">'reset HEAD --'</span></span><br><span class="line">git config --global alias.last <span class="string">'log -1 HEAD'</span></span><br><span class="line"><span class="comment"># 执行外部命令，在命令前面加入 ! 符号</span></span><br><span class="line">git config --global alias.visual <span class="string">'!gitk'</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Prometheus + Grafana</title>
      <link href="2019/02/27/promethues/"/>
      <url>2019/02/27/promethues/</url>
      
        <content type="html"><![CDATA[<p>开源监控平台 Prometheus</p><a id="more"></a><h2 id="安装-GO"><a href="#安装-GO" class="headerlink" title="安装 GO"></a>安装 GO</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum -y install go</span><br><span class="line">[root@mysqlnode05 go]# go version</span><br></pre></td></tr></table></figure><h2 id="安装-prometheus"><a href="#安装-prometheus" class="headerlink" title="安装 prometheus"></a>安装 prometheus</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# tar -zxvf prometheus-2.7.1.linux-amd64.tar.gz</span><br><span class="line">[root@master ~]# mv prometheus-2.7.1.linux-amd64 /appdata/prometheus</span><br><span class="line">[root@master ~]# cd /appdata/prometheus/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改prometheus.yml文件，配置targets其中的IP和端口则是对应的exporter的监听端口</span></span><br><span class="line">[root@master ~]# vim prometheus.yml</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span>     <span class="string">15s</span> <span class="comment"># Set the scrape interval to every 15 seconds. Default is every 1 minute.</span></span><br><span class="line">  <span class="attr">evaluation_interval:</span> <span class="string">15s</span> <span class="comment"># Evaluate rules every 15 seconds. The default is every 1 minute.</span></span><br><span class="line">  <span class="comment"># scrape_timeout is set to the global default (10s).</span></span><br><span class="line"><span class="attr">alerting:</span></span><br><span class="line">  <span class="attr">alertmanagers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span></span><br><span class="line">      <span class="comment"># - alertmanager:9093</span></span><br><span class="line"><span class="attr">rule_files:</span></span><br><span class="line">  <span class="comment"># - "first_rules.yml"</span></span><br><span class="line">  <span class="comment"># - "second_rules.yml"</span></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="comment"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">'prometheus'</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> <span class="string">['192.168.41.131:9090']</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">'master'</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> <span class="string">['192.168.41.131:9100']</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">instance:</span> <span class="string">master</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">'slave'</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> <span class="string">['192.168.41.132:9100']</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">instance:</span> <span class="string">slave</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">'mysql-master'</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> <span class="string">['192.168.41.131:9104']</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">instance:</span> <span class="string">master</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">'mysql-slave'</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> <span class="string">['192.168.41.132:9104']</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">instance:</span> <span class="string">slave</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动并通过web访问</span></span><br><span class="line">[root@master ~]# /appdata/prometheus/prometheus --config.file /appdata/prometheus/prometheus.yml &gt;&gt; /appdata/prometheus/prometheus.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><h2 id="安装-mysqld-exporter"><a href="#安装-mysqld-exporter" class="headerlink" title="安装 mysqld_exporter"></a>安装 mysqld_exporter</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# tar -zxvf mysqld_exporter-0.11.0.linux-amd64.tar.gz</span><br><span class="line">[root@master ~]# cp mysqld_exporter-0.11.0.linux-amd64/mysqld_exporter /appdata/prometheus/</span><br><span class="line">[root@master ~]# mysql -uroot -p</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建专用用户</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create user <span class="string">'prometheus'</span>@<span class="string">'%'</span> identified by <span class="string">'xxxxxx'</span>;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> grant REPLICATION CLIENT,PROCESS,SELECT ON *.* TO <span class="string">'prometheus'</span>@<span class="string">'%'</span>;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> flush privileges;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建exporter配置文件</span></span><br><span class="line">[root@master ~]# vim /appdata/prometheus/.my.cnf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">user&#x3D;mysql_prome</span><br><span class="line">password&#x3D;Aa123456789</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动mysqld_exporter</span></span><br><span class="line">[root@master ~]# /appdata/prometheus/mysqld_exporter --config.my-cnf /appdata/prometheus/.my.cnf &gt;&gt; /appdata/prometheus/mysqld_exporter.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><h2 id="安装-node-exporter"><a href="#安装-node-exporter" class="headerlink" title="安装 node_exporter"></a>安装 node_exporter</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# tar -zxvf node_exporter-0.17.0.linux-amd64.tar.gz</span><br><span class="line">[root@master ~]# cp node_exporter-0.17.0.linux-amd64/node_exporter /appdata/prometheus/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动node_exporter</span></span><br><span class="line">[root@master ~]# /appdata/prometheus/node_exporter &gt;&gt; /appdata/prometheus/node_exporter.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><h2 id="查看-target-status"><a href="#查看-target-status" class="headerlink" title="查看 target status"></a>查看 target status</h2><p>浏览器访问 <a href="http://192.168.31.131:9090" target="_blank" rel="noopener">http://192.168.31.131:9090</a></p><h2 id="安装-grafana"><a href="#安装-grafana" class="headerlink" title="安装 grafana"></a>安装 grafana</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# wget https://dl.grafana.com/oss/release/grafana-6.0.0-1.x86_64.rpm </span><br><span class="line">[root@master ~]# yum -y install grafana-6.0.0-1.x86_64.rpm</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动grafana</span></span><br><span class="line">[root@master ~]# systemctl enable grafana-server</span><br><span class="line">[root@master ~]# systemctl start grafana-server</span><br></pre></td></tr></table></figure><h2 id="添加数据源"><a href="#添加数据源" class="headerlink" title="添加数据源"></a>添加数据源</h2><p>浏览器访问 <a href="http://192.168.31.131:3000" target="_blank" rel="noopener">http://192.168.31.131:3000</a></p>]]></content>
      
      
      <categories>
          
          <category> monitor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> prometheus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL 安装指南</title>
      <link href="2019/02/18/mysql/"/>
      <url>2019/02/18/mysql/</url>
      
        <content type="html"><![CDATA[<p>MySQL 安装指南</p><a id="more"></a><h1 id="1-安装并初始化数据库"><a href="#1-安装并初始化数据库" class="headerlink" title="1. 安装并初始化数据库"></a>1. 安装并初始化数据库</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># ls</span></span><br><span class="line">mysql-8.0.15-linux-glibc2.12-x86_64.tar.xz</span><br><span class="line">[root@master ~]<span class="comment"># tar -Jxf mysql-8.0.15-linux-glibc2.12-x86_64.tar.xz</span></span><br><span class="line">[root@master ~]<span class="comment"># ls</span></span><br><span class="line">mysql-8.0.15-linux-glibc2.12-x86_64  mysql-8.0.15-linux-glibc2.12-x86_64.tar.xz</span><br><span class="line">[root@master ~]<span class="comment"># mkdir /appdata </span></span><br><span class="line">[root@master ~]<span class="comment"># mv mysql-8.0.15-linux-glibc2.12-x86_64 /appdata/mysql</span></span><br><span class="line">[root@master ~]<span class="comment"># cd /appdata/mysql/bin</span></span><br><span class="line">[root@master bin]<span class="comment"># ./mysqld --verbose --help</span></span><br><span class="line">[root@master bin]<span class="comment"># ./mysqld --initialize --user=mysql</span></span><br><span class="line">2019-02-17T13:24:47.271942Z 0 [Warning] [MY-011070] [Server] <span class="string">'Disabling symbolic links using --skip-symbolic-links (or equivalent) is the default. Consider not using this option as it'</span> is deprecated and will be removed <span class="keyword">in</span> a future release.</span><br><span class="line">2019-02-17T13:24:47.272022Z 0 [System] [MY-013169] [Server] /appdata/mysql/bin/mysqld (mysqld 8.0.15) initializing of server <span class="keyword">in</span> progress as process 9517</span><br><span class="line">2019-02-17T13:24:49.230753Z 5 [Note] [MY-010454] [Server] A temporary password is generated <span class="keyword">for</span> root@localhost: fYd00.&lt;Ucx:0</span><br><span class="line">2019-02-17T13:24:50.553995Z 0 [System] [MY-013170] [Server] /appdata/mysql/bin/mysqld (mysqld 8.0.15) initializing of server has completed</span><br></pre></td></tr></table></figure><h1 id="2-编辑自定义配置文件"><a href="#2-编辑自定义配置文件" class="headerlink" title="2. 编辑自定义配置文件"></a>2. 编辑自定义配置文件</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# vim /etc/my.cnf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">port&#x3D;3306</span><br><span class="line">basedir&#x3D;&#x2F;appdata&#x2F;mysql</span><br><span class="line">datadir&#x3D;&#x2F;appdata&#x2F;mysql&#x2F;data</span><br><span class="line">socket&#x3D;&#x2F;appdata&#x2F;mysql&#x2F;data&#x2F;mysql.sock</span><br><span class="line">log-bin&#x3D;mysql-bin</span><br><span class="line">server-id&#x3D;1</span><br><span class="line">binlog_format&#x3D;MIXED</span><br><span class="line">gtid_mode &#x3D; on</span><br><span class="line">enforce_gtid_consistency &#x3D; 1</span><br><span class="line">log_slave_updates &#x3D; 1</span><br><span class="line">max_allowed_packet &#x3D; 128M</span><br><span class="line">interactive_timeout &#x3D; 28800000</span><br><span class="line">wait_timeout &#x3D; 28800000</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">socket&#x3D;&#x2F;appdata&#x2F;mysql&#x2F;data&#x2F;mysql.sock</span><br></pre></td></tr></table></figure><h1 id="3-启动MySQL"><a href="#3-启动MySQL" class="headerlink" title="3. 启动MySQL"></a>3. 启动MySQL</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# cp /appdata/mysql/support-files/mysql.server /etc/init.d/</span><br><span class="line">[root@master ~]# vim /etc/init.d/mysql.server</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">basedir&#x3D;&#x2F;appdata&#x2F;mysql</span><br><span class="line">datadir&#x3D;&#x2F;appdata&#x2F;mysql&#x2F;data</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# /etc/init.d/mysql.server start</span><br></pre></td></tr></table></figure><h1 id="4-设置主从同步"><a href="#4-设置主从同步" class="headerlink" title="4. 设置主从同步"></a>4. 设置主从同步</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# mysql -uroot -pfYd00.&lt;Ucx:0</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; ALTER USER root@'localhost' IDENTIFIED BY 'Abc123';</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE USER replication@'%' IDENTIFIED WITH 'mysql_native_password' BY 'replication';</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant replication slave on *.* to replication@'%';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; ALTER TABLE mysql.slave_master_info ENGINE=InnoDB;</span><br><span class="line">Query OK, 0 rows affected (0.07 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; ALTER TABLE mysql.slave_relay_log_info ENGINE=InnoDB;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; reset slave;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; CHANGE MASTER TO MASTER_HOST="slave.example.com",MASTER_USER='replication',MASTER_PASSWORD="replication",MASTER_AUTO_POSITION=1;</span><br><span class="line">Query OK, 0 rows affected, 2 warnings (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show slave status\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: slave.example.com</span><br><span class="line">                  Master_User: replication</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000015</span><br><span class="line">          Read_Master_Log_Pos: 1567</span><br><span class="line">               Relay_Log_File: master-relay-bin.000003</span><br><span class="line">                Relay_Log_Pos: 456</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000015</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure><h1 id="5-问题处理"><a href="#5-问题处理" class="headerlink" title="5. 问题处理"></a>5. 问题处理</h1><blockquote><p>Error_code: MY-002061</p></blockquote><ul><li>不兼容的变化： 在caching_sha2_password和 sha256_password认证插件提供比更安全的密码加密 mysql_native_password插件，并 caching_sha2_password提供了比更好的性能sha256_password。由于这些优越的安全性和性能特性 caching_sha2_password，它现在是首选的身份验证插件，而且也是默认的身份验证插件而不是 mysql_native_password。此更改会影响服务器和libmysqlclient客户端库：<ul><li>对于服务器，default_authentication_plugin 系统变量的默认值 从更改 mysql_native_password为 caching_sha2_password。</li><li>该libmysqlclient库将其 caching_sha2_password视为默认的身份验证插件而不是 mysql_native_password。</li><li>此更改仅影响用于创建新MySQL帐户的身份验证插件。对于已升级安装中已存在的帐户，其身份验证插件保持不变。</li><li>使用经过身份验证的帐户的客户端 caching_sha2_password必须使用安全连接（使用TCP使用TLS / SSL凭据，Unix套接字文件或共享内存制作），或使用RSA密钥对支持密码交换的未加密连接。此安全要求不适用 mysql_native_passsword，因此交换机 caching_sha2_password可能需要其他配置（请参阅 缓存SHA-2可插入身份验证）。但是，默认情况下，MySQL 8.0中的客户端连接更喜欢使用TLS / SSL，因此已满足该首选项的客户端可能不需要其他配置。</li><li>因为caching_sha2_password现在也是libmysqlclient客户端库中的默认身份验证插件，所以 身份验证需要在客户端/服务器协议中进行额外的往返，以便从MySQL 8.0客户端连接到使用mysql_native_password（以前的默认身份验证插件）的帐户 ，除非调用客户端程序一个 –default-auth=mysql_native_password 选择。</li><li>不兼容：尚未更新的客户端和连接器 caching_sha2_password 无法连接到通过身份验证的帐户，caching_sha2_password 因为他们无法将此插件识别为有效。要解决此问题，请libmysqlclient从MySQL 8.0.4或更高版本重新链接客户端 ，或获取可识别的更新连接器 caching_sha2_password。</li><li>不兼容：尚未更新的客户端和连接器 caching_sha2_password可能无法连接到配置caching_sha2_password为默认身份验证插件的MySQL 8.0服务器 ，甚至使用未通过身份验证的帐户caching_sha2_password。出现此问题的原因是服务器为客户端指定其默认身份验证插件的名称。如果客户端或连接器基于未正常处理无法识别的默认身份验证插件的客户端/服务器协议实现，则可能会失败并显示错误。</li></ul></li></ul><blockquote><p>ERROR 1872 (HY000): Slave failed to initialize relay log info structure from the repository</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kubernetes 离线安装</title>
      <link href="2019/02/07/k8s/"/>
      <url>2019/02/07/k8s/</url>
      
        <content type="html"><![CDATA[<p>Kubernetes 离线安装</p><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/hosts</span><br><span class="line">192.168.61.11 node1</span><br><span class="line">192.168.61.12 node2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line"></span><br><span class="line">setenforce 0</span><br><span class="line">vim /etc/selinux/config</span><br><span class="line"></span><br><span class="line">SELINUX=disabled</span><br><span class="line"></span><br><span class="line">vim /etc/sysctl.d/k8s.conf</span><br><span class="line"></span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line"></span><br><span class="line">modprobe br_netfilter</span><br><span class="line">sysctl -p /etc/sysctl.d/k8s.conf</span><br></pre></td></tr></table></figure><h2 id="kube-proxy开启ipvs的前置条件"><a href="#kube-proxy开启ipvs的前置条件" class="headerlink" title="kube-proxy开启ipvs的前置条件"></a>kube-proxy开启ipvs的前置条件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- nf_conntrack_ipv4</span><br><span class="line">EOF</span><br><span class="line">chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看是否已经正确加载所需的内核模块</span></span><br><span class="line">lsmod | grep -e ip_vs -e nf_conntrack_ipv4</span><br></pre></td></tr></table></figure><h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"># Step 2: 添加软件源信息</span><br><span class="line">sudo yum-config-manager --add-repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line"># Step 3: 更新并安装 Docker-CE</span><br><span class="line">sudo yum makecache fast</span><br><span class="line"></span><br><span class="line">yum list docker-ce.x86_64  --showduplicates |sort -r</span><br><span class="line"></span><br><span class="line">yum makecache fast</span><br><span class="line"></span><br><span class="line">yum install -y --setopt&#x3D;obsoletes&#x3D;0 \</span><br><span class="line">  docker-ce-18.06.1.ce-3.el7</span><br><span class="line"></span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -nvL</span><br></pre></td></tr></table></figure><h2 id="安装kubeadm和kubelet"><a href="#安装kubeadm和kubelet" class="headerlink" title="安装kubeadm和kubelet"></a>安装kubeadm和kubelet</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">yum install -y kubelet kubeadm kubectl</span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet &amp;&amp; systemctl start kubelet</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubelet –help</span><br><span class="line"></span><br><span class="line">cat &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;kubelet.service.d&#x2F;10-kubeadm.conf</span><br><span class="line"></span><br><span class="line">vim &#x2F;etc&#x2F;sysconfig&#x2F;kubelet</span><br><span class="line"></span><br><span class="line">KUBELET_EXTRA_ARGS&#x3D;--fail-swap-on&#x3D;false</span><br></pre></td></tr></table></figure><h2 id="使用kubeadm-init初始化集群"><a href="#使用kubeadm-init初始化集群" class="headerlink" title="使用kubeadm init初始化集群"></a>使用kubeadm init初始化集群</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">images=(kube-apiserver:v1.13.3 kube-controller-manager:v1.13.3 kube-scheduler:v1.13.3 kube-proxy:v1.13.3 pause:3.1 etcd:3.2.24)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> imageName <span class="keyword">in</span> <span class="variable">$&#123;images[@]&#125;</span> ; <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">  docker pull mirrorgooglecontainers/<span class="variable">$imageName</span></span><br><span class="line">  docker tag mirrorgooglecontainers/<span class="variable">$imageName</span> k8s.gcr.io/<span class="variable">$imageName</span></span><br><span class="line">  docker rmi mirrorgooglecontainers/<span class="variable">$imageName</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> docker pull coredns/coredns:1.2.6</span><br><span class="line"> docker tag coredns/coredns:1.2.6  k8s.gcr.io/coredns:1.2.6</span><br><span class="line"> docker rmi coredns/coredns:1.2.6</span><br><span class="line"></span><br><span class="line">kubeadm init \</span><br><span class="line">  --kubernetes-version=v1.13.0 \</span><br><span class="line">  --pod-network-cidr=10.244.0.0/16 \</span><br><span class="line">  --apiserver-advertise-address=192.168.41.132 \</span><br><span class="line">  --ignore-preflight-errors=Swap</span><br><span class="line"><span class="comment"># running with swap on is not supported. Please disable swap</span></span><br><span class="line"><span class="comment"># 添加--ignore-preflight-errors=Swap参数忽略这个错误</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line">kubeadm join 192.168.41.132:6443 --token e4xr2p.xvfc3dr6a4dvz8se --discovery-token-ca-cert-hash sha256:7f99258581c9118551ec500b61bf3d732ed6e31799e5074fc5f75b784633410a</span><br><span class="line"></span><br><span class="line">kubectl get cs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 集群初始化如果遇到问题，可以使用下面的命令进行清理</span></span><br><span class="line">kubeadm reset</span><br></pre></td></tr></table></figure><h2 id="安装Pod-Network"><a href="#安装Pod-Network" class="headerlink" title="安装Pod Network"></a>安装Pod Network</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/k8s/</span><br><span class="line"><span class="built_in">cd</span> ~/k8s</span><br><span class="line">wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br><span class="line">kubectl apply -f  kube-flannel.yml</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
          <category> Kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL 组复制</title>
      <link href="2019/01/30/mgr/"/>
      <url>2019/01/30/mgr/</url>
      
        <content type="html"><![CDATA[<p>MySQL 组复制</p><a id="more"></a><h2 id="1-部署组复制实例"><a href="#1-部署组复制实例" class="headerlink" title="1. 部署组复制实例"></a>1. 部署组复制实例</h2><p>假定MySQL Server已下载并解压缩到名为的目录中mysql-8.0。以下过程使用一台物理计算机，因此每个MySQL服务器实例都需要该实例的特定数据目录。在名为的目录中创建数据目录data 并初始化每个目录。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir data</span><br><span class="line">mysql-8.0&#x2F;bin&#x2F;mysqld --initialize-insecure --basedir&#x3D;$PWD&#x2F;mysql-8.0 --datadir&#x3D;$PWD&#x2F;data&#x2F;s1</span><br><span class="line">mysql-8.0&#x2F;bin&#x2F;mysqld --initialize-insecure --basedir&#x3D;$PWD&#x2F;mysql-8.0 --datadir&#x3D;$PWD&#x2F;data&#x2F;s2</span><br><span class="line">mysql-8.0&#x2F;bin&#x2F;mysqld --initialize-insecure --basedir&#x3D;$PWD&#x2F;mysql-8.0 --datadir&#x3D;$PWD&#x2F;data&#x2F;s3</span><br></pre></td></tr></table></figure><p>里面data/s1，data/s2， data/s3是一个初始化的数据目录，包含了MySQL系统数据库和相关表等等</p><blockquote><p>–initialize-insecure在生产环境中使用，它仅用于简化教程。</p></blockquote><h2 id="2-配置组复制实例"><a href="#2-配置组复制实例" class="headerlink" title="2. 配置组复制实例"></a>2. 配置组复制实例</h2><h3 id="组Replication-Server设置"><a href="#组Replication-Server设置" class="headerlink" title="组Replication Server设置"></a>组Replication Server设置</h3><p>要安装和使用组复制插件，必须正确配置MySQL Server实例。建议将配置存储在实例的配置文件中。以下是组中第一个实例的配置，在此过程中称为s1。以下部分显示了示例服务器配置。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line"># server configuration</span><br><span class="line">datadir&#x3D;&lt;full_path_to_data&gt;&#x2F;data&#x2F;s1</span><br><span class="line">basedir&#x3D;&lt;full_path_to_bin&gt;&#x2F;mysql-8.0&#x2F;</span><br><span class="line"></span><br><span class="line">port&#x3D;24801</span><br><span class="line">socket&#x3D;&lt;full_path_to_sock_dir&gt;&#x2F;s1.sock</span><br></pre></td></tr></table></figure><p>这些设置将MySQL服务器配置为使用先前创建的数据目录以及服务器应打开的端口并开始侦听传入连接。</p><blockquote><p>使用非默认端口24801是因为在本教程中，三个服务器实例使用相同的主机名。在具有三台不同机器的设置中，这不是必需的。</p></blockquote><p>组复制需要成员之间的网络连接，这意味着每个成员必须能够解析所有其他成员的网络地址。例如，在本教程中，所有三个实例都在一台机器上运行，因此为了确保成员可以相互联系，您可以在选项文件中添加一行，例如 report_host=127.0.0.1。</p><h3 id="复制框架"><a href="#复制框架" class="headerlink" title="复制框架"></a>复制框架</h3><p>以下设置根据MySQL组复制要求配置复制。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server_id&#x3D;1</span><br><span class="line">gtid_mode&#x3D;ON</span><br><span class="line">enforce_gtid_consistency&#x3D;ON</span><br><span class="line">binlog_checksum&#x3D;NONE</span><br></pre></td></tr></table></figure><p>这些设置将服务器配置为使用唯一标识符编号1，以启用全局事务标识符，以允许仅执行可使用GTID安全记录的语句，以及禁用写入写入二进制日志的事件的校验和。</p><blockquote><p>如果您使用的是早于8.0.3的MySQL版本，其中默认值已针对复制进行了改进，则需要将这些行添加到成员的选项文件中。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">log_bin&#x3D;binlog</span><br><span class="line">log_slave_updates&#x3D;ON</span><br><span class="line">binlog_format&#x3D;ROW</span><br><span class="line">master_info_repository&#x3D;TABLE</span><br><span class="line">relay_log_info_repository&#x3D;TABLE</span><br></pre></td></tr></table></figure><p>这些设置指示服务器打开二进制日志记录，使用基于行的格式，将复制元数据存储在系统表而不是文件中，并禁用二进制日志事件校验和。有关更多详细信息，请参见 第18.8.1节“组复制要求”。</p><h3 id="组复制设置"><a href="#组复制设置" class="headerlink" title="组复制设置"></a>组复制设置</h3><p>此时，该my.cnf文件确保配置服务器并指示在给定配置下实例化复制基础结构。以下部分配置服务器的“组复制”设置。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">transaction_write_set_extraction&#x3D;XXHASH64</span><br><span class="line">group_replication_group_name&#x3D;&quot;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa&quot;</span><br><span class="line">group_replication_start_on_boot&#x3D;off</span><br><span class="line">group_replication_local_address&#x3D; &quot;127.0.0.1:24901&quot;</span><br><span class="line">group_replication_group_seeds&#x3D; &quot;127.0.0.1:24901,127.0.0.1:24902,127.0.0.1:24903&quot;</span><br><span class="line">group_replication_bootstrap_group&#x3D;off</span><br></pre></td></tr></table></figure><ul><li>配置 transaction_write_set_extraction 指示服务器对于每个事务，它必须收集写集并使用XXHASH64散列算法将其编码为散列。从MySQL 8.0.2开始，此设置是默认设置，因此可以省略此行。</li><li>配置 group_replication_group_name 告诉插件它正在加入或创建的组被命名为”aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa”，group_replication_group_name的值 必须是有效的UUID。在二进制日志中为组复制事件设置GTID时，将在内部使用此UUID。使用SELECT UUID()生成一个UUID。</li><li>配置 group_replication_start_on_boot 指示插件在服务器启动时不自动启动操作。这在设置组复制时很重要，因为它确保您可以在手动启动插件之前配置服务器。配置成员后，您可以设置 group_replication_start_on_boot 为on，以便在服务器引导时自动启动Group Replication。</li><li>配置 group_replication_local_address 告诉插件使用网络地址127.0.0.1和端口24901与组中的其他成员进行内部通信。</li></ul><blockquote><p>组复制将此地址用于涉及组通信引擎（XCom，Paxos变体）的远程实例的内部成员到成员连接。此地址必须与用于SQL的主机名和端口不同，并且不得用于客户端应用程序。在运行组复制时，必须为组成员之间的内部通信保留它。</p></blockquote><p>配置的网络地址 group_replication_local_address 必须可由所有组成员解析。例如，如果每个服务器实例位于具有固定网络地址的其他计算机上，则可以使用计算机的IP地址，例如10.0.0.1。如果使用主机名，则必须使用完全限定名称，并确保它可以通过DNS解析，并且配置正确 /etc/hosts文件或其他名称解析过程。从MySQL 8.0.14开始，可以使用IPv6地址（或解析它们的主机名）以及IPv4地址。组可以包含使用IPv6的成员和使用IPv4的成员的混合。</p><p>建议的端口 group_replication_local_address 是33061。在本教程中，我们使用在一台计算机上运行的三个服务器实例，因此端口24901到24903用于内部通信网络地址。 group_replication_local_address Group Replication使用它作为复制组中组成员的唯一标识符。只要主机名或IP地址都不同，您就可以为复制组的所有成员使用相同的端口，并且如本教程所示，只要具有相同的主机名或IP地址，就可以使用相同的主机名或IP地址。港口都不一样。</p><ul><li>配置 group_replication_group_seeds 设置组成员的主机名和端口，新成员使用它们建立与组的连接。这些成员称为种子成员。建立连接后，将列出组成员身份信息 performance_schema.replication_group_members。通常， group_replication_group_seeds 列表包含hostname:port每个组成员的列表 group_replication_local_address，但这不是强制性的，可以选择组成员的子集作为种子。</li></ul><blockquote><p>该hostname:port列在 group_replication_group_seeds 是种子构件的内部网络地址，由被配置 group_replication_local_address ，而不是SQL hostname:port用于客户端连接，并且例如在显示 performance_schema.replication_group_members 表中。</p></blockquote><p>启动该组的服务器不使用此选项，因为它是初始服务器，因此，它负责引导组。换句话说，引导该组的服务器上的任何现有数据都是用作下一个加入成员的数据。第二个服务器连接要求组中唯一的成员加入，第二个服务器上的任何缺失数据都从引导成员上的施主数据中复制，然后组扩展。加入的第三个服务器可以要求这两个服务器中的任何一个加入，数据被同步到新成员，然后该组再次扩展。</p><blockquote><p>在同时加入多个服务器时，请确保它们指向已在该组中的种子成员。不要使用也加入该组的成员作为种子，因为他们在联系时可能尚未加入该组。</p></blockquote><p>最好首先启动引导程序成员，然后让它创建组。然后使其成为正在加入的其余成员的种子成员。这确保了在连接其余成员时形成的组。</p><p>不支持创建组并同时加入多个成员。它可能有效，但可能是操作竞争，然后加入该组的行为最终会出错或超时。</p><p>加入成员必须使用种子成员在group_replication_group_seeds 选项中通告的相同协议（IPv4或IPv6）与种子成员通信 。出于组复制的IP地址白名单的目的，种子成员上的白名单必须包含种子成员提供的协议的加入成员的IP地址，或者解析为该协议的地址的主机名。除了加入成员之外，还必须设置此地址或主机名并列入白名单 group_replication_local_address 如果该地址的协议与种子成员的通告协议不匹配。如果加入成员没有适当协议的白名单地址，则拒绝其连接尝试。有关更多信息，请参见 第18.5.1节“IP地址白名单”。</p><ul><li>配置 group_replication_bootstrap_group 指示插件是否引导组。</li></ul><blockquote><p>此选项只能在任何时候在一个服务器实例上使用，通常是第一次引导组时（或者在整个组关闭并重新备份的情况下）。如果多次引导组，例如当多个服务器实例设置了此选项时，则可以创建一个人工分裂脑情景，其中存在两个具有相同名称的不同组。在第一个服务器实例联机后禁用此选项。组中所有服务器的配置非常相似。您需要更改有关每个服务器的细节（例如server_id， datadir， group_replication_local_address）。本教程稍后将对此进行说明。</p></blockquote><h2 id="3-用户凭证"><a href="#3-用户凭证" class="headerlink" title="3. 用户凭证"></a>3. 用户凭证</h2><p>组复制使用异步复制协议来实现 分布式恢复过程依赖于名为的复制通道group_replication_recovery，该通道用于将来自供体成员的事务转移到加入该组的成员。因此，您需要设置具有正确权限的复制用户，以便组复制可以建立直接的成员到成员恢复复制通道。</p><p>使用选项文件启动服务器：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql-8.0&#x2F;bin&#x2F;mysqld --defaults-file&#x3D;data&#x2F;s1&#x2F;s1.cnf</span><br></pre></td></tr></table></figure><p>使用该REPLICATION-SLAVE权限创建MySQL用户 。可以在二进制日志中捕获此过程，然后您可以依靠分布式恢复来复制用于创建用户的语句。或者，您可以禁用二进制日志记录，然后在每个成员上手动创建用户，例如，如果要避免将更改传播到其他服务器实例。要禁用二进制日志记录，请连接到服务器s1并发出以下语句：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET SQL_LOG_BIN&#x3D;0;</span><br></pre></td></tr></table></figure><p>在以下示例中rpl_user，将password显示具有密码 的用户 。配置服务器时，请使用合适的用户名和密码。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE USER rpl_user@&#39;%&#39; IDENTIFIED BY &#39;password&#39;;</span><br><span class="line">mysql&gt; GRANT REPLICATION SLAVE ON *.* TO rpl_user@&#39;%&#39;;</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure><p>如果禁用了二进制日志记录，则在创建用户后再次启用它。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET SQL_LOG_BIN&#x3D;1;</span><br></pre></td></tr></table></figure><p>配置用户后，使用该 CHANGE MASTER TO语句将服务器配置为group_replication_recovery在下次需要从另一个成员恢复其状态时使用复制通道的给定凭据 。发出以下，替换 rpl_user和 password与创建用户时使用的值。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CHANGE MASTER TO MASTER_USER&#x3D;&#39;rpl_user&#39;, MASTER_PASSWORD&#x3D;&#39;password&#39; \\</span><br><span class="line">      FOR CHANNEL &#39;group_replication_recovery&#39;;</span><br></pre></td></tr></table></figure><p>分布式恢复是加入组的服务器采取的第一步，并且没有与组成员相同的事务集。如果没有为group_replication_recovery 复制通道正确设置这些凭据，并且rpl_user如图所示，则服务器无法连接到供体成员并运行分布式恢复过程以与其他组成员同步，因此最终无法加入该组。</p><p>同样，如果服务器无法通过服务器正确识别其他成员，hostname则恢复过程可能会失败。建议运行MySQL的操作系统具有正确配置的唯一 hostname，使用DNS或本地设置。这hostname可以Member_host在performance_schema.replication_group_members 表格的列中 进行验证 。如果多个组成员外部化hostname操作系统的默认 设置，则成员可能无法解析为正确的成员地址而无法加入该组。在这种情况下，使用report_host配置hostname由每个服务器外部化的唯一。</p><h3 id="使用组复制和缓存SHA-2用户凭据插件"><a href="#使用组复制和缓存SHA-2用户凭据插件" class="headerlink" title="使用组复制和缓存SHA-2用户凭据插件"></a>使用组复制和缓存SHA-2用户凭据插件</h3><p>默认情况下，在MySQL 8中创建的用户使用 缓存SHA-2可插入身份验证。如果rpl_user您配置分布式恢复使用缓存SHA-2认证插件并没有使用安全套接字层支持（SSL） 的group_replication_recovery 复制通道，RSA密钥用于密码交换，创建SSL和RSA证书和密钥，您可以将rpl_user应该从组中恢复其状态的成员的公钥复制 到该组，也可以将捐赠者配置为在请求时提供公钥。</p><p>更安全的方法是将公钥复制 rpl_user到应该从捐赠者恢复组状态的成员。然后，您需要group_replication_recovery_public_key_path 在加入组的成员上配置 系统变量，并为其提供公钥的路径rpl_user。</p><p>可选地，不太安全的方法是设置 group_replication_recovery_get_public_key=ON 捐赠者，以便他们rpl_user在加入组时提供成员的公钥 。无法验证服务器的身份，因此只有group_replication_recovery_get_public_key=ON 在您确定没有服务器身份被泄露的风险时才会设置 ，例如通过中间人攻击。</p><h2 id="4-启动组复制"><a href="#4-启动组复制" class="headerlink" title="4. 启动组复制"></a>4. 启动组复制</h2><p>配置并启动服务器s1后，安装组复制插件。连接到服务器并发出以下命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSTALL PLUGIN group_replication SONAME &#39;group_replication.so&#39;;</span><br></pre></td></tr></table></figure><blockquote><p>mysql.session在加载组复制之前，用户必须存在。 MySQL 8.0.2版中添加了mysql.session。如果使用早期版本初始化数据字典，则必须运行 mysql_upgrade过程。如果未运行升级，则组复制无法以错误消息启动尝试使用用户访问服务器时出现错误：mysql.session@localhost。确保用户在服务器中，并且在服务器更新后运行了mysql_upgrade。</p></blockquote><p>要检查插件是否已成功安装，请发出 SHOW PLUGINS;并检查输出。它应该显示如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW PLUGINS;</span><br><span class="line">+----------------------------+----------+--------------------+----------------------+-------------+</span><br><span class="line">| Name                       | Status   | Type               | Library              | License     |</span><br><span class="line">+----------------------------+----------+--------------------+----------------------+-------------+</span><br><span class="line">| binlog                     | ACTIVE   | STORAGE ENGINE     | NULL                 | PROPRIETARY |</span><br><span class="line"></span><br><span class="line">(...)</span><br><span class="line"></span><br><span class="line">| group_replication          | ACTIVE   | GROUP REPLICATION  | group_replication.so | PROPRIETARY |</span><br><span class="line">+----------------------------+----------+--------------------+----------------------+-------------+</span><br></pre></td></tr></table></figure><p>要启动该组，请指示服务器s1引导该组，然后启动组复制。此引导程序应仅由单个服务器完成，该服务器启动组并且只执行一次。这就是为什么bootstrap配置选项的值未保存在配置文件中的原因。如果它保存在配置文件中，则在重新启动时，服务器会自动引导具有相同名称的第二个组。这将导致两个具有相同名称的不同组。同样的推理适用于在此选项设置为的情况下停止并重新启动插件ON。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET GLOBAL group_replication_bootstrap_group&#x3D;ON;</span><br><span class="line">START GROUP_REPLICATION;</span><br><span class="line">SET GLOBAL group_replication_bootstrap_group&#x3D;OFF;</span><br></pre></td></tr></table></figure><p>一旦START GROUP_REPLICATION 语句返回，该集团已启动。您可以检查该组现在是否已创建，并且其中包含一个成员：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM performance_schema.replication_group_members;</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+---------------+</span><br><span class="line">| CHANNEL_NAME              | MEMBER_ID                            | MEMBER_HOST | MEMBER_PORT | MEMBER_STATE  |</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+---------------+</span><br><span class="line">| group_replication_applier | ce9be252-2b71-11e6-b8f4-00212844f856 | myhost      |       24801 | ONLINE        |</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+---------------+</span><br></pre></td></tr></table></figure><p>此表中的信息确认组中有成员具有唯一标识符 ce9be252-2b71-11e6-b8f4-00212844f856，它正在ONLINE并且正在myhost 侦听端口上的客户端连接 24801。</p><p>为了证明服务器确实在一个组中并且它能够处理负载，创建一个表并向其添加一些内容。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE DATABASE test;</span><br><span class="line">mysql&gt; USE test;</span><br><span class="line">mysql&gt; CREATE TABLE t1 (c1 INT PRIMARY KEY, c2 TEXT NOT NULL);</span><br><span class="line">mysql&gt; INSERT INTO t1 VALUES (1, &#39;Luis&#39;);</span><br></pre></td></tr></table></figure><p>检查表的内容t1和二进制日志。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM t1;</span><br><span class="line">+----+------+</span><br><span class="line">| c1 | c2   |</span><br><span class="line">+----+------+</span><br><span class="line">|  1 | Luis |</span><br><span class="line">+----+------+</span><br><span class="line"></span><br><span class="line">mysql&gt; SHOW BINLOG EVENTS;</span><br><span class="line">+---------------+-----+----------------+-----------+-------------+--------------------------------------------------------------------+</span><br><span class="line">| Log_name      | Pos | Event_type     | Server_id | End_log_pos | Info                                                               |</span><br><span class="line">+---------------+-----+----------------+-----------+-------------+--------------------------------------------------------------------+</span><br><span class="line">| binlog.000001 |   4 | Format_desc    |         1 |         123 | Server ver: 8.0.2-gr080-log, Binlog ver: 4                        |</span><br><span class="line">| binlog.000001 | 123 | Previous_gtids |         1 |         150 |                                                                    |</span><br><span class="line">| binlog.000001 | 150 | Gtid           |         1 |         211 | SET @@SESSION.GTID_NEXT&#x3D; &#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:1&#39;  |</span><br><span class="line">| binlog.000001 | 211 | Query          |         1 |         270 | BEGIN                                                              |</span><br><span class="line">| binlog.000001 | 270 | View_change    |         1 |         369 | view_id&#x3D;14724817264259180:1                                        |</span><br><span class="line">| binlog.000001 | 369 | Query          |         1 |         434 | COMMIT                                                             |</span><br><span class="line">| binlog.000001 | 434 | Gtid           |         1 |         495 | SET @@SESSION.GTID_NEXT&#x3D; &#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:2&#39;  |</span><br><span class="line">| binlog.000001 | 495 | Query          |         1 |         585 | CREATE DATABASE test                                               |</span><br><span class="line">| binlog.000001 | 585 | Gtid           |         1 |         646 | SET @@SESSION.GTID_NEXT&#x3D; &#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:3&#39;  |</span><br><span class="line">| binlog.000001 | 646 | Query          |         1 |         770 | use &#96;test&#96;; CREATE TABLE t1 (c1 INT PRIMARY KEY, c2 TEXT NOT NULL) |</span><br><span class="line">| binlog.000001 | 770 | Gtid           |         1 |         831 | SET @@SESSION.GTID_NEXT&#x3D; &#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:4&#39;  |</span><br><span class="line">| binlog.000001 | 831 | Query          |         1 |         899 | BEGIN                                                              |</span><br><span class="line">| binlog.000001 | 899 | Table_map      |         1 |         942 | table_id: 108 (test.t1)                                            |</span><br><span class="line">| binlog.000001 | 942 | Write_rows     |         1 |         984 | table_id: 108 flags: STMT_END_F                                    |</span><br><span class="line">| binlog.000001 | 984 | Xid            |         1 |        1011 | COMMIT &#x2F;* xid&#x3D;38 *&#x2F;                                                |</span><br><span class="line">+---------------+-----+----------------+-----------+-------------+--------------------------------------------------------------------+</span><br></pre></td></tr></table></figure><p>如上所示，创建了数据库和表对象，并将相应的DDL语句写入二进制日志。此外，数据已插入表中并写入二进制日志。当组成长并且新成员尝试赶上并联机时执行分布式恢复时，下一节将说明二进制日志条目的重要性。</p><h2 id="5-向组添加实例"><a href="#5-向组添加实例" class="headerlink" title="5. 向组添加实例"></a>5. 向组添加实例</h2><p>此时，该组中有一个成员服务器s1，其中包含一些数据。现在是时候通过添加先前配置的其他两个服务器来扩展组。</p><h3 id="添加第二个实例"><a href="#添加第二个实例" class="headerlink" title="添加第二个实例"></a>添加第二个实例</h3><p>为了添加第二个实例，服务器s2，首先为它创建配置文件。配置类似于用于服务器s1的配置，除了诸如数据目录的位置，s2将要监听的端口或其之外的配置 server_id。这些不同的行在下面的列表中突出显示。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line"># server configuration</span><br><span class="line">datadir&#x3D;&lt;full_path_to_data&gt;&#x2F;data&#x2F;s2</span><br><span class="line">basedir&#x3D;&lt;full_path_to_bin&gt;&#x2F;mysql-8.0&#x2F;</span><br><span class="line"></span><br><span class="line">port&#x3D;24802</span><br><span class="line">socket&#x3D;&lt;full_path_to_sock_dir&gt;&#x2F;s2.sock</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Replication configuration parameters</span><br><span class="line">#</span><br><span class="line">server_id&#x3D;2</span><br><span class="line">gtid_mode&#x3D;ON</span><br><span class="line">enforce_gtid_consistency&#x3D;ON</span><br><span class="line">binlog_checksum&#x3D;NONE</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Group Replication configuration</span><br><span class="line">#</span><br><span class="line">transaction_write_set_extraction&#x3D;XXHASH64</span><br><span class="line">group_replication_group_name&#x3D;&quot;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa&quot;</span><br><span class="line">group_replication_start_on_boot&#x3D;off</span><br><span class="line">group_replication_local_address&#x3D; &quot;127.0.0.1:24902&quot;</span><br><span class="line">group_replication_group_seeds&#x3D; &quot;127.0.0.1:24901,127.0.0.1:24902,127.0.0.1:24903&quot;</span><br><span class="line">group_replication_bootstrap_group&#x3D; off</span><br></pre></td></tr></table></figure><p>与服务器s1的过程类似，使用选项文件启动服务器。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql-8.0&#x2F;bin&#x2F;mysqld --defaults-file&#x3D;data&#x2F;s2&#x2F;s2.cnf</span><br></pre></td></tr></table></figure><p>然后按如下方式配置恢复凭据。这些命令与设置服务器s1时使用的命令相同，因为用户在组内共享。在s2上发布以下语句。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SET SQL_LOG_BIN&#x3D;0;</span><br><span class="line">CREATE USER rpl_user@&#39;%&#39; IDENTIFIED BY &#39;password&#39;;</span><br><span class="line">GRANT REPLICATION SLAVE ON *.* TO rpl_user@&#39;%&#39;;</span><br><span class="line">SET SQL_LOG_BIN&#x3D;1;</span><br><span class="line">CHANGE MASTER TO MASTER_USER&#x3D;&#39;rpl_user&#39;, MASTER_PASSWORD&#x3D;&#39;password&#39; \\</span><br><span class="line">FOR CHANNEL &#39;group_replication_recovery&#39;;</span><br></pre></td></tr></table></figure><blockquote><p>如果您使用的是缓存SHA-2身份验证插件（MySQL 8中的默认设置），请参阅 使用组复制和缓存SHA-2用户凭据插件。</p></blockquote><p>安装组复制插件并开始将服务器加入组的过程。以下示例以与部署服务器s1时相同的方式安装插件。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSTALL PLUGIN group_replication SONAME &#39;group_replication.so&#39;;</span><br></pre></td></tr></table></figure><p>将服务器s2添加到组中。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; START GROUP_REPLICATION;</span><br></pre></td></tr></table></figure><p>与之前的步骤（与s1上执行的步骤相同）不同，此处的区别在于， 在启动组复制之前不会发出SET GLOBAL group_replication_bootstrap_group=ON;，因为该组已由服务器s1创建并引导。此时，只需将服务器s2添加到现有组中。</p><blockquote><p>当组复制成功启动并且服务器加入组时，它会检查 super_read_only变量。通过super_read_only 在成员的配置文件中设置为ON，可以确保因任何原因启动组复制时出现故障的服务器不接受事务。如果服务器应将该组作为读写实例加入，例如作为单主组中的主要组或多主组的成员，则当该 super_read_only变量设置为ON时，则在加入时将其设置为OFF群组。</p></blockquote><p>performance_schema.replication_group_members 再次 检查 表显示该组中现在有两个 ONLINE服务器。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM performance_schema.replication_group_members;</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+---------------+</span><br><span class="line">| CHANNEL_NAME              | MEMBER_ID                            | MEMBER_HOST | MEMBER_PORT | MEMBER_STATE  |</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+---------------+</span><br><span class="line">| group_replication_applier | 395409e1-6dfa-11e6-970b-00212844f856 | myhost      |       24801 | ONLINE        |</span><br><span class="line">| group_replication_applier | ac39f1e6-6dfa-11e6-a69d-00212844f856 | myhost      |       24802 | ONLINE        |</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+---------------+</span><br></pre></td></tr></table></figure><p>由于服务器s2也标记为ONLINE，它必须已经自动赶上服务器s1。验证它确实已与服务器s1同步，如下所示。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW DATABASES LIKE &#39;test&#39;;</span><br><span class="line">+-----------------+</span><br><span class="line">| Database (test) |</span><br><span class="line">+-----------------+</span><br><span class="line">| test            |</span><br><span class="line">+-----------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM test.t1;</span><br><span class="line">+----+------+</span><br><span class="line">| c1 | c2   |</span><br><span class="line">+----+------+</span><br><span class="line">|  1 | Luis |</span><br><span class="line">+----+------+</span><br><span class="line"></span><br><span class="line">mysql&gt; SHOW BINLOG EVENTS;</span><br><span class="line">+---------------+------+----------------+-----------+-------------+--------------------------------------------------------------------+</span><br><span class="line">| Log_name      | Pos  | Event_type     | Server_id | End_log_pos | Info                                                               |</span><br><span class="line">+---------------+------+----------------+-----------+-------------+--------------------------------------------------------------------+</span><br><span class="line">| binlog.000001 |    4 | Format_desc    |         2 |         123 | Server ver: 8.0.3-log, Binlog ver: 4                              |</span><br><span class="line">| binlog.000001 |  123 | Previous_gtids |         2 |         150 |                                                                    |</span><br><span class="line">| binlog.000001 |  150 | Gtid           |         1 |         211 | SET @@SESSION.GTID_NEXT&#x3D; &#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:1&#39;  |</span><br><span class="line">| binlog.000001 |  211 | Query          |         1 |         270 | BEGIN                                                              |</span><br><span class="line">| binlog.000001 |  270 | View_change    |         1 |         369 | view_id&#x3D;14724832985483517:1                                        |</span><br><span class="line">| binlog.000001 |  369 | Query          |         1 |         434 | COMMIT                                                             |</span><br><span class="line">| binlog.000001 |  434 | Gtid           |         1 |         495 | SET @@SESSION.GTID_NEXT&#x3D; &#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:2&#39;  |</span><br><span class="line">| binlog.000001 |  495 | Query          |         1 |         585 | CREATE DATABASE test                                               |</span><br><span class="line">| binlog.000001 |  585 | Gtid           |         1 |         646 | SET @@SESSION.GTID_NEXT&#x3D; &#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:3&#39;  |</span><br><span class="line">| binlog.000001 |  646 | Query          |         1 |         770 | use &#96;test&#96;; CREATE TABLE t1 (c1 INT PRIMARY KEY, c2 TEXT NOT NULL) |</span><br><span class="line">| binlog.000001 |  770 | Gtid           |         1 |         831 | SET @@SESSION.GTID_NEXT&#x3D; &#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:4&#39;  |</span><br><span class="line">| binlog.000001 |  831 | Query          |         1 |         890 | BEGIN                                                              |</span><br><span class="line">| binlog.000001 |  890 | Table_map      |         1 |         933 | table_id: 108 (test.t1)                                            |</span><br><span class="line">| binlog.000001 |  933 | Write_rows     |         1 |         975 | table_id: 108 flags: STMT_END_F                                    |</span><br><span class="line">| binlog.000001 |  975 | Xid            |         1 |        1002 | COMMIT &#x2F;* xid&#x3D;30 *&#x2F;                                                |</span><br><span class="line">| binlog.000001 | 1002 | Gtid           |         1 |        1063 | SET @@SESSION.GTID_NEXT&#x3D; &#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:5&#39;  |</span><br><span class="line">| binlog.000001 | 1063 | Query          |         1 |        1122 | BEGIN                                                              |</span><br><span class="line">| binlog.000001 | 1122 | View_change    |         1 |        1261 | view_id&#x3D;14724832985483517:2                                        |</span><br><span class="line">| binlog.000001 | 1261 | Query          |         1 |        1326 | COMMIT                                                             |</span><br><span class="line">+---------------+------+----------------+-----------+-------------+--------------------------------------------------------------------+</span><br></pre></td></tr></table></figure><p>如上所示，第二台服务器已添加到组中，并自动从服务器s1复制了更改。根据分布式恢复过程，这意味着在加入组之后并且在被声明在线之前，服务器s2已经自动连接到服务器s1并从中获取丢失的数据。换句话说，它将事务从缺少的s1的二进制日志复制到它加入组的时间点。</p><h3 id="添加其他实例"><a href="#添加其他实例" class="headerlink" title="添加其他实例"></a>添加其他实例</h3><p>向组添加其他实例与添加第二个服务器的步骤顺序基本相同，只是必须更改配置，因为必须更改服务器s2。总结所需的命令：</p><ol><li>创建配置文件</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line"># server configuration</span><br><span class="line">datadir&#x3D;&lt;full_path_to_data&gt;&#x2F;data&#x2F;s3</span><br><span class="line">basedir&#x3D;&lt;full_path_to_bin&gt;&#x2F;mysql-8.0&#x2F;</span><br><span class="line"></span><br><span class="line">port&#x3D;24803</span><br><span class="line">socket&#x3D;&lt;full_path_to_sock_dir&gt;&#x2F;s3.sock</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Replication configuration parameters</span><br><span class="line">#</span><br><span class="line">server_id&#x3D;3</span><br><span class="line">gtid_mode&#x3D;ON</span><br><span class="line">enforce_gtid_consistency&#x3D;ON</span><br><span class="line">binlog_checksum&#x3D;NONE</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Group Replication configuration</span><br><span class="line">#</span><br><span class="line">group_replication_group_name&#x3D;&quot;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa&quot;</span><br><span class="line">group_replication_start_on_boot&#x3D;off</span><br><span class="line">group_replication_local_address&#x3D; &quot;127.0.0.1:24903&quot;</span><br><span class="line">group_replication_group_seeds&#x3D; &quot;127.0.0.1:24901,127.0.0.1:24902,127.0.0.1:24903&quot;</span><br><span class="line">group_replication_bootstrap_group&#x3D; off</span><br></pre></td></tr></table></figure><ol start="2"><li>启动服务器</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql-8.0&#x2F;bin&#x2F;mysqld --defaults-file&#x3D;data&#x2F;s3&#x2F;s3.cnf</span><br></pre></td></tr></table></figure><ol start="3"><li>配置group_replication_recovery通道的恢复凭据。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SET SQL_LOG_BIN&#x3D;0;</span><br><span class="line">CREATE USER rpl_user@&#39;%&#39; IDENTIFIED BY &#39;password&#39;;</span><br><span class="line">GRANT REPLICATION SLAVE ON *.* TO rpl_user@&#39;%&#39;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line">SET SQL_LOG_BIN&#x3D;1;</span><br><span class="line">CHANGE MASTER TO MASTER_USER&#x3D;&#39;rpl_user&#39;, MASTER_PASSWORD&#x3D;&#39;password&#39;  \\</span><br><span class="line">FOR CHANNEL &#39;group_replication_recovery&#39;;</span><br></pre></td></tr></table></figure><ol start="4"><li>安装Group Replication插件并启动它。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSTALL PLUGIN group_replication SONAME &#39;group_replication.so&#39;;</span><br><span class="line">START GROUP_REPLICATION;</span><br></pre></td></tr></table></figure><p>此时，服务器s3已启动并正在运行，已加入该组并赶上该组中的其他服务器。performance_schema.replication_group_members 再次咨询 表证实了这种情况。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM performance_schema.replication_group_members;</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+---------------+</span><br><span class="line">| CHANNEL_NAME              | MEMBER_ID                            | MEMBER_HOST | MEMBER_PORT | MEMBER_STATE  |</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+---------------+</span><br><span class="line">| group_replication_applier | 395409e1-6dfa-11e6-970b-00212844f856 | myhost      |       24801 | ONLINE        |</span><br><span class="line">| group_replication_applier | 7eb217ff-6df3-11e6-966c-00212844f856 | myhost      |       24803 | ONLINE        |</span><br><span class="line">| group_replication_applier | ac39f1e6-6dfa-11e6-a69d-00212844f856 | myhost      |       24802 | ONLINE        |</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+---------------+</span><br></pre></td></tr></table></figure><p>在服务器s2或服务器s1上发出相同的查询会产生相同的结果。此外，您可以验证服务器s3是否也赶上了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW DATABASES LIKE &#39;test&#39;;</span><br><span class="line">+-----------------+</span><br><span class="line">| Database (test) |</span><br><span class="line">+-----------------+</span><br><span class="line">| test            |</span><br><span class="line">+-----------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM test.t1;</span><br><span class="line">+----+------+</span><br><span class="line">| c1 | c2   |</span><br><span class="line">+----+------+</span><br><span class="line">|  1 | Luis |</span><br><span class="line">+----+------+</span><br><span class="line"></span><br><span class="line">mysql&gt; SHOW BINLOG EVENTS;</span><br><span class="line">+---------------+------+----------------+-----------+-------------+--------------------------------------------------------------------+</span><br><span class="line">| Log_name      | Pos  | Event_type     | Server_id | End_log_pos | Info                                                               |</span><br><span class="line">+---------------+------+----------------+-----------+-------------+--------------------------------------------------------------------+</span><br><span class="line">| binlog.000001 |    4 | Format_desc    |         3 |         123 | Server ver: 8.0.3-log, Binlog ver: 4                              |</span><br><span class="line">| binlog.000001 |  123 | Previous_gtids |         3 |         150 |                                                                    |</span><br><span class="line">| binlog.000001 |  150 | Gtid           |         1 |         211 | SET @@SESSION.GTID_NEXT&#x3D; &#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:1&#39;  |</span><br><span class="line">| binlog.000001 |  211 | Query          |         1 |         270 | BEGIN                                                              |</span><br><span class="line">| binlog.000001 |  270 | View_change    |         1 |         369 | view_id&#x3D;14724832985483517:1                                        |</span><br><span class="line">| binlog.000001 |  369 | Query          |         1 |         434 | COMMIT                                                             |</span><br><span class="line">| binlog.000001 |  434 | Gtid           |         1 |         495 | SET @@SESSION.GTID_NEXT&#x3D; &#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:2&#39;  |</span><br><span class="line">| binlog.000001 |  495 | Query          |         1 |         585 | CREATE DATABASE test                                               |</span><br><span class="line">| binlog.000001 |  585 | Gtid           |         1 |         646 | SET @@SESSION.GTID_NEXT&#x3D; &#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:3&#39;  |</span><br><span class="line">| binlog.000001 |  646 | Query          |         1 |         770 | use &#96;test&#96;; CREATE TABLE t1 (c1 INT PRIMARY KEY, c2 TEXT NOT NULL) |</span><br><span class="line">| binlog.000001 |  770 | Gtid           |         1 |         831 | SET @@SESSION.GTID_NEXT&#x3D; &#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:4&#39;  |</span><br><span class="line">| binlog.000001 |  831 | Query          |         1 |         890 | BEGIN                                                              |</span><br><span class="line">| binlog.000001 |  890 | Table_map      |         1 |         933 | table_id: 108 (test.t1)                                            |</span><br><span class="line">| binlog.000001 |  933 | Write_rows     |         1 |         975 | table_id: 108 flags: STMT_END_F                                    |</span><br><span class="line">| binlog.000001 |  975 | Xid            |         1 |        1002 | COMMIT &#x2F;* xid&#x3D;29 *&#x2F;                                                |</span><br><span class="line">| binlog.000001 | 1002 | Gtid           |         1 |        1063 | SET @@SESSION.GTID_NEXT&#x3D; &#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:5&#39;  |</span><br><span class="line">| binlog.000001 | 1063 | Query          |         1 |        1122 | BEGIN                                                              |</span><br><span class="line">| binlog.000001 | 1122 | View_change    |         1 |        1261 | view_id&#x3D;14724832985483517:2                                        |</span><br><span class="line">| binlog.000001 | 1261 | Query          |         1 |        1326 | COMMIT                                                             |</span><br><span class="line">| binlog.000001 | 1326 | Gtid           |         1 |        1387 | SET @@SESSION.GTID_NEXT&#x3D; &#39;aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa:6&#39;  |</span><br><span class="line">| binlog.000001 | 1387 | Query          |         1 |        1446 | BEGIN                                                              |</span><br><span class="line">| binlog.000001 | 1446 | View_change    |         1 |        1585 | view_id&#x3D;14724832985483517:3                                        |</span><br><span class="line">| binlog.000001 | 1585 | Query          |         1 |        1650 | COMMIT                                                             |</span><br><span class="line">+---------------+------+----------------+-----------+-------------+--------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Powerline 美化终端</title>
      <link href="2019/01/29/powerline/"/>
      <url>2019/01/29/powerline/</url>
      
        <content type="html"><![CDATA[<p>使用 Powerline 美化终端</p><a id="more"></a><h2 id="安装-python3"><a href="#安装-python3" class="headerlink" title="安装 python3"></a>安装 python3</h2><p>Ubuntu</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]<span class="comment"># sudo apt install python3 python3-pip</span></span><br></pre></td></tr></table></figure><h2 id="安装-powerline"><a href="#安装-powerline" class="headerlink" title="安装 powerline"></a>安装 powerline</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]# python3 -m pip install powerline-status</span><br><span class="line">[root@ubuntu ~]# python3 -m pip show powerline-status</span><br><span class="line">Name: powerline-status</span><br><span class="line">Version: 2.7</span><br><span class="line">Summary: The ultimate statusline&#x2F;prompt utility.</span><br><span class="line">Home-page: https:&#x2F;&#x2F;github.com&#x2F;powerline&#x2F;powerline</span><br><span class="line">Author: Kim Silkebaekken</span><br><span class="line">Author-email: kim.silkebaekken+vim@gmail.com</span><br><span class="line">License: MIT</span><br><span class="line">Location: &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages</span><br><span class="line">Requires:</span><br></pre></td></tr></table></figure><h2 id="设置-bash"><a href="#设置-bash" class="headerlink" title="设置 bash"></a>设置 bash</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]<span class="comment"># vim ~/.bashrc</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">powerline-daemon -q</span><br><span class="line">POWERLINE_BASH_CONTINUATION&#x3D;1</span><br><span class="line">POWERLINE_BASH_SELECT&#x3D;1</span><br><span class="line">. &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;powerline&#x2F;bindings&#x2F;bash&#x2F;powerline.sh</span><br></pre></td></tr></table></figure><ul><li>效果图</li></ul><h2 id="设置-vim"><a href="#设置-vim" class="headerlink" title="设置 vim"></a>设置 vim</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ubuntu ~]<span class="comment"># vim ~/.vimrc</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set rtp+&#x3D;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.6&#x2F;dist-packages&#x2F;powerline&#x2F;bindings&#x2F;vim&#x2F;</span><br><span class="line">set laststatus&#x3D;2</span><br><span class="line">set t_Co&#x3D;256</span><br></pre></td></tr></table></figure><ul><li>效果图</li></ul>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL 常用函数</title>
      <link href="2019/01/15/mysql_function/"/>
      <url>2019/01/15/mysql_function/</url>
      
        <content type="html"><![CDATA[<p>MySQL 常用函数</p><a id="more"></a><h2 id="文本处理函数"><a href="#文本处理函数" class="headerlink" title="文本处理函数"></a>文本处理函数</h2><table><thead><tr><th>函数名</th><th>说明</th></tr></thead><tbody><tr><td>left( )</td><td>返回串左边的字符</td></tr><tr><td>right( )</td><td>返回串右边的字符</td></tr><tr><td>length( )</td><td>返回串的长度</td></tr><tr><td>locate( )</td><td>找出串的一个子串</td></tr><tr><td>lower( )</td><td>将串转换为小写</td></tr><tr><td>upper( )</td><td>将串转换为大写</td></tr><tr><td>ltrim( )</td><td>去掉串左边的空格</td></tr><tr><td>rtrim( )</td><td>去掉串右边的空格</td></tr><tr><td>soundex( )</td><td>返回串的SOUNDEX值</td></tr><tr><td>substring( )</td><td>返回子串的字符</td></tr><tr><td>## 日期和时间处理函数</td><td></td></tr></tbody></table><table><thead><tr><th>函数名</th><th>说明</th></tr></thead><tbody><tr><td>adddate( )</td><td>增加一个日期（天、周等）</td></tr><tr><td>addtime( )</td><td>增加一个时间（时、分等）</td></tr><tr><td>curdate( )</td><td>返回当前日期</td></tr><tr><td>curtime( )</td><td>返回当前时间</td></tr><tr><td>date( )</td><td>返回日期时间的日期部分</td></tr><tr><td>datediff( )</td><td>计算两个日期之差</td></tr><tr><td>date_add( )</td><td>高度灵活的日期运算函数</td></tr><tr><td>date_format( )</td><td>返回一个格式化的日期或时间串</td></tr><tr><td>day( )</td><td>返回一个日期的天数部分</td></tr><tr><td>dayofweek( )</td><td>对于一个日期，返回对应的星期几</td></tr><tr><td>hour( )</td><td>返回一个时间的小时部分</td></tr><tr><td>minute( )</td><td>返回一个时间的分钟部分</td></tr><tr><td>month( )</td><td>返回一个日期的月份部分</td></tr><tr><td>now( )</td><td>返回当前日期和时间</td></tr><tr><td>second( )</td><td>返回一个时间的秒部分</td></tr><tr><td>time( )</td><td>返回一个日期时间的时间部分</td></tr><tr><td>year( )</td><td>返回一个日期的年份部分</td></tr></tbody></table><h2 id="数值处理函数"><a href="#数值处理函数" class="headerlink" title="数值处理函数"></a>数值处理函数</h2><table><thead><tr><th>函数名</th><th>说明</th></tr></thead><tbody><tr><td>abs( )</td><td>返回一个数的绝对值</td></tr><tr><td>cos( )</td><td>返回一个角度的余弦</td></tr><tr><td>exp( )</td><td>返回一个数的指数值</td></tr><tr><td>mod( )</td><td>返回除操作的余数</td></tr><tr><td>pi( )</td><td>返回圆周率</td></tr><tr><td>rand( )</td><td>返回一个随机数</td></tr><tr><td>sin( )</td><td>返回一个角度的正弦</td></tr><tr><td>sqrt( )</td><td>返回一个数的平方根</td></tr><tr><td>tan( )</td><td>返回一个角度的正切</td></tr></tbody></table><h2 id="聚集函数"><a href="#聚集函数" class="headerlink" title="聚集函数"></a>聚集函数</h2><table><thead><tr><th>函数名</th><th>说明</th></tr></thead><tbody><tr><td>avg( )</td><td>返回某列的平均值</td></tr><tr><td>count( )</td><td>返回某列的行数</td></tr><tr><td>max( )</td><td>返回某列的最大值</td></tr><tr><td>min( )</td><td>返回某列的最小值</td></tr><tr><td>sum( )</td><td>返回某列值之和</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>uWSGI 部署 Django 应用</title>
      <link href="2019/01/07/uwsgi/"/>
      <url>2019/01/07/uwsgi/</url>
      
        <content type="html"><![CDATA[<p>uWSGI 部署 Django 应用</p><a id="more"></a><h2 id="准备项目代码"><a href="#准备项目代码" class="headerlink" title="准备项目代码"></a>准备项目代码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /appdata/uwsgi</span><br><span class="line"><span class="built_in">cd</span> /appdata/uwsgi</span><br><span class="line"><span class="comment"># 将项目代码放置此处</span></span><br></pre></td></tr></table></figure><h2 id="安装相关工具和依赖"><a href="#安装相关工具和依赖" class="headerlink" title="安装相关工具和依赖"></a>安装相关工具和依赖</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@uwsgi ~]<span class="comment"># yum -y install git wget httpd vim # 安装相关工具</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># yum -y install gcc zlib* openssl-devel # 安装编译工具和依赖库</span></span><br></pre></td></tr></table></figure><h2 id="编译安装-Python-环境"><a href="#编译安装-Python-环境" class="headerlink" title="编译安装 Python 环境"></a>编译安装 Python 环境</h2><p>rhel系列无法通过yum直接安装python3，需要源码编译安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@uwsgi ~]<span class="comment"># pwd # 查看当前目录</span></span><br><span class="line">/root</span><br><span class="line">[root@uwsgi ~]<span class="comment"># wget https://www.python.org/ftp/python/3.6.5/Python-3.6.5.tgz # 下载python3.6.5</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># tar -zxvf Python-3.6.5.tgz # 解压</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># cd Python-3.6.5</span></span><br><span class="line"></span><br><span class="line">[root@uwsgi Python-3.6.5]<span class="comment"># pwd # 查看当前目录</span></span><br><span class="line">/root/Python-3.6.5</span><br><span class="line">[root@uwsgi Python-3.6.5]<span class="comment"># ./configure # 编译</span></span><br><span class="line">[root@uwsgi Python-3.6.5]<span class="comment"># make &amp;&amp; make install # 安装</span></span><br><span class="line">[root@uwsgi Python-3.6.5]<span class="comment"># which python3 # 查看python3的路径</span></span><br><span class="line">/usr/<span class="built_in">local</span>/bin/python3</span><br></pre></td></tr></table></figure><h1 id="使用-epel-源-Python-环境"><a href="#使用-epel-源-Python-环境" class="headerlink" title="使用 epel 源 Python 环境"></a>使用 epel 源 Python 环境</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@uwsgi ~]<span class="comment"># yum -y install epel-release</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># yum makecache</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># yum -y install python3 python3-devel</span></span><br><span class="line">`</span><br></pre></td></tr></table></figure><ul><li>出现以下报错为缺少 python3-devel<blockquote><p><strong>* uWSGI compiling embedded plugins *</strong><br>  [gcc -pthread] plugins/python/python_plugin.o<br>  In file included from plugins/python/python_plugin.c:1:0:<br>  plugins/python/uwsgi_python.h:2:20: 致命错误：Python.h：没有那个文件或目录<br>  #include &lt;Python.h&gt;</p></blockquote></li></ul><h2 id="安装-uWSGI"><a href="#安装-uWSGI" class="headerlink" title="安装 uWSGI"></a>安装 uWSGI</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@uwsgi ~]<span class="comment"># python3 -m pip install uwsgi</span></span><br></pre></td></tr></table></figure><h2 id="安装配置虚拟环境"><a href="#安装配置虚拟环境" class="headerlink" title="安装配置虚拟环境"></a>安装配置虚拟环境</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@uwsgi ~]<span class="comment"># python3 -m pip install virtualenv # 安装虚拟环境</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># python3 -m virtualenv /appdata/uwsgi/venv # 配置虚拟环境</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># source /venv/bin/activate # 激活虚拟环境</span></span><br><span class="line">(venv) [root@uwsgi ~]<span class="comment"># pip install -r /appdata/planner/requirements.txt # 安装项目依赖</span></span><br><span class="line">(venv) [root@uwsgi ~]<span class="comment"># pip freeze # 查看依赖库是否安装</span></span><br><span class="line">(venv) [root@uwsgi ~]<span class="comment"># deactivate # 取消激活虚拟环境</span></span><br><span class="line">[root@uwsgi ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="修改-ALLOW-HOSTS"><a href="#修改-ALLOW-HOSTS" class="headerlink" title="修改 ALLOW_HOSTS"></a>修改 ALLOW_HOSTS</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@uwsgi ~]<span class="comment"># vim /appdata/planner/planner/settings.py # 编辑项目中的 settings.py</span></span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALLOWED_HOSTS = [<span class="string">"*"</span>]</span><br></pre></td></tr></table></figure><h2 id="配置-uWSGI"><a href="#配置-uWSGI" class="headerlink" title="配置 uWSGI"></a>配置 uWSGI</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@uwsgi ~]<span class="comment"># mkdir -p /applog/uwsgi/ # 创建 uwsgi 的日志目录</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># vim /etc/uwsgi/planner.ini # 创建 uwsgi.ini 配置文件</span></span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[uwsgi]</span></span><br><span class="line"><span class="comment"># 项目目录</span></span><br><span class="line"><span class="attr">chdir</span>=/appdata/uwsgi/planner</span><br><span class="line"><span class="attr">http</span>=<span class="number">192.168</span>.<span class="number">33.11</span>:<span class="number">8000</span></span><br><span class="line"><span class="comment"># 虚拟环境目录</span></span><br><span class="line"><span class="attr">home</span>=/appdata/uwsgi/venv</span><br><span class="line"><span class="attr">module</span>=planner.wsgi:application</span><br><span class="line"><span class="attr">master</span>=<span class="literal">True</span></span><br><span class="line"><span class="attr">pidfile</span>=/applog/uwsgi/planner.pid</span><br><span class="line"><span class="attr">daemonize</span>=/applog/uwsgi/planner.log</span><br><span class="line"><span class="attr">socket</span>=/applog/uwsgi/planner.sock</span><br><span class="line"><span class="attr">max-requests</span>=<span class="number">5000</span></span><br><span class="line"><span class="attr">env</span>=LANG=en_US.UTF-<span class="number">8</span></span><br><span class="line"><span class="attr">buffer-size</span>=<span class="number">32768</span></span><br><span class="line"><span class="attr">logformat</span>=&#123;<span class="string">"uri"</span>: <span class="string">"%(uri)"</span>,  <span class="string">"method"</span>: <span class="string">"%(method)"</span>,  <span class="string">"user"</span>: <span class="string">"%(user)"</span>,  <span class="string">"addr"</span>: <span class="string">"%(addr)"</span>,  <span class="string">"host"</span>: <span class="string">"%(host)"</span>,  <span class="string">"proto"</span>: <span class="string">"%(proto)"</span>,  <span class="string">"uagent"</span>: <span class="string">"%(uagent)"</span>,  <span class="string">"referer"</span>: <span class="string">"%(referer)"</span>,  <span class="string">"status"</span>: <span class="string">"%(status)"</span>,  <span class="string">"micros"</span>: <span class="string">"%(micros)"</span>,  <span class="string">"msecs"</span>: <span class="string">"%(msecs)"</span>,  <span class="string">"time"</span>: <span class="string">"%(time)"</span>,  <span class="string">"ctime"</span>: <span class="string">"%(ctime)"</span>,  <span class="string">"epoch"</span>: <span class="string">"%(epoch)"</span>,  <span class="string">"size"</span>: <span class="string">"%(size)"</span>,  <span class="string">"ltime"</span>: <span class="string">"%(ltime)"</span>,  <span class="string">"hsize"</span>: <span class="string">"%(hsize)"</span>,  <span class="string">"rsize"</span>: <span class="string">"%(rsize)"</span>,  <span class="string">"cl"</span>: <span class="string">"%(cl)"</span>,  <span class="string">"pid"</span>: <span class="string">"%(pid)"</span>,  <span class="string">"wid"</span>: <span class="string">"%(wid)"</span>,  <span class="string">"switches"</span>: <span class="string">"%(switches)"</span>,  <span class="string">"vars"</span>: <span class="string">"%(vars)"</span>,  <span class="string">"headers"</span>: <span class="string">"%(headers)"</span>,  <span class="string">"core"</span>: <span class="string">"%(core)"</span>,  <span class="string">"vsz"</span>: <span class="string">"%(vsz)"</span>,  <span class="string">"rss"</span>: <span class="string">"%(rss)"</span>,  <span class="string">"vszM"</span>: <span class="string">"%(vszM)"</span>,  <span class="string">"rssM"</span>: <span class="string">"%(rssM)"</span>,  <span class="string">"pktsize"</span>: <span class="string">"%(pktsize)"</span>,  <span class="string">"modifier1"</span>: <span class="string">"%(modifier1)"</span>,  <span class="string">"modifier2"</span>: <span class="string">"%(modifier2)"</span>,  <span class="string">"metric"</span>: <span class="string">"%(metric.XXX)"</span>,  <span class="string">"rerr"</span>: <span class="string">"%(rerr)"</span>,  <span class="string">"werr"</span>: <span class="string">"%(werr)"</span>,  <span class="string">"ioerr"</span>: <span class="string">"%(ioerr)"</span>,  <span class="string">"tmsecs"</span>: <span class="string">"%(tmsecs)"</span>,  <span class="string">"tmicros"</span>: <span class="string">"%(tmicros)"</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="启动-uWSGI"><a href="#启动-uWSGI" class="headerlink" title="启动 uWSGI"></a>启动 uWSGI</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以 /etc/uwsgi.ini 配置启动 uwsgi</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># uwsgi --init /etc/uwsgi.ini</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看端口是否监听</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># netstat -ntlp | grep uwsgi</span></span><br><span class="line">tcp        0      0 192.168.33.11:8000      0.0.0.0:*               LISTEN      13162/uwsgi</span><br></pre></td></tr></table></figure><h2 id="配置-Nginx"><a href="#配置-Nginx" class="headerlink" title="配置 Nginx"></a>配置 Nginx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 nginx</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># yum -y install epel-release</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># yum -y install nginx</span></span><br><span class="line"><span class="comment"># 创建配置文件</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># cat &lt;&lt; EOF &gt; /etc/nginx/conf.d/planner.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name 192.168.33.11;</span><br><span class="line">charset utf-8;</span><br><span class="line">location /static &#123;</span><br><span class="line"><span class="built_in">alias</span> /appdata/uwsgi/planner/static/;</span><br><span class="line">&#125;</span><br><span class="line">location /media  &#123;</span><br><span class="line"><span class="built_in">alias</span> /appdata/uwsgi/planner/media/;</span><br><span class="line">&#125;</span><br><span class="line">location /&#123;</span><br><span class="line">include /etc/nginx/uwsgi_params;</span><br><span class="line">uwsgi_pass unix:/applog/uwsgi/planner.sock;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"><span class="comment"># 检查文件是否合法</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># nginx -t</span></span><br><span class="line"><span class="comment"># 刷新配置文件</span></span><br><span class="line">[root@uwsgi ~]<span class="comment"># nginx -s reload</span></span><br></pre></td></tr></table></figure><p>现在就可以使用 http://<IP> 访问 Django 应用了</p><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>未安装zlib*：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zipimport.ZipImportError: can&#39;t decompress data; zlib not available # 编译时报错</span><br></pre></td></tr></table></figure><p>未安装openssl、openssl-devel：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip is configured with locations that require TLS&#x2F;SSL, however the ssl module in Python is not available # pip 安装 uwsgi 时报错</span><br></pre></td></tr></table></figure><p>uwsgi 无法访问，日志报错：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">invalid request block size: 21573 (max 4096)...skip # 在 &#x2F;etc&#x2F;uwsgi.ini 中添加 buffer-size&#x3D;32768</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 oh-my-posh 美化 PowerShell</title>
      <link href="2019/01/05/oh-my-posh/"/>
      <url>2019/01/05/oh-my-posh/</url>
      
        <content type="html"><![CDATA[<p>使用 oh-my-posh 美化 PowerShell</p><a id="more"></a><p>英文字体是支持PowerLine的DejaVuSansMono字体，中文字体是文泉驿等宽微米黑字体），并将终端字体设置为支持PowerLine的字体。<br>然后开始安装oh-my-posh（该步骤可能需要某种“较为稳定”的网络环境）。在管理员权限的PowerShell下执行指令</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ExecutionPolicy</span> Bypass</span><br></pre></td></tr></table></figure><p>该指令旨在允许加载并运行任意脚本。可能会造成安全问题，但是只要有杀毒软件在就无需担心，毕竟没有人会无聊到对一个普通的计算机用户进行针对性攻击。</p><p>然后安装oh-my-posh的依赖和oh-my-posh本身</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Install-Module</span> posh<span class="literal">-git</span> <span class="literal">-Scope</span> CurrentUser</span><br><span class="line"><span class="built_in">Install-Module</span> oh<span class="literal">-my</span><span class="literal">-posh</span> <span class="literal">-Scope</span> CurrentUser</span><br></pre></td></tr></table></figure><p>安装完成之后，可以通过</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> oh<span class="literal">-my</span><span class="literal">-posh</span></span><br></pre></td></tr></table></figure><p>来尝试启用这个模组。之后就可以使用</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-Theme</span>主题名</span><br></pre></td></tr></table></figure><p>这种格式的指令来切换不同的显示风格。示例图中的主题是基于Agnoster改造的，默认主题文件位于</p><p>IT之家学院：使用oh-my-posh美化Win10 PowerShell</p><p>接下来便是在PowerShell启动时加载这个模组了。类似于Linux Bash的.bashrc，PowerShell也提供类似的Profile文件用于在启动时执行指令。输入</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Test-Path</span> <span class="variable">$profile</span></span><br></pre></td></tr></table></figure><p>并执行，以确定profile文件是否存在。如果返回False，则应该执行：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-Item</span> <span class="literal">-path</span> <span class="variable">$profile</span> <span class="literal">-type</span> file–force</span><br></pre></td></tr></table></figure><p>来新建一个文件。然后去往Profile的目录（通常是你的文档下的WindowsPowerShell目录下），修改那个后缀为ps1的Profile文件，加入一行Import-Module oh-my-posh即可。</p><p>一切完成之后，PowerShell应该比原先美观了不少，而且提示符的功能更强了。基于oh-my-posh框架，还能自己编写更多的主题。</p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> powershell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gitlab-ce 安装指南</title>
      <link href="2019/01/03/gitlab/"/>
      <url>2019/01/03/gitlab/</url>
      
        <content type="html"><![CDATA[<p>gitlab 安装使用指南</p><a id="more"></a><h2 id="更新软件包"><a href="#更新软件包" class="headerlink" title="更新软件包"></a>更新软件包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update -y</span><br></pre></td></tr></table></figure><h2 id="配置防火墙"><a href="#配置防火墙" class="headerlink" title="配置防火墙"></a>配置防火墙</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># vim /etc/sysctl.conf</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.ip_forward &#x3D; 1</span><br></pre></td></tr></table></figure><ul><li>启用并启动防火墙</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># systemctl enable firewalld</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># systemctl start firewalld</span></span><br></pre></td></tr></table></figure><ul><li>放通 HTTP、HTTPS</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># firewall-cmd --add-service=http --permanent</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># firewall-cmd --add-service=https --permanent</span></span><br></pre></td></tr></table></figure><ul><li>重载入防火墙</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># systemctl reload firewalld</span></span><br></pre></td></tr></table></figure><h2 id="安装-postfix"><a href="#安装-postfix" class="headerlink" title="安装 postfix"></a>安装 postfix</h2><p>GitLab 需要使用 postfix 来发送邮件。当然，也可以使用 SMTP 服务器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># vim /etc/postfix/main.cf</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># inet_protocols &#x3D; all</span><br><span class="line">inet_protocols &#x3D; ipv4</span><br></pre></td></tr></table></figure><ul><li>启用并启动 postfix</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># systemctl restart postfix</span></span><br></pre></td></tr></table></figure><h2 id="配置-swap"><a href="#配置-swap" class="headerlink" title="配置 swap"></a>配置 swap</h2><p>由于 GitLab 较为消耗资源，我们需要先创建交换分区，以降低物理内存的压力。<br>在实际生产环境中，如果服务器配置够高，则不必配置交换分区。</p><ul><li>新建 2 GB 大小的交换分区</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># dd if=/dev/zero of=/root/swapfile bs=1M count=2048</span></span><br></pre></td></tr></table></figure><ul><li>格式化为交换分区文件并启用</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># mkswap /root/swapfile</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># swapon /root/swapfile</span></span><br></pre></td></tr></table></figure><ul><li>添加自启用</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># vim /etc/fstab</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;root&#x2F;swapfile swap swap defaults 0 0</span><br></pre></td></tr></table></figure><h2 id="安装-GitLab"><a href="#安装-GitLab" class="headerlink" title="安装 GitLab"></a>安装 GitLab</h2><ul><li>将软件源修改为国内源</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># vim /etc/yum.repos.d/gitlab-ce.repo</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[gitlab-ce]</span><br><span class="line">name&#x3D;Gitlab CE Repository</span><br><span class="line">baseurl&#x3D;https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;gitlab-ce&#x2F;yum&#x2F;el$releasever&#x2F;</span><br><span class="line">gpgcheck&#x3D;0</span><br><span class="line">enabled&#x3D;1</span><br></pre></td></tr></table></figure><ul><li>安装 GitLab</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># yum makecache</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># yum install -y gitlab-ce</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">     *.                  *.</span><br><span class="line">    ***                 ***</span><br><span class="line">   *****               *****</span><br><span class="line">  .******             *******</span><br><span class="line">  ********            ********</span><br><span class="line"> ,,,,,,,,,***********,,,,,,,,,</span><br><span class="line">,,,,,,,,,,,*********,,,,,,,,,,,</span><br><span class="line">.,,,,,,,,,,,*******,,,,,,,,,,,,</span><br><span class="line">    ,,,,,,,,,*****,,,,,,,,,.</span><br><span class="line">       ,,,,,,,****,,,,,,</span><br><span class="line">          .,,,***,,,,</span><br><span class="line">              ,*,.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   _______ __  __          __</span><br><span class="line">  &#x2F; ____(_) &#x2F;_&#x2F; &#x2F;   ____ _&#x2F; &#x2F;_</span><br><span class="line"> &#x2F; &#x2F; __&#x2F; &#x2F; __&#x2F; &#x2F;   &#x2F; __ &#96;&#x2F; __ \</span><br><span class="line">&#x2F; &#x2F;_&#x2F; &#x2F; &#x2F; &#x2F;_&#x2F; &#x2F;___&#x2F; &#x2F;_&#x2F; &#x2F; &#x2F;_&#x2F; &#x2F;</span><br><span class="line">\____&#x2F;_&#x2F;\__&#x2F;_____&#x2F;\__,_&#x2F;_.___&#x2F;</span><br><span class="line"></span><br><span class="line">Thank you for installing GitLab!</span><br></pre></td></tr></table></figure><h2 id="配置-HTTPS-证书"><a href="#配置-HTTPS-证书" class="headerlink" title="配置 HTTPS 证书"></a>配置 HTTPS 证书</h2><ul><li>生成 key 文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># openssl genrsa -out "/etc/gitlab/ssl/gitlab.example.com.key"</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Generating RSA private key, 2048 bit long modulus</span><br><span class="line">.........................................................................................................+++</span><br><span class="line">..............................................................+++</span><br><span class="line">e is 65537 (0x10001)</span><br></pre></td></tr></table></figure><ul><li>生成 csr 文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ssl]<span class="comment"># openssl req -new -key "/etc/gitlab/ssl/gitlab.example.com.key" -out "/etc/gitlab/ssl/gitlab.example.com.csr"</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &#39;.&#39;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:cn</span><br><span class="line">State or Province Name (full name) []:sz</span><br><span class="line">Locality Name (eg, city) [Default City]:sz</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:example</span><br><span class="line">Organizational Unit Name (eg, section) []:</span><br><span class="line">Common Name (eg, your name or your server&#39;s hostname) []:gitlab.example.com</span><br><span class="line">Email Address []:admin@example.com</span><br><span class="line"></span><br><span class="line">Please enter the following &#39;extra&#39; attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:password</span><br><span class="line">An optional company name []:</span><br></pre></td></tr></table></figure><ul><li>生成 crt 文件 </li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># openssl x509 -req -days 365 -in "/etc/gitlab/ssl/gitlab.example.com.csr" -signkey "/etc/gitlab/ssl/gitlab.example.com.key" -out "/etc/gitlab/ssl/gitlab.example.com.crt"</span></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Signature ok</span><br><span class="line">subject&#x3D;&#x2F;C&#x3D;cn&#x2F;ST&#x3D;sz&#x2F;L&#x3D;sz&#x2F;O&#x3D;example&#x2F;CN&#x3D;gitlab.example.com&#x2F;emailAddress&#x3D;admin@example.com</span><br><span class="line">Getting Private key</span><br></pre></td></tr></table></figure><ul><li>生成 dhparams.pem</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ssl]<span class="comment"># openssl dhparam -out /etc/gitlab/ssl/dhparams.pem 2048</span></span><br></pre></td></tr></table></figure><h2 id="初始化-GitLab"><a href="#初始化-GitLab" class="headerlink" title="初始化 GitLab"></a>初始化 GitLab</h2><ul><li>配置 GitLab</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># vim /etc/gitlab/gitlab.rb</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">external_url &#39;http:&#x2F;&#x2F;gitlab.example.com&#39;</span><br><span class="line">nginx[&#39;redirect_http_to_https&#39;] &#x3D; true</span><br><span class="line">nginx[&#39;ssl_certificate&#39;] &#x3D; &quot;&#x2F;etc&#x2F;gitlab&#x2F;ssl&#x2F;gitlab.example.com.crt&quot;</span><br><span class="line">nginx[&#39;ssl_certificate_key&#39;] &#x3D; &quot;&#x2F;etc&#x2F;gitlab&#x2F;ssl&#x2F;gitlab.example.com.key&quot;</span><br><span class="line">nginx[&#39;ssl_dhparam&#39;] &#x3D; &quot;&#x2F;etc&#x2F;gitlab&#x2F;ssl&#x2F;dhparams.pem&quot;</span><br></pre></td></tr></table></figure><ul><li>初始化 GitLab</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># gitlab-ctl reconfigure</span></span><br></pre></td></tr></table></figure><ul><li>修改 nginx 配置</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># vim /var/opt/gitlab/nginx/conf/gitlab-http.conf</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen *:80;</span><br><span class="line"></span><br><span class="line">  rewrite ^(.*)$ https:&#x2F;&#x2F;$host$1 permanent; # 新增</span><br><span class="line"></span><br><span class="line">  server_name gitlab.example.com;</span><br><span class="line">  server_tokens off; ## Don&#39;t show the nginx version number, a security best practice</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  location &#x2F; &#123;</span><br><span class="line">    return 301 https:&#x2F;&#x2F;gitlab.example.com:443$request_uri;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  access_log  &#x2F;var&#x2F;log&#x2F;gitlab&#x2F;nginx&#x2F;gitlab_access.log gitlab_access;</span><br><span class="line">  error_log   &#x2F;var&#x2F;log&#x2F;gitlab&#x2F;nginx&#x2F;gitlab_error.log;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>重启 gitlab</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># gitlab-ctl restart</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> git </tag>
            
            <tag> gitlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 Ambari 部署 Hadoop 集群</title>
      <link href="2018/12/18/ambari/"/>
      <url>2018/12/18/ambari/</url>
      
        <content type="html"><![CDATA[<p>使用 Ambari 部署 Hadoop 集群</p><a id="more"></a><h2 id="配置本地yum源"><a href="#配置本地yum源" class="headerlink" title="配置本地yum源"></a>配置本地yum源</h2><h3 id="安装httpd"><a href="#安装httpd" class="headerlink" title="安装httpd"></a>安装httpd</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install httpd -y</span><br></pre></td></tr></table></figure><h3 id="在官方下载镜像文件"><a href="#在官方下载镜像文件" class="headerlink" title="在官方下载镜像文件"></a>在官方下载镜像文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://public-repo-1.hortonworks.com/ambari/centos7/2.x/updates/2.6.1.0/ambari.repo</span><br><span class="line">wget http://public-repo-1.hortonworks.com/HDP/centos7/2.x/updates/2.6.4.0/hdp.repo</span><br><span class="line">wget http://public-repo-1.hortonworks.com/ambari/centos7/2.x/updates/2.6.1.0/ambari-2.6.1.0-centos7.tar.gz</span><br><span class="line">wget http://public-repo-1.hortonworks.com/HDP-UTILS-1.1.0.22/repos/centos7/HDP-UTILS-1.1.0.22-centos7.tar.gz</span><br><span class="line">wget http://public-repo-1.hortonworks.com/HDP-GPL/centos7/2.x/updates/2.6.4.0/HDP-GPL-2.6.4.0-centos7-rpm.tar.gz</span><br><span class="line">wget http://public-repo-1.hortonworks.com/HDP/centos7/2.x/updates/2.6.4.0/HDP-2.6.4.0-centos7-rpm.tar.gz</span><br></pre></td></tr></table></figure><h3 id="将对应的tar包解压到httpd的文件目录"><a href="#将对应的tar包解压到httpd的文件目录" class="headerlink" title="将对应的tar包解压到httpd的文件目录"></a>将对应的tar包解压到httpd的文件目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /var/www/html</span><br><span class="line">tar -zxvf ambari-2.6.1.0-centos7.tar.gz</span><br><span class="line">tar -zxvf HDP-2.6.4.0-centos7-rpm.tar.gz </span><br><span class="line">tar -zxvf HDP-GPL-2.6.4.0-centos7-rpm.tar.gz </span><br><span class="line">tar -zxvf HDP-UTILS-1.1.0.22-centos7.tar.gz</span><br></pre></td></tr></table></figure><h3 id="配置基础源，创建hadoop的repo文件"><a href="#配置基础源，创建hadoop的repo文件" class="headerlink" title="配置基础源，创建hadoop的repo文件"></a>配置基础源，创建hadoop的repo文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ambari 源</span></span><br><span class="line">vim /etc/yum.repo.d/ambari.repo</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[ambari-2.6.1.0]</span><br><span class="line">name&#x3D;ambari Version - ambari-2.6.1.0</span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;192.168.10.11&#x2F;ambari&#x2F;centos7&#x2F;2.6.1.0-143</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">gpgkey&#x3D;http:&#x2F;&#x2F;192.168.10.11&#x2F;ambari&#x2F;centos7&#x2F;2.6.1.0-143&#x2F;RPM-GPG-KEY&#x2F;RPM-GPG-KEY-Jenkins</span><br><span class="line">enabled&#x3D;1</span><br><span class="line">priority&#x3D;1</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> hadoop源</span></span><br><span class="line">vim /etc/yum.repo.d/hdp.repo</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#VERSION_NUMBER&#x3D;2.6.4.0-91</span><br><span class="line">[HDP-2.6.4.0]</span><br><span class="line">name&#x3D;HDP Version - HDP-2.6.4.0</span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;192.168.10.11&#x2F;HDP&#x2F;centos7&#x2F;2.6.4.0-91</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">gpgkey&#x3D;http:&#x2F;&#x2F;192.168.10.11&#x2F;HDP&#x2F;centos7&#x2F;2.6.4.0-91&#x2F;RPM-GPG-KEY&#x2F;RPM-GPG-KEY-Jenkins</span><br><span class="line">enabled&#x3D;1</span><br><span class="line">priority&#x3D;1</span><br><span class="line"></span><br><span class="line">[HDP-UTILS-1.1.0.22]</span><br><span class="line">name&#x3D;HDP-UTILS Version - HDP-UTILS-1.1.0.22</span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;192.168.10.11&#x2F;HDP-UTILS&#x2F;centos7&#x2F;1.1.0.22&#x2F;</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">gpgkey&#x3D;http:&#x2F;&#x2F;192.168.10.11&#x2F;HDP-UTILS&#x2F;centos7&#x2F;1.1.0.22&#x2F;RPM-GPG-KEY&#x2F;RPM-GPG-KEY-Jenkins</span><br><span class="line">enabled&#x3D;1</span><br><span class="line">priority&#x3D;1</span><br><span class="line"></span><br><span class="line">[HDP-GPL-2.6.4.0]</span><br><span class="line">name&#x3D;HDP-GPL Version - HDP-GPL-2.6.4.0</span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;192.168.10.11&#x2F;HDP-GPL&#x2F;centos7&#x2F;2.6.4.0-91</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">gpgkey&#x3D;http:&#x2F;&#x2F;192.168.10.11&#x2F;HDP-GPL&#x2F;centos7&#x2F;2.6.4.0-91&#x2F;RPM-GPG-KEY&#x2F;RPM-GPG-KEY-Jenkins</span><br><span class="line">enabled&#x3D;1</span><br><span class="line">priority&#x3D;1</span><br></pre></td></tr></table></figure><h3 id="启动httpd"><a href="#启动httpd" class="headerlink" title="启动httpd"></a>启动httpd</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable httpd</span><br><span class="line">systemctl start httpd</span><br></pre></td></tr></table></figure><h3 id="将本地源的repo配置拷贝到其它节点，并创建缓存"><a href="#将本地源的repo配置拷贝到其它节点，并创建缓存" class="headerlink" title="将本地源的repo配置拷贝到其它节点，并创建缓存"></a>将本地源的repo配置拷贝到其它节点，并创建缓存</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp /etc/yum.repos.d/ambari.repo 192.168.135.4:/etc/yum.repos.d/</span><br><span class="line">scp /etc/yum.repos.d/ambari.repo 192.168.135.5:/etc/yum.repos.d/</span><br><span class="line">scp /etc/yum.repos.d/hdp.repo 192.168.135.6:/etc/yum.repos.d/</span><br></pre></td></tr></table></figure><p>在各个节点创建缓存：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure><h2 id="初始化环境"><a href="#初始化环境" class="headerlink" title="初始化环境"></a>初始化环境</h2><h3 id="各个节点安装java-1-8-0-openjdk"><a href="#各个节点安装java-1-8-0-openjdk" class="headerlink" title="各个节点安装java-1.8.0-openjdk"></a>各个节点安装java-1.8.0-openjdk</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install java-1.8.0-openjdk -y</span><br></pre></td></tr></table></figure><h3 id="解析主机名"><a href="#解析主机名" class="headerlink" title="解析主机名"></a>解析主机名</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo "192.168.135.4 node2" &gt;&gt; /etc/hosts</span><br><span class="line">echo "192.168.135.5 node3" &gt;&gt; /etc/hosts</span><br><span class="line">echo "192.168.135.6 node4" &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h3 id="创建主机信任关系"><a href="#创建主机信任关系" class="headerlink" title="创建主机信任关系"></a>创建主机信任关系</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br><span class="line">ssh-copy-id node-1</span><br><span class="line">ssh-copy-id node-2</span><br><span class="line">ssh-copy-id node-3</span><br></pre></td></tr></table></figure><h3 id="安装配置数据库"><a href="#安装配置数据库" class="headerlink" title="安装配置数据库"></a>安装配置数据库</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install mariadb-server -y</span><br><span class="line">systemctl enable mariadb</span><br><span class="line">systemctl start mariadb</span><br></pre></td></tr></table></figure><h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">password</span>=<span class="keyword">password</span>(<span class="string">'123456'</span>);</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> root@localhost <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> root@<span class="string">'%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'123456'</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> ambari <span class="keyword">default</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> ambari.* <span class="keyword">to</span> ambari@localhost <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'bigdata'</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> ambari.* <span class="keyword">to</span> ambari@<span class="string">'%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'bigdata'</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> hive <span class="keyword">default</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> hive.* <span class="keyword">to</span> hive@localhost <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'hive'</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> hive.* <span class="keyword">to</span> hive@<span class="string">'%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'hive'</span>;</span><br></pre></td></tr></table></figure><h2 id="安装Amabri服务"><a href="#安装Amabri服务" class="headerlink" title="安装Amabri服务"></a>安装Amabri服务</h2><h3 id="在node-1上安装ambari-server-并启动配置向导"><a href="#在node-1上安装ambari-server-并启动配置向导" class="headerlink" title="在node-1上安装ambari-server,并启动配置向导"></a>在node-1上安装ambari-server,并启动配置向导</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install ambari-server -y</span><br><span class="line">ambari-server setup</span><br></pre></td></tr></table></figure><h3 id="按照配置向导信息、配置用户、java-home"><a href="#按照配置向导信息、配置用户、java-home" class="headerlink" title="按照配置向导信息、配置用户、java_home"></a>按照配置向导信息、配置用户、java_home</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">ambari-server setup</span><br><span class="line">Using python  /usr/bin/python</span><br><span class="line">Setup ambari-server</span><br><span class="line">Checking SELinux...</span><br><span class="line">SELinux status is 'disabled'</span><br><span class="line">Customize user account for ambari-server daemon [y/n] (n)? y</span><br><span class="line">Enter user account for ambari-server daemon (root):ambari  </span><br><span class="line">Adjusting ambari-server permissions and ownership...</span><br><span class="line">Checking firewall status...</span><br><span class="line">Checking JDK...</span><br><span class="line">[1] Oracle JDK 1.8 + Java Cryptography Extension (JCE) Policy Files 8</span><br><span class="line">[2] Oracle JDK 1.7 + Java Cryptography Extension (JCE) Policy Files 7</span><br><span class="line">[3] Custom JDK</span><br><span class="line">==============================================================================</span><br><span class="line">Enter choice (1): 3</span><br><span class="line">WARNING: JDK must be installed on all hosts and JAVA_HOME must be valid on all hosts.</span><br><span class="line">WARNING: JCE Policy files are required for configuring Kerberos security. If you plan to use Kerberos,please make sure JCE Unlimited Strength Jurisdiction Policy Files are valid on all hosts.</span><br><span class="line">Path to JAVA_HOME: /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64/jre  # 填写java_home</span><br><span class="line">Validating JDK on Ambari Server...done.</span><br><span class="line">Checking GPL software agreement...</span><br><span class="line">GPL License for LZO: https://www.gnu.org/licenses/old-licenses/gpl-2.0.en.html</span><br><span class="line">Enable Ambari Server to download and install GPL Licensed LZO packages [y/n] (n)? n</span><br><span class="line">Completing setup...</span><br><span class="line">Configuring database...</span><br><span class="line">Enter advanced database configuration [y/n] (n)? y  </span><br><span class="line">Configuring database...</span><br><span class="line">==============================================================================</span><br><span class="line">Choose one of the following options:</span><br><span class="line">[1] - PostgreSQL (Embedded)</span><br><span class="line">[2] - Oracle</span><br><span class="line">[3] - MySQL / MariaDB</span><br><span class="line">[4] - PostgreSQL</span><br><span class="line">[5] - Microsoft SQL Server (Tech Preview)</span><br><span class="line">[6] - SQL Anywhere</span><br><span class="line">[7] - BDB</span><br><span class="line">==============================================================================</span><br><span class="line">Enter choice (1): 3</span><br><span class="line">Hostname (localhost): </span><br><span class="line">Port (3306): </span><br><span class="line">Database name (ambari): </span><br><span class="line">Username (ambari): </span><br><span class="line">Enter Database Password (bigdata): </span><br><span class="line">Configuring ambari database...</span><br><span class="line">WARNING: Before starting Ambari Server, you must copy the MySQL JDBC driver JAR file to /usr/share/java and set property "server.jdbc.driver.path=[path/to/custom_jdbc_driver]" in ambari.properties.</span><br><span class="line">Press &lt;enter&gt; to continue.</span><br></pre></td></tr></table></figure><h3 id="到上面一步时，根据提示上传mysql的jdbc驱动，并修改配置文件，指定jdbc驱动文件位置："><a href="#到上面一步时，根据提示上传mysql的jdbc驱动，并修改配置文件，指定jdbc驱动文件位置：" class="headerlink" title="到上面一步时，根据提示上传mysql的jdbc驱动，并修改配置文件，指定jdbc驱动文件位置："></a>到上面一步时，根据提示上传mysql的jdbc驱动，并修改配置文件，指定jdbc驱动文件位置：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/share/java</span><br><span class="line">ll</span><br><span class="line">tar xf mysql-connector-java-5.1.45.tar.gz </span><br><span class="line">mv mysql-connector-java-5.1.45/mysql-connector-java-5.1.45-bin.jar ./</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改配置文件：</span></span><br><span class="line">vim /etc/ambari-server/conf/ambari.properties</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.jdbc.driver.path&#x3D;&#x2F;usr&#x2F;share&#x2F;java&#x2F;mysql-connector-java-5.1.45-bin.jar</span><br></pre></td></tr></table></figure><p>配置完成后继续，会出现如下提示：</p><p>Press <enter> to continue.<br>Configuring remote database connection properties…<br>WARNING: Before starting Ambari Server, you must run the following DDL against the database to create the schema: /var/lib/ambari-server/resources/Ambari-DDL-MySQL-CREATE.sql<br>Proceed with configuring remote database connection properties [y/n] (y)? </p><h3 id="出现上述提示时，根据信息导入数据库"><a href="#出现上述提示时，根据信息导入数据库" class="headerlink" title="出现上述提示时，根据信息导入数据库"></a>出现上述提示时，根据信息导入数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p ambari &lt; &#x2F;var&#x2F;lib&#x2F;ambari-server&#x2F;resources&#x2F;Ambari-DDL-MySQL-CREATE.sql</span><br></pre></td></tr></table></figure><h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ambari-server start</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hadoop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ansible 自动化运维实战</title>
      <link href="2018/12/17/ansible/"/>
      <url>2018/12/17/ansible/</url>
      
        <content type="html"><![CDATA[<p>Ansible 自动化运维实战</p><a id="more"></a><h2 id="Ad-Hoc命令简介"><a href="#Ad-Hoc命令简介" class="headerlink" title="Ad-Hoc命令简介"></a>Ad-Hoc命令简介</h2><h3 id="并行和Shell命令"><a href="#并行和Shell命令" class="headerlink" title="并行和Shell命令"></a>并行和Shell命令</h3><p>让我们使用Ansible的命令行工具重启atlanta的所有Web服务器，一次10个。首先，让我们设置SSH代理，以便它能记住我们的凭据：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-agent bash</span><br><span class="line">ssh-add ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure><p>playbook</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">[nginx]</span><br><span class="line">name&#x3D;nginx repo</span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;nginx.org&#x2F;packages&#x2F;OS&#x2F;OSRELEASE&#x2F;$basearch&#x2F;</span><br><span class="line">gpgcheck&#x3D;0</span><br><span class="line">enabled&#x3D;1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Arch Linux 入坑指南</title>
      <link href="2018/12/16/archlinux_install/"/>
      <url>2018/12/16/archlinux_install/</url>
      
        <content type="html"><![CDATA[<p>Arch Linux 安装指南</p><a id="more"></a><h2 id="系统安装"><a href="#系统安装" class="headerlink" title="系统安装"></a>系统安装</h2><h3 id="连接网络"><a href="#连接网络" class="headerlink" title="连接网络"></a>连接网络</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wifi-menu</span><br></pre></td></tr></table></figure><h3 id="磁盘分区"><a href="#磁盘分区" class="headerlink" title="磁盘分区"></a>磁盘分区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l</span><br><span class="line">fdisk /dev/sda</span><br><span class="line"><span class="comment"># 1. 先将硬盘格式转换为 GPT</span></span><br><span class="line"><span class="comment"># 2. 创建 sda1 EFI 分区 200M</span></span><br><span class="line"><span class="comment"># 3. 创建 ada2 boot 分区 1G</span></span><br><span class="line"><span class="comment"># 4. 剩下的 sda3 Linux LVM 分区</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 格式化三个分区</span></span><br><span class="line">mkfs.vfat -F32 /dev/sda1</span><br><span class="line">mkfs.ext4 /dev/sda2</span><br><span class="line">mkfs.xfs /dev/sda3</span><br></pre></td></tr></table></figure><h3 id="查看硬盘的分区情况"><a href="#查看硬盘的分区情况" class="headerlink" title="查看硬盘的分区情况"></a>查看硬盘的分区情况</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsblk -l</span><br></pre></td></tr></table></figure><h3 id="创建并挂载目录"><a href="#创建并挂载目录" class="headerlink" title="创建并挂载目录"></a>创建并挂载目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一定要先挂载 /mnt</span></span><br><span class="line">mount /dev/sda3 /mnt</span><br><span class="line"><span class="comment"># 创建 boot 文件夹并挂载</span></span><br><span class="line">mkdir /mnt/boot</span><br><span class="line">mount /dev/sda2 /mnt/boot</span><br><span class="line"><span class="comment"># 创建 efi 文件夹并挂载</span></span><br><span class="line">mkdir /mnt/boot/efi</span><br><span class="line">mount /dev/sda1 /mnt/boot/efi</span><br></pre></td></tr></table></figure><h3 id="安装基本系统"><a href="#安装基本系统" class="headerlink" title="安装基本系统"></a>安装基本系统</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacstrap &#x2F;mnt base</span><br></pre></td></tr></table></figure><h3 id="生成-fstab"><a href="#生成-fstab" class="headerlink" title="生成 fstab"></a>生成 fstab</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">genfstab -U &#x2F;mnt &gt;&gt; &#x2F;mnt&#x2F;etc&#x2F;fstab</span><br></pre></td></tr></table></figure><h3 id="Change-root-到新安装的系统"><a href="#Change-root-到新安装的系统" class="headerlink" title="Change root 到新安装的系统"></a>Change root 到新安装的系统</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arch-chroot &#x2F;mnt</span><br><span class="line">pacman -S vim net-tools</span><br></pre></td></tr></table></figure><h3 id="Locale"><a href="#Locale" class="headerlink" title="Locale"></a>Locale</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑地区信息生成文件</span></span><br><span class="line">vim /etc/locale.gen</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成地区信息</span></span><br><span class="line">locale-gen</span><br><span class="line"><span class="comment"># 写进配置文件</span></span><br><span class="line"><span class="built_in">echo</span> LANG=zh_CN.UTF-8 &gt; /etc/locale.conf</span><br></pre></td></tr></table></figure><h3 id="设置时区"><a href="#设置时区" class="headerlink" title="设置时区"></a>设置时区</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -S &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Shanghai &#x2F;etc&#x2F;localtime</span><br><span class="line">hwclock --localtime</span><br></pre></td></tr></table></figure><h3 id="主机名"><a href="#主机名" class="headerlink" title="主机名"></a>主机名</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo myhostname &gt; &#x2F;etc&#x2F;hostname</span><br><span class="line">vim &#x2F;etc&#x2F;hosts</span><br></pre></td></tr></table></figure><h3 id="Root-密码"><a href="#Root-密码" class="headerlink" title="Root 密码"></a>Root 密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd</span><br></pre></td></tr></table></figure><h3 id="安装-GRUB"><a href="#安装-GRUB" class="headerlink" title="安装 GRUB"></a>安装 GRUB</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pacman -S grub-efi-x86_64</span><br><span class="line">pacman -S efibootmgr</span><br><span class="line">grub-install --efi-directory=/boot/efi --bootloader-id=arch --recheck</span><br><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure><h3 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br><span class="line">umount &#x2F;mnt&#x2F;boot&#x2F;efi</span><br><span class="line">umount &#x2F;mnt&#x2F;boot</span><br><span class="line">umount &#x2F;mnt</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h2 id="安装图形化界面"><a href="#安装图形化界面" class="headerlink" title="安装图形化界面"></a>安装图形化界面</h2><h3 id="设置-archlinux-源"><a href="#设置-archlinux-源" class="headerlink" title="设置 archlinux 源"></a>设置 archlinux 源</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;pacman.d&#x2F;mirrorlist</span><br></pre></td></tr></table></figure><h3 id="更新源并且安装yaourt"><a href="#更新源并且安装yaourt" class="headerlink" title="更新源并且安装yaourt:"></a>更新源并且安装yaourt:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -Syu yaourt</span><br></pre></td></tr></table></figure><h3 id="安装驱动"><a href="#安装驱动" class="headerlink" title="安装驱动"></a>安装驱动</h3><ul><li>触摸板驱动</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S xf86-input-libinput xf86-input-synaptics</span><br></pre></td></tr></table></figure><ul><li>显示驱动</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pacman -S xf86-video-intel</span><br><span class="line">pacman -S mesa-libgl libva-intel-driver libvdpau-va-glmesa-demos</span><br><span class="line">pacman -S nvidia nvidia-settings</span><br></pre></td></tr></table></figure><ul><li>声音</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S alsa-utils</span><br></pre></td></tr></table></figure><ul><li>无线网卡安装BCM4322</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pacman -S linux-firmware</span><br><span class="line">pacman -S linux-headers</span><br><span class="line">yaourt -S broadcom-wl-dkms</span><br></pre></td></tr></table></figure><ul><li>安装Deepin桌面环境</li></ul><p>1.安装Xorg和其工具包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S xorg-server xorg-xinit</span><br></pre></td></tr></table></figure><p>2.DDE基本环境安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pacman -S deepin deepin-extra lightdm</span><br><span class="line">pacman -S file-roller evince gedit thunderbird gpicview</span><br><span class="line">pacman -S unrar unzip p7zip</span><br></pre></td></tr></table></figure><p>3.修改lightdm.conf使用登录管理器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;lightdm&#x2F;lightdm.conf</span><br><span class="line">greeter-session&#x3D;lightdm-deepin-greeter</span><br><span class="line">systemctl enable lightdm</span><br></pre></td></tr></table></figure><p>4.配置网络连接</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pacman -S networkmanager</span><br><span class="line">systemctl enable NetworkManager</span><br></pre></td></tr></table></figure><ul><li>安装常用软件</li></ul><p>1.搜狗输入法安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pacman -S fcitx fcitx-configtool</span><br><span class="line">pacman -S fcitx-sougoupinyin</span><br></pre></td></tr></table></figure><p>在用户目录下添加个配置文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nano ~&#x2F;.xprofile</span><br><span class="line">export GTK_IM_MODULE&#x3D;fcitx</span><br><span class="line">export QT_IM_MODULE&#x3D;fcitx</span><br><span class="line">export XMODIFIERS&#x3D;@im&#x3D;fcitx</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S opencc  （简体和繁体互相转换的库）</span><br></pre></td></tr></table></figure><p>2.浏览器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pacman -S chromium</span><br><span class="line">pacman -S google-chrome</span><br><span class="line">pacman -S firefox</span><br><span class="line">pacman -S git</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 文本处理器之 awk</title>
      <link href="2018/12/15/awk/"/>
      <url>2018/12/15/awk/</url>
      
        <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">awk  <span class="string">'BEGIN&#123;FS="[:]"&#125; &#123;aa+=$3&#125; END&#123;print "所用的UID的和是:",aa&#125;'</span> passwd</span><br><span class="line">FSawk <span class="string">'BEGIN&#123;FS="[:]"&#125; /root/&#123;print $1,$2&#125;'</span> passwd</span><br><span class="line">OFSawk <span class="string">'BEGIN&#123;FS="[:]";OFS="---"&#125; /root/&#123;print $1,$2&#125;'</span> passwd</span><br><span class="line">NFawk -F: <span class="string">'&#123;print NF&#125;'</span> passwd</span><br><span class="line">RSawk <span class="string">'BEGIN&#123;FS="[,]";RS=" "&#125;&#123;print $2&#125;'</span> bb.txt</span><br><span class="line">ORSawk <span class="string">'BEGIN&#123;FS="[:]";ORS="---"&#125;&#123;print $0&#125;'</span> passwd</span><br><span class="line">FILENAMEawk -F<span class="string">"[:]"</span> <span class="string">'&#123;print FILENAME&#125;'</span> passwd</span><br><span class="line">NRawk <span class="string">'&#123;print NR&#125;'</span> a.txt b.txt</span><br><span class="line">FNRawk <span class="string">'&#123;print NR&#125;'</span> a.txt b.txt</span><br><span class="line"><span class="comment"># NR==FNR 此时处理的是第一个文件</span></span><br><span class="line"><span class="comment"># NR!=FNR 此时处理的是第二个文件</span></span><br><span class="line">awk <span class="string">'NR==FNR&#123;print FILENAME&#125; NR!=FNR&#123;print FILENAME&#125;'</span> a.txt b.txt</span><br><span class="line"><span class="keyword">if</span>awk -F[:] <span class="string">'&#123;if($3&lt;=1000)&#123;print $1"是root用户"&#125;else&#123;print $1"是普通用户"&#125;&#125;'</span> /etc/passwd</span><br></pre></td></tr></table></figure><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>变量名</td><td>属性</td></tr><tr><td>$0</td><td>当前记录</td></tr><tr><td>$1~$n</td><td>当前记录的第n个字段</td></tr><tr><td>FS</td><td>输入字段分隔符，默认为空格</td></tr><tr><td>RS</td><td>输入记录分割符，默认为换行符</td></tr><tr><td>NF</td><td>当前记录中的字段个数，就是有多少列</td></tr><tr><td>NR</td><td>已经读出的记录数，就是行号，从1开始</td></tr><tr><td>OFS</td><td>输出字符分隔符，默认也是空格</td></tr><tr><td>ORS</td><td>输出的记录分隔符，默认为换行符</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS Oracle 12c 安装指南</title>
      <link href="2018/12/14/centos_install_oracle12c/"/>
      <url>2018/12/14/centos_install_oracle12c/</url>
      
        <content type="html"><![CDATA[<h2 id="1-优化、安装必要的工具"><a href="#1-优化、安装必要的工具" class="headerlink" title="1. 优化、安装必要的工具"></a>1. 优化、安装必要的工具</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ yum -y install unzip vim lrzsz</span><br><span class="line">[root@oracle12c ~]$ setenforce 0</span><br><span class="line">[root@oracle12c ~]$ sed -i &#39;s&#x2F;SELINUX&#x3D;enforcing&#x2F;SELINUX&#x3D;disabled&#x2F;&#39; &#x2F;etc&#x2F;selinux&#x2F;config</span><br><span class="line">[root@oracle12c ~]$ reboot</span><br><span class="line">[root@oracle12c ~]$ sed -i &#39;s&#x2F;^GSSAPIAuthentication yes$&#x2F;GSSAPIAuthentication no&#x2F;&#39; &#x2F;etc&#x2F;ssh&#x2F;sshd_config</span><br><span class="line">[root@oracle12c ~]$ sed -i &#39;s&#x2F;#UseDNS yes&#x2F;UseDNS no&#x2F;&#39; &#x2F;etc&#x2F;ssh&#x2F;sshd_config</span><br><span class="line">[root@oracle12c ~]$ service sshd restart</span><br></pre></td></tr></table></figure><h2 id="2-安装依赖"><a href="#2-安装依赖" class="headerlink" title="2. 安装依赖"></a>2. 安装依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ yum -y install binutils compat-libcap1 compat-libstdc++-33 compat-libstdc++-33*.i686 elfutils-libelf-devel gcc gcc-c++ glibc*.i686 glibc glibc-devel glibc-devel*.i686 ksh libgcc*.i686 libgcc libstdc++ libstdc++*.i686 libstdc++-devel libstdc++-devel*.i686 libaio libaio*.i686 libaio-devel libaio-devel*.i686 make sysstat unixODBC unixODBC*.i686 unixODBC-devel unixODBC-devel*.i686 libXp</span><br></pre></td></tr></table></figure><h2 id="3-建立用户和组"><a href="#3-建立用户和组" class="headerlink" title="3. 建立用户和组"></a>3. 建立用户和组</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ groupadd oinstall</span><br><span class="line">[root@oracle12c ~]$ groupadd dba</span><br><span class="line">[root@oracle12c ~]$ groupadd oper</span><br><span class="line">[root@oracle12c ~]$ useradd -g oinstall -G dba,oper oracle</span><br><span class="line">[root@oracle12c ~]$ echo oracle | passwd --stdin oracle</span><br></pre></td></tr></table></figure><h2 id="4-创建安装、备份目录"><a href="#4-创建安装、备份目录" class="headerlink" title="4. 创建安装、备份目录"></a>4. 创建安装、备份目录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ mkdir -p &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;12.2.0</span><br><span class="line">[root@oracle12c ~]$ chown -R oracle:oinstall &#x2F;u01</span><br></pre></td></tr></table></figure><h2 id="5-更改共享内存"><a href="#5-更改共享内存" class="headerlink" title="5. 更改共享内存"></a>5. 更改共享内存</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ echo &quot;shmfs &#x2F;dev&#x2F;shm tmpfs size&#x3D;12g 0&quot; &gt;&gt; &#x2F;etc&#x2F;fstab</span><br></pre></td></tr></table></figure><h2 id="6-修改内核参数"><a href="#6-修改内核参数" class="headerlink" title="6. 修改内核参数"></a>6. 修改内核参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ vim &#x2F;etc&#x2F;sysctl.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fs.file-max &#x3D; 6815744</span><br><span class="line">kernel.sem &#x3D; 250 32000 100 128</span><br><span class="line">kernel.shmmni &#x3D; 4096</span><br><span class="line">kernel.shmall &#x3D; 4294967296</span><br><span class="line">kernel.shmmax &#x3D; 4398046511104</span><br><span class="line">kernel.panic_on_oops &#x3D; 1</span><br><span class="line">net.core.rmem_default &#x3D; 262144</span><br><span class="line">net.core.rmem_max &#x3D; 4194304</span><br><span class="line">net.core.wmem_default &#x3D; 262144</span><br><span class="line">net.core.wmem_max &#x3D; 1048576</span><br><span class="line">net.ipv4.conf.all.rp_filter &#x3D; 2</span><br><span class="line">net.ipv4.conf.default.rp_filter &#x3D; 2</span><br><span class="line">fs.aio-max-nr &#x3D; 1048576</span><br><span class="line">net.ipv4.ip_local_port_range &#x3D; 9000 65500</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ sysctl -p</span><br></pre></td></tr></table></figure><h2 id="7-改文件限制"><a href="#7-改文件限制" class="headerlink" title="7. 改文件限制"></a>7. 改文件限制</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ vim &#x2F;etc&#x2F;security&#x2F;limits.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">oracle soft nproc 2047</span><br><span class="line">oracle hard nproc 16384</span><br><span class="line">oracle soft nofile 1024</span><br><span class="line">oracle hard nofile 65536</span><br><span class="line">oracle soft stack 10240</span><br></pre></td></tr></table></figure><h2 id="8-修改登陆配置文件"><a href="#8-修改登陆配置文件" class="headerlink" title="8. 修改登陆配置文件"></a>8. 修改登陆配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ vim &#x2F;etc&#x2F;pam.d&#x2F;login</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session required pam_limits.so</span><br></pre></td></tr></table></figure><h2 id="9-修改-ulimit"><a href="#9-修改-ulimit" class="headerlink" title="9. 修改 ulimit"></a>9. 修改 ulimit</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ vim &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if [ $USER &#x3D; &quot;oracle&quot; ]; then</span><br><span class="line">    if [ $SHELL &#x3D; &quot;&#x2F;bin&#x2F;ksh&quot; ]; then</span><br><span class="line">        ulimit -p 16384</span><br><span class="line">        ulimit -n 65536a</span><br><span class="line">    else</span><br><span class="line">        ulimit -u 16384 -n 65536</span><br><span class="line">    fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h2 id="10-修改环境变量"><a href="#10-修改环境变量" class="headerlink" title="10. 修改环境变量"></a>10. 修改环境变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ vim ~&#x2F;.bash_profile</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PATH&#x3D;$PATH:$HOME&#x2F;.local&#x2F;bin:$HOME&#x2F;bin:$ORACLE_HOME&#x2F;bin</span><br><span class="line">ORACLE_BASE&#x3D;&#x2F;u01&#x2F;app&#x2F;oracle</span><br><span class="line">ORACLE_HOME&#x3D;$ORACLE_BASE&#x2F;product&#x2F;12.2.0</span><br><span class="line">ORACLE_SID&#x3D;orcl</span><br><span class="line">export ORACLE_BASE ORACLE_HOME ORACLE_SID</span><br><span class="line">export NLS_LANG&#x3D;&quot;AMERICAN_AMERICA.UTF8&quot;</span><br><span class="line">export PATH</span><br></pre></td></tr></table></figure><h2 id="11-修改-hosts-文件"><a href="#11-修改-hosts-文件" class="headerlink" title="11. 修改 hosts 文件"></a>11. 修改 hosts 文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ vim &#x2F;etc&#x2F;hosts</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ipaddr] oracle12c</span><br></pre></td></tr></table></figure><h2 id="12-上传安装包-linuxx64-12201-database-zip"><a href="#12-上传安装包-linuxx64-12201-database-zip" class="headerlink" title="12. 上传安装包 linuxx64_12201_database.zip"></a>12. 上传安装包 linuxx64_12201_database.zip</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oracle12c ~]$ rz</span><br></pre></td></tr></table></figure><h2 id="13-静默安装数据库软件"><a href="#13-静默安装数据库软件" class="headerlink" title="13. 静默安装数据库软件"></a>13. 静默安装数据库软件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oracle12c ~]$ cd database</span><br><span class="line">[oracle@oracle12c database]$ .&#x2F;runInstaller  -silent -ignoreSysPrereqs -ignorePrereq -responseFile &#x2F;home&#x2F;oracle&#x2F;database&#x2F;response&#x2F;db_install.rsp</span><br></pre></td></tr></table></figure><p>/home/oracle/database/response/db_install.rsp</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">oracle.install.responseFileVersion&#x3D;&#x2F;oracle&#x2F;install&#x2F;rspfmt_dbinstall_response_schema_v12.2.0</span><br><span class="line">oracle.install.option&#x3D;INSTALL_DB_SWONLY</span><br><span class="line">UNIX_GROUP_NAME&#x3D;dba</span><br><span class="line">INVENTORY_LOCATION&#x3D;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oraInventory</span><br><span class="line">ORACLE_HOME&#x3D;&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;12.2.0</span><br><span class="line">ORACLE_BASE&#x3D;&#x2F;u01&#x2F;app&#x2F;oracle</span><br><span class="line">oracle.install.db.InstallEdition&#x3D;EE</span><br><span class="line">oracle.install.db.OSDBA_GROUP&#x3D;dba</span><br><span class="line">oracle.install.db.OSOPER_GROUP&#x3D;dba</span><br><span class="line">oracle.install.db.OSBACKUPDBA_GROUP&#x3D;dba</span><br><span class="line">oracle.install.db.OSDGDBA_GROUP&#x3D;dba</span><br><span class="line">oracle.install.db.OSKMDBA_GROUP&#x3D;dba</span><br><span class="line">oracle.install.db.OSRACDBA_GROUP&#x3D;dba</span><br><span class="line">oracle.install.db.CLUSTER_NODES&#x3D;</span><br><span class="line">oracle.install.db.isRACOneInstall&#x3D;false</span><br><span class="line">SECURITY_UPDATES_VIA_MYORACLESUPPORT&#x3D;false</span><br><span class="line">DECLINE_SECURITY_UPDATES&#x3D;true</span><br></pre></td></tr></table></figure><h2 id="14-建立数据库"><a href="#14-建立数据库" class="headerlink" title="14. 建立数据库"></a>14. 建立数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oracle12c ~]$ $ORACLE_HOME&#x2F;bin&#x2F;dbca -silent -createDatabase -templateName General_Purpose.dbc -gdbname orcl -sid orcl -responseFile NO_VALUE -characterSet AL32UTF8 -memoryPercentage 50 -emConfiguration LOCAL</span><br></pre></td></tr></table></figure><p>root 用户下执行以下命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ &#x2F;oracle&#x2F;oraInventory&#x2F;orainstRoot.sh</span><br><span class="line">[root@oracle12c ~]$ &#x2F;oracle&#x2F;product&#x2F;12.2.0&#x2F;root.sh</span><br></pre></td></tr></table></figure><h2 id="15-修改参数"><a href="#15-修改参数" class="headerlink" title="15. 修改参数"></a>15. 修改参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[oracle@oracle12c ~]$ sqlplus &#x2F; as sysdba</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; alter system set sga_target=0 scope=spfile;</span><br><span class="line">SQL&gt; alter system set pga_aggregate_target=0 scope=spfile;</span><br><span class="line">SQL&gt; alter system set db_files=2000 scope=spfile;</span><br><span class="line">SQL&gt; alter system set memory_max_target=12g scope=spfile;</span><br><span class="line">SQL&gt; alter system set memory_target=8g scope=spfile;</span><br><span class="line">SQL&gt; alter system set LOG_ARCHIVE_DEST_1='LOCATION=/backup/arch' scope=spfile;</span><br><span class="line">SQL&gt; alter SYSTEM set db_recovery_file_dest_size=4096M scope=spfile;</span><br><span class="line">SQL&gt; alter system set undo_retention=3600 scope=spfile;</span><br><span class="line">SQL&gt; alter system set processes=6000 scope=spfile;</span><br><span class="line">SQL&gt; alter system set sessions=8000 scope=spfile;</span><br><span class="line">SQL&gt; alter system set open_cursors=2000 scope=both;</span><br><span class="line">SQL&gt; create pfile='/tmp/pfile01.ora' from spfile;</span><br><span class="line">SQL&gt; alter system set filesystemio_options='asynch' scope=spfile;</span><br><span class="line">SQL&gt; alter system set disk_asynch_io=true SCOPE=SPFILE;</span><br><span class="line">SQL&gt; create directory expdp_dir as '/backup/expdp';</span><br><span class="line">SQL&gt; grant write,read on directory expdp_dir to public;</span><br><span class="line">SQL&gt; alter database add logfile group 4 '/u01/app/oracle/oradata/orcl/redo04.log' size 1G;</span><br><span class="line">SQL&gt; alter database add logfile group 5 '/u01/app/oracle/oradata/orcl/redo05.log' size 1G;</span><br><span class="line">SQL&gt; alter database add logfile group 6 '/u01/app/oracle/oradata/orcl/redo06.log' size 1G;</span><br><span class="line">SQL&gt; alter system switch logfile;</span><br><span class="line">SQL&gt; alter system switch logfile;</span><br><span class="line">SQL&gt; alter system switch logfile;</span><br><span class="line">SQL&gt; alter system checkpoint;</span><br><span class="line">SQL&gt; alter database drop logfile group 1;</span><br><span class="line">SQL&gt; alter database drop logfile group 2;</span><br><span class="line">SQL&gt; alter database drop logfile group 3;</span><br><span class="line">SQL&gt; host rm -rf /u01/app/oracle/oradata/orcl/redo0[1-3].log</span><br><span class="line">SQL&gt; alter database add logfile group 1 '/u01/app/oracle/oradata/orcl/redo01.log' size  1G;</span><br><span class="line">SQL&gt; alter database add logfile group 2 '/u01/app/oracle/oradata/orcl/redo02.log' size  1G;</span><br><span class="line">SQL&gt; alter database add logfile group 3 '/u01/app/oracle/oradata/orcl/redo03.log' size  1G; </span><br><span class="line">SQL&gt; alter system switch logfile;</span><br><span class="line">SQL&gt; alter system switch logfile;</span><br><span class="line">SQL&gt; alter system switch logfile;</span><br><span class="line">SQL&gt; alter system checkpoint;</span><br><span class="line">SQL&gt; shutdown immediate</span><br><span class="line">SQL&gt; startup mount</span><br><span class="line">SQL&gt; alter database archivelog;</span><br><span class="line">SQL&gt; alter database open;</span><br><span class="line">SQL&gt; alter profile default limit FAILED_LOGIN_ATTEMPTS unlimited;</span><br><span class="line">SQL&gt; create pfile='/tmp/pfile02.ora' from spfile;</span><br></pre></td></tr></table></figure><h2 id="16-修改-Oracle-服务启动配置"><a href="#16-修改-Oracle-服务启动配置" class="headerlink" title="16. 修改 Oracle 服务启动配置"></a>16. 修改 Oracle 服务启动配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@oracle12c ~]$ vim &#x2F;etc&#x2F;oratab</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orcl:&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;12.2.0:Y</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> oracle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker 入坑指南</title>
      <link href="2018/12/12/docker/"/>
      <url>2018/12/12/docker/</url>
      
        <content type="html"><![CDATA[<h2 id="1-Docker-安装"><a href="#1-Docker-安装" class="headerlink" title="1. Docker 安装"></a>1. Docker 安装</h2><ul><li>Ubuntu</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># step 1: 安装必要的一些系统工具</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt -y install apt-transport-https ca-certificates curl software-properties-common</span><br><span class="line"><span class="comment"># step 2: 安装GPG证书</span></span><br><span class="line">curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line"><span class="comment"># Step 3: 写入软件源信息</span></span><br><span class="line">sudo add-apt-repository <span class="string">"deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class="variable">$(lsb_release -cs)</span> stable"</span></span><br><span class="line"><span class="comment"># Step 4: 更新并安装 Docker-CE</span></span><br><span class="line">sudo apt -y update</span><br><span class="line">sudo apt -y install docker-ce</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装指定版本的Docker-CE:</span></span><br><span class="line"><span class="comment"># Step 1: 查找Docker-CE的版本:</span></span><br><span class="line"><span class="comment"># apt-cache madison docker-ce</span></span><br><span class="line"><span class="comment">#   docker-ce | 17.03.1~ce-0~ubuntu-xenial | http://mirrors.aliyun.com/docker-ce/linux/ubuntu xenial/stable amd64 Packages</span></span><br><span class="line"><span class="comment">#   docker-ce | 17.03.0~ce-0~ubuntu-xenial | http://mirrors.aliyun.com/docker-ce/linux/ubuntu xenial/stable amd64 Packages</span></span><br><span class="line"><span class="comment"># Step 2: 安装指定版本的Docker-CE: (VERSION 例如上面的 17.03.1~ce-0~ubuntu-xenial)</span></span><br><span class="line"><span class="comment"># sudo apt-get -y install docker-ce=[VERSION]</span></span><br></pre></td></tr></table></figure><ul><li>CentOS</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># step 1: 安装必要的一些系统工具</span></span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"><span class="comment"># Step 2: 添加软件源信息</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="comment"># Step 3: 更新并安装 Docker-CE</span></span><br><span class="line">yum makecache fast</span><br><span class="line">yum -y install docker-ce</span><br><span class="line"><span class="comment"># Step 4: 开启Docker服务</span></span><br><span class="line">service docker start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：</span></span><br><span class="line"><span class="comment"># 官方软件源默认启用了最新的软件，您可以通过编辑软件源的方式获取各个版本的软件包。例如官方并没有将测试版本的软件源置为可用，你可以通过以下方式开启。同理可以开启各种测试版本等。</span></span><br><span class="line"><span class="comment"># vim /etc/yum.repos.d/docker-ce.repo</span></span><br><span class="line"><span class="comment">#   将 [docker-ce-test] 下方的 enabled=0 修改为 enabled=1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 安装指定版本的Docker-CE:</span></span><br><span class="line"><span class="comment"># Step 1: 查找Docker-CE的版本:</span></span><br><span class="line"><span class="comment"># yum list docker-ce.x86_64 --showduplicates | sort -r</span></span><br><span class="line"><span class="comment">#   Loading mirror speeds from cached hostfile</span></span><br><span class="line"><span class="comment">#   Loaded plugins: branch, fastestmirror, langpacks</span></span><br><span class="line"><span class="comment">#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            docker-ce-stable</span></span><br><span class="line"><span class="comment">#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            @docker-ce-stable</span></span><br><span class="line"><span class="comment">#   docker-ce.x86_64            17.03.0.ce-1.el7.centos            docker-ce-stable</span></span><br><span class="line"><span class="comment">#   Available Packages</span></span><br><span class="line"><span class="comment"># Step2 : 安装指定版本的Docker-CE: (VERSION 例如上面的 17.03.0.ce.1-1.el7.centos)</span></span><br><span class="line"><span class="comment"># sudo yum -y install docker-ce-[VERSION]</span></span><br></pre></td></tr></table></figure><h2 id="2-非-root-用户使用-Docker"><a href="#2-非-root-用户使用-Docker" class="headerlink" title="2. 非 root 用户使用 Docker"></a>2. 非 root 用户使用 Docker</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将用户加入 docker 组</span></span><br><span class="line">sudo usermod -aG docker &lt;your-user&gt;</span><br></pre></td></tr></table></figure><h2 id="3-常见问题"><a href="#3-常见问题" class="headerlink" title="3. 常见问题"></a>3. 常见问题</h2><ul><li>防火墙的问题</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS 7 firewalld 设置，添加相应端口</span></span><br><span class="line">firewall-cmd --permanent --add-port 80/tcp</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><ul><li>IPv4 forwarding is disabled. Networking will not work.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim  /usr/lib/sysctl.d/00-system.conf 在最后添加一行</span></span><br><span class="line">net.ipv4.ip_forward=1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建基于 HDFS 碎片文件存储服务</title>
      <link href="2018/12/10/hdfs/"/>
      <url>2018/12/10/hdfs/</url>
      
        <content type="html"><![CDATA[<h2 id="准备-Java-环境"><a href="#准备-Java-环境" class="headerlink" title="准备 Java 环境"></a>准备 Java 环境</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install java-1.8.0-openjdk*</span><br><span class="line">java -version</span><br><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure><figure class="highlight profile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/lib/jvm/jre<span class="number">-1.8</span><span class="number">.0</span>-openjdk</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><h2 id="准备-HDFS-环境"><a href="#准备-HDFS-环境" class="headerlink" title="准备 HDFS 环境"></a>准备 HDFS 环境</h2><h3 id="配置-SSH"><a href="#配置-SSH" class="headerlink" title="配置 SSH"></a>配置 SSH</h3><p>先后执行如下两行命令，配置 SSH 以无密码模式登陆：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t dsa -P <span class="string">''</span> -f ~/.ssh/id_dsa</span><br><span class="line">cat ~/.ssh/id_dsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>接着可以验证下，在不输入密码的情况下，应该能使用 ssh 命令成功连接本机：</p><h3 id="安装-Hadoop"><a href="#安装-Hadoop" class="headerlink" title="安装 Hadoop"></a>安装 Hadoop</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 /data/hadoop 目录，然后进入该目录：</span></span><br><span class="line">mkdir -p /data/hadoop &amp;&amp; <span class="built_in">cd</span> <span class="variable">$_</span></span><br><span class="line"><span class="comment"># 下载并解压 Hadoop：</span></span><br><span class="line">wget http://archive.apache.org/dist/hadoop/core/hadoop-2.7.1/hadoop-2.7.1.tar.gz</span><br><span class="line">tar -zxvf hadoop-2.7.1.tar.gz</span><br><span class="line">mv hadoop-2.7.1 hadoop &amp;&amp; mv <span class="variable">$_</span> /usr/<span class="built_in">local</span>/</span><br></pre></td></tr></table></figure><p>修改 Hadoop 环境配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/hadoop/etc/hadoop/hadoop-env.sh</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;jre-1.8.0-openjdk</span><br></pre></td></tr></table></figure><p>查看下 Hadoop 的版本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/hadoop/bin/hadoop version</span><br></pre></td></tr></table></figure><h2 id="修改-Hadoop-配置"><a href="#修改-Hadoop-配置" class="headerlink" title="修改 Hadoop 配置"></a>修改 Hadoop 配置</h2><p>由于我们的实践环境是在单机下进行的，所以此处把 Hadoop 配置为伪分布式模式。<br>新建若干临时文件夹，我们在后续的配置中以及 HDFS 和 Hadoop 的启动过程中会使用到这些文件夹：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/hadoop &amp;&amp; mkdir -p tmp dfs/name dfs/data</span><br></pre></td></tr></table></figure><p>修改 HDFS 配置文件 core-site.xml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/hadoop/etc/hadoop/core-site.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/hadoop/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://localhost:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>修改 HDFS 配置文件 hdfs-site.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;usr&#x2F;local&#x2F;hadoop&#x2F;etc&#x2F;hadoop&#x2F;hdfs-site.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/usr/local/hadoop/dfs/name<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/usr/local/hadoop/dfs/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.permissions<span class="tag">&lt;/<span class="name">name</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>修改 HDFS 配置文件 yarn-site.xml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/hadoop/etc/hadoop/yarn-site.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>启动 Hadoop</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/hadoop/bin/</span><br><span class="line"><span class="comment"># 对 HDFS 文件系统进行格式化：</span></span><br><span class="line">./hdfs namenode -format</span><br><span class="line"><span class="comment"># 接着进入如下目录</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/hadoop/sbin/</span><br><span class="line"><span class="comment"># 先后执行如下两个脚本启动 Hadoop</span></span><br><span class="line">./start-dfs.sh</span><br><span class="line">./start-yarn.sh</span><br><span class="line"><span class="comment"># 验证 Hadoop 是否启动成功：</span></span><br><span class="line">jps</span><br></pre></td></tr></table></figure><p>在浏览器中访问如下链接，应该能正常访问：</p><p>http://&lt;您的 IP 地址&gt;:50070/explorer.html#/<br>接下来，我们实践下如何将碎片文件存储到 HDFS 中。</p><h2 id="存储碎片文件"><a href="#存储碎片文件" class="headerlink" title="存储碎片文件"></a>存储碎片文件</h2><h3 id="准备碎片文件"><a href="#准备碎片文件" class="headerlink" title="准备碎片文件"></a>准备碎片文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建目录用于存放碎片文件，进入该目录：</span></span><br><span class="line"></span><br><span class="line">mkdir -p /data/file &amp;&amp; <span class="built_in">cd</span> /data/file</span><br><span class="line"><span class="comment"># 新建一批碎片文件到该目录下</span></span><br><span class="line">i=1; <span class="keyword">while</span> [ <span class="variable">$i</span> -le 99 ]; <span class="keyword">do</span> name=`<span class="built_in">printf</span> <span class="string">"test%02d.txt"</span>  <span class="variable">$i</span>`; touch <span class="string">"<span class="variable">$name</span>"</span>; i=$((<span class="variable">$i</span>+1)); <span class="keyword">done</span></span><br><span class="line">ls</span><br></pre></td></tr></table></figure><h3 id="将碎片文件存储在-HDFS-中"><a href="#将碎片文件存储在-HDFS-中" class="headerlink" title="将碎片文件存储在 HDFS 中"></a>将碎片文件存储在 HDFS 中</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 HDFS 上新建目录</span></span><br><span class="line">/usr/<span class="built_in">local</span>/hadoop/bin/hadoop fs -mkdir /dest</span><br></pre></td></tr></table></figure><p>此时，在浏览器是访问如下链接，可以看到 /dest 目录已创建，但是暂时还没有内容：</p><p>http://&lt;您的 IP 地址&gt;:50070/explorer.html#/dest  </p><h3 id="上传碎片文件"><a href="#上传碎片文件" class="headerlink" title="上传碎片文件"></a>上传碎片文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">groupadd supergroup</span><br><span class="line">usermod -a -G supergroup root</span><br><span class="line"><span class="comment"># 将之前创建的碎片文件上传到 HDFS 中：</span></span><br><span class="line"><span class="built_in">cd</span> /data/file &amp;&amp; /usr/<span class="built_in">local</span>/hadoop/bin/hadoop fs -put *.txt /dest</span><br><span class="line">/usr/<span class="built_in">local</span>/hadoop/bin/hadoop fs -ls /dest</span><br><span class="line"><span class="comment"># 在上传之前，我们需先创建 HDFS 用户组 supergroup，然后将 root 用户添加到该组中，否则会因权限问题页报告异常。</span></span><br></pre></td></tr></table></figure><h3 id="访问服务"><a href="#访问服务" class="headerlink" title="访问服务"></a>访问服务</h3><p>在浏览器是访问如下链接，可以看到 /dest 目录的文件内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;&lt;您的 IP 地址&gt;:50070&#x2F;explorer.html#&#x2F;dest</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hadoop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo 打造静态博客</title>
      <link href="2018/12/09/hexo/"/>
      <url>2018/12/09/hexo/</url>
      
        <content type="html"><![CDATA[<p>使用 Hexo 打造静态博客</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><h2 id="修改主页配置文件-config-yml"><a href="#修改主页配置文件-config-yml" class="headerlink" title="修改主页配置文件 _config.yml"></a>修改主页配置文件 _config.yml</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post_asset_folder : true</span><br></pre></td></tr></table></figure><h2 id="安装本地图片插件"><a href="#安装本地图片插件" class="headerlink" title="安装本地图片插件"></a>安装本地图片插件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-asset-image --save</span><br></pre></td></tr></table></figure><h2 id="生成新的博文"><a href="#生成新的博文" class="headerlink" title="生成新的博文"></a>生成新的博文</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo n &quot;xxx&quot;</span><br></pre></td></tr></table></figure><p>此时 /source/_posts/ 下会生成同名文件夹</p><h2 id="博文引入图片"><a href="#博文引入图片" class="headerlink" title="博文引入图片"></a>博文引入图片</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](xxx&#x2F;xxx.jpg)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>给 history 添加时间戳</title>
      <link href="2018/12/08/bash_history/"/>
      <url>2018/12/08/bash_history/</url>
      
        <content type="html"><![CDATA[<h2 id="添加环境变量"><a href="#添加环境变量" class="headerlink" title="添加环境变量"></a>添加环境变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]# vim &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HISTTIMEFORMAT=<span class="string">"%Y-%m-%d %H:%M:%S"</span></span><br><span class="line"><span class="built_in">export</span> HISTTIMEFORMAT</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jekyll 打造静态博客</title>
      <link href="2018/12/07/jekyll/"/>
      <url>2018/12/07/jekyll/</url>
      
        <content type="html"><![CDATA[<h2 id="1-安装之前先安装依赖包"><a href="#1-安装之前先安装依赖包" class="headerlink" title="1. 安装之前先安装依赖包"></a>1. 安装之前先安装依赖包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ruby ruby-dev build-essential</span><br></pre></td></tr></table></figure><h2 id="2-添加环境变量"><a href="#2-添加环境变量" class="headerlink" title="2. 添加环境变量"></a>2. 添加环境变量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'# Install Ruby Gems to ~/gems'</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export GEM_HOME=$HOME/gems'</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH=$HOME/gems/bin:$PATH'</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><h2 id="3-安装-Jekyll"><a href="#3-安装-Jekyll" class="headerlink" title="3. 安装 Jekyll"></a>3. 安装 Jekyll</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem install jekyll bundler</span><br></pre></td></tr></table></figure><h2 id="4-使用-bundle-更新-Jekyll"><a href="#4-使用-bundle-更新-Jekyll" class="headerlink" title="4. 使用 bundle 更新 Jekyll"></a>4. 使用 bundle 更新 Jekyll</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jekyll --version</span><br><span class="line">gem list jekyll</span><br><span class="line">bundle update jekyll</span><br></pre></td></tr></table></figure><h2 id="5-使用-gem-更新-Jekyll"><a href="#5-使用-gem-更新-Jekyll" class="headerlink" title="5. 使用 gem 更新 Jekyll"></a>5. 使用 gem 更新 Jekyll</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem update jekyll</span><br></pre></td></tr></table></figure><h2 id="6-更新-Rubygems"><a href="#6-更新-Rubygems" class="headerlink" title="6. 更新 Rubygems"></a>6. 更新 Rubygems</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem update --system</span><br></pre></td></tr></table></figure><h2 id="7-安装预览版"><a href="#7-安装预览版" class="headerlink" title="7. 安装预览版"></a>7. 安装预览版</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装最新预览版</span></span><br><span class="line">gem install jekyll --pre</span><br><span class="line"><span class="comment">## 安装特定版本的 Jekyll</span></span><br><span class="line">gem install jekyll -v <span class="string">'2.0.0.alpha.1'</span></span><br></pre></td></tr></table></figure><h2 id="8-源码安装"><a href="#8-源码安装" class="headerlink" title="8. 源码安装"></a>8. 源码安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git://github.com/jekyll/jekyll.git</span><br><span class="line"><span class="built_in">cd</span> jekyll</span><br><span class="line">script/bootstrap</span><br><span class="line">bundle <span class="built_in">exec</span> rake build</span><br><span class="line">ls pkg/*.gem | head -n 1 | xargs gem install -l</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ruby </tag>
            
            <tag> jekyll </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Keepalive 安装与配置</title>
      <link href="2018/12/06/keepalive/"/>
      <url>2018/12/06/keepalive/</url>
      
        <content type="html"><![CDATA[<p>Keepalive 安装与配置</p><a id="more"></a><h2 id="1-安装-keepalive"><a href="#1-安装-keepalive" class="headerlink" title="1. 安装 keepalive"></a>1. 安装 keepalive</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]# yum -y install keepalived</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> keepalive </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 网络管理</title>
      <link href="2018/12/05/managenetwork/"/>
      <url>2018/12/05/managenetwork/</url>
      
        <content type="html"><![CDATA[<p>Linux 网络管理</p><a id="more"></a><h2 id="1-arp：管理系统中的-ARP-高速缓存"><a href="#1-arp：管理系统中的-ARP-高速缓存" class="headerlink" title="1. arp：管理系统中的 ARP 高速缓存"></a>1. <code>arp</code>：管理系统中的 ARP 高速缓存</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line">  arp [-vn]  [&lt;HW&gt;] [-i &lt;if&gt;] [-a] [&lt;hostname&gt;]             &lt;-Display ARP cache</span><br><span class="line">  arp [-v]          [-i &lt;if&gt;] -d  &lt;host&gt; [pub]               &lt;-Delete ARP entry</span><br><span class="line">  arp [-vnD] [&lt;HW&gt;] [-i &lt;if&gt;] -f  [&lt;filename&gt;]            &lt;-Add entry from file</span><br><span class="line">  arp [-v]   [&lt;HW&gt;] [-i &lt;if&gt;] -s  &lt;host&gt; &lt;hwaddr&gt; [temp]            &lt;-Add entry</span><br><span class="line">  arp [-v]   [&lt;HW&gt;] [-i &lt;if&gt;] -Ds &lt;host&gt; &lt;if&gt; [netmask &lt;nm&gt;] pub          &lt;-&#39;&#39;-</span><br><span class="line"></span><br><span class="line">        -a                       display (all) hosts in alternative (BSD) style</span><br><span class="line">        -e                       display (all) hosts in default (Linux) style</span><br><span class="line">        -s, --set                set a new ARP entry</span><br><span class="line">        -d, --delete             delete a specified entry</span><br><span class="line">        -v, --verbose            be verbose</span><br><span class="line">        -n, --numeric            don&#39;t resolve names</span><br><span class="line">        -i, --device             specify network interface (e.g. eth0)</span><br><span class="line">        -D, --use-device         read &lt;hwaddr&gt; from given device</span><br><span class="line">        -A, -p, --protocol       specify protocol family</span><br><span class="line">        -f, --file               read new entries from file or from &#x2F;etc&#x2F;ethers</span><br><span class="line"></span><br><span class="line">  &lt;HW&gt;&#x3D;Use &#39;-H &lt;hw&gt;&#39; to specify hardware address type. Default: ether</span><br><span class="line">  List of possible hardware types (which support ARP):</span><br><span class="line">    ash (Ash) ether (Ethernet) ax25 (AMPR AX.25)</span><br><span class="line">    netrom (AMPR NET&#x2F;ROM) rose (AMPR ROSE) arcnet (ARCnet)</span><br><span class="line">    dlci (Frame Relay DLCI) fddi (Fiber Distributed Data Interface) hippi (HIPPI)</span><br><span class="line">    irda (IrLAP) x25 (generic X.25) infiniband (InfiniBand)</span><br><span class="line">    eui64 (Generic EUI-64)</span><br></pre></td></tr></table></figure><h2 id="2-arpwatch：监听-ARP-记录"><a href="#2-arpwatch：监听-ARP-记录" class="headerlink" title="2. arpwatch：监听 ARP 记录"></a>2. <code>arpwatch</code>：监听 ARP 记录</h2><h2 id="3-arping：发送-ARP-请求到一个相邻主机"><a href="#3-arping：发送-ARP-请求到一个相邻主机" class="headerlink" title="3. arping：发送 ARP 请求到一个相邻主机"></a>3. <code>arping</code>：发送 ARP 请求到一个相邻主机</h2><h2 id="4-finger：查找并显示用户信息"><a href="#4-finger：查找并显示用户信息" class="headerlink" title="4. finger：查找并显示用户信息"></a>4. <code>finger</code>：查找并显示用户信息</h2><h2 id="5-ifconfig：设置网络接口"><a href="#5-ifconfig：设置网络接口" class="headerlink" title="5. ifconfig：设置网络接口"></a>5. <code>ifconfig</code>：设置网络接口</h2><h2 id="6-iwconfig：设置无线网卡"><a href="#6-iwconfig：设置无线网卡" class="headerlink" title="6. iwconfig：设置无线网卡"></a>6. <code>iwconfig</code>：设置无线网卡</h2><h2 id="7-hostname：显示主机名"><a href="#7-hostname：显示主机名" class="headerlink" title="7. hostname：显示主机名"></a>7. <code>hostname</code>：显示主机名</h2><h2 id="8-ifup：激活设备"><a href="#8-ifup：激活设备" class="headerlink" title="8. ifup：激活设备"></a>8. <code>ifup</code>：激活设备</h2><h2 id="9-ifdown：禁用网络设备"><a href="#9-ifdown：禁用网络设备" class="headerlink" title="9. ifdown：禁用网络设备"></a>9. <code>ifdown</code>：禁用网络设备</h2><h2 id="10-mii-tool：调整网卡模式"><a href="#10-mii-tool：调整网卡模式" class="headerlink" title="10. mii-tool：调整网卡模式"></a>10. <code>mii-tool</code>：调整网卡模式</h2><h2 id="11-route：设置路由表"><a href="#11-route：设置路由表" class="headerlink" title="11. route：设置路由表"></a>11. <code>route</code>：设置路由表</h2><h2 id="12-netstat：查看网络连接"><a href="#12-netstat：查看网络连接" class="headerlink" title="12. netstat：查看网络连接"></a>12. <code>netstat</code>：查看网络连接</h2><h2 id="13-ping：检测主机的连通性"><a href="#13-ping：检测主机的连通性" class="headerlink" title="13. ping：检测主机的连通性"></a>13. <code>ping</code>：检测主机的连通性</h2><h2 id="14-traceroute：检查数据包所经过的路由器"><a href="#14-traceroute：检查数据包所经过的路由器" class="headerlink" title="14. traceroute：检查数据包所经过的路由器"></a>14. <code>traceroute</code>：检查数据包所经过的路由器</h2><h2 id="15-wget：下载文件"><a href="#15-wget：下载文件" class="headerlink" title="15. wget：下载文件"></a>15. <code>wget</code>：下载文件</h2><h2 id="16-telnet：远程登陆"><a href="#16-telnet：远程登陆" class="headerlink" title="16. telnet：远程登陆"></a>16. <code>telnet</code>：远程登陆</h2><h2 id="17-ethtool：查询及设置网卡参数"><a href="#17-ethtool：查询及设置网卡参数" class="headerlink" title="17. ethtool：查询及设置网卡参数"></a>17. <code>ethtool</code>：查询及设置网卡参数</h2><h2 id="18-tc：显示和维护流量控制设置"><a href="#18-tc：显示和维护流量控制设置" class="headerlink" title="18. tc：显示和维护流量控制设置"></a>18. <code>tc</code>：显示和维护流量控制设置</h2>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 时区设置</title>
      <link href="2018/12/04/timezone/"/>
      <url>2018/12/04/timezone/</url>
      
        <content type="html"><![CDATA[<p>Linux 时区设置</p><a id="more"></a><h2 id="1-时间设置"><a href="#1-时间设置" class="headerlink" title="1. 时间设置"></a>1. 时间设置</h2><h3 id="查看、设置硬件时间"><a href="#查看、设置硬件时间" class="headerlink" title="查看、设置硬件时间"></a>查看、设置硬件时间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hwclock --show</span><br><span class="line">clock --show</span><br><span class="line"><span class="comment">## 月/日/年时:分:秒</span></span><br><span class="line">hwclock --<span class="built_in">set</span> --date=<span class="string">"06/18/14 14:55"</span></span><br><span class="line">clock --<span class="built_in">set</span> --date=<span class="string">"06/18/14 14:55"</span></span><br></pre></td></tr></table></figure><h3 id="硬件时钟与系统时钟同步"><a href="#硬件时钟与系统时钟同步" class="headerlink" title="硬件时钟与系统时钟同步"></a>硬件时钟与系统时钟同步</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## hc代表硬件时间，sys代表系统时间</span></span><br><span class="line"><span class="comment">## 硬件时钟同步系统时钟</span></span><br><span class="line">hwclock --hctosys</span><br><span class="line">clock --hctosys</span><br><span class="line"><span class="comment">## 系统时钟同步硬件时钟</span></span><br><span class="line">hwclock --systohc</span><br><span class="line">clock --systohc</span><br></pre></td></tr></table></figure><h3 id="同步-ntp-服务器"><a href="#同步-ntp-服务器" class="headerlink" title="同步 ntp 服务器"></a>同步 ntp 服务器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装 ntp、ntpdate</span></span><br><span class="line">yum -y install ntp</span><br><span class="line">ntpdate &lt;IP&gt;</span><br><span class="line"><span class="comment">## 添加定时任务</span></span><br><span class="line">crontab -e</span><br><span class="line">0 0 * * * /usr/sbin/ntpdate &lt;IP&gt;</span><br></pre></td></tr></table></figure><h2 id="2-时区设置"><a href="#2-时区设置" class="headerlink" title="2. 时区设置"></a>2. 时区设置</h2><h3 id="tzselect"><a href="#tzselect" class="headerlink" title="tzselect"></a>tzselect</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TZ=<span class="string">'Asia/Shanghai'</span>; <span class="built_in">export</span> TZ</span><br></pre></td></tr></table></figure><h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim etc&#x2F;sysconfig&#x2F;clock</span><br><span class="line">ZONE&#x3D;Asia&#x2F;Shanghai</span><br><span class="line">rm &#x2F;etc&#x2F;localtime</span><br><span class="line">ln -sf &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Shanghai &#x2F;etc&#x2F;localtime</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">timedatectl</span><br><span class="line">timedatectl list-timezones</span><br><span class="line">timedatectl set-timezone Asia/Shanghai</span><br><span class="line">yum -y install ntp</span><br><span class="line">vim  /etc/ntp.conf</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tomcat 配置与优化</title>
      <link href="2018/12/01/tomcat/"/>
      <url>2018/12/01/tomcat/</url>
      
        <content type="html"><![CDATA[<p>Tomcat 配置与优化</p><a id="more"></a><h2 id="1-JVM-配置"><a href="#1-JVM-配置" class="headerlink" title="1. JVM 配置"></a>1. JVM 配置</h2><h3 id="添加-tomcat-管理员"><a href="#添加-tomcat-管理员" class="headerlink" title="添加 tomcat 管理员"></a>添加 tomcat 管理员</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# vim &#x2F;tomcat&#x2F;conf&#x2F;tomcat-users.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"manager-gui"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"admin-gui"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"manager"</span> <span class="attr">password</span>=<span class="string">"manager"</span> <span class="attr">roles</span>=<span class="string">"admin-gui,manager-gui"</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="修改-JVM-虚拟内存"><a href="#修改-JVM-虚拟内存" class="headerlink" title="修改 JVM 虚拟内存"></a>修改 JVM 虚拟内存</h3><p><img src="images/jvm.png" alt=""></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPTS=<span class="string">"-server -Xms1024m -Xmx1024m -Xmn256m -XX:PermSize=512m -XX:MaxPermSize=1024m -XX:ReservedCodeCacheSize=256M -Djava.awt.headless=true -Dfile.encoding=utf-8"</span></span><br></pre></td></tr></table></figure><ul><li>堆设置：  </li></ul><p>-Xms=n   初始堆大小<br>-Xmx=n   最大堆大小<br>-XX:NewSize=n   设置年轻代大小<br>-XX:NewRatio=n  设置年轻代和年老代的比值.如:为3,表示年轻代与年老代比值为1:3,年轻代占整个年轻代年老代和的1/4<br>-XX:SurvivorRatio=n 年轻代中Eden区与两个Survivor区的比值.注意Survivor区有两个.如:3,表示Eden:Survivor=3:2,一个Survivor区占整个年轻代的1/5<br>-XX:MaxPermSize=n   设置持久代大小  </p><ul><li>收集器设置：  </li></ul><p>-XX:+UseSerialGC    设置串行收集器<br>-XX:+UseParallelGC  设置并行收集器<br>-XX:+UseParalledlOldGC  设置并行年老代收集器<br>-XX:+UseConcMarkSweepGC 设置并发收集器</p><ul><li>垃圾回收统计信息：  </li></ul><p>-XX:+PrintGC<br>-XX:+PrintGCDetails<br>-XX:+PrintGCTimeStamps<br>-Xloggc:filename  </p><ul><li>并行收集器设置：  </li></ul><p>-XX:ParallelGCThreads=n 设置并行收集器收集时使用的CPU数.并行收集线程数.<br>-XX:MaxGCPauseMillis=n  设置并行收集最大暂停时间<br>-XX:GCTimeRatio=n   设置垃圾回收时间占程序运行时间的百分比.公式为1/(1+n)并发收集器设置<br>-XX:+CMSIncrementalMode 设置为增量模式.适用于单CPU情况.<br>-XX:ParallelGCThreads=n 设置并发收集器年轻代收集方式为并行收集时,使用的CPU数.并行收集线程数</p><h2 id="2-apr-安装"><a href="#2-apr-安装" class="headerlink" title="2. apr 安装"></a>2. apr 安装</h2><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# yum -y install gcc expat-devel</span><br></pre></td></tr></table></figure><h3 id="安装-apr"><a href="#安装-apr" class="headerlink" title="安装 apr"></a>安装 <a href="">apr</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# mkdir &#x2F;usr&#x2F;local&#x2F;apr</span><br><span class="line">[root@server apr-1.6.3]# .&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;apr</span><br><span class="line">[root@server apr-1.6.3]# make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="安装-apr-util"><a href="#安装-apr-util" class="headerlink" title="安装 apr-util"></a>安装 <a href="">apr-util</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server apr-util-1.6.1]# .&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;apr --with-apr&#x3D;&#x2F;usr&#x2F;local&#x2F;apr</span><br><span class="line">[root@server apr-util-1.6.1]# make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="安装-tomcat-native"><a href="#安装-tomcat-native" class="headerlink" title="安装 tomcat-native"></a>安装 <a href="">tomcat-native</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# cd tomcat-native-1.2.17-src&#x2F;native&#x2F;</span><br><span class="line">[root@server native]# .&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;apr --with-apr&#x3D;&#x2F;usr&#x2F;local&#x2F;apr --with-java-home&#x3D;&#x2F;usr&#x2F;java&#x2F;jdk1.7.0_80&#x2F;</span><br><span class="line">[root@server native]# make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="修改-tomcat-配置"><a href="#修改-tomcat-配置" class="headerlink" title="修改 tomcat 配置"></a>修改 tomcat 配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# vim &#x2F;tomcat&#x2F;bin&#x2F;catalina.sh</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加 CATALINA_OPTS</span></span><br><span class="line">CATALINA_OPTS=<span class="string">"-Djava.library.path=/usr/local/apr/lib"</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# vim &#x2F;tomcat&#x2F;conf&#x2F;server.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8001"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">protocol</span>=<span class="string">"org.apache.coyote.http11.Http11AprProtocol"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">executor</span>=<span class="string">"tomcatThreadPool"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">maxThreads</span>=<span class="string">"1000"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">enableLookups</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">acceptCount</span>=<span class="string">"1000"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">connectionTimeout</span>=<span class="string">"30000"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">redirectPort</span>=<span class="string">"9100"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">maxPostSize</span>=<span class="string">"8388608"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">maxParameterCount</span>=<span class="string">"40000"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">disableUploadTimeout</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">URIEncoding</span>=<span class="string">"UTF-8"</span>/&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3-SSLEngine-Error"><a href="#3-SSLEngine-Error" class="headerlink" title="3. SSLEngine Error"></a>3. SSLEngine Error</h2><h3 id="查看-tomcat-日志，出现-SSLEngine-Error"><a href="#查看-tomcat-日志，出现-SSLEngine-Error" class="headerlink" title="查看 tomcat 日志，出现 SSLEngine Error"></a>查看 tomcat 日志，出现 SSLEngine Error</h3><p>org.apache.catalina.core.AprLifecycleListener.lifecycleEvent Failed to initialize the SSLEngine.<br>{:.error}</p><h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# vim &#x2F;tomcat&#x2F;conf&#x2F;server.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.core.AprLifecycleListener"</span> <span class="attr">SSLEngine</span>=<span class="string">"off"</span> /&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> tomcat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LVS</title>
      <link href="2018/11/30/lvs/"/>
      <url>2018/11/30/lvs/</url>
      
        <content type="html"><![CDATA[<p>LVS</p><a id="more"></a><h2 id="1-安装-ipvsadm"><a href="#1-安装-ipvsadm" class="headerlink" title="1. 安装 ipvsadm"></a>1. 安装 ipvsadm</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]# yum -y install ipvsadm</span><br></pre></td></tr></table></figure><h2 id="2-ipvsadm-用法"><a href="#2-ipvsadm-用法" class="headerlink" title="2. ipvsadm 用法"></a>2. ipvsadm 用法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]# ipvsadm --help</span><br><span class="line">ipvsadm v1.27 2008&#x2F;5&#x2F;15 (compiled with popt and IPVS v1.2.1)</span><br><span class="line">Usage:</span><br><span class="line">  ipvsadm -A|E -t|u|f service-address [-s scheduler] [-p [timeout]] [-M netmask] [--pe persistence_engine] [-b sched-flags]</span><br><span class="line">  ipvsadm -D -t|u|f service-address</span><br><span class="line">  ipvsadm -C</span><br><span class="line">  ipvsadm -R</span><br><span class="line">  ipvsadm -S [-n]</span><br><span class="line">  ipvsadm -a|e -t|u|f service-address -r server-address [options]</span><br><span class="line">  ipvsadm -d -t|u|f service-address -r server-address</span><br><span class="line">  ipvsadm -L|l [options]</span><br><span class="line">  ipvsadm -Z [-t|u|f service-address]</span><br><span class="line">  ipvsadm --set tcp tcpfin udp</span><br><span class="line">  ipvsadm --start-daemon state [--mcast-interface interface] [--syncid sid]</span><br><span class="line">  ipvsadm --stop-daemon state</span><br><span class="line">  ipvsadm -h</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">Either long or short options are allowed.</span><br><span class="line">  --add-service     -A        add virtual service with options</span><br><span class="line">  --edit-service    -E        edit virtual service with options</span><br><span class="line">  --delete-service  -D        delete virtual service</span><br><span class="line">  --clear           -C        clear the whole table</span><br><span class="line">  --restore         -R        restore rules from stdin</span><br><span class="line">  --save            -S        save rules to stdout</span><br><span class="line">  --add-server      -a        add real server with options</span><br><span class="line">  --edit-server     -e        edit real server with options</span><br><span class="line">  --delete-server   -d        delete real server</span><br><span class="line">  --list            -L|-l     list the table</span><br><span class="line">  --zero            -Z        zero counters in a service or all services</span><br><span class="line">  --set tcp tcpfin udp        set connection timeout values</span><br><span class="line">  --start-daemon              start connection sync daemon</span><br><span class="line">  --stop-daemon               stop connection sync daemon</span><br><span class="line">  --help            -h        display this help message</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --tcp-service  -t service-address   service-address is host[:port]</span><br><span class="line">  --udp-service  -u service-address   service-address is host[:port]</span><br><span class="line">  --fwmark-service  -f fwmark         fwmark is an integer greater than zero</span><br><span class="line">  --ipv6         -6                   fwmark entry uses IPv6</span><br><span class="line">  --scheduler    -s scheduler         one of rr|wrr|lc|wlc|lblc|lblcr|dh|sh|sed|nq,</span><br><span class="line">                                      the default scheduler is wlc.</span><br><span class="line">  --pe            engine              alternate persistence engine may be sip,</span><br><span class="line">                                      not set by default.</span><br><span class="line">  --persistent   -p [timeout]         persistent service</span><br><span class="line">  --netmask      -M netmask           persistent granularity mask</span><br><span class="line">  --real-server  -r server-address    server-address is host (and port)</span><br><span class="line">  --gatewaying   -g                   gatewaying (direct routing) (default)</span><br><span class="line">  --ipip         -i                   ipip encapsulation (tunneling)</span><br><span class="line">  --masquerading -m                   masquerading (NAT)</span><br><span class="line">  --weight       -w weight            capacity of real server</span><br><span class="line">  --u-threshold  -x uthreshold        upper threshold of connections</span><br><span class="line">  --l-threshold  -y lthreshold        lower threshold of connections</span><br><span class="line">  --mcast-interface interface         multicast interface for connection sync</span><br><span class="line">  --syncid sid                        syncid for connection sync (default&#x3D;255)</span><br><span class="line">  --connection   -c                   output of current IPVS connections</span><br><span class="line">  --timeout                           output of timeout (tcp tcpfin udp)</span><br><span class="line">  --daemon                            output of daemon information</span><br><span class="line">  --stats                             output of statistics information</span><br><span class="line">  --rate                              output of rate information</span><br><span class="line">  --exact                             expand numbers (display exact values)</span><br><span class="line">  --thresholds                        output of thresholds information</span><br><span class="line">  --persistent-conn                   output of persistent connection info</span><br><span class="line">  --nosort                            disable sorting output of service&#x2F;server entries</span><br><span class="line">  --sort                              does nothing, for backwards compatibility</span><br><span class="line">  --ops          -o                   one-packet scheduling</span><br><span class="line">  --numeric      -n                   numeric output of addresses and ports</span><br><span class="line">  --sched-flags  -b flags             scheduler flags (comma-separated)</span><br></pre></td></tr></table></figure><h2 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h2>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lvs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js 安装指南</title>
      <link href="2018/11/27/nodejs/"/>
      <url>2018/11/27/nodejs/</url>
      
        <content type="html"><![CDATA[<p>Node.js 安装（NVM 包管理器）</p><a id="more"></a><h2 id="Install-amp-Update-script"><a href="#Install-amp-Update-script" class="headerlink" title="Install &amp; Update script"></a>Install &amp; Update script</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.2/install.sh | bash</span></span><br><span class="line">wget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.2/install.sh | bash</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> NVM_DIR=<span class="string">"<span class="variable">$([ -z "$&#123;XDG_CONFIG_HOME-&#125;" ] &amp;&amp; printf %s "$&#123;HOME&#125;/.nvm" || printf %s "$&#123;XDG_CONFIG_HOME&#125;/nvm")</span>"</span></span><br><span class="line">[ -s <span class="string">"<span class="variable">$NVM_DIR</span>/nvm.sh"</span> ] &amp;&amp; \. <span class="string">"<span class="variable">$NVM_DIR</span>/nvm.sh"</span> <span class="comment"># This loads nvm</span></span><br></pre></td></tr></table></figure><h2 id="Git-install"><a href="#Git-install" class="headerlink" title="Git install"></a>Git install</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/nvm-sh/nvm.git <span class="variable">$HOME</span>/.nvm</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> .nvm</span><br><span class="line">git checkout v0.35.2</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> NVM_DIR=<span class="string">"<span class="variable">$HOME</span>/.nvm"</span></span><br><span class="line">[ -s <span class="string">"<span class="variable">$NVM_DIR</span>/nvm.sh"</span> ] &amp;&amp; \. <span class="string">"<span class="variable">$NVM_DIR</span>/nvm.sh"</span>  <span class="comment"># This loads nvm</span></span><br><span class="line">[ -s <span class="string">"<span class="variable">$NVM_DIR</span>/bash_completion"</span> ] &amp;&amp; \. <span class="string">"<span class="variable">$NVM_DIR</span>/bash_completion"</span>  <span class="comment"># This loads nvm bash_completion</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>树莓派安装教程</title>
      <link href="2018/11/26/raspberrypi/"/>
      <url>2018/11/26/raspberrypi/</url>
      
        <content type="html"><![CDATA[<p>树莓派安装教程</p><a id="more"></a><h2 id="rasbian-网络配置"><a href="#rasbian-网络配置" class="headerlink" title="rasbian 网络配置"></a>rasbian 网络配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line">auto eth0</span><br><span class="line">iface eth0 inet dhcp</span><br><span class="line"></span><br><span class="line">auto wlan0</span><br><span class="line">allow-hotplug wlan0</span><br><span class="line">iface wlan0 inet dhcp</span><br><span class="line">wpa-ssid &quot;360WiFi&quot;</span><br><span class="line">wpa-psk &quot;hellworld&quot;</span><br></pre></td></tr></table></figure><h2 id="树莓派安装-docker-ce"><a href="#树莓派安装-docker-ce" class="headerlink" title="树莓派安装 docker-ce"></a>树莓派安装 docker-ce</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;debian&#x2F;gpg | sudo apt-key add -</span><br><span class="line"></span><br><span class="line">echo &quot;deb [arch&#x3D;armhf] https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;docker-ce&#x2F;linux&#x2F;debian $(lsb_release -cs) stable&quot; | sudo tee &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;docker.list</span><br><span class="line"></span><br><span class="line">apt update</span><br><span class="line"></span><br><span class="line">apt install docker-ce</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> raspberrypi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SELinux</title>
      <link href="2018/11/25/selinux/"/>
      <url>2018/11/25/selinux/</url>
      
        <content type="html"><![CDATA[<p>SELinux</p><a id="more"></a><h2 id="1-上下文（以-apache-为例）"><a href="#1-上下文（以-apache-为例）" class="headerlink" title="1. 上下文（以 apache 为例）"></a>1. 上下文（以 apache 为例）</h2><h3 id="1）服务器端安装-httpd"><a href="#1）服务器端安装-httpd" class="headerlink" title="1）服务器端安装 httpd"></a>1）服务器端安装 httpd</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# yum -y install httpd</span><br><span class="line">[root@server ~]# systemctl start httpd</span><br><span class="line">[root@server ~]# systemctl enable httpd</span><br></pre></td></tr></table></figure><h3 id="2）查看-httpd-默认目录的上下文"><a href="#2）查看-httpd-默认目录的上下文" class="headerlink" title="2）查看 httpd 默认目录的上下文"></a>2）查看 httpd 默认目录的上下文</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# ls -ldZ &#x2F;var&#x2F;www&#x2F;</span><br><span class="line">drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 &#x2F;var&#x2F;www&#x2F;</span><br></pre></td></tr></table></figure><h3 id="3）设置临时上下文"><a href="#3）设置临时上下文" class="headerlink" title="3）设置临时上下文"></a>3）设置临时上下文</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# mkdir &#x2F;html</span><br><span class="line"></span><br><span class="line">[root@server ~]# ls -ldZ &#x2F;html&#x2F;</span><br><span class="line">drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 &#x2F;html&#x2F;</span><br><span class="line"></span><br><span class="line">[root@server ~]# chcon -R -t httpd_sys_content_t &#x2F;html&#x2F;</span><br><span class="line"></span><br><span class="line">[root@server ~]# ls -ldZ &#x2F;html&#x2F;</span><br><span class="line">drwxr-xr-x. root root unconfined_u:object_r:httpd_sys_content_t:s0 &#x2F;html&#x2F;</span><br><span class="line"></span><br><span class="line">[root@server ~]# restorecon -R &#x2F;html&#x2F;</span><br><span class="line"></span><br><span class="line">[root@server ~]# ls -ldZ &#x2F;html&#x2F;</span><br><span class="line">drwxr-xr-x. root root unconfined_u:object_r:default_t:s0 &#x2F;html&#x2F;</span><br><span class="line"></span><br><span class="line">[root@server ~]# # --reference 设置和目录相同的上下文</span><br><span class="line">[root@server ~]# chcon -R --reference&#x3D;&#x2F;var&#x2F;www&#x2F;html &#x2F;www</span><br></pre></td></tr></table></figure><h3 id="4）设置永久上下文"><a href="#4）设置永久上下文" class="headerlink" title="4）设置永久上下文"></a>4）设置永久上下文</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# semanage fcontext -a -t httpd_sys_content_t &#39;&#x2F;html(&#x2F;.*)?&#39;</span><br><span class="line"></span><br><span class="line">[root@server ~]# ls -ldZ &#x2F;html</span><br><span class="line">drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 &#x2F;html</span><br><span class="line"></span><br><span class="line">[root@server ~]# restorecon -R &#x2F;html&#x2F;</span><br><span class="line"></span><br><span class="line">[root@server ~]# ls -ldZ &#x2F;html</span><br><span class="line">drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 &#x2F;html</span><br></pre></td></tr></table></figure><h2 id="2-布尔值（以-vsftpd-为例）"><a href="#2-布尔值（以-vsftpd-为例）" class="headerlink" title="2. 布尔值（以 vsftpd 为例）"></a>2. 布尔值（以 vsftpd 为例）</h2><ul><li>如果搭建了一个服务，需要在客户端往服务里写东西，但是无法写入，按照以下不走排查<blockquote><p>1）检查配置文件是否允许写<br>2）检查文件系统是否允许写<br>3）检查 selinux （上下文|布尔值）  </p></blockquote></li></ul><h3 id="1-服务端安装-vsftpd"><a href="#1-服务端安装-vsftpd" class="headerlink" title="1)服务端安装 vsftpd"></a>1)服务端安装 vsftpd</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# yum -y install vsftpd</span><br><span class="line">[root@server ~]# systemctl start vsftpd</span><br><span class="line">[root@server ~]# systemctl enable vsftpd</span><br></pre></td></tr></table></figure><h3 id="2）检查配置文件是否允许写"><a href="#2）检查配置文件是否允许写" class="headerlink" title="2）检查配置文件是否允许写"></a>2）检查配置文件是否允许写</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# vim &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 允许匿名上传</span><br><span class="line">anon_upload_enable&#x3D;YES</span><br><span class="line">anon_mkdir_write_enable&#x3D;YES</span><br></pre></td></tr></table></figure><h3 id="3）检查文件系统是否允许写"><a href="#3）检查文件系统是否允许写" class="headerlink" title="3）检查文件系统是否允许写"></a>3）检查文件系统是否允许写</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# ls -ld &#x2F;var&#x2F;ftp&#x2F;</span><br><span class="line">drwxr-xr-x. 4 root root 27 8月  17 14:29 &#x2F;var&#x2F;ftp&#x2F;</span><br><span class="line"></span><br><span class="line">[root@server ~]# cd &#x2F;var&#x2F;ftp&#x2F;</span><br><span class="line"></span><br><span class="line">[root@server ftp]# mkdir test</span><br><span class="line"></span><br><span class="line">[root@server ftp]# chown -R ftp.ftp test</span><br><span class="line"></span><br><span class="line">[root@server ftp]# ls -ld test</span><br><span class="line">drwxr-xr-x. 2 ftp ftp 6 8月  17 14:48 test</span><br></pre></td></tr></table></figure><h3 id="4）检查-selinux-（上下文-布尔值）"><a href="#4）检查-selinux-（上下文-布尔值）" class="headerlink" title="4）检查 selinux （上下文|布尔值）"></a>4）检查 selinux （上下文|布尔值）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@server ~]# getsebool -a | grep ftp</span><br><span class="line">ftpd_anon_write --&gt; off</span><br><span class="line">ftpd_connect_all_unreserved --&gt; off</span><br><span class="line">ftpd_connect_db --&gt; off</span><br><span class="line">ftpd_full_access --&gt; off</span><br><span class="line">ftpd_use_cifs --&gt; off</span><br><span class="line">ftpd_use_fusefs --&gt; off</span><br><span class="line">ftpd_use_nfs --&gt; off</span><br><span class="line">ftpd_use_passive_mode --&gt; off</span><br><span class="line">httpd_can_connect_ftp --&gt; off</span><br><span class="line">httpd_enable_ftp_server --&gt; off</span><br><span class="line">tftp_anon_write --&gt; off</span><br><span class="line">tftp_home_dir --&gt; off</span><br><span class="line"></span><br><span class="line">[root@server ftp]# setsebool -P ftpd_anon_write on</span><br><span class="line"></span><br><span class="line">[root@server ftp]# setsebool -P ftpd_full_access on</span><br><span class="line"></span><br><span class="line">[root@server ~]# getsebool -a | grep ftp</span><br><span class="line">ftpd_anon_write --&gt; on</span><br><span class="line">ftpd_connect_all_unreserved --&gt; off</span><br><span class="line">ftpd_connect_db --&gt; off</span><br><span class="line">ftpd_full_access --&gt; on</span><br><span class="line">ftpd_use_cifs --&gt; off</span><br><span class="line">ftpd_use_fusefs --&gt; off</span><br><span class="line">ftpd_use_nfs --&gt; off</span><br><span class="line">ftpd_use_passive_mode --&gt; off</span><br><span class="line">httpd_can_connect_ftp --&gt; off</span><br><span class="line">httpd_enable_ftp_server --&gt; off</span><br><span class="line">tftp_anon_write --&gt; off</span><br><span class="line">tftp_home_dir --&gt; off</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> selinux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Subversion 安装与配置</title>
      <link href="2018/11/24/svn/"/>
      <url>2018/11/24/svn/</url>
      
        <content type="html"><![CDATA[<p>Subversion 安装与配置</p><a id="more"></a><h2 id="1-安装-Subversion"><a href="#1-安装-Subversion" class="headerlink" title="1. 安装 Subversion"></a>1. 安装 Subversion</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y subversion</span><br></pre></td></tr></table></figure><h2 id="2-创建-SVN-版本库"><a href="#2-创建-SVN-版本库" class="headerlink" title="2. 创建 SVN 版本库"></a>2. 创建 SVN 版本库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p &#x2F;data&#x2F;svn&#x2F;myproject</span><br><span class="line">svnadmin create &#x2F;data&#x2F;svn&#x2F;myproject</span><br></pre></td></tr></table></figure><h2 id="3-配置-SVN-信息"><a href="#3-配置-SVN-信息" class="headerlink" title="3. 配置 SVN 信息"></a>3. 配置 SVN 信息</h2><h3 id="配置文件简介"><a href="#配置文件简介" class="headerlink" title="配置文件简介"></a>配置文件简介</h3><p>版本库中的配置目录 conf 有三个文件:</p><ul><li>authz 是权限控制文件  </li><li>passwd 是帐号密码文件  </li><li>svnserve.conf 是SVN服务综合配置文件  </li></ul><p>配置权限配置文件 authz<br><strong>示例代码：/data/svn/myproject/conf/authz</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[groups]            </span><br><span class="line">#用户组</span><br><span class="line">admin &#x3D; admin,root,test  </span><br><span class="line">#用户组所对应的用户</span><br><span class="line">[&#x2F;]                 </span><br><span class="line">#库目录权限</span><br><span class="line">@admin &#x3D; rw         </span><br><span class="line">#用户组权限</span><br><span class="line">*&#x3D;r               </span><br><span class="line">#非用户组权限</span><br></pre></td></tr></table></figure><p>配置账号密码文件 passwd<br><strong>示例代码：/data/svn/myproject/conf/passwd</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[users]</span><br><span class="line"># harry &#x3D; harryssecret</span><br><span class="line"># sally &#x3D; sallyssecret</span><br><span class="line">admin &#x3D; 123456</span><br><span class="line">root &#x3D; 123456</span><br><span class="line">test &#x3D; 123456</span><br></pre></td></tr></table></figure><p>配置 SVN 服务综合配置文件 svnserve.conf<br><strong>示例代码：/data/svn/myproject/conf/svnserve.conf</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[general]</span><br><span class="line"># force-username-case &#x3D; none</span><br><span class="line"># 匿名访问的权限 可以是read、write，none，默认为read</span><br><span class="line">anon-access &#x3D; none</span><br><span class="line">#使授权用户有写权限</span><br><span class="line">auth-access &#x3D; write</span><br><span class="line">#密码数据库的路径</span><br><span class="line">password-db &#x3D; passwd</span><br><span class="line">#访问控制文件</span><br><span class="line">authz-db &#x3D; authz</span><br><span class="line">#认证命名空间，SVN会在认证提示里显示，并且作为凭证缓存的关键字</span><br><span class="line">realm &#x3D; &#x2F;data&#x2F;svn&#x2F;myproject</span><br><span class="line"></span><br><span class="line">[sasl]</span><br></pre></td></tr></table></figure><h2 id="4-启动-SVN-服务"><a href="#4-启动-SVN-服务" class="headerlink" title="4. 启动 SVN 服务"></a>4. 启动 SVN 服务</h2><h3 id="启动-SVN"><a href="#启动-SVN" class="headerlink" title="启动 SVN"></a>启动 SVN</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svnserve -d -r &#x2F;data&#x2F;svn</span><br></pre></td></tr></table></figure><h3 id="checkout-SVN项目"><a href="#checkout-SVN项目" class="headerlink" title="checkout SVN项目"></a>checkout SVN项目</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p &#x2F;data&#x2F;workspace&#x2F;myproject</span><br><span class="line">svn co svn:&#x2F;&#x2F;127.0.0.1&#x2F;myproject &#x2F;data&#x2F;workspace&#x2F;myproject --username root --password 123456 --force --no-auth-cache</span><br></pre></td></tr></table></figure><h3 id="提交文件到-SVN-服务器"><a href="#提交文件到-SVN-服务器" class="headerlink" title="提交文件到 SVN 服务器"></a>提交文件到 SVN 服务器</h3><p>从本地提交文件到 SVN 服务器，其中 root 密码为 /data/svn/myproject/conf/passwd 文件存储的密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;data&#x2F;workspace&#x2F;myproject</span><br><span class="line">echo test &gt;&gt; test.txt</span><br><span class="line">svn add test.txt</span><br><span class="line">svn commit test.txt -m &#39;test&#39;</span><br></pre></td></tr></table></figure><p>提交成功后可以通过如下命令从本地项目删除文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;data&#x2F;workspace&#x2F;myproject</span><br><span class="line">rm -rf test.txt</span><br></pre></td></tr></table></figure><p>删除后可以通过 SVN 服务器恢复</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;data&#x2F;workspace&#x2F;myproject</span><br><span class="line">svn update</span><br></pre></td></tr></table></figure><p>清除SVN客户端密码方法：<br>邮件选择TortoiseSVN中的settings选项—Saved Data—右边会发现有个Authentication data,点击clear，即完成清空账号密码操作，确认即可。下次就会自动弹出登录框。</p><p>在eclipse的svn插件中，我们也会保存密码，那么要清除时，换账号登录，就稍微麻烦点：</p><ol><li><p>查看你的Eclipse中使用的是什么SVN 接口<br>windows &gt; preference &gt; Team &gt; SVN</p></li><li><p>如果是用的JavaHL, 找到以下目录并删除auth目录.<br>C:\Documents and Settings\User\Application Data\Subversion\</p></li><li><p>如果你用的SVNKit, 找到以下目录并删除.keyring文件.<br>eclipse\configuration\org.eclipse.core.runtime\</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> svn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu 网络配置</title>
      <link href="2018/11/23/ubuntuserver/"/>
      <url>2018/11/23/ubuntuserver/</url>
      
        <content type="html"><![CDATA[<p>Ubuntu Server 网络配置</p><a id="more"></a><h2 id="1-查看所有网卡信息"><a href="#1-查看所有网卡信息" class="headerlink" title="1. 查看所有网卡信息"></a>1. 查看所有网卡信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig -a</span><br></pre></td></tr></table></figure><h2 id="2-修改网卡配置文件"><a href="#2-修改网卡配置文件" class="headerlink" title="2. 修改网卡配置文件"></a>2. 修改网卡配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;network&#x2F;interfaces</span><br></pre></td></tr></table></figure><ul><li>DHCP</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/network/interfaces.d/*</span><br><span class="line"></span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line">auto ens33</span><br><span class="line">iface ens33 inet dhcp</span><br></pre></td></tr></table></figure><ul><li>STATIC</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/network/interfaces.d/*</span><br><span class="line"></span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line">auto ens33</span><br><span class="line">iface ens33 inet static</span><br><span class="line"><span class="comment"># 克隆 mac 地址</span></span><br><span class="line"><span class="comment"># pre-up ifconfig ens33 hw ether &lt;MACADDR&gt; </span></span><br><span class="line">address &lt;IPADDR&gt;</span><br><span class="line">gateway &lt;GATEWAY&gt;</span><br><span class="line">netmask &lt;NETMASK&gt;</span><br><span class="line"><span class="comment"># network &lt;NETWORK&gt;</span></span><br><span class="line"><span class="comment"># broadcast &lt;BROADCAST&gt;</span></span><br><span class="line">dns-nameservers &lt;DNS&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VVirtualBox EFI 引导问题</title>
      <link href="2018/11/21/virtualbox/"/>
      <url>2018/11/21/virtualbox/</url>
      
        <content type="html"><![CDATA[<p>VirtualBox EFI 引导问题</p><a id="more"></a><h2 id="1、引导界面修改"><a href="#1、引导界面修改" class="headerlink" title="1、引导界面修改"></a>1、引导界面修改</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Shell&gt; FS0:</span><br><span class="line">FS0:\&gt; cd EFI</span><br><span class="line">FS0:\EFI&gt; cp centos\grubx64.efi BOOT\grubx64.efi</span><br></pre></td></tr></table></figure><h2 id="2、系统界面修改"><a href="#2、系统界面修改" class="headerlink" title="2、系统界面修改"></a>2、系统界面修改</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp &#x2F;boot&#x2F;efi&#x2F;EFI&#x2F;centos&#x2F;grubx64.efi &#x2F;boot&#x2F;efi&#x2F;EFI&#x2F;BOOT&#x2F;grubx64.efi</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> virtualbox </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FTP 教程</title>
      <link href="2018/11/20/vsftpd/"/>
      <url>2018/11/20/vsftpd/</url>
      
        <content type="html"><![CDATA[<p>一份简易的 ftp 安装使用教程</p><a id="more"></a><h2 id="1-安装-vsftpd"><a href="#1-安装-vsftpd" class="headerlink" title="1. 安装 vsftpd"></a>1. 安装 vsftpd</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 selinux 状态</span></span><br><span class="line">getenforce</span><br><span class="line"><span class="comment"># 查看防火墙状态</span></span><br><span class="line">service firewalld status</span><br><span class="line"><span class="comment"># 安装 vsftpd</span></span><br><span class="line">yum -y install vsftpd</span><br><span class="line"><span class="comment"># 设置开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> vsftpd</span><br><span class="line"><span class="comment"># 启动 vsftpd 服务</span></span><br><span class="line">systemctl start vsftpd</span><br><span class="line"><span class="comment"># 防火墙开放 ftp 服务</span></span><br><span class="line">firewall-cmd --add-service=ftp --permanent</span><br><span class="line"><span class="comment"># 查看和更改 ftp 的 sebool 值</span></span><br><span class="line">getsebool -a | grep ftp</span><br><span class="line">setsebool ftpd_full_access on</span><br></pre></td></tr></table></figure><h2 id="2-配置-vsftpd"><a href="#2-配置-vsftpd" class="headerlink" title="2. 配置 vsftpd"></a>2. 配置 vsftpd</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/vsftpd/vsftpd.conf</span><br></pre></td></tr></table></figure><p>vsftpd.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 不允许匿名访问 ftp</span><br><span class="line">anonymous_enable&#x3D;NO</span><br><span class="line"># 用户不允许切换上级目录</span><br><span class="line">chroot_local_user&#x3D;YES</span><br><span class="line">allow_writeable_chroot&#x3D;YES</span><br><span class="line"># 设置时区</span><br><span class="line">use_localtime&#x3D;YES</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改配置后重启 vsftpd</span></span><br><span class="line">systemctl restart vsftpd</span><br></pre></td></tr></table></figure><h2 id="3-创建用户"><a href="#3-创建用户" class="headerlink" title="3. 创建用户"></a>3. 创建用户</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建用户 [username]，不允许登陆，家目录为 [directory]</span></span><br><span class="line">useradd -s /sbin/nologin -m -d [directory] [username]</span><br><span class="line"><span class="comment"># 设置密码</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[password]"</span> | passwd --stdin [username]</span><br></pre></td></tr></table></figure><h2 id="4-验证"><a href="#4-验证" class="headerlink" title="4. 验证"></a>4. 验证</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 ftp 客户端</span></span><br><span class="line">yum -y install ftp</span><br><span class="line"><span class="comment"># 连接 ftp 服务器</span></span><br><span class="line">ftp [ip]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> ftp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows LinuxSubSystem</title>
      <link href="2018/11/19/wsl/"/>
      <url>2018/11/19/wsl/</url>
      
        <content type="html"><![CDATA[<p>Windows Linux 子系统安装指南</p><a id="more"></a><h2 id="安装-oh-my-zsh"><a href="#安装-oh-my-zsh" class="headerlink" title="安装 oh-my-zsh"></a>安装 <a href="https://ohmyz.sh/" target="_blank" rel="noopener">oh-my-zsh</a></h2><ul><li><p>curl</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c "$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"</span><br></pre></td></tr></table></figure></li><li><p>wget</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c "$(wget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)"</span><br></pre></td></tr></table></figure></li></ul><h2 id="更改默认-shell"><a href="#更改默认-shell" class="headerlink" title="更改默认 shell"></a>更改默认 shell</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chsh -s $(which zsh)</span><br></pre></td></tr></table></figure><h2 id="更改主题"><a href="#更改主题" class="headerlink" title="更改主题"></a>更改主题</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.zshrc</span><br></pre></td></tr></table></figure><p><img src="images/zshrc.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ZSH_THEME&#x3D;&quot;agnoster&quot;</span><br><span class="line">DEFAULT_USER&#x3D;&quot;jeremy&quot;</span><br></pre></td></tr></table></figure><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><blockquote><p>字体问题导致显示异常</p></blockquote><p><img src="images/zshlostfonts.png" alt=""></p><p>解决办法：Windows 环境安装 powerline-fonts 并设置控制台字体<br><a href="https://github.com/powerline/fonts.git" target="_blank" rel="noopener">https://github.com/powerline/fonts.git</a></p><p><img src="images/setpowerlinefonts.png" alt=""></p><blockquote><p>启动vim的时候会出现字体变回原来的新宋体的情况：</p></blockquote><p>win + R -&gt; 运行 -&gt; <code>regedit</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKEY_CURRENT_USER\Console\C:_Program Files_WindowsApps_CanonicalGroupLimited.Ubuntu18.04onWindows_1804.2018.817.0_x64__79rhkp1fndgsc_ubuntu1804.exe</span><br></pre></td></tr></table></figure><p>添加：CodePage (DWORD (32) 类型、值 0x01b5)</p><p><img src="images/regedit.png" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> wsl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zabbix Proxy 分布式监控</title>
      <link href="2018/11/18/zabbix_proxy/"/>
      <url>2018/11/18/zabbix_proxy/</url>
      
        <content type="html"><![CDATA[<p>使用 Zabbix Proxy 搭建分布式监控</p><a id="more"></a><h2 id="1-安装-MySQL、Zabbix-Prorxy"><a href="#1-安装-MySQL、Zabbix-Prorxy" class="headerlink" title="1. 安装 MySQL、Zabbix Prorxy"></a>1. 安装 MySQL、Zabbix Prorxy</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 MySQL</span></span><br><span class="line">apt install mysql-server</span><br><span class="line"><span class="comment"># 安装 zabbix proxy</span></span><br><span class="line">wget https://repo.zabbix.com/zabbix/3.4/ubuntu/pool/main/z/zabbix-release/zabbix-release_3.4-1+xenial_all.deb</span><br><span class="line">dpkg -i zabbix-release_3.4-1+xenial_all.deb</span><br><span class="line">apt update</span><br><span class="line">apt install zabbix-server-mysql zabbix-agent zabbix-proxy-mysql zabbix-get zabbix-sender</span><br></pre></td></tr></table></figure><h2 id="2-导入数据"><a href="#2-导入数据" class="headerlink" title="2. 导入数据"></a>2. 导入数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建 zabbix_proxy 数据库</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> zabbix_proxy <span class="built_in">character</span> <span class="keyword">set</span> utf8 <span class="keyword">collate</span> utf8_bin;</span><br><span class="line"><span class="comment">--授权</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> zabbix_proxy.* <span class="keyword">to</span> zabbix@localhost <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'password'</span>;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zcat /usr/share/doc/zabbix-proxy-mysql/schema.sql.gz | mysql -uzabbix -pzabbix zabbix</span><br></pre></td></tr></table></figure><h2 id="3-更改配置"><a href="#3-更改配置" class="headerlink" title="3. 更改配置"></a>3. 更改配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/zabbix/zabbix_proxy.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Server&#x3D;192.168.6.30</span><br><span class="line">Hostname&#x3D;Zabbix proxy</span><br><span class="line">LogFile&#x3D;&#x2F;var&#x2F;log&#x2F;zabbix&#x2F;zabbix_proxy.log</span><br><span class="line">LogFileSize&#x3D;0</span><br><span class="line">PidFile&#x3D;&#x2F;var&#x2F;run&#x2F;zabbix&#x2F;zabbix_proxy.pid</span><br><span class="line">SocketDir&#x3D;&#x2F;var&#x2F;run&#x2F;zabbix</span><br><span class="line">DBName&#x3D;zabbix</span><br><span class="line">DBUser&#x3D;zabbix</span><br><span class="line">DBPassword&#x3D;zabbix</span><br><span class="line">ConfigFrequency&#x3D;120</span><br><span class="line">DataSenderFrequency&#x3D;1</span><br><span class="line">SNMPTrapperFile&#x3D;&#x2F;var&#x2F;log&#x2F;snmptrap&#x2F;snmptrap.log</span><br><span class="line">Timeout&#x3D;30</span><br><span class="line">ExternalScripts&#x3D;&#x2F;usr&#x2F;lib&#x2F;zabbix&#x2F;externalscripts</span><br><span class="line">FpingLocation&#x3D;&#x2F;usr&#x2F;bin&#x2F;fping</span><br><span class="line">Fping6Location&#x3D;&#x2F;usr&#x2F;bin&#x2F;fping6</span><br><span class="line">LogSlowQueries&#x3D;3000</span><br></pre></td></tr></table></figure><h2 id="4-启动服务并设置开机启动"><a href="#4-启动服务并设置开机启动" class="headerlink" title="4. 启动服务并设置开机启动"></a>4. 启动服务并设置开机启动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> zabbix-proxy zabbix-agent mysql</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> monitor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zabbix 安装指南</title>
      <link href="2018/11/17/zabbix_installation/"/>
      <url>2018/11/17/zabbix_installation/</url>
      
        <content type="html"><![CDATA[<p>Zabbix 3.4 安装指南</p><a id="more"></a><h2 id="CentOS-安装-zabbix3-4"><a href="#CentOS-安装-zabbix3-4" class="headerlink" title="CentOS 安装 zabbix3.4"></a>CentOS 安装 zabbix3.4</h2><h3 id="1-准备"><a href="#1-准备" class="headerlink" title="1. 准备"></a>1. 准备</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -i http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpm</span><br><span class="line">yum install zabbix-server-mysql zabbix-web-mysql zabbix-agent</span><br><span class="line">yum -y install php-fpm php php-mysql php-gd php-bcmath php-mbstring php-xml php-ldap</span><br></pre></td></tr></table></figure><h3 id="2-设置数据库"><a href="#2-设置数据库" class="headerlink" title="2. 设置数据库"></a>2. 设置数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;bin&#x2F;mysqladmin -u root password 123456</span><br><span class="line">mysql -uroot -p</span><br><span class="line">password</span><br><span class="line">mysql&gt; create database zabbix character set utf8 collate utf8_bin;</span><br><span class="line">mysql&gt; grant all privileges on zabbix.* to zabbix@localhost identified by &#39;zabbix&#39;;</span><br><span class="line">mysql&gt; quit;</span><br></pre></td></tr></table></figure><h3 id="3-数据库导入数据"><a href="#3-数据库导入数据" class="headerlink" title="3. 数据库导入数据"></a>3. 数据库导入数据</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -p zabbix</span><br></pre></td></tr></table></figure><h3 id="4-修改-zabbix-配置文件增加-DBPassword-zabbix"><a href="#4-修改-zabbix-配置文件增加-DBPassword-zabbix" class="headerlink" title="4. 修改 zabbix 配置文件增加 DBPassword=zabbix"></a>4. 修改 zabbix 配置文件增加 DBPassword=zabbix</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/zabbix/zabbix_server.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DBPassword&#x3D;zabbix</span><br></pre></td></tr></table></figure><h3 id="5-将时区设置为：亚洲-上海"><a href="#5-将时区设置为：亚洲-上海" class="headerlink" title="5. 将时区设置为：亚洲/上海"></a>5. 将时区设置为：亚洲/上海</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf.d/zabbix.conf</span><br><span class="line">php_value date.timezone Asia/Shanghai</span><br></pre></td></tr></table></figure><h3 id="6-启动服务，将服务设为开机启动"><a href="#6-启动服务，将服务设为开机启动" class="headerlink" title="6. 启动服务，将服务设为开机启动"></a>6. 启动服务，将服务设为开机启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart zabbix-server zabbix-agent httpd</span><br><span class="line">systemctl enable zabbix-server zabbix-agent httpd</span><br></pre></td></tr></table></figure><h3 id="7-修改默认语言，文字配置"><a href="#7-修改默认语言，文字配置" class="headerlink" title="7. 修改默认语言，文字配置"></a>7. 修改默认语言，文字配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;usr&#x2F;share&#x2F;zabbix&#x2F;include&#x2F;locales.inc.php</span><br><span class="line">cp simkai.ttf &#x2F;usr&#x2F;share&#x2F;zabbix&#x2F;fonts&#x2F;</span><br><span class="line">vim &#x2F;usr&#x2F;share&#x2F;zabbix&#x2F;include&#x2F;defines.inc.php</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> monitor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zabbix 通过 jmx 监控 Tomcat</title>
      <link href="2018/11/16/zabbix_jmx/"/>
      <url>2018/11/16/zabbix_jmx/</url>
      
        <content type="html"><![CDATA[<p>Zabbix 通过 jmx 监控 Tomcat</p><a id="more"></a><h2 id="1-安装-jdk-和-zabbix-java-gateway"><a href="#1-安装-jdk-和-zabbix-java-gateway" class="headerlink" title="1. 安装 jdk 和 zabbix-java-gateway"></a>1. 安装 jdk 和 zabbix-java-gateway</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 openjdk 或者下载 tar.gz</span></span><br><span class="line">apt install openjdk-8-jdk</span><br><span class="line"><span class="comment"># 安装 zabbix-java-gateway</span></span><br><span class="line">apt install zabbix-java-gateway</span><br></pre></td></tr></table></figure><h2 id="2-修改服务器端配置"><a href="#2-修改服务器端配置" class="headerlink" title="2. 修改服务器端配置"></a>2. 修改服务器端配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;zabbix&#x2F;zabbix_server.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JavaGateway&#x3D;192.168.6.30</span><br><span class="line">JavaGatewayPort&#x3D;10052</span><br><span class="line">StartJavaPollers&#x3D;50</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart zabbix-server</span><br><span class="line">systemctl start zabbix-java-gateway</span><br><span class="line">systemctl <span class="built_in">enable</span> zabbix-java-gateway</span><br></pre></td></tr></table></figure><h2 id="3-配置被监控-tomcat"><a href="#3-配置被监控-tomcat" class="headerlink" title="3. 配置被监控 tomcat"></a>3. 配置被监控 tomcat</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /tomcat/bin/catalina.sh</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CATALINA_OPTS=<span class="string">"-Djava.rmi.server.hostname=&lt; 被监控 tomcat 主机 IP 地址 &gt; -Djavax.management.builder.initial= -Dcom.sun.management.jmxremote=true -Dcom.sun.management.jmxremote.port=12345 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false"</span></span><br></pre></td></tr></table></figure><p>更改完成之后重启 tomcat 应用</p><h2 id="4-zabbix-web-配置"><a href="#4-zabbix-web-配置" class="headerlink" title="4. zabbix web 配置"></a>4. zabbix web 配置</h2><ul><li>添加被监控 tomcat</li></ul>]]></content>
      
      
      <categories>
          
          <category> monitor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> tomcat </tag>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zabbix 通过 SNMP 进行监控</title>
      <link href="2018/11/15/zabbix_snmp/"/>
      <url>2018/11/15/zabbix_snmp/</url>
      
        <content type="html"><![CDATA[<p>Zabbix 通过 SNMP 进行监控</p><a id="more"></a><h1 id="SNMP-监控-Linux"><a href="#SNMP-监控-Linux" class="headerlink" title="SNMP 监控 Linux"></a>SNMP 监控 Linux</h1><h2 id="1-被监控主机安装-net-snmp"><a href="#1-被监控主机安装-net-snmp" class="headerlink" title="1. 被监控主机安装 net-snmp"></a>1. 被监控主机安装 net-snmp</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]# yum install -y net-snmp</span><br></pre></td></tr></table></figure><h2 id="2-修改配置文件"><a href="#2-修改配置文件" class="headerlink" title="2. 修改配置文件"></a>2. 修改配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]# vim &#x2F;etc&#x2F;snmp&#x2F;snmpd.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># sec.name  source          community</span><br><span class="line">com2sec notConfigUser  default       public</span><br><span class="line"></span><br><span class="line">view    systemview    included   .1</span><br><span class="line">view    systemview    included   .1.3.6.1.2.1.1</span><br><span class="line">view    systemview    included   .1.3.6.1.2.1.25.1.1</span><br></pre></td></tr></table></figure><h2 id="3-启动"><a href="#3-启动" class="headerlink" title="3. 启动"></a>3. 启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]# systemctl start snmpd.service</span><br><span class="line">[root@client ~]# netstat -nlp | grep 161</span><br></pre></td></tr></table></figure><h2 id="4-在-zabbix-server-上测试"><a href="#4-在-zabbix-server-上测试" class="headerlink" title="4. 在 zabbix server 上测试"></a>4. 在 zabbix server 上测试</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix ~]# yum install -y net-snmp</span><br><span class="line">[root@zabbix ~]# snmpwalk -v 2c -c zabbix 192.168.1.51 | wc -l</span><br></pre></td></tr></table></figure><h2 id="5-zabbix的web界面添加主机"><a href="#5-zabbix的web界面添加主机" class="headerlink" title="5. zabbix的web界面添加主机"></a>5. zabbix的web界面添加主机</h2><ul><li>添加模板</li></ul><p><img src="!--%EF%BF%BC15--" alt=""></p><ul><li>设置 communities</li></ul><p><img src="!--%EF%BF%BC16--" alt=""></p><h1 id="SNMP-监控-ESXI"><a href="#SNMP-监控-ESXI" class="headerlink" title="SNMP 监控 ESXI"></a>SNMP 监控 ESXI</h1><h2 id="1-开启-ESXI-的-SNMP-服务（允许所有主机访问）"><a href="#1-开启-ESXI-的-SNMP-服务（允许所有主机访问）" class="headerlink" title="1. 开启 ESXI 的 SNMP 服务（允许所有主机访问）"></a>1. 开启 ESXI 的 SNMP 服务（允许所有主机访问）</h2><ul><li>设置 communities</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi:~] esxcli system snmp set --communities public</span><br></pre></td></tr></table></figure><ul><li>开启 SNMP 服务</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi:~] esxcli system snmp set --enable true</span><br></pre></td></tr></table></figure><ul><li>允许所有主机访问 SNMP</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi:~] esxcli network firewall ruleset set --ruleset-id snmp --allowed-all true</span><br><span class="line">Already allowed all ip</span><br></pre></td></tr></table></figure><ul><li>设置防火墙</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi:~] esxcli network firewall ruleset set --ruleset-id snmp --enabled true</span><br></pre></td></tr></table></figure><ul><li>重启 SNMP 服务</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi:~] &#x2F;etc&#x2F;init.d&#x2F;snmpd restart</span><br><span class="line">root: snmpd Running from interactive shell, running command: esxcli system snmp set -e false.</span><br><span class="line">root: snmpd setting up resource reservations.</span><br><span class="line">root: snmpd opening firewall port(s) for notifications.</span><br><span class="line">root: snmpd watchdog for snmpd started.</span><br></pre></td></tr></table></figure><h2 id="2-开启-ESXI-主机的-SNMP-服务（允许特定主机访问）"><a href="#2-开启-ESXI-主机的-SNMP-服务（允许特定主机访问）" class="headerlink" title="2. 开启 ESXI 主机的 SNMP 服务（允许特定主机访问）"></a>2. 开启 ESXI 主机的 SNMP 服务（允许特定主机访问）</h2><ul><li>禁止所有主机访问 SNMP</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi:~] esxcli network firewall ruleset set --ruleset-id snmp --allowed-all false</span><br></pre></td></tr></table></figure><ul><li>设置防火墙</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi:~] esxcli network firewall ruleset allowedip add --ruleset-id snmp --ip-address 10.0.101.0&#x2F;24</span><br><span class="line">[root@esxi:~] esxcli network firewall ruleset set --ruleset-id snmp --enabled true</span><br></pre></td></tr></table></figure><ul><li>重启 SNMP 服务</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@esxi:~] &#x2F;etc&#x2F;init.d&#x2F;snmpd restart</span><br></pre></td></tr></table></figure><h2 id="3-测试是否能获取-SNMP-数据"><a href="#3-测试是否能获取-SNMP-数据" class="headerlink" title="3. 测试是否能获取 SNMP 数据"></a>3. 测试是否能获取 SNMP 数据</h2><ul><li>在其他服务器上安装 SNMP</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix ~]# yum -y install net-snmp net-snmp-utils net-snmp-devel</span><br></pre></td></tr></table></figure><ul><li>测试获取信息</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix ~]# snmpwalk -v 2c -c sunwoda 192.168.9.24:161 | wc -l</span><br><span class="line">4594</span><br></pre></td></tr></table></figure><h2 id="4-Zabbix-添加主机"><a href="#4-Zabbix-添加主机" class="headerlink" title="4. Zabbix 添加主机"></a>4. Zabbix 添加主机</h2><ul><li>添加模板</li></ul><p><img src="!--%EF%BF%BC17--" alt=""></p><ul><li>设置 communities</li></ul><p><img src="!--%EF%BF%BC18--" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zabbix 企业微信告警</title>
      <link href="2018/11/14/zabbix_wechat_alert/"/>
      <url>2018/11/14/zabbix_wechat_alert/</url>
      
        <content type="html"><![CDATA[<p>使用 python 编写 Zabbix 企业微信告警脚本</p><a id="more"></a><h2 id="1-编辑-zabbix-server-conf-配置-zabbix-告警脚本路径"><a href="#1-编辑-zabbix-server-conf-配置-zabbix-告警脚本路径" class="headerlink" title="1. 编辑 zabbix_server.conf 配置 zabbix 告警脚本路径"></a>1. 编辑 zabbix_server.conf 配置 zabbix 告警脚本路径</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AlertScriptsPath&#x3D;&#x2F;usr&#x2F;local&#x2F;share&#x2F;zabbix&#x2F;alertscripts&#x2F;</span><br></pre></td></tr></table></figure><h2 id="2-创建发送消息脚本"><a href="#2-创建发送消息脚本" class="headerlink" title="2. 创建发送消息脚本"></a>2. 创建发送消息脚本</h2><ul><li>编写脚本 vim wechat.py</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># 基本信息</span></span><br><span class="line">CropID = <span class="string">'xxxxxxxxxx'</span></span><br><span class="line">Secret = <span class="string">'xxxxxxxxxx'</span></span><br><span class="line">agentid = <span class="string">'xxxxxxxxx'</span></span><br><span class="line">touser = <span class="string">'xxxxxxxxxx'</span> </span><br><span class="line"><span class="comment"># 获取Token</span></span><br><span class="line">GetToken =<span class="string">"https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid="</span>+ CropID + <span class="string">"&amp;corpsecret="</span> + Secret</span><br><span class="line">headers = &#123;<span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>&#125;</span><br><span class="line">json_data = json.loads(requests.get(GetToken).content.decode())</span><br><span class="line">token = json_data[<span class="string">"access_token"</span>]</span><br><span class="line"><span class="comment"># 消息发送接口</span></span><br><span class="line">Purl = <span class="string">"https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token="</span> + token</span><br><span class="line"><span class="comment"># 消息发送函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendmsg</span><span class="params">(message)</span>:</span></span><br><span class="line">    weixin_msg = &#123;</span><br><span class="line">        <span class="string">"touser"</span> : <span class="string">"TangYingJie"</span>,         </span><br><span class="line">        <span class="string">"msgtype"</span> : <span class="string">"text"</span>,</span><br><span class="line">        <span class="string">"agentid"</span> : <span class="number">1000002</span>,</span><br><span class="line">        <span class="string">"text"</span> : &#123;</span><br><span class="line">            <span class="string">"content"</span> : message</span><br><span class="line">         &#125;,</span><br><span class="line">     &#125;</span><br><span class="line">    <span class="keyword">print</span> requests.post(Purl,json.dumps(weixin_msg),headers=headers)</span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    message = sys.argv[<span class="number">1</span>]      <span class="comment">#获取第二个参数</span></span><br><span class="line">    sendmsg(message)</span><br></pre></td></tr></table></figure><ul><li>测试脚本发送消息</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;wechat.py 测试消息</span><br></pre></td></tr></table></figure><h2 id="3-进入-zabbix-主界面配置"><a href="#3-进入-zabbix-主界面配置" class="headerlink" title="3. 进入 zabbix 主界面配置"></a>3. 进入 zabbix 主界面配置</h2><h3 id="报警媒介类型"><a href="#报警媒介类型" class="headerlink" title="报警媒介类型"></a>报警媒介类型</h3><p><img src="!--%EF%BF%BC5--" alt=""></p><h3 id="用户-gt-报警媒介"><a href="#用户-gt-报警媒介" class="headerlink" title="用户 -&gt; 报警媒介"></a>用户 -&gt; 报警媒介</h3><p><img src="!--%EF%BF%BC6--" alt=""></p><h3 id="动作-gt-操作"><a href="#动作-gt-操作" class="headerlink" title="动作 -&gt; 操作"></a>动作 -&gt; 操作</h3><p><img src="!--%EF%BF%BC7--" alt=""></p><ul><li>默认接收人</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;TRIGGER.STATUS&#125; : &#123;TRIGGER.NAME&#125;</span><br></pre></td></tr></table></figure><ul><li>默认信息</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">当前状态 : &#123;TRIGGER.STATUS&#125;</span><br><span class="line">告警主机 : &#123;HOST.NAME&#125;</span><br><span class="line">告警地址 : &#123;HOST.IP&#125;</span><br><span class="line">告警时间 : &#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;</span><br><span class="line">告警等级 : &#123;TRIGGER.SEVERITY&#125;</span><br><span class="line">告警信息 : &#123;TRIGGER.NAME&#125;</span><br><span class="line">监控取值 : &#123;ITEM.VALUE&#125;</span><br><span class="line">监控项目 : &#123;ITEM.NAME&#125;</span><br><span class="line">持续时间 : &#123;EVENT.AGE&#125;</span><br><span class="line">事件ID : &#123;ITEM.ID&#125;</span><br></pre></td></tr></table></figure><h3 id="动作-gt-恢复操作"><a href="#动作-gt-恢复操作" class="headerlink" title="动作 -&gt; 恢复操作"></a>动作 -&gt; 恢复操作</h3><p><img src="!--%EF%BF%BC8--" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> monitor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
